2025-09-10T08:29:19.0665421Z Current runner version: '2.328.0'
2025-09-10T08:29:19.0690861Z ##[group]Runner Image Provisioner
2025-09-10T08:29:19.0691794Z Hosted Compute Agent
2025-09-10T08:29:19.0692352Z Version: 20250829.383
2025-09-10T08:29:19.0692920Z Commit: 27cb235aab5b0e52e153a26cd86b4742e89dac5d
2025-09-10T08:29:19.0693733Z Build Date: 2025-08-29T13:48:48Z
2025-09-10T08:29:19.0694307Z ##[endgroup]
2025-09-10T08:29:19.0694871Z ##[group]Operating System
2025-09-10T08:29:19.0695429Z Ubuntu
2025-09-10T08:29:19.0695927Z 24.04.3
2025-09-10T08:29:19.0696349Z LTS
2025-09-10T08:29:19.0696856Z ##[endgroup]
2025-09-10T08:29:19.0697392Z ##[group]Runner Image
2025-09-10T08:29:19.0698140Z Image: ubuntu-24.04
2025-09-10T08:29:19.0698865Z Version: 20250907.24.1
2025-09-10T08:29:19.0699854Z Included Software: https://github.com/actions/runner-images/blob/ubuntu24/20250907.24/images/ubuntu/Ubuntu2404-Readme.md
2025-09-10T08:29:19.0701502Z Image Release: https://github.com/actions/runner-images/releases/tag/ubuntu24%2F20250907.24
2025-09-10T08:29:19.0702534Z ##[endgroup]
2025-09-10T08:29:19.0703621Z ##[group]GITHUB_TOKEN Permissions
2025-09-10T08:29:19.0705995Z Contents: read
2025-09-10T08:29:19.0706525Z Metadata: read
2025-09-10T08:29:19.0707090Z Packages: read
2025-09-10T08:29:19.0707583Z ##[endgroup]
2025-09-10T08:29:19.0710143Z Secret source: Actions
2025-09-10T08:29:19.0711135Z Prepare workflow directory
2025-09-10T08:29:19.1132411Z Prepare all required actions
2025-09-10T08:29:19.1169594Z Getting action download info
2025-09-10T08:29:19.4588731Z Download action repository 'actions/checkout@v4' (SHA:08eba0b27e820071cde6df949e0beb9ba4906955)
2025-09-10T08:29:19.5327420Z Download action repository 'actions/setup-node@v4' (SHA:49933ea5288caeca8642d1e84afbd3f7d6820020)
2025-09-10T08:29:19.6253522Z Download action repository 'pnpm/action-setup@v4' (SHA:a7487c7e89a18df4991f7f222e4898a00d66ddda)
2025-09-10T08:29:19.9933020Z Complete job name: build
2025-09-10T08:29:20.0452923Z ##[group]Checking docker version
2025-09-10T08:29:20.0466022Z ##[command]/usr/bin/docker version --format '{{.Server.APIVersion}}'
2025-09-10T08:29:20.1298643Z '1.48'
2025-09-10T08:29:20.1309955Z Docker daemon API version: '1.48'
2025-09-10T08:29:20.1311329Z ##[command]/usr/bin/docker version --format '{{.Client.APIVersion}}'
2025-09-10T08:29:20.1472778Z '1.48'
2025-09-10T08:29:20.1487096Z Docker client API version: '1.48'
2025-09-10T08:29:20.1493299Z ##[endgroup]
2025-09-10T08:29:20.1497871Z ##[group]Clean up resources from previous jobs
2025-09-10T08:29:20.1505235Z ##[command]/usr/bin/docker ps --all --quiet --no-trunc --filter "label=168c69"
2025-09-10T08:29:20.1648388Z ##[command]/usr/bin/docker network prune --force --filter "label=168c69"
2025-09-10T08:29:20.1773007Z ##[endgroup]
2025-09-10T08:29:20.1773587Z ##[group]Create local container network
2025-09-10T08:29:20.1784071Z ##[command]/usr/bin/docker network create --label 168c69 github_network_aa2edaaa637e473c89f2582ba465e42a
2025-09-10T08:29:20.2262670Z eb055be0974914cbbe749b598594c7d10eec005be63610a4bce6a62c911224b6
2025-09-10T08:29:20.2281020Z ##[endgroup]
2025-09-10T08:29:20.2304947Z ##[group]Starting postgres service container
2025-09-10T08:29:20.2324638Z ##[command]/usr/bin/docker pull postgres:15-alpine
2025-09-10T08:29:20.4894489Z 15-alpine: Pulling from library/postgres
2025-09-10T08:29:20.5639770Z 9824c27679d3: Pulling fs layer
2025-09-10T08:29:20.5641070Z 45222bf54768: Pulling fs layer
2025-09-10T08:29:20.5642327Z cc455ce33b7a: Pulling fs layer
2025-09-10T08:29:20.5643599Z 6e59367d2e76: Pulling fs layer
2025-09-10T08:29:20.5644808Z a9186699d5f8: Pulling fs layer
2025-09-10T08:29:20.5646054Z 90793d70c9dc: Pulling fs layer
2025-09-10T08:29:20.5647098Z d97eb1910934: Pulling fs layer
2025-09-10T08:29:20.5648205Z 8a4d728ab743: Pulling fs layer
2025-09-10T08:29:20.5649057Z cb75953ddf8d: Pulling fs layer
2025-09-10T08:29:20.5649888Z 4c5335ab75e4: Pulling fs layer
2025-09-10T08:29:20.5650767Z 02c858cee38f: Pulling fs layer
2025-09-10T08:29:20.5651608Z 6e59367d2e76: Waiting
2025-09-10T08:29:20.5652358Z d97eb1910934: Waiting
2025-09-10T08:29:20.5653400Z 8a4d728ab743: Waiting
2025-09-10T08:29:20.5654185Z cb75953ddf8d: Waiting
2025-09-10T08:29:20.5654968Z 4c5335ab75e4: Waiting
2025-09-10T08:29:20.5655748Z a9186699d5f8: Waiting
2025-09-10T08:29:20.5656508Z 90793d70c9dc: Waiting
2025-09-10T08:29:20.6710893Z 45222bf54768: Verifying Checksum
2025-09-10T08:29:20.6712585Z 45222bf54768: Download complete
2025-09-10T08:29:20.6999819Z 9824c27679d3: Verifying Checksum
2025-09-10T08:29:20.7001817Z 9824c27679d3: Download complete
2025-09-10T08:29:20.7160867Z cc455ce33b7a: Download complete
2025-09-10T08:29:20.7441696Z 6e59367d2e76: Verifying Checksum
2025-09-10T08:29:20.7443369Z 6e59367d2e76: Download complete
2025-09-10T08:29:20.7807808Z a9186699d5f8: Verifying Checksum
2025-09-10T08:29:20.7810900Z a9186699d5f8: Download complete
2025-09-10T08:29:20.8126260Z 9824c27679d3: Pull complete
2025-09-10T08:29:20.8142342Z d97eb1910934: Verifying Checksum
2025-09-10T08:29:20.8149018Z d97eb1910934: Download complete
2025-09-10T08:29:20.8493819Z 45222bf54768: Pull complete
2025-09-10T08:29:20.8655091Z 8a4d728ab743: Verifying Checksum
2025-09-10T08:29:20.8660720Z 8a4d728ab743: Download complete
2025-09-10T08:29:20.8864804Z cb75953ddf8d: Verifying Checksum
2025-09-10T08:29:20.8868666Z cb75953ddf8d: Download complete
2025-09-10T08:29:20.8947046Z cc455ce33b7a: Pull complete
2025-09-10T08:29:20.9131334Z 6e59367d2e76: Pull complete
2025-09-10T08:29:20.9328362Z a9186699d5f8: Pull complete
2025-09-10T08:29:20.9461216Z 4c5335ab75e4: Download complete
2025-09-10T08:29:20.9567111Z 02c858cee38f: Download complete
2025-09-10T08:29:21.3697047Z 90793d70c9dc: Verifying Checksum
2025-09-10T08:29:21.3699018Z 90793d70c9dc: Download complete
2025-09-10T08:29:23.6271933Z 90793d70c9dc: Pull complete
2025-09-10T08:29:23.6405903Z d97eb1910934: Pull complete
2025-09-10T08:29:23.6515621Z 8a4d728ab743: Pull complete
2025-09-10T08:29:23.6626001Z cb75953ddf8d: Pull complete
2025-09-10T08:29:23.6737397Z 4c5335ab75e4: Pull complete
2025-09-10T08:29:23.6834265Z 02c858cee38f: Pull complete
2025-09-10T08:29:23.6876257Z Digest: sha256:dfcf0459185089e88a43197975780f5a3078acd5ece84824a14c9d6fbbab02d0
2025-09-10T08:29:23.6891690Z Status: Downloaded newer image for postgres:15-alpine
2025-09-10T08:29:23.6903561Z docker.io/library/postgres:15-alpine
2025-09-10T08:29:23.6964248Z ##[command]/usr/bin/docker create --name 8aa5bf64f2a2455aa0a50299e31d5cf1_postgres15alpine_969090 --label 168c69 --network github_network_aa2edaaa637e473c89f2582ba465e42a --network-alias postgres -p 5496:5432 --health-cmd pg_isready --health-interval 10s --health-timeout 5s --health-retries 5 -e "POSTGRES_USER=speakeasy" -e "POSTGRES_PASSWORD=speakeasy" -e "POSTGRES_DB=speakeasy" -e GITHUB_ACTIONS=true -e CI=true postgres:15-alpine
2025-09-10T08:29:23.7212567Z 740d372ee3f147e6cbc4957c2aba839dfe922d79340b25e1219e3bef33eed394
2025-09-10T08:29:23.7234523Z ##[command]/usr/bin/docker start 740d372ee3f147e6cbc4957c2aba839dfe922d79340b25e1219e3bef33eed394
2025-09-10T08:29:24.0066216Z 740d372ee3f147e6cbc4957c2aba839dfe922d79340b25e1219e3bef33eed394
2025-09-10T08:29:24.0089251Z ##[command]/usr/bin/docker ps --all --filter id=740d372ee3f147e6cbc4957c2aba839dfe922d79340b25e1219e3bef33eed394 --filter status=running --no-trunc --format "{{.ID}} {{.Status}}"
2025-09-10T08:29:24.0218452Z 740d372ee3f147e6cbc4957c2aba839dfe922d79340b25e1219e3bef33eed394 Up Less than a second (health: starting)
2025-09-10T08:29:24.0240705Z ##[command]/usr/bin/docker port 740d372ee3f147e6cbc4957c2aba839dfe922d79340b25e1219e3bef33eed394
2025-09-10T08:29:24.0373203Z 5432/tcp -> 0.0.0.0:5496
2025-09-10T08:29:24.0374832Z 5432/tcp -> [::]:5496
2025-09-10T08:29:24.0423566Z ##[endgroup]
2025-09-10T08:29:24.0424510Z ##[group]Starting localstack service container
2025-09-10T08:29:24.0425907Z ##[command]/usr/bin/docker pull localstack/localstack:latest
2025-09-10T08:29:24.2366268Z latest: Pulling from localstack/localstack
2025-09-10T08:29:24.3043908Z af7c915c8849: Pulling fs layer
2025-09-10T08:29:24.3044822Z 38b81130a831: Pulling fs layer
2025-09-10T08:29:24.3046280Z f68adc1d13a4: Pulling fs layer
2025-09-10T08:29:24.3049920Z 6892a96cf1e5: Pulling fs layer
2025-09-10T08:29:24.3050450Z 369dd9458268: Pulling fs layer
2025-09-10T08:29:24.3051134Z 8fe80e6175d3: Pulling fs layer
2025-09-10T08:29:24.3051513Z 112bf680eacb: Pulling fs layer
2025-09-10T08:29:24.3051876Z 874121c97d56: Pulling fs layer
2025-09-10T08:29:24.3052278Z 4f4fb700ef54: Pulling fs layer
2025-09-10T08:29:24.3052624Z c7df4744c2c8: Pulling fs layer
2025-09-10T08:29:24.3052955Z 51848b409747: Pulling fs layer
2025-09-10T08:29:24.3053271Z 65c30dcad9de: Pulling fs layer
2025-09-10T08:29:24.3053493Z 0691e9d04447: Pulling fs layer
2025-09-10T08:29:24.3053696Z c395b363acc6: Pulling fs layer
2025-09-10T08:29:24.3053934Z d376986ceb33: Pulling fs layer
2025-09-10T08:29:24.3054143Z 7d2cbfa8f55b: Pulling fs layer
2025-09-10T08:29:24.3054337Z 1b02ee0d6014: Pulling fs layer
2025-09-10T08:29:24.3054557Z 0c1acf3e383d: Pulling fs layer
2025-09-10T08:29:24.3054774Z 8e980bbd5c4f: Pulling fs layer
2025-09-10T08:29:24.3054968Z 542568727558: Pulling fs layer
2025-09-10T08:29:24.3055175Z bab12299beb2: Pulling fs layer
2025-09-10T08:29:24.3055373Z 52ea0c0047c4: Pulling fs layer
2025-09-10T08:29:24.3055585Z 5b4fd9e49bb8: Pulling fs layer
2025-09-10T08:29:24.3055774Z 216785c39be4: Pulling fs layer
2025-09-10T08:29:24.3055963Z 0691e9d04447: Waiting
2025-09-10T08:29:24.3056139Z c395b363acc6: Waiting
2025-09-10T08:29:24.3056321Z d376986ceb33: Waiting
2025-09-10T08:29:24.3056486Z 7d2cbfa8f55b: Waiting
2025-09-10T08:29:24.3056654Z 1b02ee0d6014: Waiting
2025-09-10T08:29:24.3056814Z 0c1acf3e383d: Waiting
2025-09-10T08:29:24.3056983Z 8e980bbd5c4f: Waiting
2025-09-10T08:29:24.3057149Z 542568727558: Waiting
2025-09-10T08:29:24.3057307Z bab12299beb2: Waiting
2025-09-10T08:29:24.3057626Z 52ea0c0047c4: Waiting
2025-09-10T08:29:24.3057823Z 5b4fd9e49bb8: Waiting
2025-09-10T08:29:24.3058245Z 216785c39be4: Waiting
2025-09-10T08:29:24.3058664Z 874121c97d56: Waiting
2025-09-10T08:29:24.3058855Z 4f4fb700ef54: Waiting
2025-09-10T08:29:24.3059021Z c7df4744c2c8: Waiting
2025-09-10T08:29:24.3059200Z 51848b409747: Waiting
2025-09-10T08:29:24.3059370Z 65c30dcad9de: Waiting
2025-09-10T08:29:24.3059531Z 6892a96cf1e5: Waiting
2025-09-10T08:29:24.3059700Z 369dd9458268: Waiting
2025-09-10T08:29:24.3059860Z 8fe80e6175d3: Waiting
2025-09-10T08:29:24.3060028Z 112bf680eacb: Waiting
2025-09-10T08:29:24.4406140Z 38b81130a831: Verifying Checksum
2025-09-10T08:29:24.4411157Z 38b81130a831: Download complete
2025-09-10T08:29:24.5133184Z 6892a96cf1e5: Download complete
2025-09-10T08:29:24.5255935Z af7c915c8849: Verifying Checksum
2025-09-10T08:29:24.5256699Z af7c915c8849: Download complete
2025-09-10T08:29:24.5427636Z f68adc1d13a4: Verifying Checksum
2025-09-10T08:29:24.5428514Z f68adc1d13a4: Download complete
2025-09-10T08:29:24.6204879Z 112bf680eacb: Verifying Checksum
2025-09-10T08:29:24.6214198Z 112bf680eacb: Download complete
2025-09-10T08:29:24.7003920Z 874121c97d56: Verifying Checksum
2025-09-10T08:29:24.7004511Z 874121c97d56: Download complete
2025-09-10T08:29:24.7936325Z 4f4fb700ef54: Verifying Checksum
2025-09-10T08:29:24.7936965Z 4f4fb700ef54: Download complete
2025-09-10T08:29:24.8733737Z c7df4744c2c8: Download complete
2025-09-10T08:29:24.9499440Z 51848b409747: Verifying Checksum
2025-09-10T08:29:24.9500858Z 51848b409747: Download complete
2025-09-10T08:29:25.0398563Z 65c30dcad9de: Download complete
2025-09-10T08:29:25.0884403Z 8fe80e6175d3: Verifying Checksum
2025-09-10T08:29:25.0884925Z 8fe80e6175d3: Download complete
2025-09-10T08:29:25.4187135Z 369dd9458268: Download complete
2025-09-10T08:29:25.5252803Z d376986ceb33: Download complete
2025-09-10T08:29:25.6041737Z 7d2cbfa8f55b: Verifying Checksum
2025-09-10T08:29:25.6042442Z 7d2cbfa8f55b: Download complete
2025-09-10T08:29:25.7115883Z 1b02ee0d6014: Verifying Checksum
2025-09-10T08:29:25.7116352Z 1b02ee0d6014: Download complete
2025-09-10T08:29:25.7881848Z 0c1acf3e383d: Download complete
2025-09-10T08:29:25.9117794Z 8e980bbd5c4f: Verifying Checksum
2025-09-10T08:29:25.9118437Z 8e980bbd5c4f: Download complete
2025-09-10T08:29:25.9149026Z c395b363acc6: Verifying Checksum
2025-09-10T08:29:25.9149452Z c395b363acc6: Download complete
2025-09-10T08:29:25.9646002Z af7c915c8849: Pull complete
2025-09-10T08:29:25.9938242Z 542568727558: Verifying Checksum
2025-09-10T08:29:25.9938671Z 542568727558: Download complete
2025-09-10T08:29:26.0400844Z 0691e9d04447: Verifying Checksum
2025-09-10T08:29:26.0414064Z 0691e9d04447: Download complete
2025-09-10T08:29:26.0913643Z 52ea0c0047c4: Download complete
2025-09-10T08:29:26.1417862Z 5b4fd9e49bb8: Verifying Checksum
2025-09-10T08:29:26.1420024Z 5b4fd9e49bb8: Download complete
2025-09-10T08:29:26.2721962Z 216785c39be4: Download complete
2025-09-10T08:29:26.6746363Z bab12299beb2: Download complete
2025-09-10T08:29:27.1768602Z 38b81130a831: Pull complete
2025-09-10T08:29:27.8763897Z f68adc1d13a4: Pull complete
2025-09-10T08:29:27.8877860Z 6892a96cf1e5: Pull complete
2025-09-10T08:29:29.5848693Z 369dd9458268: Pull complete
2025-09-10T08:29:32.1014735Z 8fe80e6175d3: Pull complete
2025-09-10T08:29:32.1115054Z 112bf680eacb: Pull complete
2025-09-10T08:29:32.1228606Z 874121c97d56: Pull complete
2025-09-10T08:29:32.1326506Z 4f4fb700ef54: Pull complete
2025-09-10T08:29:32.1506822Z c7df4744c2c8: Pull complete
2025-09-10T08:29:32.1604028Z 51848b409747: Pull complete
2025-09-10T08:29:32.1728628Z 65c30dcad9de: Pull complete
2025-09-10T08:29:35.0138233Z 0691e9d04447: Pull complete
2025-09-10T08:29:45.8874101Z c395b363acc6: Pull complete
2025-09-10T08:29:45.8990379Z d376986ceb33: Pull complete
2025-09-10T08:29:45.9095129Z 7d2cbfa8f55b: Pull complete
2025-09-10T08:29:46.3005489Z 1b02ee0d6014: Pull complete
2025-09-10T08:29:46.3291591Z 0c1acf3e383d: Pull complete
2025-09-10T08:29:46.8764286Z 8e980bbd5c4f: Pull complete
2025-09-10T08:29:46.8908240Z 542568727558: Pull complete
2025-09-10T08:29:47.6852215Z bab12299beb2: Pull complete
2025-09-10T08:29:47.6976178Z 52ea0c0047c4: Pull complete
2025-09-10T08:29:47.7113126Z 5b4fd9e49bb8: Pull complete
2025-09-10T08:29:47.7215002Z 216785c39be4: Pull complete
2025-09-10T08:29:47.7254841Z Digest: sha256:123e287cb03853a38622f17414691a97fb5a005505c6c9597bef63adb1f8e3ca
2025-09-10T08:29:47.7265953Z Status: Downloaded newer image for localstack/localstack:latest
2025-09-10T08:29:47.7277530Z docker.io/localstack/localstack:latest
2025-09-10T08:29:47.7294801Z ##[command]/usr/bin/docker create --name f73d8c708e4043b0bd7a54c71649e65a_localstacklocalstacklatest_1ba29c --label 168c69 --network github_network_aa2edaaa637e473c89f2582ba465e42a --network-alias localstack -p 4566:4566  -e "SERVICES=s3" -e "DEBUG=1" -e "AWS_ACCESS_KEY_ID=s3_test_key" -e "AWS_SECRET_ACCESS_KEY=s3_test_secret" -e "DEFAULT_REGION=us-east-1" -e GITHUB_ACTIONS=true -e CI=true localstack/localstack:latest
2025-09-10T08:29:47.7537819Z cf2411009a9b5b7c8a72ad0c8e2b62ddd492d94af1e06971cb43de553307fd28
2025-09-10T08:29:47.7551246Z ##[command]/usr/bin/docker start cf2411009a9b5b7c8a72ad0c8e2b62ddd492d94af1e06971cb43de553307fd28
2025-09-10T08:29:47.8895102Z cf2411009a9b5b7c8a72ad0c8e2b62ddd492d94af1e06971cb43de553307fd28
2025-09-10T08:29:47.8930610Z ##[command]/usr/bin/docker ps --all --filter id=cf2411009a9b5b7c8a72ad0c8e2b62ddd492d94af1e06971cb43de553307fd28 --filter status=running --no-trunc --format "{{.ID}} {{.Status}}"
2025-09-10T08:29:47.9070199Z cf2411009a9b5b7c8a72ad0c8e2b62ddd492d94af1e06971cb43de553307fd28 Up Less than a second (health: starting)
2025-09-10T08:29:47.9088238Z ##[command]/usr/bin/docker port cf2411009a9b5b7c8a72ad0c8e2b62ddd492d94af1e06971cb43de553307fd28
2025-09-10T08:29:47.9215458Z 4566/tcp -> 0.0.0.0:4566
2025-09-10T08:29:47.9215873Z 4566/tcp -> [::]:4566
2025-09-10T08:29:47.9230887Z ##[endgroup]
2025-09-10T08:29:47.9241986Z ##[group]Waiting for all services to be ready
2025-09-10T08:29:47.9255420Z ##[command]/usr/bin/docker inspect --format="{{if .Config.Healthcheck}}{{print .State.Health.Status}}{{end}}" 740d372ee3f147e6cbc4957c2aba839dfe922d79340b25e1219e3bef33eed394
2025-09-10T08:29:47.9389857Z healthy
2025-09-10T08:29:47.9411538Z postgres service is healthy.
2025-09-10T08:29:47.9412734Z ##[command]/usr/bin/docker inspect --format="{{if .Config.Healthcheck}}{{print .State.Health.Status}}{{end}}" cf2411009a9b5b7c8a72ad0c8e2b62ddd492d94af1e06971cb43de553307fd28
2025-09-10T08:29:47.9534759Z starting
2025-09-10T08:29:47.9550785Z localstack service is starting, waiting 2 seconds before checking again.
2025-09-10T08:29:49.9553897Z ##[command]/usr/bin/docker inspect --format="{{if .Config.Healthcheck}}{{print .State.Health.Status}}{{end}}" cf2411009a9b5b7c8a72ad0c8e2b62ddd492d94af1e06971cb43de553307fd28
2025-09-10T08:29:49.9670504Z starting
2025-09-10T08:29:49.9684433Z localstack service is starting, waiting 3 seconds before checking again.
2025-09-10T08:29:53.8280020Z ##[command]/usr/bin/docker inspect --format="{{if .Config.Healthcheck}}{{print .State.Health.Status}}{{end}}" cf2411009a9b5b7c8a72ad0c8e2b62ddd492d94af1e06971cb43de553307fd28
2025-09-10T08:29:53.8401998Z healthy
2025-09-10T08:29:53.8418929Z localstack service is healthy.
2025-09-10T08:29:53.8419871Z ##[endgroup]
2025-09-10T08:29:53.8670889Z ##[group]Run actions/checkout@v4
2025-09-10T08:29:53.8671457Z with:
2025-09-10T08:29:53.8671670Z   repository: speakeasy-social/services
2025-09-10T08:29:53.8672078Z   token: ***
2025-09-10T08:29:53.8672268Z   ssh-strict: true
2025-09-10T08:29:53.8672466Z   ssh-user: git
2025-09-10T08:29:53.8672667Z   persist-credentials: true
2025-09-10T08:29:53.8672893Z   clean: true
2025-09-10T08:29:53.8673093Z   sparse-checkout-cone-mode: true
2025-09-10T08:29:53.8673329Z   fetch-depth: 1
2025-09-10T08:29:53.8673519Z   fetch-tags: false
2025-09-10T08:29:53.8673714Z   show-progress: true
2025-09-10T08:29:53.8673910Z   lfs: false
2025-09-10T08:29:53.8674078Z   submodules: false
2025-09-10T08:29:53.8674276Z   set-safe-directory: true
2025-09-10T08:29:53.8674673Z ##[endgroup]
2025-09-10T08:29:53.9738558Z Syncing repository: speakeasy-social/services
2025-09-10T08:29:53.9739817Z ##[group]Getting Git version info
2025-09-10T08:29:53.9740239Z Working directory is '/home/runner/work/services/services'
2025-09-10T08:29:53.9740758Z [command]/usr/bin/git version
2025-09-10T08:29:53.9819808Z git version 2.51.0
2025-09-10T08:29:53.9845055Z ##[endgroup]
2025-09-10T08:29:53.9860356Z Temporarily overriding HOME='/home/runner/work/_temp/dcfc4e95-a535-4dc6-bed2-3ffe1452697f' before making global git config changes
2025-09-10T08:29:53.9861696Z Adding repository directory to the temporary git global config as a safe directory
2025-09-10T08:29:53.9866171Z [command]/usr/bin/git config --global --add safe.directory /home/runner/work/services/services
2025-09-10T08:29:53.9900398Z Deleting the contents of '/home/runner/work/services/services'
2025-09-10T08:29:53.9903851Z ##[group]Initializing the repository
2025-09-10T08:29:53.9908190Z [command]/usr/bin/git init /home/runner/work/services/services
2025-09-10T08:29:53.9987366Z hint: Using 'master' as the name for the initial branch. This default branch name
2025-09-10T08:29:53.9988699Z hint: is subject to change. To configure the initial branch name to use in all
2025-09-10T08:29:53.9989376Z hint: of your new repositories, which will suppress this warning, call:
2025-09-10T08:29:53.9989965Z hint:
2025-09-10T08:29:53.9990282Z hint: 	git config --global init.defaultBranch <name>
2025-09-10T08:29:53.9990670Z hint:
2025-09-10T08:29:53.9991153Z hint: Names commonly chosen instead of 'master' are 'main', 'trunk' and
2025-09-10T08:29:53.9991937Z hint: 'development'. The just-created branch can be renamed via this command:
2025-09-10T08:29:53.9992285Z hint:
2025-09-10T08:29:53.9992463Z hint: 	git branch -m <name>
2025-09-10T08:29:53.9992660Z hint:
2025-09-10T08:29:53.9992947Z hint: Disable this message with "git config set advice.defaultBranchName false"
2025-09-10T08:29:53.9995116Z Initialized empty Git repository in /home/runner/work/services/services/.git/
2025-09-10T08:29:54.0005167Z [command]/usr/bin/git remote add origin https://github.com/speakeasy-social/services
2025-09-10T08:29:54.0039526Z ##[endgroup]
2025-09-10T08:29:54.0040144Z ##[group]Disabling automatic garbage collection
2025-09-10T08:29:54.0044327Z [command]/usr/bin/git config --local gc.auto 0
2025-09-10T08:29:54.0072873Z ##[endgroup]
2025-09-10T08:29:54.0073442Z ##[group]Setting up auth
2025-09-10T08:29:54.0080319Z [command]/usr/bin/git config --local --name-only --get-regexp core\.sshCommand
2025-09-10T08:29:54.0109651Z [command]/usr/bin/git submodule foreach --recursive sh -c "git config --local --name-only --get-regexp 'core\.sshCommand' && git config --local --unset-all 'core.sshCommand' || :"
2025-09-10T08:29:54.0399993Z [command]/usr/bin/git config --local --name-only --get-regexp http\.https\:\/\/github\.com\/\.extraheader
2025-09-10T08:29:54.0428547Z [command]/usr/bin/git submodule foreach --recursive sh -c "git config --local --name-only --get-regexp 'http\.https\:\/\/github\.com\/\.extraheader' && git config --local --unset-all 'http.https://github.com/.extraheader' || :"
2025-09-10T08:29:54.0641321Z [command]/usr/bin/git config --local http.https://github.com/.extraheader AUTHORIZATION: basic ***
2025-09-10T08:29:54.0675922Z ##[endgroup]
2025-09-10T08:29:54.0676359Z ##[group]Fetching the repository
2025-09-10T08:29:54.0684013Z [command]/usr/bin/git -c protocol.version=2 fetch --no-tags --prune --no-recurse-submodules --depth=1 origin +3eb840201da82dceee79bf56136f021ba8415470:refs/remotes/pull/34/merge
2025-09-10T08:29:54.3163308Z From https://github.com/speakeasy-social/services
2025-09-10T08:29:54.3164056Z  * [new ref]         3eb840201da82dceee79bf56136f021ba8415470 -> pull/34/merge
2025-09-10T08:29:54.3194190Z ##[endgroup]
2025-09-10T08:29:54.3194790Z ##[group]Determining the checkout info
2025-09-10T08:29:54.3197368Z ##[endgroup]
2025-09-10T08:29:54.3202579Z [command]/usr/bin/git sparse-checkout disable
2025-09-10T08:29:54.3241868Z [command]/usr/bin/git config --local --unset-all extensions.worktreeConfig
2025-09-10T08:29:54.3269143Z ##[group]Checking out the ref
2025-09-10T08:29:54.3273103Z [command]/usr/bin/git checkout --progress --force refs/remotes/pull/34/merge
2025-09-10T08:29:54.3428784Z Note: switching to 'refs/remotes/pull/34/merge'.
2025-09-10T08:29:54.3429166Z 
2025-09-10T08:29:54.3429528Z You are in 'detached HEAD' state. You can look around, make experimental
2025-09-10T08:29:54.3430308Z changes and commit them, and you can discard any commits you make in this
2025-09-10T08:29:54.3431081Z state without impacting any branches by switching back to a branch.
2025-09-10T08:29:54.3431516Z 
2025-09-10T08:29:54.3431834Z If you want to create a new branch to retain commits you create, you may
2025-09-10T08:29:54.3432444Z do so (now or later) by using -c with the switch command. Example:
2025-09-10T08:29:54.3432794Z 
2025-09-10T08:29:54.3432980Z   git switch -c <new-branch-name>
2025-09-10T08:29:54.3433300Z 
2025-09-10T08:29:54.3433482Z Or undo this operation with:
2025-09-10T08:29:54.3433767Z 
2025-09-10T08:29:54.3433917Z   git switch -
2025-09-10T08:29:54.3434133Z 
2025-09-10T08:29:54.3434549Z Turn off this advice by setting config variable advice.detachedHead to false
2025-09-10T08:29:54.3435090Z 
2025-09-10T08:29:54.3435796Z HEAD is now at 3eb8402 Merge 8be1d96b824bb952f8294fe5d1f209158a5cbb7c into 182e9884282f249ee4c947de6ee2e49f220dfdbd
2025-09-10T08:29:54.3437575Z ##[endgroup]
2025-09-10T08:29:54.3470716Z [command]/usr/bin/git log -1 --format=%H
2025-09-10T08:29:54.3491324Z 3eb840201da82dceee79bf56136f021ba8415470
2025-09-10T08:29:54.3719219Z ##[group]Run actions/setup-node@v4
2025-09-10T08:29:54.3719479Z with:
2025-09-10T08:29:54.3719653Z   node-version: 22.14.0
2025-09-10T08:29:54.3719843Z   always-auth: false
2025-09-10T08:29:54.3720028Z   check-latest: false
2025-09-10T08:29:54.3720327Z   token: ***
2025-09-10T08:29:54.3720501Z ##[endgroup]
2025-09-10T08:29:54.5389102Z Attempting to download 22.14.0...
2025-09-10T08:29:54.9209189Z Acquiring 22.14.0 - x64 from https://github.com/actions/node-versions/releases/download/22.14.0-13265982013/node-22.14.0-linux-x64.tar.gz
2025-09-10T08:29:55.3641506Z Extracting ...
2025-09-10T08:29:55.3745568Z [command]/usr/bin/tar xz --strip 1 --warning=no-unknown-keyword --overwrite -C /home/runner/work/_temp/1384fe16-7a2a-4af2-9d83-687948beb188 -f /home/runner/work/_temp/aeab8c42-4931-4337-a463-cd7615b59b79
2025-09-10T08:29:56.5125706Z Adding to the cache ...
2025-09-10T08:29:58.3037236Z ##[group]Environment details
2025-09-10T08:29:58.5192702Z node: v22.14.0
2025-09-10T08:29:58.5193156Z npm: 10.9.2
2025-09-10T08:29:58.5193420Z yarn: 1.22.22
2025-09-10T08:29:58.5194104Z ##[endgroup]
2025-09-10T08:29:58.5346131Z ##[group]Run pnpm/action-setup@v4
2025-09-10T08:29:58.5346369Z with:
2025-09-10T08:29:58.5346528Z   version: 10.15.1
2025-09-10T08:29:58.5346700Z   dest: ~/setup-pnpm
2025-09-10T08:29:58.5346879Z   run_install: null
2025-09-10T08:29:58.5347058Z   package_json_file: package.json
2025-09-10T08:29:58.5347286Z   standalone: false
2025-09-10T08:29:58.5347459Z ##[endgroup]
2025-09-10T08:29:58.5881602Z ##[group]Running self-installer...
2025-09-10T08:29:59.1460625Z Progress: resolved 1, reused 0, downloaded 0, added 0
2025-09-10T08:29:59.1573134Z Packages: +1
2025-09-10T08:29:59.1573453Z +
2025-09-10T08:29:59.5702690Z Progress: resolved 1, reused 0, downloaded 1, added 1, done
2025-09-10T08:29:59.6025825Z 
2025-09-10T08:29:59.6026210Z dependencies:
2025-09-10T08:29:59.6026582Z + pnpm 10.15.1
2025-09-10T08:29:59.6026797Z 
2025-09-10T08:29:59.6052900Z Done in 854ms
2025-09-10T08:29:59.6221448Z ##[endgroup]
2025-09-10T08:29:59.6225288Z Installation Completed!
2025-09-10T08:29:59.6314344Z ##[group]Run pnpm install --frozen-lockfile
2025-09-10T08:29:59.6314711Z [36;1mpnpm install --frozen-lockfile[0m
2025-09-10T08:29:59.6365728Z shell: /usr/bin/bash -e {0}
2025-09-10T08:29:59.6365967Z env:
2025-09-10T08:29:59.6366191Z   PNPM_HOME: /home/runner/setup-pnpm/node_modules/.bin
2025-09-10T08:29:59.6366473Z ##[endgroup]
2025-09-10T08:30:00.0278995Z Scope: all 11 workspace projects
2025-09-10T08:30:00.1357856Z Lockfile is up to date, resolution step is skipped
2025-09-10T08:30:00.1853388Z Progress: resolved 1, reused 0, downloaded 0, added 0
2025-09-10T08:30:00.2938758Z Packages: +763
2025-09-10T08:30:00.2939424Z ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
2025-09-10T08:30:01.1859055Z Progress: resolved 763, reused 0, downloaded 178, added 169
2025-09-10T08:30:02.1875742Z Progress: resolved 763, reused 0, downloaded 297, added 296
2025-09-10T08:30:03.1884788Z Progress: resolved 763, reused 0, downloaded 516, added 491
2025-09-10T08:30:04.1881613Z Progress: resolved 763, reused 0, downloaded 630, added 568
2025-09-10T08:30:04.9548879Z Progress: resolved 763, reused 0, downloaded 763, added 763, done
2025-09-10T08:30:05.5920552Z 
2025-09-10T08:30:05.5921074Z devDependencies:
2025-09-10T08:30:05.5921521Z + @types/jsonwebtoken 9.0.10
2025-09-10T08:30:05.5921953Z + @types/node 22.18.1
2025-09-10T08:30:05.5922329Z + @types/supertest 6.0.3
2025-09-10T08:30:05.5922809Z + @typescript-eslint/eslint-plugin 7.18.0
2025-09-10T08:30:05.5923354Z + @typescript-eslint/parser 7.18.0
2025-09-10T08:30:05.5923757Z + dotenv 16.6.1
2025-09-10T08:30:05.5924029Z + eslint 8.57.1
2025-09-10T08:30:05.5924327Z + jsonwebtoken 9.0.2
2025-09-10T08:30:05.5924659Z + nock 13.5.6
2025-09-10T08:30:05.5924936Z + prettier 3.6.2
2025-09-10T08:30:05.5925250Z + prisma 6.15.0
2025-09-10T08:30:05.5925604Z + supertest 6.3.4
2025-09-10T08:30:05.5925910Z + turbo 2.5.6
2025-09-10T08:30:05.5926325Z + typescript 5.9.2
2025-09-10T08:30:05.5926546Z 
2025-09-10T08:30:05.5927450Z â•­ Warning â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®
2025-09-10T08:30:05.5928592Z â”‚                                                                              â”‚
2025-09-10T08:30:05.5929636Z â”‚   Ignored build scripts: @prisma/client, @prisma/engines, cbor-extract,      â”‚
2025-09-10T08:30:05.5930873Z â”‚   esbuild, prisma, puppeteer.                                                â”‚
2025-09-10T08:30:05.5932046Z â”‚   Run "pnpm approve-builds" to pick which dependencies should be allowed     â”‚
2025-09-10T08:30:05.5933219Z â”‚   to run scripts.                                                            â”‚
2025-09-10T08:30:05.5934154Z â”‚                                                                              â”‚
2025-09-10T08:30:05.5935506Z â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯
2025-09-10T08:30:05.5935906Z 
2025-09-10T08:30:05.7346506Z Done in 6s using pnpm v10.15.1
2025-09-10T08:30:05.7705735Z ##[group]Run pnpm dev:setup:env
2025-09-10T08:30:05.7706023Z [36;1mpnpm dev:setup:env[0m
2025-09-10T08:30:05.7737147Z shell: /usr/bin/bash -e {0}
2025-09-10T08:30:05.7737372Z env:
2025-09-10T08:30:05.7737591Z   PNPM_HOME: /home/runner/setup-pnpm/node_modules/.bin
2025-09-10T08:30:05.7737885Z ##[endgroup]
2025-09-10T08:30:06.0349692Z 
2025-09-10T08:30:06.0350445Z > speakeasy-services@0.1.0 dev:setup:env /home/runner/work/services/services
2025-09-10T08:30:06.0352421Z > test -f .env || (test -f .env.example && cp .env.example .env) && for service in services/*; do test -f "$service/.env" || (test -f "$service/.env.example" && cp "$service/.env.example" "$service/.env") 2>/dev/null || true; done
2025-09-10T08:30:06.0353520Z 
2025-09-10T08:30:06.0597031Z ##[group]Run sudo apt-get update && sudo apt-get install -y postgresql-client
2025-09-10T08:30:06.0597868Z [36;1msudo apt-get update && sudo apt-get install -y postgresql-client[0m
2025-09-10T08:30:06.0637081Z shell: /usr/bin/bash -e {0}
2025-09-10T08:30:06.0637432Z env:
2025-09-10T08:30:06.0637787Z   PNPM_HOME: /home/runner/setup-pnpm/node_modules/.bin
2025-09-10T08:30:06.0638424Z ##[endgroup]
2025-09-10T08:30:06.2345687Z Get:1 file:/etc/apt/apt-mirrors.txt Mirrorlist [144 B]
2025-09-10T08:30:06.3291986Z Hit:2 http://azure.archive.ubuntu.com/ubuntu noble InRelease
2025-09-10T08:30:06.3311513Z Get:3 http://azure.archive.ubuntu.com/ubuntu noble-updates InRelease [126 kB]
2025-09-10T08:30:06.3336811Z Get:4 http://azure.archive.ubuntu.com/ubuntu noble-backports InRelease [126 kB]
2025-09-10T08:30:06.3395608Z Get:5 http://azure.archive.ubuntu.com/ubuntu noble-security InRelease [126 kB]
2025-09-10T08:30:06.3461231Z Hit:6 https://packages.microsoft.com/repos/azure-cli noble InRelease
2025-09-10T08:30:06.3521324Z Get:7 https://packages.microsoft.com/ubuntu/24.04/prod noble InRelease [3600 B]
2025-09-10T08:30:06.5775801Z Get:8 http://azure.archive.ubuntu.com/ubuntu noble-updates/main amd64 Packages [1390 kB]
2025-09-10T08:30:06.5948454Z Get:9 http://azure.archive.ubuntu.com/ubuntu noble-updates/main Translation-en [274 kB]
2025-09-10T08:30:06.5980237Z Get:10 http://azure.archive.ubuntu.com/ubuntu noble-updates/main amd64 Components [175 kB]
2025-09-10T08:30:06.6008936Z Get:11 http://azure.archive.ubuntu.com/ubuntu noble-updates/main amd64 c-n-f Metadata [15.2 kB]
2025-09-10T08:30:06.6014967Z Get:12 http://azure.archive.ubuntu.com/ubuntu noble-updates/universe amd64 Packages [1481 kB]
2025-09-10T08:30:06.6116773Z Get:13 http://azure.archive.ubuntu.com/ubuntu noble-updates/universe amd64 Components [377 kB]
2025-09-10T08:30:06.6179263Z Get:14 http://azure.archive.ubuntu.com/ubuntu noble-updates/universe amd64 c-n-f Metadata [31.0 kB]
2025-09-10T08:30:06.6212013Z Get:15 http://azure.archive.ubuntu.com/ubuntu noble-updates/restricted amd64 Components [212 B]
2025-09-10T08:30:06.6259454Z Get:16 http://azure.archive.ubuntu.com/ubuntu noble-updates/multiverse amd64 Components [940 B]
2025-09-10T08:30:06.6401369Z Get:17 http://azure.archive.ubuntu.com/ubuntu noble-backports/main amd64 Components [7068 B]
2025-09-10T08:30:06.6825577Z Get:18 http://azure.archive.ubuntu.com/ubuntu noble-backports/universe amd64 Components [19.2 kB]
2025-09-10T08:30:06.6837282Z Get:19 http://azure.archive.ubuntu.com/ubuntu noble-backports/restricted amd64 Components [216 B]
2025-09-10T08:30:06.6845600Z Get:20 http://azure.archive.ubuntu.com/ubuntu noble-backports/multiverse amd64 Components [212 B]
2025-09-10T08:30:06.6989104Z Get:21 http://azure.archive.ubuntu.com/ubuntu noble-security/main amd64 Packages [1118 kB]
2025-09-10T08:30:06.7035884Z Get:22 http://azure.archive.ubuntu.com/ubuntu noble-security/main amd64 Components [21.6 kB]
2025-09-10T08:30:06.7061105Z Get:23 http://azure.archive.ubuntu.com/ubuntu noble-security/main amd64 c-n-f Metadata [8708 B]
2025-09-10T08:30:06.7076245Z Get:24 http://azure.archive.ubuntu.com/ubuntu noble-security/universe amd64 Packages [879 kB]
2025-09-10T08:30:06.7140682Z Get:25 http://azure.archive.ubuntu.com/ubuntu noble-security/universe amd64 Components [52.3 kB]
2025-09-10T08:30:06.7159787Z Get:26 http://azure.archive.ubuntu.com/ubuntu noble-security/restricted amd64 Components [212 B]
2025-09-10T08:30:06.7182056Z Get:27 http://azure.archive.ubuntu.com/ubuntu noble-security/multiverse amd64 Components [212 B]
2025-09-10T08:30:06.8037785Z Get:28 https://packages.microsoft.com/ubuntu/24.04/prod noble/main amd64 Packages [51.4 kB]
2025-09-10T08:30:06.8147393Z Get:29 https://packages.microsoft.com/ubuntu/24.04/prod noble/main arm64 Packages [35.3 kB]
2025-09-10T08:30:15.1669970Z Fetched 6320 kB in 1s (5908 kB/s)
2025-09-10T08:30:15.8513477Z Reading package lists...
2025-09-10T08:30:15.8833187Z Reading package lists...
2025-09-10T08:30:16.0315351Z Building dependency tree...
2025-09-10T08:30:16.0323295Z Reading state information...
2025-09-10T08:30:16.1953860Z The following NEW packages will be installed:
2025-09-10T08:30:16.1954234Z   postgresql-client
2025-09-10T08:30:16.2119259Z 0 upgraded, 1 newly installed, 0 to remove and 11 not upgraded.
2025-09-10T08:30:16.2119710Z Need to get 11.6 kB of archives.
2025-09-10T08:30:16.2120116Z After this operation, 17.4 kB of additional disk space will be used.
2025-09-10T08:30:16.2120867Z Get:1 file:/etc/apt/apt-mirrors.txt Mirrorlist [144 B]
2025-09-10T08:30:16.2450372Z Get:2 http://azure.archive.ubuntu.com/ubuntu noble-updates/main amd64 postgresql-client all 16+257build1.1 [11.6 kB]
2025-09-10T08:30:16.5073323Z Fetched 11.6 kB in 0s (268 kB/s)
2025-09-10T08:30:16.5389650Z Selecting previously unselected package postgresql-client.
2025-09-10T08:30:16.6334926Z (Reading database ... 
2025-09-10T08:30:16.6335664Z (Reading database ... 5%
2025-09-10T08:30:16.6336164Z (Reading database ... 10%
2025-09-10T08:30:16.6336596Z (Reading database ... 15%
2025-09-10T08:30:16.6337039Z (Reading database ... 20%
2025-09-10T08:30:16.6337446Z (Reading database ... 25%
2025-09-10T08:30:16.6337716Z (Reading database ... 30%
2025-09-10T08:30:16.6338104Z (Reading database ... 35%
2025-09-10T08:30:16.6338381Z (Reading database ... 40%
2025-09-10T08:30:16.6338648Z (Reading database ... 45%
2025-09-10T08:30:16.6338920Z (Reading database ... 50%
2025-09-10T08:30:16.8812996Z (Reading database ... 55%
2025-09-10T08:30:17.2932647Z (Reading database ... 60%
2025-09-10T08:30:17.6495657Z (Reading database ... 65%
2025-09-10T08:30:18.0397813Z (Reading database ... 70%
2025-09-10T08:30:18.4503288Z (Reading database ... 75%
2025-09-10T08:30:19.0053601Z (Reading database ... 80%
2025-09-10T08:30:19.6132847Z (Reading database ... 85%
2025-09-10T08:30:20.2998744Z (Reading database ... 90%
2025-09-10T08:30:21.3432806Z (Reading database ... 95%
2025-09-10T08:30:21.3433395Z (Reading database ... 100%
2025-09-10T08:30:21.3434266Z (Reading database ... 218657 files and directories currently installed.)
2025-09-10T08:30:21.3479990Z Preparing to unpack .../postgresql-client_16+257build1.1_all.deb ...
2025-09-10T08:30:21.3505687Z Unpacking postgresql-client (16+257build1.1) ...
2025-09-10T08:30:21.3941657Z Setting up postgresql-client (16+257build1.1) ...
2025-09-10T08:30:22.8415765Z 
2025-09-10T08:30:22.8416410Z Running kernel seems to be up-to-date.
2025-09-10T08:30:22.8416851Z 
2025-09-10T08:30:22.8417054Z Restarting services...
2025-09-10T08:30:22.8483775Z 
2025-09-10T08:30:22.8484154Z Service restarts being deferred:
2025-09-10T08:30:22.8485352Z  systemctl restart hosted-compute-agent.service
2025-09-10T08:30:22.8485770Z 
2025-09-10T08:30:22.8486006Z No containers need to be restarted.
2025-09-10T08:30:22.8486271Z 
2025-09-10T08:30:22.8486556Z No user sessions are running outdated binaries.
2025-09-10T08:30:22.8486909Z 
2025-09-10T08:30:22.8487283Z No VM guests are running outdated hypervisor (qemu) binaries on this host.
2025-09-10T08:30:23.6743227Z ##[group]Run NODE_ENV=test pnpm dev:setup:db
2025-09-10T08:30:23.6743736Z [36;1mNODE_ENV=test pnpm dev:setup:db[0m
2025-09-10T08:30:23.6773127Z shell: /usr/bin/bash -e {0}
2025-09-10T08:30:23.6773337Z env:
2025-09-10T08:30:23.6773547Z   PNPM_HOME: /home/runner/setup-pnpm/node_modules/.bin
2025-09-10T08:30:23.6773825Z ##[endgroup]
2025-09-10T08:30:23.9489703Z 
2025-09-10T08:30:23.9490573Z > speakeasy-services@0.1.0 dev:setup:db /home/runner/work/services/services
2025-09-10T08:30:23.9491252Z > ./scripts/create-schemas.sh
2025-09-10T08:30:23.9492208Z 
2025-09-10T08:30:23.9539178Z Setting up databases...
2025-09-10T08:30:23.9539938Z Using direct psql connection
2025-09-10T08:30:24.1914486Z CREATE DATABASE
2025-09-10T08:30:24.1929960Z Setting up schemas for test database: speakeasy_test
2025-09-10T08:30:24.2462940Z NOTICE:  schema "user_keys" does not exist, skipping
2025-09-10T08:30:24.2465667Z NOTICE:  schema "private_sessions" does not exist, skipping
2025-09-10T08:30:24.2466575Z DROP SCHEMA
2025-09-10T08:30:24.2466863Z DROP SCHEMA
2025-09-10T08:30:24.2468662Z DROP SCHEMA
2025-09-10T08:30:24.2471472Z NOTICE:  schema "trusted_users" does not exist, skipping
2025-09-10T08:30:24.2478445Z NOTICE:  schema "service_admin" does not exist, skipping
2025-09-10T08:30:24.2479761Z DROP SCHEMA
2025-09-10T08:30:24.2491825Z NOTICE:  schema "media" does not exist, skipping
2025-09-10T08:30:24.2492387Z DROP SCHEMA
2025-09-10T08:30:24.2505490Z NOTICE:  schema "pgboss" does not exist, skipping
2025-09-10T08:30:24.2506030Z DROP SCHEMA
2025-09-10T08:30:24.2506341Z CREATE SCHEMA
2025-09-10T08:30:24.2506764Z CREATE SCHEMA
2025-09-10T08:30:24.2510591Z CREATE SCHEMA
2025-09-10T08:30:24.2514495Z CREATE SCHEMA
2025-09-10T08:30:24.2518836Z CREATE SCHEMA
2025-09-10T08:30:24.2522130Z CREATE SCHEMA
2025-09-10T08:30:24.2526639Z GRANT
2025-09-10T08:30:24.2530121Z GRANT
2025-09-10T08:30:24.2534506Z GRANT
2025-09-10T08:30:24.2538254Z GRANT
2025-09-10T08:30:24.2541462Z GRANT
2025-09-10T08:30:24.2544506Z GRANT
2025-09-10T08:30:24.2670691Z ##[group]Run NODE_ENV=test pnpm dev:setup:migrations
2025-09-10T08:30:24.2671101Z [36;1mNODE_ENV=test pnpm dev:setup:migrations[0m
2025-09-10T08:30:24.2708511Z shell: /usr/bin/bash -e {0}
2025-09-10T08:30:24.2708881Z env:
2025-09-10T08:30:24.2709219Z   PNPM_HOME: /home/runner/setup-pnpm/node_modules/.bin
2025-09-10T08:30:24.2709676Z ##[endgroup]
2025-09-10T08:30:24.5404529Z 
2025-09-10T08:30:24.5405587Z > speakeasy-services@0.1.0 dev:setup:migrations /home/runner/work/services/services
2025-09-10T08:30:24.5406446Z > ./scripts/run-migrations.sh
2025-09-10T08:30:24.5406738Z 
2025-09-10T08:30:24.5447505Z Running migrations for test database: speakeasy_test
2025-09-10T08:30:24.5448392Z Running migrations for user-keys service...
2025-09-10T08:30:24.8359015Z 
2025-09-10T08:30:24.8359774Z > @speakeasy-services/user-keys@0.1.0 prisma:migrate /home/runner/work/services/services/services/user-keys
2025-09-10T08:30:24.8360323Z > prisma migrate deploy
2025-09-10T08:30:24.8360456Z 
2025-09-10T08:30:26.4484492Z Environment variables loaded from .env
2025-09-10T08:30:26.4491429Z Prisma schema loaded from prisma/schema.prisma
2025-09-10T08:30:26.4514052Z Datasource "db": PostgreSQL database "speakeasy_test", schema "user_keys" at "localhost:5496"
2025-09-10T08:30:26.5203692Z 
2025-09-10T08:30:26.5204074Z 1 migration found in prisma/migrations
2025-09-10T08:30:26.5204344Z 
2025-09-10T08:30:26.6000960Z Applying migration `20240323000000_initial_schema`
2025-09-10T08:30:26.6086229Z 
2025-09-10T08:30:26.6091082Z The following migration(s) have been applied:
2025-09-10T08:30:26.6091440Z 
2025-09-10T08:30:26.6091564Z migrations/
2025-09-10T08:30:26.6092182Z   â””â”€ 20240323000000_initial_schema/
2025-09-10T08:30:26.6092616Z     â””â”€ migration.sql
2025-09-10T08:30:26.6092929Z       
2025-09-10T08:30:26.6093471Z All migrations have been successfully applied.
2025-09-10T08:30:26.6400763Z Running migrations for trusted-users service...
2025-09-10T08:30:26.9343709Z 
2025-09-10T08:30:26.9345232Z > @speakeasy-services/trusted-users@0.1.0 prisma:migrate /home/runner/work/services/services/services/trusted-users
2025-09-10T08:30:26.9346848Z > prisma migrate deploy
2025-09-10T08:30:26.9347068Z 
2025-09-10T08:30:28.1742147Z Environment variables loaded from .env
2025-09-10T08:30:28.1750024Z Prisma schema loaded from prisma/schema.prisma
2025-09-10T08:30:28.1774276Z Datasource "db": PostgreSQL database "speakeasy_test", schema "trusted_users" at "localhost:5496"
2025-09-10T08:30:28.2483962Z 
2025-09-10T08:30:28.2484526Z 1 migration found in prisma/migrations
2025-09-10T08:30:28.2484767Z 
2025-09-10T08:30:28.3301012Z Applying migration `20240321000000_initial_schema`
2025-09-10T08:30:28.3408418Z 
2025-09-10T08:30:28.3408794Z The following migration(s) have been applied:
2025-09-10T08:30:28.3409171Z 
2025-09-10T08:30:28.3409299Z migrations/
2025-09-10T08:30:28.3409930Z   â””â”€ 20240321000000_initial_schema/
2025-09-10T08:30:28.3410261Z     â””â”€ migration.sql
2025-09-10T08:30:28.3410454Z       
2025-09-10T08:30:28.3410758Z All migrations have been successfully applied.
2025-09-10T08:30:28.3698594Z Running migrations for private-sessions service...
2025-09-10T08:30:28.6617480Z 
2025-09-10T08:30:28.6618639Z > @speakeasy-services/private-sessions@0.1.0 prisma:migrate /home/runner/work/services/services/services/private-sessions
2025-09-10T08:30:28.6619265Z > prisma migrate deploy
2025-09-10T08:30:28.6619400Z 
2025-09-10T08:30:29.9269060Z Environment variables loaded from .env
2025-09-10T08:30:29.9277917Z Prisma schema loaded from prisma/schema.prisma
2025-09-10T08:30:29.9306276Z Datasource "db": PostgreSQL database "speakeasy_test", schema "private_sessions" at "localhost:5496"
2025-09-10T08:30:30.0035969Z 
2025-09-10T08:30:30.0036385Z 6 migrations found in prisma/migrations
2025-09-10T08:30:30.0036786Z 
2025-09-10T08:30:30.0839463Z Applying migration `20240321000000_initial_schema`
2025-09-10T08:30:30.1138623Z Applying migration `20250427110139_add_reactions_notifications_tables`
2025-09-10T08:30:30.1305797Z Applying migration `20250502095452_add_media_post_relationships`
2025-09-10T08:30:30.1398326Z Applying migration `20250502184200_unique_post_uri`
2025-09-10T08:30:30.1434770Z Applying migration `20250504112206_did_cache`
2025-09-10T08:30:30.1481724Z Applying migration `20250607014807_remove_media`
2025-09-10T08:30:30.1561144Z 
2025-09-10T08:30:30.1567028Z The following migration(s) have been applied:
2025-09-10T08:30:30.1567552Z 
2025-09-10T08:30:30.1567772Z migrations/
2025-09-10T08:30:30.1569630Z   â””â”€ 20240321000000_initial_schema/
2025-09-10T08:30:30.1570171Z     â””â”€ migration.sql
2025-09-10T08:30:30.1570768Z   â””â”€ 20250427110139_add_reactions_notifications_tables/
2025-09-10T08:30:30.1571349Z     â””â”€ migration.sql
2025-09-10T08:30:30.1571912Z   â””â”€ 20250502095452_add_media_post_relationships/
2025-09-10T08:30:30.1572495Z     â””â”€ migration.sql
2025-09-10T08:30:30.1572997Z   â””â”€ 20250502184200_unique_post_uri/
2025-09-10T08:30:30.1573490Z     â””â”€ migration.sql
2025-09-10T08:30:30.1573941Z   â””â”€ 20250504112206_did_cache/
2025-09-10T08:30:30.1574365Z     â””â”€ migration.sql
2025-09-10T08:30:30.1574773Z   â””â”€ 20250607014807_remove_media/
2025-09-10T08:30:30.1575196Z     â””â”€ migration.sql
2025-09-10T08:30:30.1575475Z       
2025-09-10T08:30:30.1575882Z All migrations have been successfully applied.
2025-09-10T08:30:30.1877009Z Running migrations for service-admin service...
2025-09-10T08:30:30.4808480Z 
2025-09-10T08:30:30.4809408Z > @speakeasy-services/service-admin@0.1.0 prisma:migrate /home/runner/work/services/services/services/service-admin
2025-09-10T08:30:30.4810012Z > prisma migrate deploy
2025-09-10T08:30:30.4810152Z 
2025-09-10T08:30:31.7102260Z Environment variables loaded from .env
2025-09-10T08:30:31.7111359Z Prisma schema loaded from prisma/schema.prisma
2025-09-10T08:30:31.7130538Z Datasource "db": PostgreSQL database "speakeasy_test", schema "service_admin" at "localhost:5496"
2025-09-10T08:30:31.7857905Z 
2025-09-10T08:30:31.7858516Z 1 migration found in prisma/migrations
2025-09-10T08:30:31.7858877Z 
2025-09-10T08:30:31.8640774Z Applying migration `20250428044906_init`
2025-09-10T08:30:31.8834709Z 
2025-09-10T08:30:31.8840397Z The following migration(s) have been applied:
2025-09-10T08:30:31.8841035Z 
2025-09-10T08:30:31.8841119Z migrations/
2025-09-10T08:30:31.8841526Z   â””â”€ 20250428044906_init/
2025-09-10T08:30:31.8841769Z     â””â”€ migration.sql
2025-09-10T08:30:31.8841955Z       
2025-09-10T08:30:31.8842207Z All migrations have been successfully applied.
2025-09-10T08:30:31.9141412Z Running migrations for media service...
2025-09-10T08:30:32.2115535Z 
2025-09-10T08:30:32.2116729Z > @speakeasy-services/media@0.1.0 prisma:migrate /home/runner/work/services/services/services/media
2025-09-10T08:30:32.2117669Z > prisma migrate deploy
2025-09-10T08:30:32.2117925Z 
2025-09-10T08:30:33.4435059Z Environment variables loaded from .env
2025-09-10T08:30:33.4445228Z Prisma schema loaded from prisma/schema.prisma
2025-09-10T08:30:33.4461720Z Datasource "db": PostgreSQL database "speakeasy_test", schema "media" at "localhost:5496"
2025-09-10T08:30:33.5163203Z 
2025-09-10T08:30:33.5163653Z 1 migration found in prisma/migrations
2025-09-10T08:30:33.5164015Z 
2025-09-10T08:30:33.5931956Z Applying migration `20250607010839_initial`
2025-09-10T08:30:33.6006093Z 
2025-09-10T08:30:33.6012118Z The following migration(s) have been applied:
2025-09-10T08:30:33.6012571Z 
2025-09-10T08:30:33.6013026Z migrations/
2025-09-10T08:30:33.6013602Z   â””â”€ 20250607010839_initial/
2025-09-10T08:30:33.6014115Z     â””â”€ migration.sql
2025-09-10T08:30:33.6014447Z       
2025-09-10T08:30:33.6014942Z All migrations have been successfully applied.
2025-09-10T08:30:33.6399164Z ##[group]Run pnpm dev:setup:s3
2025-09-10T08:30:33.6399459Z [36;1mpnpm dev:setup:s3[0m
2025-09-10T08:30:33.6429929Z shell: /usr/bin/bash -e {0}
2025-09-10T08:30:33.6430161Z env:
2025-09-10T08:30:33.6430378Z   PNPM_HOME: /home/runner/setup-pnpm/node_modules/.bin
2025-09-10T08:30:33.6430655Z ##[endgroup]
2025-09-10T08:30:33.9016147Z 
2025-09-10T08:30:33.9016845Z > speakeasy-services@0.1.0 dev:setup:s3 /home/runner/work/services/services
2025-09-10T08:30:33.9017542Z > ./scripts/init-s3.sh
2025-09-10T08:30:33.9017725Z 
2025-09-10T08:30:33.9059657Z Setting up S3 bucket in localstack...
2025-09-10T08:30:33.9085294Z Waiting for localstack to be ready...
2025-09-10T08:30:34.0315896Z Localstack is running, creating S3 bucket...
2025-09-10T08:30:34.0316319Z Creating bucket speakeasy-develop...
2025-09-10T08:30:34.4100173Z   % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
2025-09-10T08:30:34.4101634Z                                  Dload  Upload   Total   Spent    Left  Speed
2025-09-10T08:30:34.4102026Z 
2025-09-10T08:30:34.4176325Z   0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0
2025-09-10T08:30:34.4177183Z 100   326    0     0  100   326      0  42376 --:--:-- --:--:-- --:--:-- 46571
2025-09-10T08:30:34.4185079Z Verifying bucket creation...
2025-09-10T08:30:34.4315402Z Bucket created successfully!
2025-09-10T08:30:34.4316752Z Configuring CORS...
2025-09-10T08:30:34.4409344Z S3 bucket 'speakeasy-develop' created and configured successfully!
2025-09-10T08:30:34.4553063Z ##[group]Run cd packages/queue && NODE_ENV=test pnpm setup:pgboss
2025-09-10T08:30:34.4553506Z [36;1mcd packages/queue && NODE_ENV=test pnpm setup:pgboss[0m
2025-09-10T08:30:34.4583358Z shell: /usr/bin/bash -e {0}
2025-09-10T08:30:34.4583602Z env:
2025-09-10T08:30:34.4583829Z   PNPM_HOME: /home/runner/setup-pnpm/node_modules/.bin
2025-09-10T08:30:34.4584133Z ##[endgroup]
2025-09-10T08:30:34.7865909Z 
2025-09-10T08:30:34.7866712Z > @speakeasy-services/queue@0.1.0 setup:pgboss /home/runner/work/services/services/packages/queue
2025-09-10T08:30:34.7867493Z > tsx src/setup.ts
2025-09-10T08:30:34.7867690Z 
2025-09-10T08:30:35.3672476Z Setting up PgBoss...
2025-09-10T08:30:35.4565809Z PgBoss setup complete!
2025-09-10T08:30:35.4566177Z 
2025-09-10T08:30:35.4566541Z ** Setup complete! **
2025-09-10T08:30:35.4566814Z 
2025-09-10T08:30:35.4567163Z Shutting down PgBoss... (may take a few seconds)
2025-09-10T08:30:45.4840442Z ##[group]Run pnpm build
2025-09-10T08:30:45.4840704Z [36;1mpnpm build[0m
2025-09-10T08:30:45.4871129Z shell: /usr/bin/bash -e {0}
2025-09-10T08:30:45.4871371Z env:
2025-09-10T08:30:45.4871606Z   PNPM_HOME: /home/runner/setup-pnpm/node_modules/.bin
2025-09-10T08:30:45.4871900Z ##[endgroup]
2025-09-10T08:30:45.7447739Z 
2025-09-10T08:30:45.7448595Z > speakeasy-services@0.1.0 build /home/runner/work/services/services
2025-09-10T08:30:45.7449207Z > turbo run build
2025-09-10T08:30:45.7449391Z 
2025-09-10T08:30:45.7930187Z 
2025-09-10T08:30:45.7930399Z Attention:
2025-09-10T08:30:45.7931108Z Turborepo now collects completely anonymous telemetry regarding usage.
2025-09-10T08:30:45.7932074Z This information is used to shape the Turborepo roadmap and prioritize features.
2025-09-10T08:30:45.7933431Z You can learn more, including how to opt-out if you'd not like to participate in this anonymous program, by visiting the following URL:
2025-09-10T08:30:45.7934537Z https://turborepo.com/docs/telemetry
2025-09-10T08:30:45.7934864Z 
2025-09-10T08:30:45.8674957Z â€¢ Packages in scope: @speakeasy-services/common, @speakeasy-services/crypto, @speakeasy-services/media, @speakeasy-services/private-sessions, @speakeasy-services/queue, @speakeasy-services/service-admin, @speakeasy-services/service-base, @speakeasy-services/test-utils, @speakeasy-services/trusted-users, @speakeasy-services/user-keys
2025-09-10T08:30:45.8677617Z â€¢ Running build in 10 packages
2025-09-10T08:30:45.8678417Z â€¢ Remote caching disabled
2025-09-10T08:30:47.9435292Z ##[group]@speakeasy-services/common:build
2025-09-10T08:30:47.9436014Z cache miss, executing 5d2bdf062730c893
2025-09-10T08:30:47.9436307Z 
2025-09-10T08:30:47.9436948Z > @speakeasy-services/common@0.1.0 build /home/runner/work/services/services/packages/common
2025-09-10T08:30:47.9437676Z > tsc --build
2025-09-10T08:30:47.9437850Z 
2025-09-10T08:30:47.9438447Z ##[endgroup]
2025-09-10T08:30:49.8937193Z ##[group]@speakeasy-services/crypto:build
2025-09-10T08:30:49.8939931Z cache miss, executing 50a3dd0fba249376
2025-09-10T08:30:49.8940347Z 
2025-09-10T08:30:49.8941038Z > @speakeasy-services/crypto@0.1.0 build /home/runner/work/services/services/packages/crypto
2025-09-10T08:30:49.8941851Z > tsc --build
2025-09-10T08:30:49.8942052Z 
2025-09-10T08:30:49.8942534Z ##[endgroup]
2025-09-10T08:30:50.1336528Z ##[group]@speakeasy-services/queue:build
2025-09-10T08:30:50.1340953Z cache miss, executing 2fa8e2dbd1fd9e39
2025-09-10T08:30:50.1341285Z 
2025-09-10T08:30:50.1341885Z > @speakeasy-services/queue@0.1.0 build /home/runner/work/services/services/packages/queue
2025-09-10T08:30:50.1342614Z > tsc --build
2025-09-10T08:30:50.1342804Z 
2025-09-10T08:30:50.1343205Z ##[endgroup]
2025-09-10T08:30:52.0749495Z ##[group]@speakeasy-services/service-base:build
2025-09-10T08:30:52.0750217Z cache miss, executing a41124420aac09d5
2025-09-10T08:30:52.0750534Z 
2025-09-10T08:30:52.0751020Z > @speakeasy-services/service-base@0.1.0 build /home/runner/work/services/services/packages/service-base
2025-09-10T08:30:52.0751559Z > tsc --build
2025-09-10T08:30:52.0751755Z 
2025-09-10T08:30:52.0752080Z ##[endgroup]
2025-09-10T08:30:53.6919952Z ##[group]@speakeasy-services/test-utils:build
2025-09-10T08:30:53.6920664Z cache miss, executing 832dabdf1002b9a8
2025-09-10T08:30:53.6920977Z 
2025-09-10T08:30:53.6921665Z > @speakeasy-services/test-utils@0.1.0 build /home/runner/work/services/services/packages/test-utils
2025-09-10T08:30:53.6922426Z > tsc --build
2025-09-10T08:30:53.6922617Z 
2025-09-10T08:30:53.6922986Z ##[endgroup]
2025-09-10T08:30:57.3690455Z ##[group]@speakeasy-services/trusted-users:prisma:generate
2025-09-10T08:30:57.3695409Z cache miss, executing eac29c7794f48588
2025-09-10T08:30:57.3696003Z 
2025-09-10T08:30:57.3700796Z > @speakeasy-services/trusted-users@0.1.0 prisma:generate /home/runner/work/services/services/services/trusted-users
2025-09-10T08:30:57.3702008Z > prisma generate
2025-09-10T08:30:57.3702457Z 
2025-09-10T08:30:57.3702860Z Environment variables loaded from .env
2025-09-10T08:30:57.3704148Z Prisma schema loaded from prisma/schema.prisma
2025-09-10T08:30:57.3704847Z 
2025-09-10T08:30:57.3710238Z âœ” Generated Prisma Client (v6.15.0) to ./src/generated/prisma-client in 77ms
2025-09-10T08:30:57.3711276Z 
2025-09-10T08:30:57.3712016Z Start by importing your Prisma Client (See: https://pris.ly/d/importing-client)
2025-09-10T08:30:57.3712748Z 
2025-09-10T08:30:57.3713772Z Tip: Need your database queries to be 1000x faster? Accelerate offers you that and more: https://pris.ly/tip-2-accelerate
2025-09-10T08:30:57.3714671Z 
2025-09-10T08:30:57.3715287Z ##[endgroup]
2025-09-10T08:30:57.6639561Z ##[group]@speakeasy-services/private-sessions:prisma:generate
2025-09-10T08:30:57.6640339Z cache miss, executing b7cd3625cd7c7d01
2025-09-10T08:30:57.6640646Z 
2025-09-10T08:30:57.6641537Z > @speakeasy-services/private-sessions@0.1.0 prisma:generate /home/runner/work/services/services/services/private-sessions
2025-09-10T08:30:57.6642457Z > prisma generate
2025-09-10T08:30:57.6642649Z 
2025-09-10T08:30:57.6642935Z Environment variables loaded from .env
2025-09-10T08:30:57.6643515Z Prisma schema loaded from prisma/schema.prisma
2025-09-10T08:30:57.6643869Z 
2025-09-10T08:30:57.6644689Z âœ” Generated Prisma Client (v6.15.0) to ./src/generated/prisma-client in 301ms
2025-09-10T08:30:57.6645184Z 
2025-09-10T08:30:57.6645712Z Start by importing your Prisma Client (See: https://pris.ly/d/importing-client)
2025-09-10T08:30:57.6646230Z 
2025-09-10T08:30:57.6646700Z Tip: Want to turn off tips and other hints? https://pris.ly/tip-4-nohints
2025-09-10T08:30:57.6647170Z 
2025-09-10T08:30:57.6647547Z ##[endgroup]
2025-09-10T08:30:57.6899711Z ##[group]@speakeasy-services/media:prisma:generate
2025-09-10T08:30:57.6935568Z cache miss, executing efffbab482d147db
2025-09-10T08:30:57.6936172Z 
2025-09-10T08:30:57.6937615Z > @speakeasy-services/media@0.1.0 prisma:generate /home/runner/work/services/services/services/media
2025-09-10T08:30:57.6939265Z > prisma generate
2025-09-10T08:30:57.6939769Z 
2025-09-10T08:30:57.6942857Z Environment variables loaded from .env
2025-09-10T08:30:57.6943708Z Prisma schema loaded from prisma/schema.prisma
2025-09-10T08:30:57.6944223Z 
2025-09-10T08:30:57.6945440Z âœ” Generated Prisma Client (v6.15.0) to ./src/generated/prisma-client in 135ms
2025-09-10T08:30:57.6946230Z 
2025-09-10T08:30:57.6946926Z Start by importing your Prisma Client (See: https://pris.ly/d/importing-client)
2025-09-10T08:30:57.6947777Z 
2025-09-10T08:30:57.6948567Z Tip: Want to turn off tips and other hints? https://pris.ly/tip-4-nohints
2025-09-10T08:30:57.6949048Z 
2025-09-10T08:30:57.6949474Z ##[endgroup]
2025-09-10T08:30:58.1780620Z ##[group]@speakeasy-services/user-keys:prisma:generate
2025-09-10T08:30:58.1781855Z cache miss, executing 2c179faac421be67
2025-09-10T08:30:58.1782493Z 
2025-09-10T08:30:58.1783620Z > @speakeasy-services/user-keys@0.1.0 prisma:generate /home/runner/work/services/services/services/user-keys
2025-09-10T08:30:58.1784823Z > prisma generate
2025-09-10T08:30:58.1785256Z 
2025-09-10T08:30:58.1785774Z Environment variables loaded from .env
2025-09-10T08:30:58.1786662Z Prisma schema loaded from prisma/schema.prisma
2025-09-10T08:30:58.1787282Z 
2025-09-10T08:30:58.1788602Z âœ” Generated Prisma Client (v6.15.0) to ./src/generated/prisma-client in 165ms
2025-09-10T08:30:58.1789403Z 
2025-09-10T08:30:58.1790191Z Start by importing your Prisma Client (See: https://pris.ly/d/importing-client)
2025-09-10T08:30:58.1790951Z 
2025-09-10T08:30:58.1791930Z Tip: Need your database queries to be 1000x faster? Accelerate offers you that and more: https://pris.ly/tip-2-accelerate
2025-09-10T08:30:58.1792871Z 
2025-09-10T08:30:58.1793444Z ##[endgroup]
2025-09-10T08:30:58.2078317Z ##[group]@speakeasy-services/service-admin:prisma:generate
2025-09-10T08:30:58.2127203Z cache miss, executing 5a760e4723a93d45
2025-09-10T08:30:58.2127882Z 
2025-09-10T08:30:58.2129405Z > @speakeasy-services/service-admin@0.1.0 prisma:generate /home/runner/work/services/services/services/service-admin
2025-09-10T08:30:58.2130577Z > prisma generate
2025-09-10T08:30:58.2131320Z 
2025-09-10T08:30:58.2131781Z Environment variables loaded from .env
2025-09-10T08:30:58.2132803Z Prisma schema loaded from prisma/schema.prisma
2025-09-10T08:30:58.2133320Z 
2025-09-10T08:30:58.2134306Z âœ” Generated Prisma Client (v6.15.0) to ./src/generated/prisma-client in 189ms
2025-09-10T08:30:58.2134993Z 
2025-09-10T08:30:58.2135714Z Start by importing your Prisma Client (See: https://pris.ly/d/importing-client)
2025-09-10T08:30:58.2136485Z 
2025-09-10T08:30:58.2137520Z Tip: Interested in query caching in just a few lines of code? Try Accelerate today! https://pris.ly/tip-3-accelerate
2025-09-10T08:30:58.2138654Z 
2025-09-10T08:30:58.2139697Z ##[endgroup]
2025-09-10T08:31:10.6292930Z ##[group]@speakeasy-services/media:build
2025-09-10T08:31:10.6293817Z cache miss, executing f3e943cfc76303e5
2025-09-10T08:31:10.6294220Z 
2025-09-10T08:31:10.6295063Z > @speakeasy-services/media@0.1.0 prebuild /home/runner/work/services/services/services/media
2025-09-10T08:31:10.6295846Z > prisma generate
2025-09-10T08:31:10.6296062Z 
2025-09-10T08:31:10.6296304Z Environment variables loaded from .env
2025-09-10T08:31:10.6296879Z Prisma schema loaded from prisma/schema.prisma
2025-09-10T08:31:10.6297213Z 
2025-09-10T08:31:10.6298198Z âœ” Generated Prisma Client (v6.15.0) to ./src/generated/prisma-client in 71ms
2025-09-10T08:31:10.6298703Z 
2025-09-10T08:31:10.6299301Z Start by importing your Prisma Client (See: https://pris.ly/d/importing-client)
2025-09-10T08:31:10.6299855Z 
2025-09-10T08:31:10.6300314Z Tip: Want to turn off tips and other hints? https://pris.ly/tip-4-nohints
2025-09-10T08:31:10.6300764Z 
2025-09-10T08:31:10.6300773Z 
2025-09-10T08:31:10.6301353Z > @speakeasy-services/media@0.1.0 build /home/runner/work/services/services/services/media
2025-09-10T08:31:10.6302278Z > prisma generate && tsc --build && cp -r src/generated dist
2025-09-10T08:31:10.6302663Z 
2025-09-10T08:31:10.6302896Z Environment variables loaded from .env
2025-09-10T08:31:10.6303474Z Prisma schema loaded from prisma/schema.prisma
2025-09-10T08:31:10.6303808Z 
2025-09-10T08:31:10.6304416Z âœ” Generated Prisma Client (v6.15.0) to ./src/generated/prisma-client in 112ms
2025-09-10T08:31:10.6304907Z 
2025-09-10T08:31:10.6305434Z Start by importing your Prisma Client (See: https://pris.ly/d/importing-client)
2025-09-10T08:31:10.6305953Z 
2025-09-10T08:31:10.6306717Z Tip: Interested in query caching in just a few lines of code? Try Accelerate today! https://pris.ly/tip-3-accelerate
2025-09-10T08:31:10.6307395Z 
2025-09-10T08:31:10.6394930Z ##[endgroup]
2025-09-10T08:31:11.4010614Z ##[group]@speakeasy-services/trusted-users:build
2025-09-10T08:31:11.4011342Z cache miss, executing 45456064e90b8a7e
2025-09-10T08:31:11.4011654Z 
2025-09-10T08:31:11.4012479Z > @speakeasy-services/trusted-users@0.1.0 prebuild /home/runner/work/services/services/services/trusted-users
2025-09-10T08:31:11.4013372Z > prisma generate
2025-09-10T08:31:11.4013577Z 
2025-09-10T08:31:11.4013830Z Environment variables loaded from .env
2025-09-10T08:31:11.4014446Z Prisma schema loaded from prisma/schema.prisma
2025-09-10T08:31:11.4014803Z 
2025-09-10T08:31:11.4015640Z âœ” Generated Prisma Client (v6.15.0) to ./src/generated/prisma-client in 97ms
2025-09-10T08:31:11.4016163Z 
2025-09-10T08:31:11.4016722Z Start by importing your Prisma Client (See: https://pris.ly/d/importing-client)
2025-09-10T08:31:11.4017242Z 
2025-09-10T08:31:11.4017705Z Tip: Want to turn off tips and other hints? https://pris.ly/tip-4-nohints
2025-09-10T08:31:11.4018424Z 
2025-09-10T08:31:11.4018433Z 
2025-09-10T08:31:11.4019193Z > @speakeasy-services/trusted-users@0.1.0 build /home/runner/work/services/services/services/trusted-users
2025-09-10T08:31:11.4020259Z > prisma generate && tsc --build && cp -r src/generated dist
2025-09-10T08:31:11.4020658Z 
2025-09-10T08:31:11.4020897Z Environment variables loaded from .env
2025-09-10T08:31:11.4021479Z Prisma schema loaded from prisma/schema.prisma
2025-09-10T08:31:11.4021826Z 
2025-09-10T08:31:11.4022839Z âœ” Generated Prisma Client (v6.15.0) to ./src/generated/prisma-client in 144ms
2025-09-10T08:31:11.4023358Z 
2025-09-10T08:31:11.4023921Z Start by importing your Prisma Client (See: https://pris.ly/d/importing-client)
2025-09-10T08:31:11.4024780Z 
2025-09-10T08:31:11.4025598Z Tip: Need your database queries to be 1000x faster? Accelerate offers you that and more: https://pris.ly/tip-2-accelerate
2025-09-10T08:31:11.4026353Z 
2025-09-10T08:31:11.4026723Z ##[endgroup]
2025-09-10T08:31:12.5653897Z ##[group]@speakeasy-services/private-sessions:build
2025-09-10T08:31:12.5663057Z cache miss, executing f2795fd3a5853e36
2025-09-10T08:31:12.5669089Z 
2025-09-10T08:31:12.5671118Z > @speakeasy-services/private-sessions@0.1.0 prebuild /home/runner/work/services/services/services/private-sessions
2025-09-10T08:31:12.5673075Z > prisma generate
2025-09-10T08:31:12.5673283Z 
2025-09-10T08:31:12.5673526Z Environment variables loaded from .env
2025-09-10T08:31:12.5674090Z Prisma schema loaded from prisma/schema.prisma
2025-09-10T08:31:12.5674414Z 
2025-09-10T08:31:12.5675275Z âœ” Generated Prisma Client (v6.15.0) to ./src/generated/prisma-client in 260ms
2025-09-10T08:31:12.5675769Z 
2025-09-10T08:31:12.5676296Z Start by importing your Prisma Client (See: https://pris.ly/d/importing-client)
2025-09-10T08:31:12.5676777Z 
2025-09-10T08:31:12.5677207Z Tip: Want to turn off tips and other hints? https://pris.ly/tip-4-nohints
2025-09-10T08:31:12.5677658Z 
2025-09-10T08:31:12.5677668Z 
2025-09-10T08:31:12.5678687Z > @speakeasy-services/private-sessions@0.1.0 build /home/runner/work/services/services/services/private-sessions
2025-09-10T08:31:12.5679844Z > prisma generate && tsc --build && cp -r src/generated dist
2025-09-10T08:31:12.5680264Z 
2025-09-10T08:31:12.5680538Z Environment variables loaded from .env
2025-09-10T08:31:12.5681167Z Prisma schema loaded from prisma/schema.prisma
2025-09-10T08:31:12.5681535Z 
2025-09-10T08:31:12.5682221Z âœ” Generated Prisma Client (v6.15.0) to ./src/generated/prisma-client in 254ms
2025-09-10T08:31:12.5682729Z 
2025-09-10T08:31:12.5683295Z Start by importing your Prisma Client (See: https://pris.ly/d/importing-client)
2025-09-10T08:31:12.5683828Z 
2025-09-10T08:31:12.5684287Z Tip: Want to turn off tips and other hints? https://pris.ly/tip-4-nohints
2025-09-10T08:31:12.5684745Z 
2025-09-10T08:31:12.5685148Z ##[endgroup]
2025-09-10T08:31:12.6577513Z ##[group]@speakeasy-services/user-keys:build
2025-09-10T08:31:12.6580501Z cache miss, executing 32d420d7aa8f5de4
2025-09-10T08:31:12.6581034Z 
2025-09-10T08:31:12.6581960Z > @speakeasy-services/user-keys@0.1.0 prebuild /home/runner/work/services/services/services/user-keys
2025-09-10T08:31:12.6582974Z > prisma generate
2025-09-10T08:31:12.6583356Z 
2025-09-10T08:31:12.6583781Z Environment variables loaded from .env
2025-09-10T08:31:12.6584580Z Prisma schema loaded from prisma/schema.prisma
2025-09-10T08:31:12.6585117Z 
2025-09-10T08:31:12.6586065Z âœ” Generated Prisma Client (v6.15.0) to ./src/generated/prisma-client in 99ms
2025-09-10T08:31:12.6586716Z 
2025-09-10T08:31:12.6587425Z Start by importing your Prisma Client (See: https://pris.ly/d/importing-client)
2025-09-10T08:31:12.6588493Z 
2025-09-10T08:31:12.6589495Z Tip: Need your database queries to be 1000x faster? Accelerate offers you that and more: https://pris.ly/tip-2-accelerate
2025-09-10T08:31:12.6590435Z 
2025-09-10T08:31:12.6590555Z 
2025-09-10T08:31:12.6591347Z > @speakeasy-services/user-keys@0.1.0 build /home/runner/work/services/services/services/user-keys
2025-09-10T08:31:12.6592497Z > prisma generate && tsc --build && cp -r src/generated dist
2025-09-10T08:31:12.6593053Z 
2025-09-10T08:31:12.6593422Z Environment variables loaded from .env
2025-09-10T08:31:12.6594159Z Prisma schema loaded from prisma/schema.prisma
2025-09-10T08:31:12.6594661Z 
2025-09-10T08:31:12.6595679Z âœ” Generated Prisma Client (v6.15.0) to ./src/generated/prisma-client in 182ms
2025-09-10T08:31:12.6596393Z 
2025-09-10T08:31:12.6597062Z Start by importing your Prisma Client (See: https://pris.ly/d/importing-client)
2025-09-10T08:31:12.6597728Z 
2025-09-10T08:31:12.6599246Z Tip: Need your database queries to be 1000x faster? Accelerate offers you that and more: https://pris.ly/tip-2-accelerate
2025-09-10T08:31:12.6600368Z 
2025-09-10T08:31:12.6600869Z ##[endgroup]
2025-09-10T08:31:12.7385892Z ##[group]@speakeasy-services/service-admin:build
2025-09-10T08:31:12.7386615Z cache miss, executing d743fc4820383576
2025-09-10T08:31:12.7386925Z 
2025-09-10T08:31:12.7387715Z > @speakeasy-services/service-admin@0.1.0 prebuild /home/runner/work/services/services/services/service-admin
2025-09-10T08:31:12.7388784Z > prisma generate
2025-09-10T08:31:12.7388995Z 
2025-09-10T08:31:12.7389235Z Environment variables loaded from .env
2025-09-10T08:31:12.7389820Z Prisma schema loaded from prisma/schema.prisma
2025-09-10T08:31:12.7390168Z 
2025-09-10T08:31:12.7391015Z âœ” Generated Prisma Client (v6.15.0) to ./src/generated/prisma-client in 176ms
2025-09-10T08:31:12.7391548Z 
2025-09-10T08:31:12.7392131Z Start by importing your Prisma Client (See: https://pris.ly/d/importing-client)
2025-09-10T08:31:12.7392722Z 
2025-09-10T08:31:12.7393514Z Tip: Interested in query caching in just a few lines of code? Try Accelerate today! https://pris.ly/tip-3-accelerate
2025-09-10T08:31:12.7394225Z 
2025-09-10T08:31:12.7394234Z 
2025-09-10T08:31:12.7394992Z > @speakeasy-services/service-admin@0.1.0 build /home/runner/work/services/services/services/service-admin
2025-09-10T08:31:12.7396059Z > prisma generate && tsc --build && cp -r src/generated dist
2025-09-10T08:31:12.7396463Z 
2025-09-10T08:31:12.7396708Z Environment variables loaded from .env
2025-09-10T08:31:12.7397294Z Prisma schema loaded from prisma/schema.prisma
2025-09-10T08:31:12.7397632Z 
2025-09-10T08:31:12.7398454Z âœ” Generated Prisma Client (v6.15.0) to ./src/generated/prisma-client in 135ms
2025-09-10T08:31:12.7398982Z 
2025-09-10T08:31:12.7399521Z Start by importing your Prisma Client (See: https://pris.ly/d/importing-client)
2025-09-10T08:31:12.7400063Z 
2025-09-10T08:31:12.7400846Z Tip: Interested in query caching in just a few lines of code? Try Accelerate today! https://pris.ly/tip-3-accelerate
2025-09-10T08:31:12.7401554Z 
2025-09-10T08:31:12.7401564Z 
2025-09-10T08:31:12.7402376Z > @speakeasy-services/service-admin@0.1.0 postbuild /home/runner/work/services/services/services/service-admin
2025-09-10T08:31:12.7403315Z > chmod +x dist/cli/addInvite.js
2025-09-10T08:31:12.7403571Z 
2025-09-10T08:31:12.7403934Z ##[endgroup]
2025-09-10T08:31:12.7529560Z 
2025-09-10T08:31:12.7530173Z  Tasks:    15 successful, 15 total
2025-09-10T08:31:12.7530901Z Cached:    0 cached, 15 total
2025-09-10T08:31:12.7531403Z   Time:    26.926s 
2025-09-10T08:31:12.7531711Z 
2025-09-10T08:31:12.8821456Z ##[group]Run NODE_ENV=test pnpm test
2025-09-10T08:31:12.8821759Z [36;1mNODE_ENV=test pnpm test[0m
2025-09-10T08:31:12.8851435Z shell: /usr/bin/bash -e {0}
2025-09-10T08:31:12.8851651Z env:
2025-09-10T08:31:12.8851870Z   PNPM_HOME: /home/runner/setup-pnpm/node_modules/.bin
2025-09-10T08:31:12.8852138Z   CI: true
2025-09-10T08:31:12.8852306Z ##[endgroup]
2025-09-10T08:31:13.1473052Z 
2025-09-10T08:31:13.1473697Z > speakeasy-services@0.1.0 test /home/runner/work/services/services
2025-09-10T08:31:13.1474259Z > turbo run test --continue
2025-09-10T08:31:13.1474426Z 
2025-09-10T08:31:13.2645063Z â€¢ Packages in scope: @speakeasy-services/common, @speakeasy-services/crypto, @speakeasy-services/media, @speakeasy-services/private-sessions, @speakeasy-services/queue, @speakeasy-services/service-admin, @speakeasy-services/service-base, @speakeasy-services/test-utils, @speakeasy-services/trusted-users, @speakeasy-services/user-keys
2025-09-10T08:31:13.2646484Z â€¢ Running test in 10 packages
2025-09-10T08:31:13.3491872Z â€¢ Remote caching disabled
2025-09-10T08:31:13.3492630Z ##[group]@speakeasy-services/common:build
2025-09-10T08:31:13.3494218Z cache hit, replaying logs 5d2bdf062730c893
2025-09-10T08:31:13.3494549Z 
2025-09-10T08:31:13.3495159Z > @speakeasy-services/common@0.1.0 build /home/runner/work/services/services/packages/common
2025-09-10T08:31:13.3495852Z > tsc --build
2025-09-10T08:31:13.3496025Z 
2025-09-10T08:31:13.3496484Z ##[endgroup]
2025-09-10T08:31:13.3548696Z ##[group]@speakeasy-services/crypto:build
2025-09-10T08:31:13.3550956Z cache hit, replaying logs 50a3dd0fba249376
2025-09-10T08:31:13.3551270Z 
2025-09-10T08:31:13.3551875Z > @speakeasy-services/crypto@0.1.0 build /home/runner/work/services/services/packages/crypto
2025-09-10T08:31:13.3552570Z > tsc --build
2025-09-10T08:31:13.3552753Z 
2025-09-10T08:31:13.3553109Z ##[endgroup]
2025-09-10T08:31:13.3578889Z ##[group]@speakeasy-services/queue:build
2025-09-10T08:31:13.3590949Z cache hit, replaying logs 2fa8e2dbd1fd9e39
2025-09-10T08:31:13.3591310Z 
2025-09-10T08:31:13.3591912Z > @speakeasy-services/queue@0.1.0 build /home/runner/work/services/services/packages/queue
2025-09-10T08:31:13.3592613Z > tsc --build
2025-09-10T08:31:13.3592794Z 
2025-09-10T08:31:13.3593224Z ##[endgroup]
2025-09-10T08:31:13.3672051Z ##[group]@speakeasy-services/service-base:build
2025-09-10T08:31:13.3692085Z cache hit, replaying logs a41124420aac09d5
2025-09-10T08:31:13.3692715Z 
2025-09-10T08:31:13.3697145Z > @speakeasy-services/service-base@0.1.0 build /home/runner/work/services/services/packages/service-base
2025-09-10T08:31:13.3698697Z > tsc --build
2025-09-10T08:31:13.3699299Z 
2025-09-10T08:31:13.3699880Z ##[endgroup]
2025-09-10T08:31:13.3753758Z ##[group]@speakeasy-services/test-utils:build
2025-09-10T08:31:13.3754637Z cache hit, replaying logs 832dabdf1002b9a8
2025-09-10T08:31:13.3755248Z 
2025-09-10T08:31:13.3756127Z > @speakeasy-services/test-utils@0.1.0 build /home/runner/work/services/services/packages/test-utils
2025-09-10T08:31:13.3757008Z > tsc --build
2025-09-10T08:31:13.3757367Z 
2025-09-10T08:31:13.3758521Z ##[endgroup]
2025-09-10T08:31:13.5389863Z ##[group]@speakeasy-services/private-sessions:prisma:generate
2025-09-10T08:31:13.5418929Z cache hit, replaying logs b7cd3625cd7c7d01
2025-09-10T08:31:13.5419644Z 
2025-09-10T08:31:13.5420863Z > @speakeasy-services/private-sessions@0.1.0 prisma:generate /home/runner/work/services/services/services/private-sessions
2025-09-10T08:31:13.5422171Z > prisma generate
2025-09-10T08:31:13.5422625Z 
2025-09-10T08:31:13.5423117Z Environment variables loaded from .env
2025-09-10T08:31:13.5424062Z Prisma schema loaded from prisma/schema.prisma
2025-09-10T08:31:13.5424689Z 
2025-09-10T08:31:13.5425810Z âœ” Generated Prisma Client (v6.15.0) to ./src/generated/prisma-client in 301ms
2025-09-10T08:31:13.5426625Z 
2025-09-10T08:31:13.5427439Z Start by importing your Prisma Client (See: https://pris.ly/d/importing-client)
2025-09-10T08:31:13.5428484Z 
2025-09-10T08:31:13.5429474Z Tip: Want to turn off tips and other hints? https://pris.ly/tip-4-nohints
2025-09-10T08:31:13.5430143Z 
2025-09-10T08:31:13.5430685Z ##[endgroup]
2025-09-10T08:31:13.5540572Z ##[group]@speakeasy-services/trusted-users:prisma:generate
2025-09-10T08:31:13.5545678Z cache hit, replaying logs eac29c7794f48588
2025-09-10T08:31:13.5550559Z 
2025-09-10T08:31:13.5555014Z > @speakeasy-services/trusted-users@0.1.0 prisma:generate /home/runner/work/services/services/services/trusted-users
2025-09-10T08:31:13.5559955Z > prisma generate
2025-09-10T08:31:13.5560417Z 
2025-09-10T08:31:13.5563989Z Environment variables loaded from .env
2025-09-10T08:31:13.5564819Z Prisma schema loaded from prisma/schema.prisma
2025-09-10T08:31:13.5565324Z 
2025-09-10T08:31:13.5566133Z âœ” Generated Prisma Client (v6.15.0) to ./src/generated/prisma-client in 77ms
2025-09-10T08:31:13.5567185Z 
2025-09-10T08:31:13.5567754Z Start by importing your Prisma Client (See: https://pris.ly/d/importing-client)
2025-09-10T08:31:13.5568488Z 
2025-09-10T08:31:13.5569358Z Tip: Need your database queries to be 1000x faster? Accelerate offers you that and more: https://pris.ly/tip-2-accelerate
2025-09-10T08:31:13.5570726Z 
2025-09-10T08:31:13.5572044Z ##[endgroup]
2025-09-10T08:31:13.5607430Z ##[group]@speakeasy-services/media:prisma:generate
2025-09-10T08:31:13.5612291Z cache hit, replaying logs efffbab482d147db
2025-09-10T08:31:13.5616511Z 
2025-09-10T08:31:13.5620880Z > @speakeasy-services/media@0.1.0 prisma:generate /home/runner/work/services/services/services/media
2025-09-10T08:31:13.5625001Z > prisma generate
2025-09-10T08:31:13.5629196Z 
2025-09-10T08:31:13.5632872Z Environment variables loaded from .env
2025-09-10T08:31:13.5637069Z Prisma schema loaded from prisma/schema.prisma
2025-09-10T08:31:13.5645385Z 
2025-09-10T08:31:13.5649974Z âœ” Generated Prisma Client (v6.15.0) to ./src/generated/prisma-client in 135ms
2025-09-10T08:31:13.5653958Z 
2025-09-10T08:31:13.5658258Z Start by importing your Prisma Client (See: https://pris.ly/d/importing-client)
2025-09-10T08:31:13.5663583Z 
2025-09-10T08:31:13.5667838Z Tip: Want to turn off tips and other hints? https://pris.ly/tip-4-nohints
2025-09-10T08:31:13.5670024Z 
2025-09-10T08:31:13.5700771Z ##[endgroup]
2025-09-10T08:31:13.5709011Z ##[group]@speakeasy-services/user-keys:prisma:generate
2025-09-10T08:31:13.5710017Z cache hit, replaying logs 2c179faac421be67
2025-09-10T08:31:13.5710570Z 
2025-09-10T08:31:13.5711614Z > @speakeasy-services/user-keys@0.1.0 prisma:generate /home/runner/work/services/services/services/user-keys
2025-09-10T08:31:13.5712715Z > prisma generate
2025-09-10T08:31:13.5713082Z 
2025-09-10T08:31:13.5713458Z Environment variables loaded from .env
2025-09-10T08:31:13.5714163Z Prisma schema loaded from prisma/schema.prisma
2025-09-10T08:31:13.5714655Z 
2025-09-10T08:31:13.5715514Z âœ” Generated Prisma Client (v6.15.0) to ./src/generated/prisma-client in 165ms
2025-09-10T08:31:13.5716225Z 
2025-09-10T08:31:13.5716926Z Start by importing your Prisma Client (See: https://pris.ly/d/importing-client)
2025-09-10T08:31:13.5717622Z 
2025-09-10T08:31:13.5718814Z Tip: Need your database queries to be 1000x faster? Accelerate offers you that and more: https://pris.ly/tip-2-accelerate
2025-09-10T08:31:13.5719725Z 
2025-09-10T08:31:13.5720256Z ##[endgroup]
2025-09-10T08:31:13.6461766Z ##[group]@speakeasy-services/service-admin:prisma:generate
2025-09-10T08:31:13.6466409Z cache hit, replaying logs 5a760e4723a93d45
2025-09-10T08:31:13.6470592Z 
2025-09-10T08:31:13.6475391Z > @speakeasy-services/service-admin@0.1.0 prisma:generate /home/runner/work/services/services/services/service-admin
2025-09-10T08:31:13.6481248Z > prisma generate
2025-09-10T08:31:13.6483396Z 
2025-09-10T08:31:13.6484983Z Environment variables loaded from .env
2025-09-10T08:31:13.6490823Z Prisma schema loaded from prisma/schema.prisma
2025-09-10T08:31:13.6491209Z 
2025-09-10T08:31:13.6492096Z âœ” Generated Prisma Client (v6.15.0) to ./src/generated/prisma-client in 189ms
2025-09-10T08:31:13.6493999Z 
2025-09-10T08:31:13.6496233Z Start by importing your Prisma Client (See: https://pris.ly/d/importing-client)
2025-09-10T08:31:13.6502507Z 
2025-09-10T08:31:13.6503306Z Tip: Interested in query caching in just a few lines of code? Try Accelerate today! https://pris.ly/tip-3-accelerate
2025-09-10T08:31:13.6503975Z 
2025-09-10T08:31:13.6504369Z ##[endgroup]
2025-09-10T08:31:14.1062598Z ##[group]@speakeasy-services/service-base:test
2025-09-10T08:31:14.1067040Z cache miss, executing 5f8f3de8b7e8ed73
2025-09-10T08:31:14.1070767Z 
2025-09-10T08:31:14.1100803Z > @speakeasy-services/service-base@0.1.0 test /home/runner/work/services/services/packages/service-base
2025-09-10T08:31:14.1101760Z > echo 'No tests yet'
2025-09-10T08:31:14.1101997Z 
2025-09-10T08:31:14.1102137Z No tests yet
2025-09-10T08:31:14.1102708Z ##[endgroup]
2025-09-10T08:31:14.1667324Z ##[group]@speakeasy-services/queue:test
2025-09-10T08:31:14.1668638Z cache miss, executing cef17fc4656d86e1
2025-09-10T08:31:14.1669188Z 
2025-09-10T08:31:14.1670147Z > @speakeasy-services/queue@0.1.0 test /home/runner/work/services/services/packages/queue
2025-09-10T08:31:14.1671187Z > echo 'No tests yet'
2025-09-10T08:31:14.1671651Z 
2025-09-10T08:31:14.1672125Z No tests yet
2025-09-10T08:31:14.1672861Z ##[endgroup]
2025-09-10T08:31:17.9144175Z ##[group]@speakeasy-services/common:test
2025-09-10T08:31:17.9146163Z cache miss, executing 0ffc76c13d4d027e
2025-09-10T08:31:17.9147606Z 
2025-09-10T08:31:17.9149672Z > @speakeasy-services/common@0.1.0 test /home/runner/work/services/services/packages/common
2025-09-10T08:31:17.9151766Z > vitest run
2025-09-10T08:31:17.9156245Z 
2025-09-10T08:31:17.9160696Z 
2025-09-10T08:31:17.9165423Z [1m[46m RUN [49m[22m [36mv3.2.4 [39m[90m/home/runner/work/services/services/packages/common[39m
2025-09-10T08:31:17.9173669Z 
2025-09-10T08:31:17.9181252Z  [32mâœ“[39m tests/bsky.test.ts [2m([22m[2m10 tests[22m[2m)[22m[33m 778[2mms[22m[39m
2025-09-10T08:31:17.9183265Z    [33m[2mâœ“[22m[39m Enhanced JWT Authentication - fetchBlueskySession[2m > [22mJWT Structure Validation[2m > [22mshould work without issuer (iss) claim [33m 603[2mms[22m[39m
2025-09-10T08:31:17.9184814Z 
2025-09-10T08:31:17.9185555Z [2m Test Files [22m [1m[32m1 passed[39m[22m[90m (1)[39m
2025-09-10T08:31:17.9191523Z [2m      Tests [22m [1m[32m10 passed[39m[22m[90m (10)[39m
2025-09-10T08:31:17.9192694Z [2m   Start at [22m 08:31:14
2025-09-10T08:31:17.9194127Z [2m   Duration [22m 2.66s[2m (transform 441ms, setup 0ms, collect 1.14s, tests 778ms, environment 0ms, prepare 338ms)[22m
2025-09-10T08:31:17.9194932Z 
2025-09-10T08:31:17.9195499Z ##[endgroup]
2025-09-10T08:31:20.5907895Z ##[group]@speakeasy-services/service-admin:test
2025-09-10T08:31:20.5908919Z cache miss, executing d9a876579e814cff
2025-09-10T08:31:20.5909139Z 
2025-09-10T08:31:20.5909566Z > @speakeasy-services/service-admin@0.1.0 test /home/runner/work/services/services/services/service-admin
2025-09-10T08:31:20.5910185Z > vitest run
2025-09-10T08:31:20.5910384Z 
2025-09-10T08:31:20.5910392Z 
2025-09-10T08:31:20.5911360Z [1m[46m RUN [49m[22m [36mv3.2.4 [39m[90m/home/runner/work/services/services/services/service-admin[39m
2025-09-10T08:31:20.5911809Z 
2025-09-10T08:31:20.5912328Z [2025-09-10 08:31:18.797 +0000] INFO: ðŸš€ service-admin service running on port 0 {"service":"service-admin"}
2025-09-10T08:31:20.5913457Z  [32mâœ“[39m tests/integration/api/feature.test.ts[2m > [22mService Admin API Tests[2m > [22mgetFeatures endpoint[2m > [22mshould get features for user with no features[33m 377[2mms[22m[39m
2025-09-10T08:31:20.5914786Z  [32mâœ“[39m tests/integration/api/feature.test.ts[2m > [22mService Admin API Tests[2m > [22mgetFeatures endpoint[2m > [22mshould get features for user with existing features[32m 45[2mms[22m[39m
2025-09-10T08:31:20.5916161Z [90mstdout[2m | tests/integration/api/feature.test.ts[2m > [22m[2mService Admin API Tests[2m > [22m[2mapplyInviteCode endpoint[2m > [22m[2mshould reject invalid invite code
2025-09-10T08:31:20.5916902Z [22m[39mNotFoundError: Invalid invite code
2025-09-10T08:31:20.5917880Z     at /home/runner/work/services/services/services/service-admin/src/services/feature.service.ts:47:15
2025-09-10T08:31:20.5919615Z     at Proxy._transactionWithCallback (/home/runner/work/services/services/services/service-admin/src/generated/prisma-client/runtime/library.js:133:8120)
2025-09-10T08:31:20.5921460Z     at FeatureService.applyInviteCode (/home/runner/work/services/services/services/service-admin/src/services/feature.service.ts:36:5)
2025-09-10T08:31:20.5923290Z     at Object.social.spkeasy.actor.applyInviteCode [as handler] (/home/runner/work/services/services/services/service-admin/src/routes/feature.routes.ts:48:5)
2025-09-10T08:31:20.5924338Z     at /home/runner/work/services/services/packages/service-base/src/server.ts:137:26
2025-09-10T08:31:20.5924666Z 
2025-09-10T08:31:20.5926140Z [2025-09-10 08:31:19.147 +0000] INFO: {"service":"service-admin","requestId":"unknown","method":"social.spkeasy.actor.getFeatures","path":"/xrpc/social.spkeasy.actor.getFeatures","duration":246,"status":200,"ip":"313d5b13e067911efcc8e257ab3925051bb57a136f2d54f697e1e92ef9997f35","user":"3698761d94b6992d6277d4dc2932712760c796ead51e44dd484d665e3bcd7c08","authDuration":46}
2025-09-10T08:31:20.5928962Z [2025-09-10 08:31:19.196 +0000] INFO: {"service":"service-admin","requestId":"unknown","method":"social.spkeasy.actor.getFeatures","path":"/xrpc/social.spkeasy.actor.getFeatures","duration":3,"status":200,"ip":"313d5b13e067911efcc8e257ab3925051bb57a136f2d54f697e1e92ef9997f35","user":"3698761d94b6992d6277d4dc2932712760c796ead51e44dd484d665e3bcd7c08","authDuration":16}
2025-09-10T08:31:20.5931813Z [2025-09-10 08:31:19.283 +0000] INFO: {"service":"service-admin","requestId":"unknown","method":"social.spkeasy.actor.applyInviteCode","path":"/xrpc/social.spkeasy.actor.applyInviteCode","duration":29,"status":200,"ip":"313d5b13e067911efcc8e257ab3925051bb57a136f2d54f697e1e92ef9997f35","user":"3698761d94b6992d6277d4dc2932712760c796ead51e44dd484d665e3bcd7c08","authDuration":20}
2025-09-10T08:31:20.5934841Z [2025-09-10 08:31:19.339 +0000] ERROR: NotFoundError occurred {"service":"service-admin","requestId":"unknown","method":"POST","path":"/xrpc/social.spkeasy.actor.applyInviteCode","duration":18,"status":404,"ip":"313d5b13e067911efcc8e257ab3925051bb57a136f2d54f697e1e92ef9997f35","user":"3698761d94b6992d6277d4dc2932712760c796ead51e44dd484d665e3bcd7c08","relevantLine":"/services/services/services/service-admin/src/generated/prisma-client/runtime/library.js:133:8120"}
2025-09-10T08:31:20.5936383Z     error: {
2025-09-10T08:31:20.5936580Z       "name": "NotFoundError",
2025-09-10T08:31:20.5936836Z       "message": "Invalid invite code",
2025-09-10T08:31:20.5937070Z       "statusCode": 404,
2025-09-10T08:31:20.5937259Z       "stack":
2025-09-10T08:31:20.5937472Z           NotFoundError: Invalid invite code
2025-09-10T08:31:20.5938226Z               at /home/runner/work/services/services/services/service-admin/src/services/feature.service.ts:47:15
2025-09-10T08:31:20.5939200Z               at Proxy._transactionWithCallback (/home/runner/work/services/services/services/service-admin/src/generated/prisma-client/runtime/library.js:133:8120)
2025-09-10T08:31:20.5940256Z               at FeatureService.applyInviteCode (/home/runner/work/services/services/services/service-admin/src/services/feature.service.ts:36:5)
2025-09-10T08:31:20.5941316Z               at Object.social.spkeasy.actor.applyInviteCode [as handler] (/home/runner/work/services/services/services/service-admin/src/routes/feature.routes.ts:48:5)
2025-09-10T08:31:20.5942146Z               at /home/runner/work/services/services/packages/service-base/src/server.ts:137:26
2025-09-10T08:31:20.5942535Z     }
2025-09-10T08:31:20.5943505Z [90mstdout[2m | tests/integration/api/feature.test.ts[2m > [22m[2mService Admin API Tests[2m > [22m[2mapplyInviteCode endpoint[2m > [22m[2mshould reject invite code with no remaining uses
2025-09-10T08:31:20.5944341Z [22m[39mValidationError: Invite code has been fully redeemed
2025-09-10T08:31:20.5945052Z     at /home/runner/work/services/services/services/service-admin/src/services/feature.service.ts:63:15
2025-09-10T08:31:20.5946000Z     at Proxy._transactionWithCallback (/home/runner/work/services/services/services/service-admin/src/generated/prisma-client/runtime/library.js:133:8120)
2025-09-10T08:31:20.5947034Z     at FeatureService.applyInviteCode (/home/runner/work/services/services/services/service-admin/src/services/feature.service.ts:36:5)
2025-09-10T08:31:20.5948372Z     at Object.social.spkeasy.actor.applyInviteCode [as handler] (/home/runner/work/services/services/services/service-admin/src/routes/feature.routes.ts:48:5)
2025-09-10T08:31:20.5949526Z     at /home/runner/work/services/services/packages/service-base/src/server.ts:137:26
2025-09-10T08:31:20.5949849Z 
2025-09-10T08:31:20.5950591Z  [32mâœ“[39m tests/integration/api/feature.test.ts[2m > [22mService Admin API Tests[2m > [22mapplyInviteCode endpoint[2m > [22mshould apply valid invite code[32m 95[2mms[22m[39m
2025-09-10T08:31:20.5951873Z  [32mâœ“[39m tests/integration/api/feature.test.ts[2m > [22mService Admin API Tests[2m > [22mapplyInviteCode endpoint[2m > [22mshould reject invalid invite code[32m 41[2mms[22m[39m
2025-09-10T08:31:20.5954464Z [2025-09-10 08:31:19.386 +0000] ERROR: ValidationError occurred {"service":"service-admin","requestId":"unknown","method":"POST","path":"/xrpc/social.spkeasy.actor.applyInviteCode","duration":19,"status":400,"ip":"313d5b13e067911efcc8e257ab3925051bb57a136f2d54f697e1e92ef9997f35","user":"3698761d94b6992d6277d4dc2932712760c796ead51e44dd484d665e3bcd7c08","relevantLine":"/services/services/services/service-admin/src/generated/prisma-client/runtime/library.js:133:8120"}
2025-09-10T08:31:20.5956269Z     error: {
2025-09-10T08:31:20.5956668Z       "name": "ValidationError",
2025-09-10T08:31:20.5957057Z       "message": "Invite code has been fully redeemed",
2025-09-10T08:31:20.5957454Z       "statusCode": 400,
2025-09-10T08:31:20.5957782Z       "stack":
2025-09-10T08:31:20.5958405Z           ValidationError: Invite code has been fully redeemed
2025-09-10T08:31:20.5959070Z               at /home/runner/work/services/services/services/service-admin/src/services/feature.service.ts:63:15
2025-09-10T08:31:20.5960160Z               at Proxy._transactionWithCallback (/home/runner/work/services/services/services/service-admin/src/generated/prisma-client/runtime/library.js:133:8120)
2025-09-10T08:31:20.5961352Z               at FeatureService.applyInviteCode (/home/runner/work/services/services/services/service-admin/src/services/feature.service.ts:36:5)
2025-09-10T08:31:20.5962561Z               at Object.social.spkeasy.actor.applyInviteCode [as handler] (/home/runner/work/services/services/services/service-admin/src/routes/feature.routes.ts:48:5)
2025-09-10T08:31:20.5963569Z               at /home/runner/work/services/services/packages/service-base/src/server.ts:137:26
2025-09-10T08:31:20.5964013Z     }
2025-09-10T08:31:20.5965009Z [90mstdout[2m | tests/integration/api/feature.test.ts[2m > [22m[2mService Admin API Tests[2m > [22m[2mapplyInviteCode endpoint[2m > [22m[2mshould reject duplicate feature application
2025-09-10T08:31:20.5965977Z [22m[39mValidationError: You already have this feature
2025-09-10T08:31:20.5966634Z     at /home/runner/work/services/services/services/service-admin/src/services/feature.service.ts:59:15
2025-09-10T08:31:20.5967658Z     at Proxy._transactionWithCallback (/home/runner/work/services/services/services/service-admin/src/generated/prisma-client/runtime/library.js:133:8120)
2025-09-10T08:31:20.5969344Z     at FeatureService.applyInviteCode (/home/runner/work/services/services/services/service-admin/src/services/feature.service.ts:36:5)
2025-09-10T08:31:20.5970486Z     at Object.social.spkeasy.actor.applyInviteCode [as handler] (/home/runner/work/services/services/services/service-admin/src/routes/feature.routes.ts:48:5)
2025-09-10T08:31:20.5971406Z     at /home/runner/work/services/services/packages/service-base/src/server.ts:137:26
2025-09-10T08:31:20.5971856Z 
2025-09-10T08:31:20.5972902Z  [32mâœ“[39m tests/integration/api/feature.test.ts[2m > [22mService Admin API Tests[2m > [22mapplyInviteCode endpoint[2m > [22mshould reject invite code with no remaining uses[32m 55[2mms[22m[39m
2025-09-10T08:31:20.5974426Z  [32mâœ“[39m tests/integration/api/feature.test.ts[2m > [22mService Admin API Tests[2m > [22mapplyInviteCode endpoint[2m > [22mshould reject duplicate feature application[32m 56[2mms[22m[39m
2025-09-10T08:31:20.5977063Z [2025-09-10 08:31:19.452 +0000] ERROR: ValidationError occurred {"service":"service-admin","requestId":"unknown","method":"POST","path":"/xrpc/social.spkeasy.actor.applyInviteCode","duration":11,"status":400,"ip":"313d5b13e067911efcc8e257ab3925051bb57a136f2d54f697e1e92ef9997f35","user":"3698761d94b6992d6277d4dc2932712760c796ead51e44dd484d665e3bcd7c08","relevantLine":"/services/services/services/service-admin/src/generated/prisma-client/runtime/library.js:133:8120"}
2025-09-10T08:31:20.5978963Z     error: {
2025-09-10T08:31:20.5979277Z       "name": "ValidationError",
2025-09-10T08:31:20.5979708Z       "message": "You already have this feature",
2025-09-10T08:31:20.5980052Z       "statusCode": 400,
2025-09-10T08:31:20.5980375Z       "stack":
2025-09-10T08:31:20.5980774Z           ValidationError: You already have this feature
2025-09-10T08:31:20.5981417Z               at /home/runner/work/services/services/services/service-admin/src/services/feature.service.ts:59:15
2025-09-10T08:31:20.5982476Z               at Proxy._transactionWithCallback (/home/runner/work/services/services/services/service-admin/src/generated/prisma-client/runtime/library.js:133:8120)
2025-09-10T08:31:20.5983825Z               at FeatureService.applyInviteCode (/home/runner/work/services/services/services/service-admin/src/services/feature.service.ts:36:5)
2025-09-10T08:31:20.5984971Z               at Object.social.spkeasy.actor.applyInviteCode [as handler] (/home/runner/work/services/services/services/service-admin/src/routes/feature.routes.ts:48:5)
2025-09-10T08:31:20.5985954Z               at /home/runner/work/services/services/packages/service-base/src/server.ts:137:26
2025-09-10T08:31:20.5986472Z     }
2025-09-10T08:31:20.5986931Z [2025-09-10 08:31:19.459 +0000] INFO: Shutting down server... {"service":"service-admin"}
2025-09-10T08:31:20.5987586Z [2025-09-10 08:31:19.473 +0000] INFO: Shutting down server... {"service":"service-admin"}
2025-09-10T08:31:20.5987909Z 
2025-09-10T08:31:20.5988484Z [2m Test Files [22m [1m[32m1 passed[39m[22m[90m (1)[39m
2025-09-10T08:31:20.5989105Z [2m      Tests [22m [1m[32m6 passed[39m[22m[90m (6)[39m
2025-09-10T08:31:20.5989542Z [2m   Start at [22m 08:31:15
2025-09-10T08:31:20.5990328Z [2m   Duration [22m 5.11s[2m (transform 756ms, setup 202ms, collect 1.79s, tests 866ms, environment 0ms, prepare 766ms)[22m
2025-09-10T08:31:20.5990761Z 
2025-09-10T08:31:20.5991116Z ##[endgroup]
2025-09-10T08:31:21.0066481Z ##[group]@speakeasy-services/trusted-users:test
2025-09-10T08:31:21.0067502Z cache miss, executing 0dfc690f1b3694c1
2025-09-10T08:31:21.0068800Z 
2025-09-10T08:31:21.0069712Z > @speakeasy-services/trusted-users@0.1.0 test /home/runner/work/services/services/services/trusted-users
2025-09-10T08:31:21.0071064Z > vitest run
2025-09-10T08:31:21.0071367Z 
2025-09-10T08:31:21.0071376Z 
2025-09-10T08:31:21.0073952Z [1m[46m RUN [49m[22m [36mv3.2.4 [39m[90m/home/runner/work/services/services/services/trusted-users[39m
2025-09-10T08:31:21.0074782Z 
2025-09-10T08:31:21.0075820Z [2025-09-10 08:31:19.214 +0000] INFO: ðŸš€ trusted-users service running on port 0 {"service":"trusted-users"}
2025-09-10T08:31:21.0079621Z [2025-09-10 08:31:19.464 +0000] INFO: {"service":"trusted-users","requestId":"unknown","method":"social.spkeasy.graph.getTrusted","path":"/xrpc/social.spkeasy.graph.getTrusted","duration":179,"status":200,"ip":"313d5b13e067911efcc8e257ab3925051bb57a136f2d54f697e1e92ef9997f35","user":"3698761d94b6992d6277d4dc2932712760c796ead51e44dd484d665e3bcd7c08","authDuration":38}
2025-09-10T08:31:21.0084566Z [90mstdout[2m | tests/integration/api/trust.test.ts[2m > [22m[2mTrusted Users API Tests[2m > [22m[2mTrusted Users API Tests[2m > [22m[2mget social.spkeasy.graph.getTrusted - empty list - without token[2m > [22m[2mshould return expected response
2025-09-10T08:31:21.0086729Z [22m[39mAuthenticationError: Missing authorization header
2025-09-10T08:31:21.0088148Z     at getBearerToken (/home/runner/work/services/services/packages/common/src/auth/bearer-tokens.ts:58:11)
2025-09-10T08:31:21.0090032Z     at authenticateToken (/home/runner/work/services/services/packages/common/src/auth/bearer-tokens.ts:81:17)
2025-09-10T08:31:21.0092037Z     at newFn (/home/runner/work/services/services/node_modules/.pnpm/express-async-errors@3.1.1_express@4.21.2/node_modules/express-async-errors/index.js:16:20)
2025-09-10T08:31:21.0094203Z     at Layer.handle [as handle_request] (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/layer.js:95:5)
2025-09-10T08:31:21.0096403Z     at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:149:13)
2025-09-10T08:31:21.0098515Z     at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:145:7)
2025-09-10T08:31:21.0100472Z     at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:145:7)
2025-09-10T08:31:21.0102369Z     at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:145:7)
2025-09-10T08:31:21.0104523Z     at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:145:7)
2025-09-10T08:31:21.0106403Z     at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:145:7)
2025-09-10T08:31:21.0107333Z 
2025-09-10T08:31:21.0110572Z [2025-09-10 08:31:19.491 +0000] ERROR: AuthenticationError occurred {"service":"trusted-users","requestId":"unknown","method":"GET","path":"/xrpc/social.spkeasy.graph.getTrusted","duration":null,"status":401,"ip":"313d5b13e067911efcc8e257ab3925051bb57a136f2d54f697e1e92ef9997f35","relevantLine":"/services/services/packages/common/src/auth/bearer-tokens.ts:58:11"}
2025-09-10T08:31:21.0113062Z     error: {
2025-09-10T08:31:21.0113780Z       "name": "AuthenticationError",
2025-09-10T08:31:21.0114553Z       "message": "Missing authorization header",
2025-09-10T08:31:21.0115140Z       "statusCode": 401,
2025-09-10T08:31:21.0115762Z       "stack":
2025-09-10T08:31:21.0116448Z           AuthenticationError: Missing authorization header
2025-09-10T08:31:21.0117667Z               at getBearerToken (/home/runner/work/services/services/packages/common/src/auth/bearer-tokens.ts:58:11)
2025-09-10T08:31:21.0119795Z               at authenticateToken (/home/runner/work/services/services/packages/common/src/auth/bearer-tokens.ts:81:17)
2025-09-10T08:31:21.0121915Z               at newFn (/home/runner/work/services/services/node_modules/.pnpm/express-async-errors@3.1.1_express@4.21.2/node_modules/express-async-errors/index.js:16:20)
2025-09-10T08:31:21.0124164Z               at Layer.handle [as handle_request] (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/layer.js:95:5)
2025-09-10T08:31:21.0126213Z               at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:149:13)
2025-09-10T08:31:21.0128232Z               at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:145:7)
2025-09-10T08:31:21.0130078Z               at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:145:7)
2025-09-10T08:31:21.0131823Z               at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:145:7)
2025-09-10T08:31:21.0133817Z               at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:145:7)
2025-09-10T08:31:21.0135681Z               at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:145:7)
2025-09-10T08:31:21.0136948Z     }
2025-09-10T08:31:21.0139807Z [90mstdout[2m | tests/integration/api/trust.test.ts[2m > [22m[2mTrusted Users API Tests[2m > [22m[2mTrusted Users API Tests[2m > [22m[2mget social.spkeasy.graph.getTrusted - empty list - with wrong user token[2m > [22m[2mshould return expected response
2025-09-10T08:31:21.0142165Z [22m[39mAuthorizationError: Not authorized to list on trusted_user
2025-09-10T08:31:21.0143468Z     at authorize (/home/runner/work/services/services/packages/common/src/auth/ability.ts:132:11)
2025-09-10T08:31:21.0145196Z     at Object.social.spkeasy.graph.getTrusted [as handler] (/home/runner/work/services/services/services/trusted-users/src/routes/trust.routes.ts:41:5)
2025-09-10T08:31:21.0146798Z     at /home/runner/work/services/services/packages/service-base/src/server.ts:137:46
2025-09-10T08:31:21.0148768Z     at newFn (/home/runner/work/services/services/node_modules/.pnpm/express-async-errors@3.1.1_express@4.21.2/node_modules/express-async-errors/index.js:16:20)
2025-09-10T08:31:21.0151005Z     at Layer.handle [as handle_request] (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/layer.js:95:5)
2025-09-10T08:31:21.0153188Z     at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:149:13)
2025-09-10T08:31:21.0155231Z     at jsonParser (/home/runner/work/services/services/node_modules/.pnpm/body-parser@1.20.3/node_modules/body-parser/lib/types/json.js:113:7)
2025-09-10T08:31:21.0157428Z     at newFn (/home/runner/work/services/services/node_modules/.pnpm/express-async-errors@3.1.1_express@4.21.2/node_modules/express-async-errors/index.js:16:20)
2025-09-10T08:31:21.0159906Z     at Layer.handle [as handle_request] (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/layer.js:95:5)
2025-09-10T08:31:21.0161959Z     at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:149:13)
2025-09-10T08:31:21.0163000Z 
2025-09-10T08:31:21.0166467Z [2025-09-10 08:31:19.523 +0000] ERROR: AuthorizationError occurred {"service":"trusted-users","requestId":"unknown","method":"GET","path":"/xrpc/social.spkeasy.graph.getTrusted","duration":5,"status":403,"ip":"313d5b13e067911efcc8e257ab3925051bb57a136f2d54f697e1e92ef9997f35","user":"9f652c84f78e4382f36be7eeece30a4401694b3ef0f1b68c98fdb45fb41fe1d3","relevantLine":"/services/services/packages/common/src/auth/ability.ts:132:11"}
2025-09-10T08:31:21.0169770Z     error: {
2025-09-10T08:31:21.0170430Z       "name": "AuthorizationError",
2025-09-10T08:31:21.0171123Z       "message": "Not authorized to list on trusted_user",
2025-09-10T08:31:21.0171785Z       "statusCode": 403,
2025-09-10T08:31:21.0172479Z       "stack":
2025-09-10T08:31:21.0173142Z           AuthorizationError: Not authorized to list on trusted_user
2025-09-10T08:31:21.0174354Z               at authorize (/home/runner/work/services/services/packages/common/src/auth/ability.ts:132:11)
2025-09-10T08:31:21.0176394Z               at Object.social.spkeasy.graph.getTrusted [as handler] (/home/runner/work/services/services/services/trusted-users/src/routes/trust.routes.ts:41:5)
2025-09-10T08:31:21.0178321Z               at /home/runner/work/services/services/packages/service-base/src/server.ts:137:46
2025-09-10T08:31:21.0180079Z               at newFn (/home/runner/work/services/services/node_modules/.pnpm/express-async-errors@3.1.1_express@4.21.2/node_modules/express-async-errors/index.js:16:20)
2025-09-10T08:31:21.0182517Z               at Layer.handle [as handle_request] (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/layer.js:95:5)
2025-09-10T08:31:21.0184387Z               at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:149:13)
2025-09-10T08:31:21.0186240Z               at jsonParser (/home/runner/work/services/services/node_modules/.pnpm/body-parser@1.20.3/node_modules/body-parser/lib/types/json.js:113:7)
2025-09-10T08:31:21.0188748Z               at newFn (/home/runner/work/services/services/node_modules/.pnpm/express-async-errors@3.1.1_express@4.21.2/node_modules/express-async-errors/index.js:16:20)
2025-09-10T08:31:21.0191031Z               at Layer.handle [as handle_request] (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/layer.js:95:5)
2025-09-10T08:31:21.0193208Z               at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:149:13)
2025-09-10T08:31:21.0194355Z       "meta": {
2025-09-10T08:31:21.0194860Z         "action": "list",
2025-09-10T08:31:21.0195531Z         "subject": "trusted_user",
2025-09-10T08:31:21.0196105Z         "user": {
2025-09-10T08:31:21.0196617Z           "type": "user",
2025-09-10T08:31:21.0197167Z           "did": "did:example:wrong-user",
2025-09-10T08:31:21.0198196Z           "handle": "wrong.test",
2025-09-10T08:31:21.0202439Z           "token": "***",
2025-09-10T08:31:21.0203132Z           "authDuration": 20
2025-09-10T08:31:21.0203623Z         }
2025-09-10T08:31:21.0204031Z       }
2025-09-10T08:31:21.0204622Z     }
2025-09-10T08:31:21.0208160Z [2025-09-10 08:31:19.569 +0000] INFO: {"service":"trusted-users","requestId":"unknown","method":"social.spkeasy.graph.getTrusted","path":"/xrpc/social.spkeasy.graph.getTrusted","duration":6,"status":200,"ip":"313d5b13e067911efcc8e257ab3925051bb57a136f2d54f697e1e92ef9997f35","user":"3698761d94b6992d6277d4dc2932712760c796ead51e44dd484d665e3bcd7c08","authDuration":20}
2025-09-10T08:31:21.0212420Z  [32mâœ“[39m tests/integration/api/trust.test.ts[2m > [22mTrusted Users API Tests[2m > [22mTrusted Users API Tests[2m > [22mget social.spkeasy.graph.getTrusted - empty list[2m > [22mshould return expected response[32m 284[2mms[22m[39m
2025-09-10T08:31:21.0216028Z  [32mâœ“[39m tests/integration/api/trust.test.ts[2m > [22mTrusted Users API Tests[2m > [22mTrusted Users API Tests[2m > [22mget social.spkeasy.graph.getTrusted - empty list - without token[2m > [22mshould return expected response[32m 15[2mms[22m[39m
2025-09-10T08:31:21.0219945Z  [32mâœ“[39m tests/integration/api/trust.test.ts[2m > [22mTrusted Users API Tests[2m > [22mTrusted Users API Tests[2m > [22mget social.spkeasy.graph.getTrusted - empty list - with wrong user token[2m > [22mshould return expected response[32m 40[2mms[22m[39m
2025-09-10T08:31:21.0223511Z  [32mâœ“[39m tests/integration/api/trust.test.ts[2m > [22mTrusted Users API Tests[2m > [22mTrusted Users API Tests[2m > [22mget social.spkeasy.graph.getTrusted - with trusted users[2m > [22mshould return expected response[32m 38[2mms[22m[39m
2025-09-10T08:31:21.0227351Z [90mstdout[2m | tests/integration/api/trust.test.ts[2m > [22m[2mTrusted Users API Tests[2m > [22m[2mTrusted Users API Tests[2m > [22m[2mget social.spkeasy.graph.getTrusted - with trusted users - without token[2m > [22m[2mshould return expected response
2025-09-10T08:31:21.0229850Z [22m[39mAuthenticationError: Missing authorization header
2025-09-10T08:31:21.0231169Z     at getBearerToken (/home/runner/work/services/services/packages/common/src/auth/bearer-tokens.ts:58:11)
2025-09-10T08:31:21.0232899Z     at authenticateToken (/home/runner/work/services/services/packages/common/src/auth/bearer-tokens.ts:81:17)
2025-09-10T08:31:21.0234927Z     at newFn (/home/runner/work/services/services/node_modules/.pnpm/express-async-errors@3.1.1_express@4.21.2/node_modules/express-async-errors/index.js:16:20)
2025-09-10T08:31:21.0237400Z     at Layer.handle [as handle_request] (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/layer.js:95:5)
2025-09-10T08:31:21.0239996Z     at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:149:13)
2025-09-10T08:31:21.0241836Z     at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:145:7)
2025-09-10T08:31:21.0243700Z     at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:145:7)
2025-09-10T08:31:21.0245691Z     at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:145:7)
2025-09-10T08:31:21.0247532Z     at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:145:7)
2025-09-10T08:31:21.0249544Z     at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:145:7)
2025-09-10T08:31:21.0250597Z 
2025-09-10T08:31:21.0253457Z [2025-09-10 08:31:19.589 +0000] ERROR: AuthenticationError occurred {"service":"trusted-users","requestId":"unknown","method":"GET","path":"/xrpc/social.spkeasy.graph.getTrusted","duration":null,"status":401,"ip":"313d5b13e067911efcc8e257ab3925051bb57a136f2d54f697e1e92ef9997f35","relevantLine":"/services/services/packages/common/src/auth/bearer-tokens.ts:58:11"}
2025-09-10T08:31:21.0255902Z     error: {
2025-09-10T08:31:21.0256420Z       "name": "AuthenticationError",
2025-09-10T08:31:21.0257398Z       "message": "Missing authorization header",
2025-09-10T08:31:21.0258233Z       "statusCode": 401,
2025-09-10T08:31:21.0258671Z       "stack":
2025-09-10T08:31:21.0259420Z           AuthenticationError: Missing authorization header
2025-09-10T08:31:21.0260726Z               at getBearerToken (/home/runner/work/services/services/packages/common/src/auth/bearer-tokens.ts:58:11)
2025-09-10T08:31:21.0262352Z               at authenticateToken (/home/runner/work/services/services/packages/common/src/auth/bearer-tokens.ts:81:17)
2025-09-10T08:31:21.0264562Z               at newFn (/home/runner/work/services/services/node_modules/.pnpm/express-async-errors@3.1.1_express@4.21.2/node_modules/express-async-errors/index.js:16:20)
2025-09-10T08:31:21.0266849Z               at Layer.handle [as handle_request] (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/layer.js:95:5)
2025-09-10T08:31:21.0269124Z               at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:149:13)
2025-09-10T08:31:21.0271125Z               at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:145:7)
2025-09-10T08:31:21.0272971Z               at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:145:7)
2025-09-10T08:31:21.0274794Z               at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:145:7)
2025-09-10T08:31:21.0276782Z               at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:145:7)
2025-09-10T08:31:21.0278878Z               at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:145:7)
2025-09-10T08:31:21.0279996Z     }
2025-09-10T08:31:21.0282733Z [90mstdout[2m | tests/integration/api/trust.test.ts[2m > [22m[2mTrusted Users API Tests[2m > [22m[2mTrusted Users API Tests[2m > [22m[2mget social.spkeasy.graph.getTrusted - with trusted users - with wrong user token[2m > [22m[2mshould return expected response
2025-09-10T08:31:21.0284959Z [22m[39mAuthorizationError: Not authorized to list on trusted_user
2025-09-10T08:31:21.0286468Z     at authorize (/home/runner/work/services/services/packages/common/src/auth/ability.ts:132:11)
2025-09-10T08:31:21.0288983Z     at Object.social.spkeasy.graph.getTrusted [as handler] (/home/runner/work/services/services/services/trusted-users/src/routes/trust.routes.ts:41:5)
2025-09-10T08:31:21.0291010Z     at /home/runner/work/services/services/packages/service-base/src/server.ts:137:46
2025-09-10T08:31:21.0292834Z     at newFn (/home/runner/work/services/services/node_modules/.pnpm/express-async-errors@3.1.1_express@4.21.2/node_modules/express-async-errors/index.js:16:20)
2025-09-10T08:31:21.0295055Z     at Layer.handle [as handle_request] (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/layer.js:95:5)
2025-09-10T08:31:21.0296963Z     at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:149:13)
2025-09-10T08:31:21.0298847Z     at jsonParser (/home/runner/work/services/services/node_modules/.pnpm/body-parser@1.20.3/node_modules/body-parser/lib/types/json.js:113:7)
2025-09-10T08:31:21.0300673Z     at newFn (/home/runner/work/services/services/node_modules/.pnpm/express-async-errors@3.1.1_express@4.21.2/node_modules/express-async-errors/index.js:16:20)
2025-09-10T08:31:21.0302743Z     at Layer.handle [as handle_request] (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/layer.js:95:5)
2025-09-10T08:31:21.0304567Z     at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:149:13)
2025-09-10T08:31:21.0305626Z 
2025-09-10T08:31:21.0309095Z [2025-09-10 08:31:19.621 +0000] ERROR: AuthorizationError occurred {"service":"trusted-users","requestId":"unknown","method":"GET","path":"/xrpc/social.spkeasy.graph.getTrusted","duration":1,"status":403,"ip":"313d5b13e067911efcc8e257ab3925051bb57a136f2d54f697e1e92ef9997f35","user":"9f652c84f78e4382f36be7eeece30a4401694b3ef0f1b68c98fdb45fb41fe1d3","relevantLine":"/services/services/packages/common/src/auth/ability.ts:132:11"}
2025-09-10T08:31:21.0311881Z     error: {
2025-09-10T08:31:21.0312289Z       "name": "AuthorizationError",
2025-09-10T08:31:21.0312868Z       "message": "Not authorized to list on trusted_user",
2025-09-10T08:31:21.0313432Z       "statusCode": 403,
2025-09-10T08:31:21.0313806Z       "stack":
2025-09-10T08:31:21.0314352Z           AuthorizationError: Not authorized to list on trusted_user
2025-09-10T08:31:21.0315441Z               at authorize (/home/runner/work/services/services/packages/common/src/auth/ability.ts:132:11)
2025-09-10T08:31:21.0317184Z               at Object.social.spkeasy.graph.getTrusted [as handler] (/home/runner/work/services/services/services/trusted-users/src/routes/trust.routes.ts:41:5)
2025-09-10T08:31:21.0318987Z               at /home/runner/work/services/services/packages/service-base/src/server.ts:137:46
2025-09-10T08:31:21.0320736Z               at newFn (/home/runner/work/services/services/node_modules/.pnpm/express-async-errors@3.1.1_express@4.21.2/node_modules/express-async-errors/index.js:16:20)
2025-09-10T08:31:21.0322933Z               at Layer.handle [as handle_request] (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/layer.js:95:5)
2025-09-10T08:31:21.0324848Z               at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:149:13)
2025-09-10T08:31:21.0326693Z               at jsonParser (/home/runner/work/services/services/node_modules/.pnpm/body-parser@1.20.3/node_modules/body-parser/lib/types/json.js:113:7)
2025-09-10T08:31:21.0329016Z               at newFn (/home/runner/work/services/services/node_modules/.pnpm/express-async-errors@3.1.1_express@4.21.2/node_modules/express-async-errors/index.js:16:20)
2025-09-10T08:31:21.0331196Z               at Layer.handle [as handle_request] (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/layer.js:95:5)
2025-09-10T08:31:21.0333346Z               at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:149:13)
2025-09-10T08:31:21.0334392Z       "meta": {
2025-09-10T08:31:21.0334738Z         "action": "list",
2025-09-10T08:31:21.0335181Z         "subject": "trusted_user",
2025-09-10T08:31:21.0335595Z         "user": {
2025-09-10T08:31:21.0335929Z           "type": "user",
2025-09-10T08:31:21.0336372Z           "did": "did:example:wrong-user",
2025-09-10T08:31:21.0336895Z           "handle": "wrong.test",
2025-09-10T08:31:21.0339594Z           "token": "***",
2025-09-10T08:31:21.0339853Z           "authDuration": 15
2025-09-10T08:31:21.0340055Z         }
2025-09-10T08:31:21.0340207Z       }
2025-09-10T08:31:21.0340353Z     }
2025-09-10T08:31:21.0341543Z  [32mâœ“[39m tests/integration/api/trust.test.ts[2m > [22mTrusted Users API Tests[2m > [22mTrusted Users API Tests[2m > [22mget social.spkeasy.graph.getTrusted - with trusted users - without token[2m > [22mshould return expected response[32m 24[2mms[22m[39m
2025-09-10T08:31:21.0343378Z  [32mâœ“[39m tests/integration/api/trust.test.ts[2m > [22mTrusted Users API Tests[2m > [22mTrusted Users API Tests[2m > [22mget social.spkeasy.graph.getTrusted - with trusted users - with wrong user token[2m > [22mshould return expected response[32m 28[2mms[22m[39m
2025-09-10T08:31:21.0345619Z [2025-09-10 08:31:19.704 +0000] INFO: {"service":"trusted-users","requestId":"unknown","method":"social.spkeasy.graph.addTrusted","path":"/xrpc/social.spkeasy.graph.addTrusted","duration":41,"status":200,"ip":"313d5b13e067911efcc8e257ab3925051bb57a136f2d54f697e1e92ef9997f35","user":"3698761d94b6992d6277d4dc2932712760c796ead51e44dd484d665e3bcd7c08","authDuration":17}
2025-09-10T08:31:21.0348220Z [90mstdout[2m | tests/integration/api/trust.test.ts[2m > [22m[2mTrusted Users API Tests[2m > [22m[2mTrusted Users API Tests[2m > [22m[2mpost social.spkeasy.graph.addTrusted - new user - without token[2m > [22m[2mshould return expected response
2025-09-10T08:31:21.0349262Z [22m[39mAuthenticationError: Missing authorization header
2025-09-10T08:31:21.0349862Z     at getBearerToken (/home/runner/work/services/services/packages/common/src/auth/bearer-tokens.ts:58:11)
2025-09-10T08:31:21.0350638Z     at authenticateToken (/home/runner/work/services/services/packages/common/src/auth/bearer-tokens.ts:81:17)
2025-09-10T08:31:21.0351583Z     at newFn (/home/runner/work/services/services/node_modules/.pnpm/express-async-errors@3.1.1_express@4.21.2/node_modules/express-async-errors/index.js:16:20)
2025-09-10T08:31:21.0352661Z     at Layer.handle [as handle_request] (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/layer.js:95:5)
2025-09-10T08:31:21.0353616Z     at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:149:13)
2025-09-10T08:31:21.0354493Z     at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:145:7)
2025-09-10T08:31:21.0355350Z     at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:145:7)
2025-09-10T08:31:21.0356205Z     at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:145:7)
2025-09-10T08:31:21.0357052Z     at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:145:7)
2025-09-10T08:31:21.0357908Z     at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:145:7)
2025-09-10T08:31:21.0358542Z 
2025-09-10T08:31:21.0360123Z [2025-09-10 08:31:19.715 +0000] ERROR: AuthenticationError occurred {"service":"trusted-users","requestId":"unknown","method":"POST","path":"/xrpc/social.spkeasy.graph.addTrusted","duration":null,"status":401,"ip":"313d5b13e067911efcc8e257ab3925051bb57a136f2d54f697e1e92ef9997f35","relevantLine":"/services/services/packages/common/src/auth/bearer-tokens.ts:58:11"}
2025-09-10T08:31:21.0361337Z     error: {
2025-09-10T08:31:21.0361547Z       "name": "AuthenticationError",
2025-09-10T08:31:21.0361836Z       "message": "Missing authorization header",
2025-09-10T08:31:21.0362092Z       "statusCode": 401,
2025-09-10T08:31:21.0362284Z       "stack":
2025-09-10T08:31:21.0362533Z           AuthenticationError: Missing authorization header
2025-09-10T08:31:21.0363126Z               at getBearerToken (/home/runner/work/services/services/packages/common/src/auth/bearer-tokens.ts:58:11)
2025-09-10T08:31:21.0363907Z               at authenticateToken (/home/runner/work/services/services/packages/common/src/auth/bearer-tokens.ts:81:17)
2025-09-10T08:31:21.0364849Z               at newFn (/home/runner/work/services/services/node_modules/.pnpm/express-async-errors@3.1.1_express@4.21.2/node_modules/express-async-errors/index.js:16:20)
2025-09-10T08:31:21.0365923Z               at Layer.handle [as handle_request] (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/layer.js:95:5)
2025-09-10T08:31:21.0366888Z               at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:149:13)
2025-09-10T08:31:21.0367758Z               at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:145:7)
2025-09-10T08:31:21.0368781Z               at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:145:7)
2025-09-10T08:31:21.0369779Z               at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:145:7)
2025-09-10T08:31:21.0370634Z               at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:145:7)
2025-09-10T08:31:21.0372153Z               at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:145:7)
2025-09-10T08:31:21.0372670Z     }
2025-09-10T08:31:21.0373880Z [90mstdout[2m | tests/integration/api/trust.test.ts[2m > [22m[2mTrusted Users API Tests[2m > [22m[2mTrusted Users API Tests[2m > [22m[2mpost social.spkeasy.graph.addTrusted - duplicate trust not allowed[2m > [22m[2mshould return expected response
2025-09-10T08:31:21.0374817Z [22m[39mPrismaClientKnownRequestError: 
2025-09-10T08:31:21.0375182Z Invalid `prisma.trustedUser.create()` invocation in
2025-09-10T08:31:21.0375783Z /home/runner/work/services/services/services/trusted-users/src/services/trust.service.ts:147:32
2025-09-10T08:31:21.0376161Z 
2025-09-10T08:31:21.0376596Z   144 async addTrusted(authorDid: string, recipientDid: string): Promise<void> {
2025-09-10T08:31:21.0377409Z   145   await prisma.$transaction(async (tx: Prisma.TransactionClient) => {
2025-09-10T08:31:21.0378582Z   146     // Create trust relationship - we can rely on the unique constraint to prevent duplicates
2025-09-10T08:31:21.0379176Z â†’ 147     await prisma.trustedUser.create(
2025-09-10T08:31:21.0379609Z Unique constraint failed on the fields: (`authorDid`,`recipientDid`)
2025-09-10T08:31:21.0380388Z     at ei.handleRequestError (/home/runner/work/services/services/services/trusted-users/src/generated/prisma-client/runtime/library.js:124:7283)
2025-09-10T08:31:21.0381469Z     at ei.handleAndLogRequestError (/home/runner/work/services/services/services/trusted-users/src/generated/prisma-client/runtime/library.js:124:6608)
2025-09-10T08:31:21.0382496Z     at ei.request (/home/runner/work/services/services/services/trusted-users/src/generated/prisma-client/runtime/library.js:124:6315)
2025-09-10T08:31:21.0383414Z     at a (/home/runner/work/services/services/services/trusted-users/src/generated/prisma-client/runtime/library.js:133:9551)
2025-09-10T08:31:21.0384347Z     at /home/runner/work/services/services/services/trusted-users/src/services/trust.service.ts:147:7
2025-09-10T08:31:21.0385277Z     at Proxy._transactionWithCallback (/home/runner/work/services/services/services/trusted-users/src/generated/prisma-client/runtime/library.js:133:8120)
2025-09-10T08:31:21.0386267Z     at TrustService.addTrusted (/home/runner/work/services/services/services/trusted-users/src/services/trust.service.ts:145:5)
2025-09-10T08:31:21.0387269Z     at Object.social.spkeasy.graph.addTrusted [as handler] (/home/runner/work/services/services/services/trusted-users/src/routes/trust.routes.ts:114:5)
2025-09-10T08:31:21.0388258Z     at /home/runner/work/services/services/packages/service-base/src/server.ts:137:26
2025-09-10T08:31:21.0388574Z 
2025-09-10T08:31:21.0390000Z [2025-09-10 08:31:19.755 +0000] ERROR: PrismaClientKnownRequestError occurred {"service":"trusted-users","requestId":"unknown","method":"POST","path":"/xrpc/social.spkeasy.graph.addTrusted","duration":15,"status":400,"ip":"313d5b13e067911efcc8e257ab3925051bb57a136f2d54f697e1e92ef9997f35","user":"3698761d94b6992d6277d4dc2932712760c796ead51e44dd484d665e3bcd7c08"}
2025-09-10T08:31:21.0391195Z     error: {
2025-09-10T08:31:21.0391424Z       "name": "PrismaClientKnownRequestError",
2025-09-10T08:31:21.0393850Z       "message": "\nInvalid `prisma.trustedUser.create()` invocation in\n/home/runner/work/services/services/services/trusted-users/src/services/trust.service.ts:147:32\n\n  144 async addTrusted(authorDid: string, recipientDid: string): Promise<void> {\n  145   await prisma.$transaction(async (tx: Prisma.TransactionClient) => {\n  146     // Create trust relationship - we can rely on the unique constraint to prevent duplicates\nâ†’ 147     await prisma.trustedUser.create(\nUnique constraint failed on the fields: (`authorDid`,`recipientDid`)",
2025-09-10T08:31:21.0395819Z       "stack":
2025-09-10T08:31:21.0396041Z           PrismaClientKnownRequestError: 
2025-09-10T08:31:21.0396379Z           Invalid `prisma.trustedUser.create()` invocation in
2025-09-10T08:31:21.0396947Z           /home/runner/work/services/services/services/trusted-users/src/services/trust.service.ts:147:32
2025-09-10T08:31:21.0397387Z           
2025-09-10T08:31:21.0397732Z             144 async addTrusted(authorDid: string, recipientDid: string): Promise<void> {
2025-09-10T08:31:21.0398502Z             145   await prisma.$transaction(async (tx: Prisma.TransactionClient) => {
2025-09-10T08:31:21.0399058Z             146     // Create trust relationship - we can rely on the unique constraint to prevent duplicates
2025-09-10T08:31:21.0399583Z           â†’ 147     await prisma.trustedUser.create(
2025-09-10T08:31:21.0400000Z           Unique constraint failed on the fields: (`authorDid`,`recipientDid`)
2025-09-10T08:31:21.0400791Z               at ei.handleRequestError (/home/runner/work/services/services/services/trusted-users/src/generated/prisma-client/runtime/library.js:124:7283)
2025-09-10T08:31:21.0401893Z               at ei.handleAndLogRequestError (/home/runner/work/services/services/services/trusted-users/src/generated/prisma-client/runtime/library.js:124:6608)
2025-09-10T08:31:21.0402936Z               at ei.request (/home/runner/work/services/services/services/trusted-users/src/generated/prisma-client/runtime/library.js:124:6315)
2025-09-10T08:31:21.0403864Z               at a (/home/runner/work/services/services/services/trusted-users/src/generated/prisma-client/runtime/library.js:133:9551)
2025-09-10T08:31:21.0404666Z               at /home/runner/work/services/services/services/trusted-users/src/services/trust.service.ts:147:7
2025-09-10T08:31:21.0405607Z               at Proxy._transactionWithCallback (/home/runner/work/services/services/services/trusted-users/src/generated/prisma-client/runtime/library.js:133:8120)
2025-09-10T08:31:21.0406622Z               at TrustService.addTrusted (/home/runner/work/services/services/services/trusted-users/src/services/trust.service.ts:145:5)
2025-09-10T08:31:21.0407740Z               at Object.social.spkeasy.graph.addTrusted [as handler] (/home/runner/work/services/services/services/trusted-users/src/routes/trust.routes.ts:114:5)
2025-09-10T08:31:21.0408757Z               at /home/runner/work/services/services/packages/service-base/src/server.ts:137:26
2025-09-10T08:31:21.0409144Z       "meta": {
2025-09-10T08:31:21.0409355Z         "modelName": "TrustedUser",
2025-09-10T08:31:21.0409577Z         "target": [
2025-09-10T08:31:21.0409757Z           "authorDid",
2025-09-10T08:31:21.0409939Z           "recipientDid"
2025-09-10T08:31:21.0410126Z         ]
2025-09-10T08:31:21.0410277Z       },
2025-09-10T08:31:21.0410430Z       "code": "P2002"
2025-09-10T08:31:21.0410609Z     }
2025-09-10T08:31:21.0411878Z [90mstdout[2m | tests/integration/api/trust.test.ts[2m > [22m[2mTrusted Users API Tests[2m > [22m[2mTrusted Users API Tests[2m > [22m[2mpost social.spkeasy.graph.addTrusted - duplicate trust not allowed - without token[2m > [22m[2mshould return expected response
2025-09-10T08:31:21.0412933Z [22m[39mAuthenticationError: Missing authorization header
2025-09-10T08:31:21.0413531Z     at getBearerToken (/home/runner/work/services/services/packages/common/src/auth/bearer-tokens.ts:58:11)
2025-09-10T08:31:21.0414289Z     at authenticateToken (/home/runner/work/services/services/packages/common/src/auth/bearer-tokens.ts:81:17)
2025-09-10T08:31:21.0415227Z     at newFn (/home/runner/work/services/services/node_modules/.pnpm/express-async-errors@3.1.1_express@4.21.2/node_modules/express-async-errors/index.js:16:20)
2025-09-10T08:31:21.0416292Z     at Layer.handle [as handle_request] (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/layer.js:95:5)
2025-09-10T08:31:21.0417372Z     at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:149:13)
2025-09-10T08:31:21.0418458Z     at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:145:7)
2025-09-10T08:31:21.0419341Z     at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:145:7)
2025-09-10T08:31:21.0420200Z     at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:145:7)
2025-09-10T08:31:21.0421047Z     at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:145:7)
2025-09-10T08:31:21.0422027Z     at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:145:7)
2025-09-10T08:31:21.0422530Z 
2025-09-10T08:31:21.0423985Z [2025-09-10 08:31:19.767 +0000] ERROR: AuthenticationError occurred {"service":"trusted-users","requestId":"unknown","method":"POST","path":"/xrpc/social.spkeasy.graph.addTrusted","duration":null,"status":401,"ip":"313d5b13e067911efcc8e257ab3925051bb57a136f2d54f697e1e92ef9997f35","relevantLine":"/services/services/packages/common/src/auth/bearer-tokens.ts:58:11"}
2025-09-10T08:31:21.0425197Z     error: {
2025-09-10T08:31:21.0425415Z       "name": "AuthenticationError",
2025-09-10T08:31:21.0425707Z       "message": "Missing authorization header",
2025-09-10T08:31:21.0425964Z       "statusCode": 401,
2025-09-10T08:31:21.0426148Z       "stack":
2025-09-10T08:31:21.0426402Z           AuthenticationError: Missing authorization header
2025-09-10T08:31:21.0426985Z               at getBearerToken (/home/runner/work/services/services/packages/common/src/auth/bearer-tokens.ts:58:11)
2025-09-10T08:31:21.0427756Z               at authenticateToken (/home/runner/work/services/services/packages/common/src/auth/bearer-tokens.ts:81:17)
2025-09-10T08:31:21.0428951Z               at newFn (/home/runner/work/services/services/node_modules/.pnpm/express-async-errors@3.1.1_express@4.21.2/node_modules/express-async-errors/index.js:16:20)
2025-09-10T08:31:21.0430032Z               at Layer.handle [as handle_request] (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/layer.js:95:5)
2025-09-10T08:31:21.0431132Z               at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:149:13)
2025-09-10T08:31:21.0432009Z               at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:145:7)
2025-09-10T08:31:21.0432876Z               at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:145:7)
2025-09-10T08:31:21.0433744Z               at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:145:7)
2025-09-10T08:31:21.0434607Z               at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:145:7)
2025-09-10T08:31:21.0435461Z               at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:145:7)
2025-09-10T08:31:21.0435969Z     }
2025-09-10T08:31:21.0437015Z  [32mâœ“[39m tests/integration/api/trust.test.ts[2m > [22mTrusted Users API Tests[2m > [22mTrusted Users API Tests[2m > [22mpost social.spkeasy.graph.addTrusted - new user[2m > [22mshould return expected response[32m 82[2mms[22m[39m
2025-09-10T08:31:21.0438795Z  [32mâœ“[39m tests/integration/api/trust.test.ts[2m > [22mTrusted Users API Tests[2m > [22mTrusted Users API Tests[2m > [22mpost social.spkeasy.graph.addTrusted - new user - without token[2m > [22mshould return expected response[32m 12[2mms[22m[39m
2025-09-10T08:31:21.0440780Z  [32mâœ“[39m tests/integration/api/trust.test.ts[2m > [22mTrusted Users API Tests[2m > [22mTrusted Users API Tests[2m > [22mpost social.spkeasy.graph.addTrusted - duplicate trust not allowed[2m > [22mshould return expected response[32m 40[2mms[22m[39m
2025-09-10T08:31:21.0442624Z  [32mâœ“[39m tests/integration/api/trust.test.ts[2m > [22mTrusted Users API Tests[2m > [22mTrusted Users API Tests[2m > [22mpost social.spkeasy.graph.addTrusted - duplicate trust not allowed - without token[2m > [22mshould return expected response[32m 11[2mms[22m[39m
2025-09-10T08:31:21.0444866Z [2025-09-10 08:31:19.792 +0000] INFO: {"service":"trusted-users","requestId":"unknown","method":"social.spkeasy.graph.addTrusted","path":"/xrpc/social.spkeasy.graph.addTrusted","duration":8,"status":200,"ip":"313d5b13e067911efcc8e257ab3925051bb57a136f2d54f697e1e92ef9997f35","user":"3698761d94b6992d6277d4dc2932712760c796ead51e44dd484d665e3bcd7c08","authDuration":8}
2025-09-10T08:31:21.0447095Z [90mstdout[2m | tests/integration/api/trust.test.ts[2m > [22m[2mTrusted Users API Tests[2m > [22m[2mTrusted Users API Tests[2m > [22m[2mpost social.spkeasy.graph.addTrusted - re-trusting is ok - without token[2m > [22m[2mshould return expected response
2025-09-10T08:31:21.0448291Z [22m[39mAuthenticationError: Missing authorization header
2025-09-10T08:31:21.0449232Z     at getBearerToken (/home/runner/work/services/services/packages/common/src/auth/bearer-tokens.ts:58:11)
2025-09-10T08:31:21.0450684Z     at authenticateToken (/home/runner/work/services/services/packages/common/src/auth/bearer-tokens.ts:81:17)
2025-09-10T08:31:21.0452473Z     at newFn (/home/runner/work/services/services/node_modules/.pnpm/express-async-errors@3.1.1_express@4.21.2/node_modules/express-async-errors/index.js:16:20)
2025-09-10T08:31:21.0454624Z     at Layer.handle [as handle_request] (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/layer.js:95:5)
2025-09-10T08:31:21.0456249Z     at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:149:13)
2025-09-10T08:31:21.0457156Z     at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:145:7)
2025-09-10T08:31:21.0458355Z     at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:145:7)
2025-09-10T08:31:21.0459224Z     at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:145:7)
2025-09-10T08:31:21.0460095Z     at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:145:7)
2025-09-10T08:31:21.0460944Z     at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:145:7)
2025-09-10T08:31:21.0461399Z 
2025-09-10T08:31:21.0462853Z [2025-09-10 08:31:19.799 +0000] ERROR: AuthenticationError occurred {"service":"trusted-users","requestId":"unknown","method":"POST","path":"/xrpc/social.spkeasy.graph.addTrusted","duration":null,"status":401,"ip":"313d5b13e067911efcc8e257ab3925051bb57a136f2d54f697e1e92ef9997f35","relevantLine":"/services/services/packages/common/src/auth/bearer-tokens.ts:58:11"}
2025-09-10T08:31:21.0464292Z     error: {
2025-09-10T08:31:21.0464524Z       "name": "AuthenticationError",
2025-09-10T08:31:21.0464818Z       "message": "Missing authorization header",
2025-09-10T08:31:21.0465075Z       "statusCode": 401,
2025-09-10T08:31:21.0465263Z       "stack":
2025-09-10T08:31:21.0465508Z           AuthenticationError: Missing authorization header
2025-09-10T08:31:21.0466100Z               at getBearerToken (/home/runner/work/services/services/packages/common/src/auth/bearer-tokens.ts:58:11)
2025-09-10T08:31:21.0466882Z               at authenticateToken (/home/runner/work/services/services/packages/common/src/auth/bearer-tokens.ts:81:17)
2025-09-10T08:31:21.0468203Z               at newFn (/home/runner/work/services/services/node_modules/.pnpm/express-async-errors@3.1.1_express@4.21.2/node_modules/express-async-errors/index.js:16:20)
2025-09-10T08:31:21.0469315Z               at Layer.handle [as handle_request] (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/layer.js:95:5)
2025-09-10T08:31:21.0470291Z               at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:149:13)
2025-09-10T08:31:21.0471165Z               at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:145:7)
2025-09-10T08:31:21.0472034Z               at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:145:7)
2025-09-10T08:31:21.0472905Z               at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:145:7)
2025-09-10T08:31:21.0473778Z               at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:145:7)
2025-09-10T08:31:21.0474639Z               at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:145:7)
2025-09-10T08:31:21.0475142Z     }
2025-09-10T08:31:21.0476693Z [2025-09-10 08:31:19.818 +0000] INFO: {"service":"trusted-users","requestId":"unknown","method":"social.spkeasy.graph.removeTrusted","path":"/xrpc/social.spkeasy.graph.removeTrusted","duration":4,"status":200,"ip":"313d5b13e067911efcc8e257ab3925051bb57a136f2d54f697e1e92ef9997f35","user":"3698761d94b6992d6277d4dc2932712760c796ead51e44dd484d665e3bcd7c08","authDuration":7}
2025-09-10T08:31:21.0479147Z [90mstdout[2m | tests/integration/api/trust.test.ts[2m > [22m[2mTrusted Users API Tests[2m > [22m[2mTrusted Users API Tests[2m > [22m[2mpost social.spkeasy.graph.removeTrusted - existing user - without token[2m > [22m[2mshould return expected response
2025-09-10T08:31:21.0480180Z [22m[39mAuthenticationError: Missing authorization header
2025-09-10T08:31:21.0480912Z     at getBearerToken (/home/runner/work/services/services/packages/common/src/auth/bearer-tokens.ts:58:11)
2025-09-10T08:31:21.0483279Z     at authenticateToken (/home/runner/work/services/services/packages/common/src/auth/bearer-tokens.ts:81:17)
2025-09-10T08:31:21.0485033Z     at newFn (/home/runner/work/services/services/node_modules/.pnpm/express-async-errors@3.1.1_express@4.21.2/node_modules/express-async-errors/index.js:16:20)
2025-09-10T08:31:21.0486906Z     at Layer.handle [as handle_request] (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/layer.js:95:5)
2025-09-10T08:31:21.0488874Z     at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:149:13)
2025-09-10T08:31:21.0490501Z     at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:145:7)
2025-09-10T08:31:21.0492088Z     at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:145:7)
2025-09-10T08:31:21.0493674Z     at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:145:7)
2025-09-10T08:31:21.0495265Z     at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:145:7)
2025-09-10T08:31:21.0496868Z     at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:145:7)
2025-09-10T08:31:21.0497676Z 
2025-09-10T08:31:21.0500445Z [2025-09-10 08:31:19.828 +0000] ERROR: AuthenticationError occurred {"service":"trusted-users","requestId":"unknown","method":"POST","path":"/xrpc/social.spkeasy.graph.removeTrusted","duration":null,"status":401,"ip":"313d5b13e067911efcc8e257ab3925051bb57a136f2d54f697e1e92ef9997f35","relevantLine":"/services/services/packages/common/src/auth/bearer-tokens.ts:58:11"}
2025-09-10T08:31:21.0502744Z     error: {
2025-09-10T08:31:21.0503083Z       "name": "AuthenticationError",
2025-09-10T08:31:21.0503541Z       "message": "Missing authorization header",
2025-09-10T08:31:21.0503946Z       "statusCode": 401,
2025-09-10T08:31:21.0504253Z       "stack":
2025-09-10T08:31:21.0504675Z           AuthenticationError: Missing authorization header
2025-09-10T08:31:21.0505695Z               at getBearerToken (/home/runner/work/services/services/packages/common/src/auth/bearer-tokens.ts:58:11)
2025-09-10T08:31:21.0507121Z               at authenticateToken (/home/runner/work/services/services/packages/common/src/auth/bearer-tokens.ts:81:17)
2025-09-10T08:31:21.0508995Z               at newFn (/home/runner/work/services/services/node_modules/.pnpm/express-async-errors@3.1.1_express@4.21.2/node_modules/express-async-errors/index.js:16:20)
2025-09-10T08:31:21.0510948Z               at Layer.handle [as handle_request] (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/layer.js:95:5)
2025-09-10T08:31:21.0512722Z               at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:149:13)
2025-09-10T08:31:21.0514340Z               at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:145:7)
2025-09-10T08:31:21.0515950Z               at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:145:7)
2025-09-10T08:31:21.0517541Z               at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:145:7)
2025-09-10T08:31:21.0519310Z               at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:145:7)
2025-09-10T08:31:21.0520937Z               at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:145:7)
2025-09-10T08:31:21.0521833Z     }
2025-09-10T08:31:21.0524154Z [90mstdout[2m | tests/integration/api/trust.test.ts[2m > [22m[2mTrusted Users API Tests[2m > [22m[2mTrusted Users API Tests[2m > [22m[2mpost social.spkeasy.graph.removeTrusted - non-existent user[2m > [22m[2mshould return expected response
2025-09-10T08:31:21.0525809Z [22m[39mNotFoundError: Trust relationship does not exist
2025-09-10T08:31:21.0526741Z     at /home/runner/work/services/services/services/trusted-users/src/services/trust.service.ts:192:15
2025-09-10T08:31:21.0528482Z     at Proxy._transactionWithCallback (/home/runner/work/services/services/services/trusted-users/src/generated/prisma-client/runtime/library.js:133:8120)
2025-09-10T08:31:21.0530266Z     at TrustService.removeTrusted (/home/runner/work/services/services/services/trusted-users/src/services/trust.service.ts:182:5)
2025-09-10T08:31:21.0531999Z     at Object.social.spkeasy.graph.removeTrusted [as handler] (/home/runner/work/services/services/services/trusted-users/src/routes/trust.routes.ts:165:5)
2025-09-10T08:31:21.0533358Z     at /home/runner/work/services/services/packages/service-base/src/server.ts:137:26
2025-09-10T08:31:21.0533872Z 
2025-09-10T08:31:21.0537300Z [2025-09-10 08:31:19.847 +0000] ERROR: NotFoundError occurred {"service":"trusted-users","requestId":"unknown","method":"POST","path":"/xrpc/social.spkeasy.graph.removeTrusted","duration":6,"status":404,"ip":"313d5b13e067911efcc8e257ab3925051bb57a136f2d54f697e1e92ef9997f35","user":"3698761d94b6992d6277d4dc2932712760c796ead51e44dd484d665e3bcd7c08","relevantLine":"/services/services/services/trusted-users/src/generated/prisma-client/runtime/library.js:133:8120"}
2025-09-10T08:31:21.0540206Z     error: {
2025-09-10T08:31:21.0540696Z       "name": "NotFoundError",
2025-09-10T08:31:21.0541160Z       "message": "Trust relationship does not exist",
2025-09-10T08:31:21.0541604Z       "statusCode": 404,
2025-09-10T08:31:21.0541915Z       "stack":
2025-09-10T08:31:21.0542328Z           NotFoundError: Trust relationship does not exist
2025-09-10T08:31:21.0543267Z               at /home/runner/work/services/services/services/trusted-users/src/services/trust.service.ts:192:15
2025-09-10T08:31:21.0544884Z               at Proxy._transactionWithCallback (/home/runner/work/services/services/services/trusted-users/src/generated/prisma-client/runtime/library.js:133:8120)
2025-09-10T08:31:21.0546702Z               at TrustService.removeTrusted (/home/runner/work/services/services/services/trusted-users/src/services/trust.service.ts:182:5)
2025-09-10T08:31:21.0548743Z               at Object.social.spkeasy.graph.removeTrusted [as handler] (/home/runner/work/services/services/services/trusted-users/src/routes/trust.routes.ts:165:5)
2025-09-10T08:31:21.0550262Z               at /home/runner/work/services/services/packages/service-base/src/server.ts:137:26
2025-09-10T08:31:21.0550925Z     }
2025-09-10T08:31:21.0552995Z [90mstdout[2m | tests/integration/api/trust.test.ts[2m > [22m[2mTrusted Users API Tests[2m > [22m[2mTrusted Users API Tests[2m > [22m[2mpost social.spkeasy.graph.removeTrusted - non-existent user - without token[2m > [22m[2mshould return expected response
2025-09-10T08:31:21.0554807Z [22m[39mAuthenticationError: Missing authorization header
2025-09-10T08:31:21.0555856Z     at getBearerToken (/home/runner/work/services/services/packages/common/src/auth/bearer-tokens.ts:58:11)
2025-09-10T08:31:21.0557238Z     at authenticateToken (/home/runner/work/services/services/packages/common/src/auth/bearer-tokens.ts:81:17)
2025-09-10T08:31:21.0559049Z     at newFn (/home/runner/work/services/services/node_modules/.pnpm/express-async-errors@3.1.1_express@4.21.2/node_modules/express-async-errors/index.js:16:20)
2025-09-10T08:31:21.0560949Z     at Layer.handle [as handle_request] (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/layer.js:95:5)
2025-09-10T08:31:21.0562612Z     at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:149:13)
2025-09-10T08:31:21.0564208Z     at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:145:7)
2025-09-10T08:31:21.0565963Z     at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:145:7)
2025-09-10T08:31:21.0567564Z     at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:145:7)
2025-09-10T08:31:21.0569315Z     at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:145:7)
2025-09-10T08:31:21.0570856Z     at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:145:7)
2025-09-10T08:31:21.0571635Z 
2025-09-10T08:31:21.0574234Z [2025-09-10 08:31:19.857 +0000] ERROR: AuthenticationError occurred {"service":"trusted-users","requestId":"unknown","method":"POST","path":"/xrpc/social.spkeasy.graph.removeTrusted","duration":null,"status":401,"ip":"313d5b13e067911efcc8e257ab3925051bb57a136f2d54f697e1e92ef9997f35","relevantLine":"/services/services/packages/common/src/auth/bearer-tokens.ts:58:11"}
2025-09-10T08:31:21.0576362Z     error: {
2025-09-10T08:31:21.0576697Z       "name": "AuthenticationError",
2025-09-10T08:31:21.0577180Z       "message": "Missing authorization header",
2025-09-10T08:31:21.0577609Z       "statusCode": 401,
2025-09-10T08:31:21.0577916Z       "stack":
2025-09-10T08:31:21.0578501Z           AuthenticationError: Missing authorization header
2025-09-10T08:31:21.0579546Z               at getBearerToken (/home/runner/work/services/services/packages/common/src/auth/bearer-tokens.ts:58:11)
2025-09-10T08:31:21.0581127Z               at authenticateToken (/home/runner/work/services/services/packages/common/src/auth/bearer-tokens.ts:81:17)
2025-09-10T08:31:21.0582850Z               at newFn (/home/runner/work/services/services/node_modules/.pnpm/express-async-errors@3.1.1_express@4.21.2/node_modules/express-async-errors/index.js:16:20)
2025-09-10T08:31:21.0584835Z               at Layer.handle [as handle_request] (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/layer.js:95:5)
2025-09-10T08:31:21.0586597Z               at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:149:13)
2025-09-10T08:31:21.0588486Z               at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:145:7)
2025-09-10T08:31:21.0590082Z               at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:145:7)
2025-09-10T08:31:21.0591645Z               at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:145:7)
2025-09-10T08:31:21.0593228Z               at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:145:7)
2025-09-10T08:31:21.0594807Z               at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:145:7)
2025-09-10T08:31:21.0595704Z     }
2025-09-10T08:31:21.0596348Z [2025-09-10 08:31:19.865 +0000] INFO: Shutting down server... {"service":"trusted-users"}
2025-09-10T08:31:21.0598769Z  [32mâœ“[39m tests/integration/api/trust.test.ts[2m > [22mTrusted Users API Tests[2m > [22mTrusted Users API Tests[2m > [22mpost social.spkeasy.graph.addTrusted - re-trusting is ok[2m > [22mshould return expected response[32m 25[2mms[22m[39m
2025-09-10T08:31:21.0601976Z  [32mâœ“[39m tests/integration/api/trust.test.ts[2m > [22mTrusted Users API Tests[2m > [22mTrusted Users API Tests[2m > [22mpost social.spkeasy.graph.addTrusted - re-trusting is ok - without token[2m > [22mshould return expected response[32m 7[2mms[22m[39m
2025-09-10T08:31:21.0605212Z  [32mâœ“[39m tests/integration/api/trust.test.ts[2m > [22mTrusted Users API Tests[2m > [22mTrusted Users API Tests[2m > [22mpost social.spkeasy.graph.removeTrusted - existing user[2m > [22mshould return expected response[32m 18[2mms[22m[39m
2025-09-10T08:31:21.0608399Z  [32mâœ“[39m tests/integration/api/trust.test.ts[2m > [22mTrusted Users API Tests[2m > [22mTrusted Users API Tests[2m > [22mpost social.spkeasy.graph.removeTrusted - existing user - without token[2m > [22mshould return expected response[32m 11[2mms[22m[39m
2025-09-10T08:31:21.0611376Z  [32mâœ“[39m tests/integration/api/trust.test.ts[2m > [22mTrusted Users API Tests[2m > [22mTrusted Users API Tests[2m > [22mpost social.spkeasy.graph.removeTrusted - non-existent user[2m > [22mshould return expected response[32m 19[2mms[22m[39m
2025-09-10T08:31:21.0614571Z  [32mâœ“[39m tests/integration/api/trust.test.ts[2m > [22mTrusted Users API Tests[2m > [22mTrusted Users API Tests[2m > [22mpost social.spkeasy.graph.removeTrusted - non-existent user - without token[2m > [22mshould return expected response[32m 10[2mms[22m[39m
2025-09-10T08:31:21.0616679Z [2025-09-10 08:31:19.877 +0000] INFO: Shutting down server... {"service":"trusted-users"}
2025-09-10T08:31:21.0617183Z 
2025-09-10T08:31:21.0617690Z [2m Test Files [22m [1m[32m1 passed[39m[22m[90m (1)[39m
2025-09-10T08:31:21.0618679Z [2m      Tests [22m [1m[32m16 passed[39m[22m[90m (16)[39m
2025-09-10T08:31:21.0619273Z [2m   Start at [22m 08:31:15
2025-09-10T08:31:21.0620445Z [2m   Duration [22m 4.92s[2m (transform 709ms, setup 173ms, collect 1.88s, tests 901ms, environment 0ms, prepare 273ms)[22m
2025-09-10T08:31:21.0621102Z 
2025-09-10T08:31:21.0621796Z ##[endgroup]
2025-09-10T08:31:21.1299672Z ##[group]@speakeasy-services/user-keys:test
2025-09-10T08:31:21.1304439Z cache miss, executing 41e3efaf1d603fee
2025-09-10T08:31:21.1306651Z 
2025-09-10T08:31:21.1307761Z > @speakeasy-services/user-keys@0.1.0 test /home/runner/work/services/services/services/user-keys
2025-09-10T08:31:21.1316313Z > vitest run
2025-09-10T08:31:21.1316520Z 
2025-09-10T08:31:21.1316530Z 
2025-09-10T08:31:21.1317588Z [1m[46m RUN [49m[22m [36mv3.2.4 [39m[90m/home/runner/work/services/services/services/user-keys[39m
2025-09-10T08:31:21.1318411Z 
2025-09-10T08:31:21.1319286Z [2025-09-10 08:31:19.213 +0000] INFO: ðŸš€ user-keys service running on port 0 {"service":"user-keys"}
2025-09-10T08:31:21.1321194Z  [32mâœ“[39m tests/integration/api/key.test.ts[2m > [22mUser Keys API Tests[2m > [22mgetPublicKey endpoint[2m > [22mshould get public key for existing user[33m 338[2mms[22m[39m
2025-09-10T08:31:21.1323564Z  [32mâœ“[39m tests/integration/api/key.test.ts[2m > [22mUser Keys API Tests[2m > [22mgetPublicKey endpoint[2m > [22mshould get public key for new user (creates key)[32m 42[2mms[22m[39m
2025-09-10T08:31:21.1325950Z  [32mâœ“[39m tests/integration/api/key.test.ts[2m > [22mUser Keys API Tests[2m > [22mgetPublicKeys endpoint[2m > [22mshould get multiple public keys[32m 34[2mms[22m[39m
2025-09-10T08:31:21.1329918Z [2025-09-10 08:31:19.744 +0000] INFO: {"service":"user-keys","requestId":"unknown","method":"social.spkeasy.key.getPublicKey","path":"/xrpc/social.spkeasy.key.getPublicKey","duration":240,"status":200,"ip":"313d5b13e067911efcc8e257ab3925051bb57a136f2d54f697e1e92ef9997f35","user":"3698761d94b6992d6277d4dc2932712760c796ead51e44dd484d665e3bcd7c08","authDuration":27}
2025-09-10T08:31:21.1334954Z [2025-09-10 08:31:19.787 +0000] INFO: {"service":"user-keys","requestId":"unknown","method":"social.spkeasy.key.getPublicKey","path":"/xrpc/social.spkeasy.key.getPublicKey","duration":16,"status":200,"ip":"313d5b13e067911efcc8e257ab3925051bb57a136f2d54f697e1e92ef9997f35","user":"3698761d94b6992d6277d4dc2932712760c796ead51e44dd484d665e3bcd7c08","authDuration":13}
2025-09-10T08:31:21.1341559Z [2025-09-10 08:31:19.826 +0000] INFO: {"service":"user-keys","requestId":"unknown","method":"social.spkeasy.key.getPublicKeys","path":"/xrpc/social.spkeasy.key.getPublicKeys","duration":7,"status":200,"ip":"313d5b13e067911efcc8e257ab3925051bb57a136f2d54f697e1e92ef9997f35","user":"3698761d94b6992d6277d4dc2932712760c796ead51e44dd484d665e3bcd7c08","authDuration":11}
2025-09-10T08:31:21.1346246Z [2025-09-10 08:31:19.849 +0000] INFO: {"service":"user-keys","requestId":"unknown","method":"social.spkeasy.key.getPrivateKey","path":"/xrpc/social.spkeasy.key.getPrivateKey","duration":3,"status":200,"ip":"313d5b13e067911efcc8e257ab3925051bb57a136f2d54f697e1e92ef9997f35","user":"3698761d94b6992d6277d4dc2932712760c796ead51e44dd484d665e3bcd7c08","authDuration":10}
2025-09-10T08:31:21.1351401Z [2025-09-10 08:31:19.885 +0000] INFO: {"service":"user-keys","requestId":"unknown","method":"social.spkeasy.key.getPrivateKeys","path":"/xrpc/social.spkeasy.key.getPrivateKeys","duration":9,"status":200,"ip":"313d5b13e067911efcc8e257ab3925051bb57a136f2d54f697e1e92ef9997f35","user":"3698761d94b6992d6277d4dc2932712760c796ead51e44dd484d665e3bcd7c08","authDuration":8}
2025-09-10T08:31:21.1355066Z  [32mâœ“[39m tests/integration/api/key.test.ts[2m > [22mUser Keys API Tests[2m > [22mgetPrivateKey endpoint[2m > [22mshould get private key for authenticated user[32m 25[2mms[22m[39m
2025-09-10T08:31:21.1357360Z  [32mâœ“[39m tests/integration/api/key.test.ts[2m > [22mUser Keys API Tests[2m > [22mgetPrivateKeys endpoint[2m > [22mshould get private keys by IDs[32m 33[2mms[22m[39m
2025-09-10T08:31:21.1359569Z  [32mâœ“[39m tests/integration/api/key.test.ts[2m > [22mUser Keys API Tests[2m > [22mrotate key endpoint[2m > [22mshould rotate key for authenticated user[32m 51[2mms[22m[39m
2025-09-10T08:31:21.1363256Z [2025-09-10 08:31:19.930 +0000] INFO: {"service":"user-keys","requestId":"unknown","method":"social.spkeasy.key.rotate","path":"/xrpc/social.spkeasy.key.rotate","duration":15,"status":200,"ip":"313d5b13e067911efcc8e257ab3925051bb57a136f2d54f697e1e92ef9997f35","user":"3698761d94b6992d6277d4dc2932712760c796ead51e44dd484d665e3bcd7c08","authDuration":10}
2025-09-10T08:31:21.1366154Z [2025-09-10 08:31:19.944 +0000] INFO: Shutting down server... {"service":"user-keys"}
2025-09-10T08:31:21.1367192Z [2025-09-10 08:31:19.954 +0000] INFO: Shutting down server... {"service":"user-keys"}
2025-09-10T08:31:21.1367713Z 
2025-09-10T08:31:21.1368601Z [2m Test Files [22m [1m[32m1 passed[39m[22m[90m (1)[39m
2025-09-10T08:31:21.1369521Z [2m      Tests [22m [1m[32m6 passed[39m[22m[90m (6)[39m
2025-09-10T08:31:21.1370219Z [2m   Start at [22m 08:31:15
2025-09-10T08:31:21.1371497Z [2m   Duration [22m 5.24s[2m (transform 662ms, setup 158ms, collect 1.89s, tests 969ms, environment 0ms, prepare 463ms)[22m
2025-09-10T08:31:21.1372210Z 
2025-09-10T08:31:21.1372626Z ##[endgroup]
2025-09-10T08:31:21.3511141Z ##[group]@speakeasy-services/media:test
2025-09-10T08:31:21.3512613Z cache miss, executing 51e2dd6679a8d391
2025-09-10T08:31:21.3516942Z 
2025-09-10T08:31:21.3517629Z > @speakeasy-services/media@0.1.0 test /home/runner/work/services/services/services/media
2025-09-10T08:31:21.3523488Z > vitest run
2025-09-10T08:31:21.3523693Z 
2025-09-10T08:31:21.3523702Z 
2025-09-10T08:31:21.3524754Z [1m[46m RUN [49m[22m [36mv3.2.4 [39m[90m/home/runner/work/services/services/services/media[39m
2025-09-10T08:31:21.3525358Z 
2025-09-10T08:31:21.3526158Z [2025-09-10 08:31:19.587 +0000] INFO: ðŸš€ media service running on port 0 {"service":"media"}
2025-09-10T08:31:21.3528616Z [90mstdout[2m | tests/integration/api/media.test.ts[2m > [22m[2mMedia API Tests[2m > [22m[2mPOST /xrpc/social.spkeasy.media.upload[2m > [22m[2mshould reject upload without Content-Length header
2025-09-10T08:31:21.3530328Z [22m[39mValidationError: Content-Length header is required
2025-09-10T08:31:21.3531676Z     at Object.social.spkeasy.media.upload [as handler] (/home/runner/work/services/services/services/media/src/routes/media.routes.ts:56:13)
2025-09-10T08:31:21.3533164Z     at /home/runner/work/services/services/packages/service-base/src/server.ts:137:46
2025-09-10T08:31:21.3534772Z     at newFn (/home/runner/work/services/services/node_modules/.pnpm/express-async-errors@3.1.1_express@4.21.2/node_modules/express-async-errors/index.js:16:20)
2025-09-10T08:31:21.3537126Z     at Layer.handle [as handle_request] (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/layer.js:95:5)
2025-09-10T08:31:21.3539206Z     at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:149:13)
2025-09-10T08:31:21.3541011Z     at jsonParser (/home/runner/work/services/services/node_modules/.pnpm/body-parser@1.20.3/node_modules/body-parser/lib/types/json.js:122:7)
2025-09-10T08:31:21.3542959Z     at newFn (/home/runner/work/services/services/node_modules/.pnpm/express-async-errors@3.1.1_express@4.21.2/node_modules/express-async-errors/index.js:16:20)
2025-09-10T08:31:21.3545039Z     at Layer.handle [as handle_request] (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/layer.js:95:5)
2025-09-10T08:31:21.3546877Z     at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:149:13)
2025-09-10T08:31:21.3554070Z     at authorizationMiddleware (/home/runner/work/services/services/packages/common/src/auth/ability.ts:103:3)
2025-09-10T08:31:21.3554856Z 
2025-09-10T08:31:21.3556553Z [90mstdout[2m | tests/integration/api/media.test.ts[2m > [22m[2mMedia API Tests[2m > [22m[2mPOST /xrpc/social.spkeasy.media.upload[2m > [22m[2mshould reject upload without session ID header
2025-09-10T08:31:21.3558600Z [22m[39mValidationError: X-Speakeasy-Session-Id header must be set exactly once
2025-09-10T08:31:21.3560099Z     at Object.social.spkeasy.media.upload [as handler] (/home/runner/work/services/services/services/media/src/routes/media.routes.ts:68:13)
2025-09-10T08:31:21.3561828Z     at /home/runner/work/services/services/packages/service-base/src/server.ts:137:46
2025-09-10T08:31:21.3563473Z     at newFn (/home/runner/work/services/services/node_modules/.pnpm/express-async-errors@3.1.1_express@4.21.2/node_modules/express-async-errors/index.js:16:20)
2025-09-10T08:31:21.3565502Z     at Layer.handle [as handle_request] (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/layer.js:95:5)
2025-09-10T08:31:21.3567400Z     at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:149:13)
2025-09-10T08:31:21.3569397Z     at jsonParser (/home/runner/work/services/services/node_modules/.pnpm/body-parser@1.20.3/node_modules/body-parser/lib/types/json.js:122:7)
2025-09-10T08:31:21.3571370Z     at newFn (/home/runner/work/services/services/node_modules/.pnpm/express-async-errors@3.1.1_express@4.21.2/node_modules/express-async-errors/index.js:16:20)
2025-09-10T08:31:21.3573389Z     at Layer.handle [as handle_request] (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/layer.js:95:5)
2025-09-10T08:31:21.3575238Z     at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:149:13)
2025-09-10T08:31:21.3576834Z     at authorizationMiddleware (/home/runner/work/services/services/packages/common/src/auth/ability.ts:103:3)
2025-09-10T08:31:21.3577626Z 
2025-09-10T08:31:21.3580764Z [2025-09-10 08:31:19.824 +0000] INFO: {"service":"media","requestId":"unknown","method":"social.spkeasy.media.upload","path":"/xrpc/social.spkeasy.media.upload","duration":167,"status":200,"ip":"313d5b13e067911efcc8e257ab3925051bb57a136f2d54f697e1e92ef9997f35","user":"3698761d94b6992d6277d4dc2932712760c796ead51e44dd484d665e3bcd7c08","dbDuration":4,"dbProfile":"2,2","authDuration":25}
2025-09-10T08:31:21.3585794Z [2025-09-10 08:31:19.853 +0000] ERROR: ValidationError occurred {"service":"media","requestId":"unknown","method":"POST","path":"/xrpc/social.spkeasy.media.upload","duration":8,"status":400,"user":"3698761d94b6992d6277d4dc2932712760c796ead51e44dd484d665e3bcd7c08","relevantLine":"/services/services/services/media/src/routes/media.routes.ts:56:13"}
2025-09-10T08:31:21.3588138Z     error: {
2025-09-10T08:31:21.3588716Z       "name": "ValidationError",
2025-09-10T08:31:21.3589259Z       "message": "Content-Length header is required",
2025-09-10T08:31:21.3589758Z       "statusCode": 400,
2025-09-10T08:31:21.3590118Z       "stack":
2025-09-10T08:31:21.3590597Z           ValidationError: Content-Length header is required
2025-09-10T08:31:21.3591930Z               at Object.social.spkeasy.media.upload [as handler] (/home/runner/work/services/services/services/media/src/routes/media.routes.ts:56:13)
2025-09-10T08:31:21.3593345Z               at /home/runner/work/services/services/packages/service-base/src/server.ts:137:46
2025-09-10T08:31:21.3594970Z               at newFn (/home/runner/work/services/services/node_modules/.pnpm/express-async-errors@3.1.1_express@4.21.2/node_modules/express-async-errors/index.js:16:20)
2025-09-10T08:31:21.3597000Z               at Layer.handle [as handle_request] (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/layer.js:95:5)
2025-09-10T08:31:21.3599065Z               at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:149:13)
2025-09-10T08:31:21.3600800Z               at jsonParser (/home/runner/work/services/services/node_modules/.pnpm/body-parser@1.20.3/node_modules/body-parser/lib/types/json.js:122:7)
2025-09-10T08:31:21.3602840Z               at newFn (/home/runner/work/services/services/node_modules/.pnpm/express-async-errors@3.1.1_express@4.21.2/node_modules/express-async-errors/index.js:16:20)
2025-09-10T08:31:21.3605190Z               at Layer.handle [as handle_request] (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/layer.js:95:5)
2025-09-10T08:31:21.3607104Z               at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:149:13)
2025-09-10T08:31:21.3608960Z               at authorizationMiddleware (/home/runner/work/services/services/packages/common/src/auth/ability.ts:103:3)
2025-09-10T08:31:21.3609856Z     }
2025-09-10T08:31:21.3613323Z [2025-09-10 08:31:19.862 +0000] ERROR: ValidationError occurred {"service":"media","requestId":"unknown","method":"POST","path":"/xrpc/social.spkeasy.media.upload","duration":1,"status":400,"ip":"313d5b13e067911efcc8e257ab3925051bb57a136f2d54f697e1e92ef9997f35","user":"3698761d94b6992d6277d4dc2932712760c796ead51e44dd484d665e3bcd7c08","relevantLine":"/services/services/services/media/src/routes/media.routes.ts:68:13"}
2025-09-10T08:31:21.3616084Z     error: {
2025-09-10T08:31:21.3616481Z       "name": "ValidationError",
2025-09-10T08:31:21.3617163Z       "message": "X-Speakeasy-Session-Id header must be set exactly once",
2025-09-10T08:31:21.3617787Z       "statusCode": 400,
2025-09-10T08:31:21.3618364Z       "stack":
2025-09-10T08:31:21.3619024Z           ValidationError: X-Speakeasy-Session-Id header must be set exactly once
2025-09-10T08:31:21.3620511Z               at Object.social.spkeasy.media.upload [as handler] (/home/runner/work/services/services/services/media/src/routes/media.routes.ts:68:13)
2025-09-10T08:31:21.3622029Z               at /home/runner/work/services/services/packages/service-base/src/server.ts:137:46
2025-09-10T08:31:21.3623720Z               at newFn (/home/runner/work/services/services/node_modules/.pnpm/express-async-errors@3.1.1_express@4.21.2/node_modules/express-async-errors/index.js:16:20)
2025-09-10T08:31:21.3625761Z               at Layer.handle [as handle_request] (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/layer.js:95:5)
2025-09-10T08:31:21.3627639Z               at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:149:13)
2025-09-10T08:31:21.3629644Z               at jsonParser (/home/runner/work/services/services/node_modules/.pnpm/body-parser@1.20.3/node_modules/body-parser/lib/types/json.js:122:7)
2025-09-10T08:31:21.3631897Z               at newFn (/home/runner/work/services/services/node_modules/.pnpm/express-async-errors@3.1.1_express@4.21.2/node_modules/express-async-errors/index.js:16:20)
2025-09-10T08:31:21.3634016Z               at Layer.handle [as handle_request] (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/layer.js:95:5)
2025-09-10T08:31:21.3635921Z               at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:149:13)
2025-09-10T08:31:21.3652784Z               at authorizationMiddleware (/home/runner/work/services/services/packages/common/src/auth/ability.ts:103:3)
2025-09-10T08:31:21.3653839Z     }
2025-09-10T08:31:21.3655643Z [90mstdout[2m | tests/integration/api/media.test.ts[2m > [22m[2mMedia API Tests[2m > [22m[2mPOST /xrpc/social.spkeasy.media.upload[2m > [22m[2mshould reject non-image file types
2025-09-10T08:31:21.3657668Z [22m[39mValidationError: Only image files are allowed. Supported formats: JPEG, PNG, GIF, WEBP, AVIF
2025-09-10T08:31:21.3659492Z     at Object.social.spkeasy.media.upload [as handler] (/home/runner/work/services/services/services/media/src/routes/media.routes.ts:84:13)
2025-09-10T08:31:21.3660967Z     at /home/runner/work/services/services/packages/service-base/src/server.ts:137:46
2025-09-10T08:31:21.3662633Z     at newFn (/home/runner/work/services/services/node_modules/.pnpm/express-async-errors@3.1.1_express@4.21.2/node_modules/express-async-errors/index.js:16:20)
2025-09-10T08:31:21.3664745Z     at Layer.handle [as handle_request] (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/layer.js:95:5)
2025-09-10T08:31:21.3666879Z     at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:149:13)
2025-09-10T08:31:21.3668920Z     at jsonParser (/home/runner/work/services/services/node_modules/.pnpm/body-parser@1.20.3/node_modules/body-parser/lib/types/json.js:122:7)
2025-09-10T08:31:21.3670870Z     at newFn (/home/runner/work/services/services/node_modules/.pnpm/express-async-errors@3.1.1_express@4.21.2/node_modules/express-async-errors/index.js:16:20)
2025-09-10T08:31:21.3672946Z     at Layer.handle [as handle_request] (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/layer.js:95:5)
2025-09-10T08:31:21.3674796Z     at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:149:13)
2025-09-10T08:31:21.3676424Z     at authorizationMiddleware (/home/runner/work/services/services/packages/common/src/auth/ability.ts:103:3)
2025-09-10T08:31:21.3677245Z 
2025-09-10T08:31:21.3680815Z [2025-09-10 08:31:19.875 +0000] ERROR: ValidationError occurred {"service":"media","requestId":"unknown","method":"POST","path":"/xrpc/social.spkeasy.media.upload","duration":1,"status":400,"ip":"313d5b13e067911efcc8e257ab3925051bb57a136f2d54f697e1e92ef9997f35","user":"3698761d94b6992d6277d4dc2932712760c796ead51e44dd484d665e3bcd7c08","relevantLine":"/services/services/services/media/src/routes/media.routes.ts:84:13"}
2025-09-10T08:31:21.3683668Z     error: {
2025-09-10T08:31:21.3684075Z       "name": "ValidationError",
2025-09-10T08:31:21.3684895Z       "message": "Only image files are allowed. Supported formats: JPEG, PNG, GIF, WEBP, AVIF",
2025-09-10T08:31:21.3685643Z       "statusCode": 400,
2025-09-10T08:31:21.3686026Z       "stack":
2025-09-10T08:31:21.3686794Z           ValidationError: Only image files are allowed. Supported formats: JPEG, PNG, GIF, WEBP, AVIF
2025-09-10T08:31:21.3688586Z               at Object.social.spkeasy.media.upload [as handler] (/home/runner/work/services/services/services/media/src/routes/media.routes.ts:84:13)
2025-09-10T08:31:21.3690115Z               at /home/runner/work/services/services/packages/service-base/src/server.ts:137:46
2025-09-10T08:31:21.3692026Z               at newFn (/home/runner/work/services/services/node_modules/.pnpm/express-async-errors@3.1.1_express@4.21.2/node_modules/express-async-errors/index.js:16:20)
2025-09-10T08:31:21.3694183Z               at Layer.handle [as handle_request] (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/layer.js:95:5)
2025-09-10T08:31:21.3696069Z               at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:149:13)
2025-09-10T08:31:21.3697922Z               at jsonParser (/home/runner/work/services/services/node_modules/.pnpm/body-parser@1.20.3/node_modules/body-parser/lib/types/json.js:122:7)
2025-09-10T08:31:21.3700181Z               at newFn (/home/runner/work/services/services/node_modules/.pnpm/express-async-errors@3.1.1_express@4.21.2/node_modules/express-async-errors/index.js:16:20)
2025-09-10T08:31:21.3702294Z               at Layer.handle [as handle_request] (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/layer.js:95:5)
2025-09-10T08:31:21.3704196Z               at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:149:13)
2025-09-10T08:31:21.3705842Z               at authorizationMiddleware (/home/runner/work/services/services/packages/common/src/auth/ability.ts:103:3)
2025-09-10T08:31:21.3706764Z     }
2025-09-10T08:31:21.3708777Z [90mstdout[2m | tests/integration/api/media.test.ts[2m > [22m[2mMedia API Tests[2m > [22m[2mPOST /xrpc/social.spkeasy.media.upload[2m > [22m[2mshould reject files exceeding size limit
2025-09-10T08:31:21.3710681Z [22m[39mValidationError: File size must be less than 2MB
2025-09-10T08:31:21.3712040Z     at Object.social.spkeasy.media.upload [as handler] (/home/runner/work/services/services/services/media/src/routes/media.routes.ts:59:13)
2025-09-10T08:31:21.3713533Z     at /home/runner/work/services/services/packages/service-base/src/server.ts:137:46
2025-09-10T08:31:21.3715210Z     at newFn (/home/runner/work/services/services/node_modules/.pnpm/express-async-errors@3.1.1_express@4.21.2/node_modules/express-async-errors/index.js:16:20)
2025-09-10T08:31:21.3717315Z     at Layer.handle [as handle_request] (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/layer.js:95:5)
2025-09-10T08:31:21.3719388Z     at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:149:13)
2025-09-10T08:31:21.3721204Z     at jsonParser (/home/runner/work/services/services/node_modules/.pnpm/body-parser@1.20.3/node_modules/body-parser/lib/types/json.js:122:7)
2025-09-10T08:31:21.3723290Z     at newFn (/home/runner/work/services/services/node_modules/.pnpm/express-async-errors@3.1.1_express@4.21.2/node_modules/express-async-errors/index.js:16:20)
2025-09-10T08:31:21.3725401Z     at Layer.handle [as handle_request] (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/layer.js:95:5)
2025-09-10T08:31:21.3727289Z     at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:149:13)
2025-09-10T08:31:21.3729129Z     at authorizationMiddleware (/home/runner/work/services/services/packages/common/src/auth/ability.ts:103:3)
2025-09-10T08:31:21.3729925Z 
2025-09-10T08:31:21.3733249Z [2025-09-10 08:31:19.899 +0000] ERROR: ValidationError occurred {"service":"media","requestId":"unknown","method":"POST","path":"/xrpc/social.spkeasy.media.upload","duration":2,"status":400,"ip":"313d5b13e067911efcc8e257ab3925051bb57a136f2d54f697e1e92ef9997f35","user":"3698761d94b6992d6277d4dc2932712760c796ead51e44dd484d665e3bcd7c08","relevantLine":"/services/services/services/media/src/routes/media.routes.ts:59:13"}
2025-09-10T08:31:21.3735996Z     error: {
2025-09-10T08:31:21.3736384Z       "name": "ValidationError",
2025-09-10T08:31:21.3736927Z       "message": "File size must be less than 2MB",
2025-09-10T08:31:21.3737445Z       "statusCode": 400,
2025-09-10T08:31:21.3737804Z       "stack":
2025-09-10T08:31:21.3738752Z           ValidationError: File size must be less than 2MB
2025-09-10T08:31:21.3740093Z               at Object.social.spkeasy.media.upload [as handler] (/home/runner/work/services/services/services/media/src/routes/media.routes.ts:59:13)
2025-09-10T08:31:21.3741585Z               at /home/runner/work/services/services/packages/service-base/src/server.ts:137:46
2025-09-10T08:31:21.3743300Z               at newFn (/home/runner/work/services/services/node_modules/.pnpm/express-async-errors@3.1.1_express@4.21.2/node_modules/express-async-errors/index.js:16:20)
2025-09-10T08:31:21.3745434Z               at Layer.handle [as handle_request] (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/layer.js:95:5)
2025-09-10T08:31:21.3747332Z               at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:149:13)
2025-09-10T08:31:21.3749358Z               at jsonParser (/home/runner/work/services/services/node_modules/.pnpm/body-parser@1.20.3/node_modules/body-parser/lib/types/json.js:122:7)
2025-09-10T08:31:21.3751411Z               at newFn (/home/runner/work/services/services/node_modules/.pnpm/express-async-errors@3.1.1_express@4.21.2/node_modules/express-async-errors/index.js:16:20)
2025-09-10T08:31:21.3753524Z               at Layer.handle [as handle_request] (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/layer.js:95:5)
2025-09-10T08:31:21.3755677Z               at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:149:13)
2025-09-10T08:31:21.3757343Z               at authorizationMiddleware (/home/runner/work/services/services/packages/common/src/auth/ability.ts:103:3)
2025-09-10T08:31:21.3758484Z     }
2025-09-10T08:31:21.3761650Z [2025-09-10 08:31:19.911 +0000] INFO: {"service":"media","requestId":"unknown","method":"social.spkeasy.media.upload","path":"/xrpc/social.spkeasy.media.upload","duration":5,"status":200,"ip":"313d5b13e067911efcc8e257ab3925051bb57a136f2d54f697e1e92ef9997f35","user":"3698761d94b6992d6277d4dc2932712760c796ead51e44dd484d665e3bcd7c08","dbDuration":1,"dbProfile":"0,1","authDuration":0}
2025-09-10T08:31:21.3766935Z [2025-09-10 08:31:19.921 +0000] INFO: {"service":"media","requestId":"unknown","method":"social.spkeasy.media.upload","path":"/xrpc/social.spkeasy.media.upload","duration":5,"status":200,"ip":"313d5b13e067911efcc8e257ab3925051bb57a136f2d54f697e1e92ef9997f35","user":"3698761d94b6992d6277d4dc2932712760c796ead51e44dd484d665e3bcd7c08","dbDuration":0,"dbProfile":"0,0","authDuration":0}
2025-09-10T08:31:21.3772444Z [2025-09-10 08:31:19.932 +0000] INFO: {"service":"media","requestId":"unknown","method":"social.spkeasy.media.upload","path":"/xrpc/social.spkeasy.media.upload","duration":4,"status":200,"ip":"313d5b13e067911efcc8e257ab3925051bb57a136f2d54f697e1e92ef9997f35","user":"3698761d94b6992d6277d4dc2932712760c796ead51e44dd484d665e3bcd7c08","dbDuration":0,"dbProfile":"0,0","authDuration":0}
2025-09-10T08:31:21.3776359Z  [32mâœ“[39m tests/integration/api/media.test.ts[2m > [22mMedia API Tests[2m > [22mPOST /xrpc/social.spkeasy.media.upload[2m > [22mshould upload a valid image file successfully[32m 288[2mms[22m[39m
2025-09-10T08:31:21.3779307Z  [32mâœ“[39m tests/integration/api/media.test.ts[2m > [22mMedia API Tests[2m > [22mPOST /xrpc/social.spkeasy.media.upload[2m > [22mshould reject upload without Content-Length header[32m 18[2mms[22m[39m
2025-09-10T08:31:21.3781111Z  [32mâœ“[39m tests/integration/api/media.test.ts[2m > [22mMedia API Tests[2m > [22mPOST /xrpc/social.spkeasy.media.upload[2m > [22mshould reject upload without session ID header[32m 10[2mms[22m[39m
2025-09-10T08:31:21.3783626Z  [32mâœ“[39m tests/integration/api/media.test.ts[2m > [22mMedia API Tests[2m > [22mPOST /xrpc/social.spkeasy.media.upload[2m > [22mshould reject non-image file types[32m 12[2mms[22m[39m
2025-09-10T08:31:21.3786478Z  [32mâœ“[39m tests/integration/api/media.test.ts[2m > [22mMedia API Tests[2m > [22mPOST /xrpc/social.spkeasy.media.upload[2m > [22mshould reject files exceeding size limit[32m 24[2mms[22m[39m
2025-09-10T08:31:21.3790847Z [2025-09-10 08:31:19.945 +0000] INFO: {"service":"media","requestId":"unknown","method":"social.spkeasy.media.upload","path":"/xrpc/social.spkeasy.media.upload","duration":8,"status":200,"ip":"313d5b13e067911efcc8e257ab3925051bb57a136f2d54f697e1e92ef9997f35","user":"3698761d94b6992d6277d4dc2932712760c796ead51e44dd484d665e3bcd7c08","dbDuration":0,"dbProfile":"0,0","authDuration":1}
2025-09-10T08:31:21.3794793Z [2025-09-10 08:31:19.957 +0000] INFO: {"service":"media","requestId":"unknown","method":"social.spkeasy.media.upload","path":"/xrpc/social.spkeasy.media.upload","duration":6,"status":200,"ip":"313d5b13e067911efcc8e257ab3925051bb57a136f2d54f697e1e92ef9997f35","user":"3698761d94b6992d6277d4dc2932712760c796ead51e44dd484d665e3bcd7c08","dbDuration":0,"dbProfile":"0,0","authDuration":0}
2025-09-10T08:31:21.3797867Z [2025-09-10 08:31:19.983 +0000] INFO: {"service":"media","requestId":"unknown","method":"social.spkeasy.media.upload","path":"/xrpc/social.spkeasy.media.upload","duration":8,"status":200,"ip":"313d5b13e067911efcc8e257ab3925051bb57a136f2d54f697e1e92ef9997f35","user":"27a6975c25e4173a88c88b5f5302928606895d1dbb1925a1f15bd54ef2a8e9d9","dbDuration":3,"dbProfile":"0,3","authDuration":8}
2025-09-10T08:31:21.3800978Z [2025-09-10 08:31:19.994 +0000] INFO: {"service":"media","requestId":"unknown","method":"social.spkeasy.media.upload","path":"/xrpc/social.spkeasy.media.upload","duration":3,"status":200,"ip":"313d5b13e067911efcc8e257ab3925051bb57a136f2d54f697e1e92ef9997f35","user":"27a6975c25e4173a88c88b5f5302928606895d1dbb1925a1f15bd54ef2a8e9d9","dbDuration":0,"dbProfile":"0,0","authDuration":0}
2025-09-10T08:31:21.3804029Z [2025-09-10 08:31:20.007 +0000] INFO: {"service":"media","requestId":"unknown","method":"social.spkeasy.media.upload","path":"/xrpc/social.spkeasy.media.upload","duration":4,"status":200,"ip":"313d5b13e067911efcc8e257ab3925051bb57a136f2d54f697e1e92ef9997f35","user":"27a6975c25e4173a88c88b5f5302928606895d1dbb1925a1f15bd54ef2a8e9d9","dbDuration":1,"dbProfile":"0,1","authDuration":0}
2025-09-10T08:31:21.3806900Z [2025-09-10 08:31:20.017 +0000] INFO: {"service":"media","requestId":"unknown","method":"social.spkeasy.media.upload","path":"/xrpc/social.spkeasy.media.upload","duration":3,"status":200,"ip":"313d5b13e067911efcc8e257ab3925051bb57a136f2d54f697e1e92ef9997f35","user":"27a6975c25e4173a88c88b5f5302928606895d1dbb1925a1f15bd54ef2a8e9d9","dbDuration":0,"dbProfile":"0,0","authDuration":0}
2025-09-10T08:31:21.3809955Z [2025-09-10 08:31:20.028 +0000] INFO: {"service":"media","requestId":"unknown","method":"social.spkeasy.media.upload","path":"/xrpc/social.spkeasy.media.upload","duration":3,"status":200,"ip":"313d5b13e067911efcc8e257ab3925051bb57a136f2d54f697e1e92ef9997f35","user":"27a6975c25e4173a88c88b5f5302928606895d1dbb1925a1f15bd54ef2a8e9d9","dbDuration":0,"dbProfile":"0,0","authDuration":0}
2025-09-10T08:31:21.3812792Z [2025-09-10 08:31:20.039 +0000] INFO: {"service":"media","requestId":"unknown","method":"social.spkeasy.media.upload","path":"/xrpc/social.spkeasy.media.upload","duration":5,"status":200,"ip":"313d5b13e067911efcc8e257ab3925051bb57a136f2d54f697e1e92ef9997f35","user":"27a6975c25e4173a88c88b5f5302928606895d1dbb1925a1f15bd54ef2a8e9d9","dbDuration":1,"dbProfile":"1,0","authDuration":0}
2025-09-10T08:31:21.3815638Z [2025-09-10 08:31:20.048 +0000] INFO: {"service":"media","requestId":"unknown","method":"social.spkeasy.media.upload","path":"/xrpc/social.spkeasy.media.upload","duration":3,"status":200,"ip":"313d5b13e067911efcc8e257ab3925051bb57a136f2d54f697e1e92ef9997f35","user":"27a6975c25e4173a88c88b5f5302928606895d1dbb1925a1f15bd54ef2a8e9d9","dbDuration":0,"dbProfile":"0,0","authDuration":0}
2025-09-10T08:31:21.3818762Z [2025-09-10 08:31:20.054 +0000] INFO: {"service":"media","requestId":"unknown","method":"social.spkeasy.media.upload","path":"/xrpc/social.spkeasy.media.upload","duration":2,"status":200,"ip":"313d5b13e067911efcc8e257ab3925051bb57a136f2d54f697e1e92ef9997f35","user":"27a6975c25e4173a88c88b5f5302928606895d1dbb1925a1f15bd54ef2a8e9d9","dbDuration":0,"dbProfile":"0,0","authDuration":0}
2025-09-10T08:31:21.3820891Z  [32mâœ“[39m tests/integration/api/media.test.ts[2m > [22mMedia API Tests[2m > [22mPOST /xrpc/social.spkeasy.media.upload[2m > [22mshould accept different image formats[32m 58[2mms[22m[39m
2025-09-10T08:31:21.3823137Z [2025-09-10 08:31:20.062 +0000] INFO: {"service":"media","requestId":"unknown","method":"social.spkeasy.media.upload","path":"/xrpc/social.spkeasy.media.upload","duration":3,"status":200,"ip":"313d5b13e067911efcc8e257ab3925051bb57a136f2d54f697e1e92ef9997f35","user":"27a6975c25e4173a88c88b5f5302928606895d1dbb1925a1f15bd54ef2a8e9d9","dbDuration":0,"dbProfile":"0,0","authDuration":0}
2025-09-10T08:31:21.3826022Z [2025-09-10 08:31:20.068 +0000] INFO: {"service":"media","requestId":"unknown","method":"social.spkeasy.media.upload","path":"/xrpc/social.spkeasy.media.upload","duration":2,"status":200,"ip":"313d5b13e067911efcc8e257ab3925051bb57a136f2d54f697e1e92ef9997f35","user":"27a6975c25e4173a88c88b5f5302928606895d1dbb1925a1f15bd54ef2a8e9d9","dbDuration":0,"dbProfile":"0,0","authDuration":0}
2025-09-10T08:31:21.3829047Z [2025-09-10 08:31:20.077 +0000] INFO: {"service":"media","requestId":"unknown","method":"social.spkeasy.media.upload","path":"/xrpc/social.spkeasy.media.upload","duration":3,"status":200,"ip":"313d5b13e067911efcc8e257ab3925051bb57a136f2d54f697e1e92ef9997f35","user":"27a6975c25e4173a88c88b5f5302928606895d1dbb1925a1f15bd54ef2a8e9d9","dbDuration":0,"dbProfile":"0,0","authDuration":0}
2025-09-10T08:31:21.3832033Z [2025-09-10 08:31:20.082 +0000] INFO: {"service":"media","requestId":"unknown","method":"social.spkeasy.media.upload","path":"/xrpc/social.spkeasy.media.upload","duration":3,"status":200,"ip":"313d5b13e067911efcc8e257ab3925051bb57a136f2d54f697e1e92ef9997f35","user":"27a6975c25e4173a88c88b5f5302928606895d1dbb1925a1f15bd54ef2a8e9d9","dbDuration":0,"dbProfile":"0,0","authDuration":0}
2025-09-10T08:31:21.3835642Z [90mstdout[2m | tests/integration/api/media.test.ts[2m > [22m[2mMedia API Tests[2m > [22m[2mPOST /xrpc/social.spkeasy.media.upload[2m > [22m[2mshould enforce daily upload quota
2025-09-10T08:31:21.3837209Z [22m[39mValidationError: Daily upload limit of 20MB exceeded
2025-09-10T08:31:21.3838702Z     at MediaService.uploadMedia (/home/runner/work/services/services/services/media/src/services/media.service.ts:51:13)
2025-09-10T08:31:21.3840499Z     at Object.social.spkeasy.media.upload [as handler] (/home/runner/work/services/services/services/media/src/routes/media.routes.ts:89:20)
2025-09-10T08:31:21.3841921Z     at /home/runner/work/services/services/packages/service-base/src/server.ts:137:26
2025-09-10T08:31:21.3842513Z 
2025-09-10T08:31:21.3845838Z [2025-09-10 08:31:20.088 +0000] ERROR: ValidationError occurred {"service":"media","requestId":"unknown","method":"POST","path":"/xrpc/social.spkeasy.media.upload","duration":1,"status":400,"ip":"313d5b13e067911efcc8e257ab3925051bb57a136f2d54f697e1e92ef9997f35","user":"27a6975c25e4173a88c88b5f5302928606895d1dbb1925a1f15bd54ef2a8e9d9","relevantLine":"/services/services/services/media/src/services/media.service.ts:51:13"}
2025-09-10T08:31:21.3848724Z     error: {
2025-09-10T08:31:21.3849104Z       "name": "ValidationError",
2025-09-10T08:31:21.3849706Z       "message": "Daily upload limit of 20MB exceeded",
2025-09-10T08:31:21.3850202Z       "statusCode": 400,
2025-09-10T08:31:21.3850560Z       "stack":
2025-09-10T08:31:21.3851029Z           ValidationError: Daily upload limit of 20MB exceeded
2025-09-10T08:31:21.3852183Z               at MediaService.uploadMedia (/home/runner/work/services/services/services/media/src/services/media.service.ts:51:13)
2025-09-10T08:31:21.3853879Z               at Object.social.spkeasy.media.upload [as handler] (/home/runner/work/services/services/services/media/src/routes/media.routes.ts:89:20)
2025-09-10T08:31:21.3855219Z               at /home/runner/work/services/services/packages/service-base/src/server.ts:137:26
2025-09-10T08:31:21.3855632Z     }
2025-09-10T08:31:21.3856924Z [90mstdout[2m | tests/integration/api/media.test.ts[2m > [22m[2mMedia API Tests[2m > [22m[2mPOST /xrpc/social.spkeasy.media.upload[2m > [22m[2mshould enforce daily upload quota
2025-09-10T08:31:21.3858581Z [22m[39mValidationError: Daily upload limit of 20MB exceeded
2025-09-10T08:31:21.3859401Z     at MediaService.uploadMedia (/home/runner/work/services/services/services/media/src/services/media.service.ts:51:13)
2025-09-10T08:31:21.3860866Z     at Object.social.spkeasy.media.upload [as handler] (/home/runner/work/services/services/services/media/src/routes/media.routes.ts:89:20)
2025-09-10T08:31:21.3862281Z     at /home/runner/work/services/services/packages/service-base/src/server.ts:137:26
2025-09-10T08:31:21.3862855Z 
2025-09-10T08:31:21.3866164Z [2025-09-10 08:31:20.097 +0000] ERROR: ValidationError occurred {"service":"media","requestId":"unknown","method":"POST","path":"/xrpc/social.spkeasy.media.upload","duration":5,"status":400,"ip":"313d5b13e067911efcc8e257ab3925051bb57a136f2d54f697e1e92ef9997f35","user":"27a6975c25e4173a88c88b5f5302928606895d1dbb1925a1f15bd54ef2a8e9d9","relevantLine":"/services/services/services/media/src/services/media.service.ts:51:13"}
2025-09-10T08:31:21.3869015Z     error: {
2025-09-10T08:31:21.3869359Z       "name": "ValidationError",
2025-09-10T08:31:21.3869863Z       "message": "Daily upload limit of 20MB exceeded",
2025-09-10T08:31:21.3870543Z       "statusCode": 400,
2025-09-10T08:31:21.3870859Z       "stack":
2025-09-10T08:31:21.3871297Z           ValidationError: Daily upload limit of 20MB exceeded
2025-09-10T08:31:21.3872448Z               at MediaService.uploadMedia (/home/runner/work/services/services/services/media/src/services/media.service.ts:51:13)
2025-09-10T08:31:21.3874197Z               at Object.social.spkeasy.media.upload [as handler] (/home/runner/work/services/services/services/media/src/routes/media.routes.ts:89:20)
2025-09-10T08:31:21.3875624Z               at /home/runner/work/services/services/packages/service-base/src/server.ts:137:26
2025-09-10T08:31:21.3876300Z     }
2025-09-10T08:31:21.3878117Z [90mstdout[2m | tests/integration/api/media.test.ts[2m > [22m[2mMedia API Tests[2m > [22m[2mPOST /xrpc/social.spkeasy.media.upload[2m > [22m[2mshould require authentication
2025-09-10T08:31:21.3879627Z [22m[39mAuthenticationError: Missing authorization header
2025-09-10T08:31:21.3880743Z     at getBearerToken (/home/runner/work/services/services/packages/common/src/auth/bearer-tokens.ts:58:11)
2025-09-10T08:31:21.3882179Z     at authenticateToken (/home/runner/work/services/services/packages/common/src/auth/bearer-tokens.ts:81:17)
2025-09-10T08:31:21.3883925Z     at newFn (/home/runner/work/services/services/node_modules/.pnpm/express-async-errors@3.1.1_express@4.21.2/node_modules/express-async-errors/index.js:16:20)
2025-09-10T08:31:21.3885901Z     at Layer.handle [as handle_request] (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/layer.js:95:5)
2025-09-10T08:31:21.3887629Z     at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:149:13)
2025-09-10T08:31:21.3889210Z     at queryTrackerMiddleware (/home/runner/work/services/services/services/media/src/db.ts:114:3)
2025-09-10T08:31:21.3890845Z     at newFn (/home/runner/work/services/services/node_modules/.pnpm/express-async-errors@3.1.1_express@4.21.2/node_modules/express-async-errors/index.js:16:20)
2025-09-10T08:31:21.3892795Z     at Layer.handle [as handle_request] (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/layer.js:95:5)
2025-09-10T08:31:21.3894577Z     at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:149:13)
2025-09-10T08:31:21.3896468Z     at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:145:7)
2025-09-10T08:31:21.3897310Z 
2025-09-10T08:31:21.3900145Z [2025-09-10 08:31:20.102 +0000] ERROR: AuthenticationError occurred {"service":"media","requestId":"unknown","method":"POST","path":"/xrpc/social.spkeasy.media.upload","duration":null,"status":401,"ip":"313d5b13e067911efcc8e257ab3925051bb57a136f2d54f697e1e92ef9997f35","relevantLine":"/services/services/packages/common/src/auth/bearer-tokens.ts:58:11"}
2025-09-10T08:31:21.3902346Z     error: {
2025-09-10T08:31:21.3902718Z       "name": "AuthenticationError",
2025-09-10T08:31:21.3903232Z       "message": "Missing authorization header",
2025-09-10T08:31:21.3903686Z       "statusCode": 401,
2025-09-10T08:31:21.3904018Z       "stack":
2025-09-10T08:31:21.3904462Z           AuthenticationError: Missing authorization header
2025-09-10T08:31:21.3905510Z               at getBearerToken (/home/runner/work/services/services/packages/common/src/auth/bearer-tokens.ts:58:11)
2025-09-10T08:31:21.3906922Z               at authenticateToken (/home/runner/work/services/services/packages/common/src/auth/bearer-tokens.ts:81:17)
2025-09-10T08:31:21.3908834Z               at newFn (/home/runner/work/services/services/node_modules/.pnpm/express-async-errors@3.1.1_express@4.21.2/node_modules/express-async-errors/index.js:16:20)
2025-09-10T08:31:21.3910872Z               at Layer.handle [as handle_request] (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/layer.js:95:5)
2025-09-10T08:31:21.3912931Z               at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:149:13)
2025-09-10T08:31:21.3914410Z               at queryTrackerMiddleware (/home/runner/work/services/services/services/media/src/db.ts:114:3)
2025-09-10T08:31:21.3916170Z               at newFn (/home/runner/work/services/services/node_modules/.pnpm/express-async-errors@3.1.1_express@4.21.2/node_modules/express-async-errors/index.js:16:20)
2025-09-10T08:31:21.3918367Z               at Layer.handle [as handle_request] (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/layer.js:95:5)
2025-09-10T08:31:21.3920206Z               at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:149:13)
2025-09-10T08:31:21.3921869Z               at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:145:7)
2025-09-10T08:31:21.3922822Z     }
2025-09-10T08:31:21.3925264Z [2025-09-10 08:31:20.119 +0000] INFO: {"service":"media","requestId":"unknown","method":"social.spkeasy.media.delete","path":"/xrpc/social.spkeasy.media.delete","duration":2,"status":200,"ip":"313d5b13e067911efcc8e257ab3925051bb57a136f2d54f697e1e92ef9997f35","user":"private-sessions","dbDuration":0,"dbProfile":"0"}
2025-09-10T08:31:21.3928915Z [90mstdout[2m | tests/integration/api/media.test.ts[2m > [22m[2mMedia API Tests[2m > [22m[2mPOST /xrpc/social.spkeasy.media.delete[2m > [22m[2mshould fail to delete non-existent media file
2025-09-10T08:31:21.3930395Z [22m[39mPrismaClientKnownRequestError: 
2025-09-10T08:31:21.3931000Z Invalid `prisma.media.delete()` invocation in
2025-09-10T08:31:21.3931980Z /home/runner/work/services/services/services/media/src/services/media.service.ts:85:24
2025-09-10T08:31:21.3932610Z 
2025-09-10T08:31:21.3932770Z   82 await deleteFromS3(key);
2025-09-10T08:31:21.3933130Z   83 
2025-09-10T08:31:21.3933426Z   84 // Delete from database
2025-09-10T08:31:21.3933954Z â†’ 85 await prisma.media.delete(
2025-09-10T08:31:21.3935102Z An operation failed because it depends on one or more records that were required but not found. No record was found for a delete.
2025-09-10T08:31:21.3936828Z     at ei.handleRequestError (/home/runner/work/services/services/services/media/src/generated/prisma-client/runtime/library.js:124:7283)
2025-09-10T08:31:21.3939168Z     at ei.handleAndLogRequestError (/home/runner/work/services/services/services/media/src/generated/prisma-client/runtime/library.js:124:6608)
2025-09-10T08:31:21.3941021Z     at ei.request (/home/runner/work/services/services/services/media/src/generated/prisma-client/runtime/library.js:124:6315)
2025-09-10T08:31:21.3942638Z     at a (/home/runner/work/services/services/services/media/src/generated/prisma-client/runtime/library.js:133:9551)
2025-09-10T08:31:21.3944224Z     at MediaService.deleteMedia (/home/runner/work/services/services/services/media/src/services/media.service.ts:85:5)
2025-09-10T08:31:21.3945965Z     at Object.social.spkeasy.media.delete [as handler] (/home/runner/work/services/services/services/media/src/routes/media.routes.ts:113:5)
2025-09-10T08:31:21.3947389Z     at /home/runner/work/services/services/packages/service-base/src/server.ts:137:26
2025-09-10T08:31:21.3948145Z 
2025-09-10T08:31:21.3949709Z [90mstdout[2m | tests/integration/api/media.test.ts[2m > [22m[2mMedia API Tests[2m > [22m[2mPOST /xrpc/social.spkeasy.media.delete[2m > [22m[2mshould require authentication
2025-09-10T08:31:21.3950626Z [22m[39mAuthenticationError: Missing authorization header
2025-09-10T08:31:21.3951261Z     at getBearerToken (/home/runner/work/services/services/packages/common/src/auth/bearer-tokens.ts:58:11)
2025-09-10T08:31:21.3952085Z     at authenticateToken (/home/runner/work/services/services/packages/common/src/auth/bearer-tokens.ts:81:17)
2025-09-10T08:31:21.3953094Z     at newFn (/home/runner/work/services/services/node_modules/.pnpm/express-async-errors@3.1.1_express@4.21.2/node_modules/express-async-errors/index.js:16:20)
2025-09-10T08:31:21.3954416Z     at Layer.handle [as handle_request] (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/layer.js:95:5)
2025-09-10T08:31:21.3955436Z     at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:149:13)
2025-09-10T08:31:21.3956243Z     at queryTrackerMiddleware (/home/runner/work/services/services/services/media/src/db.ts:114:3)
2025-09-10T08:31:21.3957196Z     at newFn (/home/runner/work/services/services/node_modules/.pnpm/express-async-errors@3.1.1_express@4.21.2/node_modules/express-async-errors/index.js:16:20)
2025-09-10T08:31:21.3958569Z     at Layer.handle [as handle_request] (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/layer.js:95:5)
2025-09-10T08:31:21.3959585Z     at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:149:13)
2025-09-10T08:31:21.3960508Z     at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:145:7)
2025-09-10T08:31:21.3960993Z 
2025-09-10T08:31:21.3962228Z [2025-09-10 08:31:20.127 +0000] ERROR: PrismaClientKnownRequestError occurred {"service":"media","requestId":"unknown","method":"POST","path":"/xrpc/social.spkeasy.media.delete","duration":5,"status":400,"ip":"313d5b13e067911efcc8e257ab3925051bb57a136f2d54f697e1e92ef9997f35","user":"private-sessions"}
2025-09-10T08:31:21.3963318Z     error: {
2025-09-10T08:31:21.3963555Z       "name": "PrismaClientKnownRequestError",
2025-09-10T08:31:21.3965409Z       "message": "\nInvalid `prisma.media.delete()` invocation in\n/home/runner/work/services/services/services/media/src/services/media.service.ts:85:24\n\n  82 await deleteFromS3(key);\n  83 \n  84 // Delete from database\nâ†’ 85 await prisma.media.delete(\nAn operation failed because it depends on one or more records that were required but not found. No record was found for a delete.",
2025-09-10T08:31:21.3966778Z       "stack":
2025-09-10T08:31:21.3967002Z           PrismaClientKnownRequestError: 
2025-09-10T08:31:21.3967324Z           Invalid `prisma.media.delete()` invocation in
2025-09-10T08:31:21.3967842Z           /home/runner/work/services/services/services/media/src/services/media.service.ts:85:24
2025-09-10T08:31:21.3968624Z           
2025-09-10T08:31:21.3968832Z             82 await deleteFromS3(key);
2025-09-10T08:31:21.3969073Z             83 
2025-09-10T08:31:21.3969272Z             84 // Delete from database
2025-09-10T08:31:21.3969603Z           â†’ 85 await prisma.media.delete(
2025-09-10T08:31:21.3970210Z           An operation failed because it depends on one or more records that were required but not found. No record was found for a delete.
2025-09-10T08:31:21.3971194Z               at ei.handleRequestError (/home/runner/work/services/services/services/media/src/generated/prisma-client/runtime/library.js:124:7283)
2025-09-10T08:31:21.3972303Z               at ei.handleAndLogRequestError (/home/runner/work/services/services/services/media/src/generated/prisma-client/runtime/library.js:124:6608)
2025-09-10T08:31:21.3973351Z               at ei.request (/home/runner/work/services/services/services/media/src/generated/prisma-client/runtime/library.js:124:6315)
2025-09-10T08:31:21.3974283Z               at a (/home/runner/work/services/services/services/media/src/generated/prisma-client/runtime/library.js:133:9551)
2025-09-10T08:31:21.3975179Z               at MediaService.deleteMedia (/home/runner/work/services/services/services/media/src/services/media.service.ts:85:5)
2025-09-10T08:31:21.3976148Z               at Object.social.spkeasy.media.delete [as handler] (/home/runner/work/services/services/services/media/src/routes/media.routes.ts:113:5)
2025-09-10T08:31:21.3976966Z               at /home/runner/work/services/services/packages/service-base/src/server.ts:137:26
2025-09-10T08:31:21.3977484Z       "meta": {
2025-09-10T08:31:21.3977667Z         "modelName": "Media",
2025-09-10T08:31:21.3978064Z         "cause": "No record was found for a delete."
2025-09-10T08:31:21.3978318Z       },
2025-09-10T08:31:21.3978477Z       "code": "P2025"
2025-09-10T08:31:21.3978655Z     }
2025-09-10T08:31:21.3980209Z [2025-09-10 08:31:20.130 +0000] ERROR: AuthenticationError occurred {"service":"media","requestId":"unknown","method":"POST","path":"/xrpc/social.spkeasy.media.delete","duration":null,"status":401,"ip":"313d5b13e067911efcc8e257ab3925051bb57a136f2d54f697e1e92ef9997f35","relevantLine":"/services/services/packages/common/src/auth/bearer-tokens.ts:58:11"}
2025-09-10T08:31:21.3981482Z     error: {
2025-09-10T08:31:21.3981687Z       "name": "AuthenticationError",
2025-09-10T08:31:21.3981974Z       "message": "Missing authorization header",
2025-09-10T08:31:21.3982241Z       "statusCode": 401,
2025-09-10T08:31:21.3982425Z       "stack":
2025-09-10T08:31:21.3982684Z           AuthenticationError: Missing authorization header
2025-09-10T08:31:21.3983301Z               at getBearerToken (/home/runner/work/services/services/packages/common/src/auth/bearer-tokens.ts:58:11)
2025-09-10T08:31:21.3984122Z               at authenticateToken (/home/runner/work/services/services/packages/common/src/auth/bearer-tokens.ts:81:17)
2025-09-10T08:31:21.3985132Z               at newFn (/home/runner/work/services/services/node_modules/.pnpm/express-async-errors@3.1.1_express@4.21.2/node_modules/express-async-errors/index.js:16:20)
2025-09-10T08:31:21.3986279Z               at Layer.handle [as handle_request] (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/layer.js:95:5)
2025-09-10T08:31:21.3987312Z               at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:149:13)
2025-09-10T08:31:21.3988341Z               at queryTrackerMiddleware (/home/runner/work/services/services/services/media/src/db.ts:114:3)
2025-09-10T08:31:21.3989334Z               at newFn (/home/runner/work/services/services/node_modules/.pnpm/express-async-errors@3.1.1_express@4.21.2/node_modules/express-async-errors/index.js:16:20)
2025-09-10T08:31:21.3990482Z               at Layer.handle [as handle_request] (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/layer.js:95:5)
2025-09-10T08:31:21.3991637Z               at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:149:13)
2025-09-10T08:31:21.3992564Z               at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:145:7)
2025-09-10T08:31:21.3993102Z     }
2025-09-10T08:31:21.3994002Z [90mstdout[2m | tests/integration/api/media.test.ts[2m > [22m[2mMedia API Tests[2m > [22m[2mPOST /xrpc/social.spkeasy.media.delete[2m > [22m[2mshould require key parameter
2025-09-10T08:31:21.3994855Z [22m[39mValidationError: Validation failed: key: Required
2025-09-10T08:31:21.3995550Z     at validateAgainstLexicon (/home/runner/work/services/services/packages/common/src/lexicon/lexicon-validation.ts:134:13)
2025-09-10T08:31:21.3996579Z     at Object.social.spkeasy.media.delete [as handler] (/home/runner/work/services/services/services/media/src/routes/media.routes.ts:107:5)
2025-09-10T08:31:21.3997370Z     at /home/runner/work/services/services/packages/service-base/src/server.ts:137:46
2025-09-10T08:31:21.3998418Z     at newFn (/home/runner/work/services/services/node_modules/.pnpm/express-async-errors@3.1.1_express@4.21.2/node_modules/express-async-errors/index.js:16:20)
2025-09-10T08:31:21.3999551Z     at Layer.handle [as handle_request] (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/layer.js:95:5)
2025-09-10T08:31:21.4000562Z     at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:149:13)
2025-09-10T08:31:21.4001590Z     at /home/runner/work/services/services/node_modules/.pnpm/body-parser@1.20.3/node_modules/body-parser/lib/read.js:137:5
2025-09-10T08:31:21.4002236Z     at AsyncResource.runInAsyncScope (node:async_hooks:211:14)
2025-09-10T08:31:21.4002943Z     at invokeCallback (/home/runner/work/services/services/node_modules/.pnpm/raw-body@2.5.2/node_modules/raw-body/index.js:238:16)
2025-09-10T08:31:21.4003839Z     at done (/home/runner/work/services/services/node_modules/.pnpm/raw-body@2.5.2/node_modules/raw-body/index.js:227:7)
2025-09-10T08:31:21.4004291Z 
2025-09-10T08:31:21.4006114Z [2025-09-10 08:31:20.134 +0000] ERROR: ValidationError occurred {"service":"media","requestId":"unknown","method":"POST","path":"/xrpc/social.spkeasy.media.delete","duration":2,"status":400,"ip":"313d5b13e067911efcc8e257ab3925051bb57a136f2d54f697e1e92ef9997f35","user":"3698761d94b6992d6277d4dc2932712760c796ead51e44dd484d665e3bcd7c08","relevantLine":"/services/services/packages/common/src/lexicon/lexicon-validation.ts:134:13"}
2025-09-10T08:31:21.4007664Z     error: {
2025-09-10T08:31:21.4007871Z       "name": "ValidationError",
2025-09-10T08:31:21.4008376Z       "message": "Validation failed: key: Required",
2025-09-10T08:31:21.4008659Z       "statusCode": 400,
2025-09-10T08:31:21.4008853Z       "stack":
2025-09-10T08:31:21.4009098Z           ValidationError: Validation failed: key: Required
2025-09-10T08:31:21.4009790Z               at validateAgainstLexicon (/home/runner/work/services/services/packages/common/src/lexicon/lexicon-validation.ts:134:13)
2025-09-10T08:31:21.4010788Z               at Object.social.spkeasy.media.delete [as handler] (/home/runner/work/services/services/services/media/src/routes/media.routes.ts:107:5)
2025-09-10T08:31:21.4011590Z               at /home/runner/work/services/services/packages/service-base/src/server.ts:137:46
2025-09-10T08:31:21.4012505Z               at newFn (/home/runner/work/services/services/node_modules/.pnpm/express-async-errors@3.1.1_express@4.21.2/node_modules/express-async-errors/index.js:16:20)
2025-09-10T08:31:21.4013652Z               at Layer.handle [as handle_request] (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/layer.js:95:5)
2025-09-10T08:31:21.4014676Z               at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:149:13)
2025-09-10T08:31:21.4015701Z               at /home/runner/work/services/services/node_modules/.pnpm/body-parser@1.20.3/node_modules/body-parser/lib/read.js:137:5
2025-09-10T08:31:21.4016359Z               at AsyncResource.runInAsyncScope (node:async_hooks:211:14)
2025-09-10T08:31:21.4017070Z               at invokeCallback (/home/runner/work/services/services/node_modules/.pnpm/raw-body@2.5.2/node_modules/raw-body/index.js:238:16)
2025-09-10T08:31:21.4018076Z               at done (/home/runner/work/services/services/node_modules/.pnpm/raw-body@2.5.2/node_modules/raw-body/index.js:227:7)
2025-09-10T08:31:21.4018597Z     }
2025-09-10T08:31:21.4019576Z [90mstdout[2m | tests/integration/api/media.test.ts[2m > [22m[2mMedia API Tests[2m > [22m[2mPOST /xrpc/social.spkeasy.media.delete[2m > [22m[2mshould validate authorization for media deletion
2025-09-10T08:31:21.4020480Z [22m[39mAuthorizationError: Not authorized to delete on media
2025-09-10T08:31:21.4021056Z     at authorize (/home/runner/work/services/services/packages/common/src/auth/ability.ts:132:11)
2025-09-10T08:31:21.4021922Z     at Object.social.spkeasy.media.delete [as handler] (/home/runner/work/services/services/services/media/src/routes/media.routes.ts:109:5)
2025-09-10T08:31:21.4022706Z     at /home/runner/work/services/services/packages/service-base/src/server.ts:137:46
2025-09-10T08:31:21.4023614Z     at newFn (/home/runner/work/services/services/node_modules/.pnpm/express-async-errors@3.1.1_express@4.21.2/node_modules/express-async-errors/index.js:16:20)
2025-09-10T08:31:21.4024751Z     at Layer.handle [as handle_request] (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/layer.js:95:5)
2025-09-10T08:31:21.4025921Z     at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:149:13)
2025-09-10T08:31:21.4026819Z     at /home/runner/work/services/services/node_modules/.pnpm/body-parser@1.20.3/node_modules/body-parser/lib/read.js:137:5
2025-09-10T08:31:21.4027468Z     at AsyncResource.runInAsyncScope (node:async_hooks:211:14)
2025-09-10T08:31:21.4028421Z     at invokeCallback (/home/runner/work/services/services/node_modules/.pnpm/raw-body@2.5.2/node_modules/raw-body/index.js:238:16)
2025-09-10T08:31:21.4029331Z     at done (/home/runner/work/services/services/node_modules/.pnpm/raw-body@2.5.2/node_modules/raw-body/index.js:227:7)
2025-09-10T08:31:21.4029781Z 
2025-09-10T08:31:21.4031551Z [2025-09-10 08:31:20.138 +0000] ERROR: AuthorizationError occurred {"service":"media","requestId":"unknown","method":"POST","path":"/xrpc/social.spkeasy.media.delete","duration":1,"status":403,"ip":"313d5b13e067911efcc8e257ab3925051bb57a136f2d54f697e1e92ef9997f35","user":"3698761d94b6992d6277d4dc2932712760c796ead51e44dd484d665e3bcd7c08","relevantLine":"/services/services/packages/common/src/auth/ability.ts:132:11"}
2025-09-10T08:31:21.4033057Z     error: {
2025-09-10T08:31:21.4033271Z       "name": "AuthorizationError",
2025-09-10T08:31:21.4033575Z       "message": "Not authorized to delete on media",
2025-09-10T08:31:21.4033851Z       "statusCode": 403,
2025-09-10T08:31:21.4034042Z       "stack":
2025-09-10T08:31:21.4034309Z           AuthorizationError: Not authorized to delete on media
2025-09-10T08:31:21.4034879Z               at authorize (/home/runner/work/services/services/packages/common/src/auth/ability.ts:132:11)
2025-09-10T08:31:21.4035781Z               at Object.social.spkeasy.media.delete [as handler] (/home/runner/work/services/services/services/media/src/routes/media.routes.ts:109:5)
2025-09-10T08:31:21.4036604Z               at /home/runner/work/services/services/packages/service-base/src/server.ts:137:46
2025-09-10T08:31:21.4037526Z               at newFn (/home/runner/work/services/services/node_modules/.pnpm/express-async-errors@3.1.1_express@4.21.2/node_modules/express-async-errors/index.js:16:20)
2025-09-10T08:31:21.4038907Z               at Layer.handle [as handle_request] (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/layer.js:95:5)
2025-09-10T08:31:21.4039938Z               at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:149:13)
2025-09-10T08:31:21.4040862Z               at /home/runner/work/services/services/node_modules/.pnpm/body-parser@1.20.3/node_modules/body-parser/lib/read.js:137:5
2025-09-10T08:31:21.4041520Z               at AsyncResource.runInAsyncScope (node:async_hooks:211:14)
2025-09-10T08:31:21.4042240Z               at invokeCallback (/home/runner/work/services/services/node_modules/.pnpm/raw-body@2.5.2/node_modules/raw-body/index.js:238:16)
2025-09-10T08:31:21.4043139Z               at done (/home/runner/work/services/services/node_modules/.pnpm/raw-body@2.5.2/node_modules/raw-body/index.js:227:7)
2025-09-10T08:31:21.4043650Z       "meta": {
2025-09-10T08:31:21.4043828Z         "action": "delete",
2025-09-10T08:31:21.4044025Z         "subject": "media",
2025-09-10T08:31:21.4044217Z         "user": {
2025-09-10T08:31:21.4044392Z           "type": "user",
2025-09-10T08:31:21.4044632Z           "did": "did:example:alex-author",
2025-09-10T08:31:21.4044903Z           "handle": "alex.test",
2025-09-10T08:31:21.4047022Z           "token": "***",
2025-09-10T08:31:21.4047387Z           "authDuration": 0
2025-09-10T08:31:21.4047728Z         }
2025-09-10T08:31:21.4048150Z       }
2025-09-10T08:31:21.4048413Z     }
2025-09-10T08:31:21.4049014Z [2025-09-10 08:31:20.145 +0000] INFO: Shutting down server... {"service":"media"}
2025-09-10T08:31:21.4050892Z  [32mâœ“[39m tests/integration/api/media.test.ts[2m > [22mMedia API Tests[2m > [22mPOST /xrpc/social.spkeasy.media.upload[2m > [22mshould enforce daily upload quota[32m 138[2mms[22m[39m
2025-09-10T08:31:21.4053630Z  [32mâœ“[39m tests/integration/api/media.test.ts[2m > [22mMedia API Tests[2m > [22mPOST /xrpc/social.spkeasy.media.upload[2m > [22mshould require authentication[32m 5[2mms[22m[39m
2025-09-10T08:31:21.4056314Z  [32mâœ“[39m tests/integration/api/media.test.ts[2m > [22mMedia API Tests[2m > [22mPOST /xrpc/social.spkeasy.media.delete[2m > [22mshould delete an existing media file successfully[32m 17[2mms[22m[39m
2025-09-10T08:31:21.4059294Z  [32mâœ“[39m tests/integration/api/media.test.ts[2m > [22mMedia API Tests[2m > [22mPOST /xrpc/social.spkeasy.media.delete[2m > [22mshould fail to delete non-existent media file[32m 7[2mms[22m[39m
2025-09-10T08:31:21.4061855Z  [32mâœ“[39m tests/integration/api/media.test.ts[2m > [22mMedia API Tests[2m > [22mPOST /xrpc/social.spkeasy.media.delete[2m > [22mshould require authentication[32m 3[2mms[22m[39m
2025-09-10T08:31:21.4064323Z  [32mâœ“[39m tests/integration/api/media.test.ts[2m > [22mMedia API Tests[2m > [22mPOST /xrpc/social.spkeasy.media.delete[2m > [22mshould require key parameter[32m 4[2mms[22m[39m
2025-09-10T08:31:21.4067002Z  [32mâœ“[39m tests/integration/api/media.test.ts[2m > [22mMedia API Tests[2m > [22mPOST /xrpc/social.spkeasy.media.delete[2m > [22mshould validate authorization for media deletion[32m 4[2mms[22m[39m
2025-09-10T08:31:21.4069611Z  [32mâœ“[39m tests/integration/api/media.test.ts[2m > [22mMedia API Tests[2m > [22mHealth Check[2m > [22mshould return healthy status[32m 4[2mms[22m[39m
2025-09-10T08:31:21.4071023Z [2025-09-10 08:31:20.150 +0000] INFO: Shutting down server... {"service":"media"}
2025-09-10T08:31:21.4071505Z 
2025-09-10T08:31:21.4072043Z [2m Test Files [22m [1m[32m1 passed[39m[22m[90m (1)[39m
2025-09-10T08:31:21.4072950Z [2m      Tests [22m [1m[32m14 passed[39m[22m[90m (14)[39m
2025-09-10T08:31:21.4073691Z [2m   Start at [22m 08:31:15
2025-09-10T08:31:21.4074614Z [2m   Duration [22m 5.71s[2m (transform 1.09s, setup 176ms, collect 2.54s, tests 750ms, environment 19ms, prepare 659ms)[22m
2025-09-10T08:31:21.4075027Z 
2025-09-10T08:31:21.4075319Z ##[endgroup]
2025-09-10T08:31:23.1398737Z [;31m@speakeasy-services/private-sessions:test[;0m
2025-09-10T08:31:23.1399401Z cache miss, executing 9781659c3424806e
2025-09-10T08:31:23.1399974Z 
2025-09-10T08:31:23.1400882Z > @speakeasy-services/private-sessions@0.1.0 test /home/runner/work/services/services/services/private-sessions
2025-09-10T08:31:23.1401729Z > vitest run
2025-09-10T08:31:23.1401901Z 
2025-09-10T08:31:23.1401910Z 
2025-09-10T08:31:23.1402790Z [1m[46m RUN [49m[22m [36mv3.2.4 [39m[90m/home/runner/work/services/services/services/private-sessions[39m
2025-09-10T08:31:23.1403422Z 
2025-09-10T08:31:23.1404324Z [2025-09-10 08:31:19.275 +0000] INFO: ðŸš€ private-sessions service running on port 0 {"service":"private-sessions"}
2025-09-10T08:31:23.1406771Z [90mstdout[2m | tests/integration/api/private-posts.test.ts[2m > [22m[2mPrivate Posts API Tests[2m > [22m[2mPOST /xrpc/social.spkeasy.privatePost.createPosts[2m > [22m[2mshould create encrypted posts successfully
2025-09-10T08:31:23.1409567Z [22m[39mPrismaClientKnownRequestError: 
2025-09-10T08:31:23.1410281Z Invalid `tx.encryptedPost.createMany()` invocation in
2025-09-10T08:31:23.1416510Z /home/runner/work/services/services/services/private-sessions/src/services/privatePosts.service.ts:96:30
2025-09-10T08:31:23.1417309Z 
2025-09-10T08:31:23.1417635Z   93   create: { handle: authorHandle, userDid: authorDid },
2025-09-10T08:31:23.1418283Z   94 });
2025-09-10T08:31:23.1418535Z   95 
2025-09-10T08:31:23.1419051Z â†’ 96 await tx.encryptedPost.createMany(
2025-09-10T08:31:23.1419885Z Foreign key constraint violated on the constraint: `encrypted_posts_sessionId_fkey`
2025-09-10T08:31:23.1421045Z     at ei.handleRequestError (/home/runner/work/services/services/services/private-sessions/src/generated/prisma-client/runtime/library.js:124:7283)
2025-09-10T08:31:23.1422416Z     at ei.handleAndLogRequestError (/home/runner/work/services/services/services/private-sessions/src/generated/prisma-client/runtime/library.js:124:6608)
2025-09-10T08:31:23.1423537Z     at ei.request (/home/runner/work/services/services/services/private-sessions/src/generated/prisma-client/runtime/library.js:124:6315)
2025-09-10T08:31:23.1424497Z     at a (/home/runner/work/services/services/services/private-sessions/src/generated/prisma-client/runtime/library.js:133:9551)
2025-09-10T08:31:23.1425360Z     at /home/runner/work/services/services/services/private-sessions/src/services/privatePosts.service.ts:96:7
2025-09-10T08:31:23.1426347Z     at Proxy._transactionWithCallback (/home/runner/work/services/services/services/private-sessions/src/generated/prisma-client/runtime/library.js:133:8120)
2025-09-10T08:31:23.1427504Z     at PrivatePostsService.createEncryptedPosts (/home/runner/work/services/services/services/private-sessions/src/services/privatePosts.service.ts:88:5)
2025-09-10T08:31:23.1428925Z     at Object.social.spkeasy.privatePost.createPosts [as handler] (/home/runner/work/services/services/services/private-sessions/src/routes/privatePosts.routes.ts:140:5)
2025-09-10T08:31:23.1429802Z     at /home/runner/work/services/services/packages/service-base/src/server.ts:137:26
2025-09-10T08:31:23.1430116Z 
2025-09-10T08:31:23.1430638Z [2025-09-10 08:31:19.364 +0000] INFO: ðŸš€ private-sessions service running on port 0 {"service":"private-sessions"}
2025-09-10T08:31:23.1431459Z [2025-09-10 08:31:19.363 +0000] INFO: ðŸš€ private-sessions service running on port 0 {"service":"private-sessions"}
2025-09-10T08:31:23.1433816Z [2025-09-10 08:31:19.562 +0000] ERROR: PrismaClientKnownRequestError occurred {"service":"private-sessions","requestId":"unknown","method":"POST","path":"/xrpc/social.spkeasy.privatePost.createPosts","duration":174,"status":400,"ip":"313d5b13e067911efcc8e257ab3925051bb57a136f2d54f697e1e92ef9997f35","user":"3698761d94b6992d6277d4dc2932712760c796ead51e44dd484d665e3bcd7c08","relevantLine":"/services/services/services/private-sessions/src/generated/prisma-client/runtime/library.js:124:7283"}
2025-09-10T08:31:23.1435572Z     error: {
2025-09-10T08:31:23.1435815Z       "name": "PrismaClientKnownRequestError",
2025-09-10T08:31:23.1437740Z       "message": "\nInvalid `tx.encryptedPost.createMany()` invocation in\n/home/runner/work/services/services/services/private-sessions/src/services/privatePosts.service.ts:96:30\n\n  93   create: { handle: authorHandle, userDid: authorDid },\n  94 });\n  95 \nâ†’ 96 await tx.encryptedPost.createMany(\nForeign key constraint violated on the constraint: `encrypted_posts_sessionId_fkey`",
2025-09-10T08:31:23.1439515Z       "stack":
2025-09-10T08:31:23.1439874Z           PrismaClientKnownRequestError: 
2025-09-10T08:31:23.1440349Z           Invalid `tx.encryptedPost.createMany()` invocation in
2025-09-10T08:31:23.1440950Z           /home/runner/work/services/services/services/private-sessions/src/services/privatePosts.service.ts:96:30
2025-09-10T08:31:23.1441432Z           
2025-09-10T08:31:23.1441693Z             93   create: { handle: authorHandle, userDid: authorDid },
2025-09-10T08:31:23.1441979Z             94 });
2025-09-10T08:31:23.1442154Z             95 
2025-09-10T08:31:23.1442451Z           â†’ 96 await tx.encryptedPost.createMany(
2025-09-10T08:31:23.1442909Z           Foreign key constraint violated on the constraint: `encrypted_posts_sessionId_fkey`
2025-09-10T08:31:23.1443760Z               at ei.handleRequestError (/home/runner/work/services/services/services/private-sessions/src/generated/prisma-client/runtime/library.js:124:7283)
2025-09-10T08:31:23.1444876Z               at ei.handleAndLogRequestError (/home/runner/work/services/services/services/private-sessions/src/generated/prisma-client/runtime/library.js:124:6608)
2025-09-10T08:31:23.1445930Z               at ei.request (/home/runner/work/services/services/services/private-sessions/src/generated/prisma-client/runtime/library.js:124:6315)
2025-09-10T08:31:23.1447031Z               at a (/home/runner/work/services/services/services/private-sessions/src/generated/prisma-client/runtime/library.js:133:9551)
2025-09-10T08:31:23.1447890Z               at /home/runner/work/services/services/services/private-sessions/src/services/privatePosts.service.ts:96:7
2025-09-10T08:31:23.1449106Z               at Proxy._transactionWithCallback (/home/runner/work/services/services/services/private-sessions/src/generated/prisma-client/runtime/library.js:133:8120)
2025-09-10T08:31:23.1450252Z               at PrivatePostsService.createEncryptedPosts (/home/runner/work/services/services/services/private-sessions/src/services/privatePosts.service.ts:88:5)
2025-09-10T08:31:23.1451437Z               at Object.social.spkeasy.privatePost.createPosts [as handler] (/home/runner/work/services/services/services/private-sessions/src/routes/privatePosts.routes.ts:140:5)
2025-09-10T08:31:23.1452322Z               at /home/runner/work/services/services/packages/service-base/src/server.ts:137:26
2025-09-10T08:31:23.1452705Z       "meta": {
2025-09-10T08:31:23.1452923Z         "modelName": "EncryptedPost",
2025-09-10T08:31:23.1453261Z         "constraint": "encrypted_posts_sessionId_fkey"
2025-09-10T08:31:23.1453519Z       },
2025-09-10T08:31:23.1453682Z       "code": "P2003"
2025-09-10T08:31:23.1453860Z     }
2025-09-10T08:31:23.1455666Z [2025-09-10 08:31:19.649 +0000] INFO: {"service":"private-sessions","requestId":"unknown","method":"social.spkeasy.notification.getUnreadCount","path":"/xrpc/social.spkeasy.notification.getUnreadCount","duration":140,"status":200,"ip":"313d5b13e067911efcc8e257ab3925051bb57a136f2d54f697e1e92ef9997f35","user":"a2e2b3deeb1a32b63ae64d5fb18f43d6f3eee5e55e126a26d54bbc6e1a95528d","dbDuration":4,"dbProfile":"4","authDuration":23}
2025-09-10T08:31:23.1459108Z [2025-09-10 08:31:19.640 +0000] INFO: {"service":"private-sessions","requestId":"unknown","method":"social.spkeasy.privatePost.createPosts","path":"/xrpc/social.spkeasy.privatePost.createPosts","duration":27,"status":200,"ip":"313d5b13e067911efcc8e257ab3925051bb57a136f2d54f697e1e92ef9997f35","user":"3698761d94b6992d6277d4dc2932712760c796ead51e44dd484d665e3bcd7c08","dbDuration":2,"dbProfile":"0,0,2,0,0,0","authDuration":12}
2025-09-10T08:31:23.1461618Z [90mstdout[2m | tests/integration/api/private-posts.test.ts[2m > [22m[2mPrivate Posts API Tests[2m > [22m[2mPOST /xrpc/social.spkeasy.privatePost.createPosts[2m > [22m[2mshould require authentication
2025-09-10T08:31:23.1462539Z [22m[39mAuthenticationError: Missing authorization header
2025-09-10T08:31:23.1463135Z     at getBearerToken (/home/runner/work/services/services/packages/common/src/auth/bearer-tokens.ts:58:11)
2025-09-10T08:31:23.1463902Z     at authenticateToken (/home/runner/work/services/services/packages/common/src/auth/bearer-tokens.ts:81:17)
2025-09-10T08:31:23.1464844Z     at newFn (/home/runner/work/services/services/node_modules/.pnpm/express-async-errors@3.1.1_express@4.21.2/node_modules/express-async-errors/index.js:16:20)
2025-09-10T08:31:23.1465912Z     at Layer.handle [as handle_request] (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/layer.js:95:5)
2025-09-10T08:31:23.1466850Z     at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:149:13)
2025-09-10T08:31:23.1467674Z     at prefetchUserFollowing (/home/runner/work/services/services/services/private-sessions/src/server.ts:77:3)
2025-09-10T08:31:23.1468829Z     at newFn (/home/runner/work/services/services/node_modules/.pnpm/express-async-errors@3.1.1_express@4.21.2/node_modules/express-async-errors/index.js:16:20)
2025-09-10T08:31:23.1469879Z     at Layer.handle [as handle_request] (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/layer.js:95:5)
2025-09-10T08:31:23.1470820Z     at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:149:13)
2025-09-10T08:31:23.1471751Z     at queryTrackerMiddleware (/home/runner/work/services/services/services/private-sessions/src/db.ts:132:3)
2025-09-10T08:31:23.1472145Z 
2025-09-10T08:31:23.1473824Z [2025-09-10 08:31:19.651 +0000] INFO: {"service":"private-sessions","requestId":"unknown","method":"social.spkeasy.reaction.createReaction","path":"/xrpc/social.spkeasy.reaction.createReaction","duration":145,"status":200,"ip":"313d5b13e067911efcc8e257ab3925051bb57a136f2d54f697e1e92ef9997f35","user":"a2e2b3deeb1a32b63ae64d5fb18f43d6f3eee5e55e126a26d54bbc6e1a95528d","dbDuration":6,"dbProfile":"6","authDuration":26}
2025-09-10T08:31:23.1476627Z [2025-09-10 08:31:19.665 +0000] ERROR: AuthenticationError occurred {"service":"private-sessions","requestId":"unknown","method":"POST","path":"/xrpc/social.spkeasy.privatePost.createPosts","duration":null,"status":401,"ip":"313d5b13e067911efcc8e257ab3925051bb57a136f2d54f697e1e92ef9997f35","relevantLine":"/services/services/packages/common/src/auth/bearer-tokens.ts:58:11"}
2025-09-10T08:31:23.1477880Z     error: {
2025-09-10T08:31:23.1478260Z       "name": "AuthenticationError",
2025-09-10T08:31:23.1478554Z       "message": "Missing authorization header",
2025-09-10T08:31:23.1478810Z       "statusCode": 401,
2025-09-10T08:31:23.1478999Z       "stack":
2025-09-10T08:31:23.1479250Z           AuthenticationError: Missing authorization header
2025-09-10T08:31:23.1479840Z               at getBearerToken (/home/runner/work/services/services/packages/common/src/auth/bearer-tokens.ts:58:11)
2025-09-10T08:31:23.1480615Z               at authenticateToken (/home/runner/work/services/services/packages/common/src/auth/bearer-tokens.ts:81:17)
2025-09-10T08:31:23.1481569Z               at newFn (/home/runner/work/services/services/node_modules/.pnpm/express-async-errors@3.1.1_express@4.21.2/node_modules/express-async-errors/index.js:16:20)
2025-09-10T08:31:23.1482639Z               at Layer.handle [as handle_request] (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/layer.js:95:5)
2025-09-10T08:31:23.1483600Z               at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:149:13)
2025-09-10T08:31:23.1484429Z               at prefetchUserFollowing (/home/runner/work/services/services/services/private-sessions/src/server.ts:77:3)
2025-09-10T08:31:23.1485506Z               at newFn (/home/runner/work/services/services/node_modules/.pnpm/express-async-errors@3.1.1_express@4.21.2/node_modules/express-async-errors/index.js:16:20)
2025-09-10T08:31:23.1486572Z               at Layer.handle [as handle_request] (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/layer.js:95:5)
2025-09-10T08:31:23.1487522Z               at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:149:13)
2025-09-10T08:31:23.1488510Z               at queryTrackerMiddleware (/home/runner/work/services/services/services/private-sessions/src/db.ts:132:3)
2025-09-10T08:31:23.1489097Z     }
2025-09-10T08:31:23.1490546Z  [31mÃ—[39m tests/integration/api/private-posts.test.ts[2m > [22mPrivate Posts API Tests[2m > [22mPOST /xrpc/social.spkeasy.privatePost.createPosts[2m > [22mshould create encrypted posts successfully[33m 314[2mms[22m[39m
2025-09-10T08:31:23.1491522Z [31m   â†’ expected 200 "OK", got 400 "Bad Request"[39m
2025-09-10T08:31:23.1492636Z  [32mâœ“[39m tests/integration/api/private-posts.test.ts[2m > [22mPrivate Posts API Tests[2m > [22mPOST /xrpc/social.spkeasy.privatePost.createPosts[2m > [22mshould create posts with reply relationships[32m 72[2mms[22m[39m
2025-09-10T08:31:23.1494188Z  [32mâœ“[39m tests/integration/api/private-posts.test.ts[2m > [22mPrivate Posts API Tests[2m > [22mPOST /xrpc/social.spkeasy.privatePost.createPosts[2m > [22mshould require authentication[32m 25[2mms[22m[39m
2025-09-10T08:31:23.1495929Z [90mstdout[2m | tests/integration/api/private-posts.test.ts[2m > [22m[2mPrivate Posts API Tests[2m > [22m[2mPOST /xrpc/social.spkeasy.privatePost.createPosts[2m > [22m[2mshould validate post data format
2025-09-10T08:31:23.1497032Z [22m[39mValidationError: Validation failed: encryptedPosts: Expected array, received string
2025-09-10T08:31:23.1497816Z     at validateAgainstLexicon (/home/runner/work/services/services/packages/common/src/lexicon/lexicon-validation.ts:134:13)
2025-09-10T08:31:23.1499136Z     at Object.social.spkeasy.privatePost.createPosts [as handler] (/home/runner/work/services/services/services/private-sessions/src/routes/privatePosts.routes.ts:131:5)
2025-09-10T08:31:23.1500015Z     at /home/runner/work/services/services/packages/service-base/src/server.ts:137:46
2025-09-10T08:31:23.1500864Z     at newFn (/home/runner/work/services/services/node_modules/.pnpm/express-async-errors@3.1.1_express@4.21.2/node_modules/express-async-errors/index.js:16:20)
2025-09-10T08:31:23.1501927Z     at Layer.handle [as handle_request] (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/layer.js:95:5)
2025-09-10T08:31:23.1502871Z     at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:149:13)
2025-09-10T08:31:23.1503724Z     at /home/runner/work/services/services/node_modules/.pnpm/body-parser@1.20.3/node_modules/body-parser/lib/read.js:137:5
2025-09-10T08:31:23.1504337Z     at AsyncResource.runInAsyncScope (node:async_hooks:211:14)
2025-09-10T08:31:23.1504994Z     at invokeCallback (/home/runner/work/services/services/node_modules/.pnpm/raw-body@2.5.2/node_modules/raw-body/index.js:238:16)
2025-09-10T08:31:23.1505832Z     at done (/home/runner/work/services/services/node_modules/.pnpm/raw-body@2.5.2/node_modules/raw-body/index.js:227:7)
2025-09-10T08:31:23.1506245Z 
2025-09-10T08:31:23.1508127Z [2025-09-10 08:31:19.712 +0000] INFO: {"service":"private-sessions","requestId":"unknown","method":"social.spkeasy.notification.getUnreadCount","path":"/xrpc/social.spkeasy.notification.getUnreadCount","duration":6,"status":200,"ip":"313d5b13e067911efcc8e257ab3925051bb57a136f2d54f697e1e92ef9997f35","user":"a2e2b3deeb1a32b63ae64d5fb18f43d6f3eee5e55e126a26d54bbc6e1a95528d","dbDuration":3,"dbProfile":"3","authDuration":11}
2025-09-10T08:31:23.1510579Z [90mstdout[2m | tests/integration/api/notifications.test.ts[2m > [22m[2mNotifications API Tests[2m > [22m[2mGET /xrpc/social.spkeasy.notification.getUnreadCount[2m > [22m[2mshould require authentication
2025-09-10T08:31:23.1511506Z [22m[39mAuthenticationError: Missing authorization header
2025-09-10T08:31:23.1512090Z     at getBearerToken (/home/runner/work/services/services/packages/common/src/auth/bearer-tokens.ts:58:11)
2025-09-10T08:31:23.1512856Z     at authenticateToken (/home/runner/work/services/services/packages/common/src/auth/bearer-tokens.ts:81:17)
2025-09-10T08:31:23.1513790Z     at newFn (/home/runner/work/services/services/node_modules/.pnpm/express-async-errors@3.1.1_express@4.21.2/node_modules/express-async-errors/index.js:16:20)
2025-09-10T08:31:23.1514853Z     at Layer.handle [as handle_request] (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/layer.js:95:5)
2025-09-10T08:31:23.1515799Z     at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:149:13)
2025-09-10T08:31:23.1516622Z     at prefetchUserFollowing (/home/runner/work/services/services/services/private-sessions/src/server.ts:77:3)
2025-09-10T08:31:23.1517558Z     at newFn (/home/runner/work/services/services/node_modules/.pnpm/express-async-errors@3.1.1_express@4.21.2/node_modules/express-async-errors/index.js:16:20)
2025-09-10T08:31:23.1518801Z     at Layer.handle [as handle_request] (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/layer.js:95:5)
2025-09-10T08:31:23.1519967Z     at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:149:13)
2025-09-10T08:31:23.1520917Z     at queryTrackerMiddleware (/home/runner/work/services/services/services/private-sessions/src/db.ts:132:3)
2025-09-10T08:31:23.1521594Z 
2025-09-10T08:31:23.1524242Z [2025-09-10 08:31:19.729 +0000] ERROR: AuthenticationError occurred {"service":"private-sessions","requestId":"unknown","method":"GET","path":"/xrpc/social.spkeasy.notification.getUnreadCount","duration":null,"status":401,"ip":"313d5b13e067911efcc8e257ab3925051bb57a136f2d54f697e1e92ef9997f35","relevantLine":"/services/services/packages/common/src/auth/bearer-tokens.ts:58:11"}
2025-09-10T08:31:23.1525881Z     error: {
2025-09-10T08:31:23.1526248Z       "name": "AuthenticationError",
2025-09-10T08:31:23.1526746Z       "message": "Missing authorization header",
2025-09-10T08:31:23.1527197Z       "statusCode": 401,
2025-09-10T08:31:23.1527533Z       "stack":
2025-09-10T08:31:23.1527838Z           AuthenticationError: Missing authorization header
2025-09-10T08:31:23.1528688Z               at getBearerToken (/home/runner/work/services/services/packages/common/src/auth/bearer-tokens.ts:58:11)
2025-09-10T08:31:23.1529469Z               at authenticateToken (/home/runner/work/services/services/packages/common/src/auth/bearer-tokens.ts:81:17)
2025-09-10T08:31:23.1530415Z               at newFn (/home/runner/work/services/services/node_modules/.pnpm/express-async-errors@3.1.1_express@4.21.2/node_modules/express-async-errors/index.js:16:20)
2025-09-10T08:31:23.1531479Z               at Layer.handle [as handle_request] (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/layer.js:95:5)
2025-09-10T08:31:23.1532437Z               at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:149:13)
2025-09-10T08:31:23.1533269Z               at prefetchUserFollowing (/home/runner/work/services/services/services/private-sessions/src/server.ts:77:3)
2025-09-10T08:31:23.1534208Z               at newFn (/home/runner/work/services/services/node_modules/.pnpm/express-async-errors@3.1.1_express@4.21.2/node_modules/express-async-errors/index.js:16:20)
2025-09-10T08:31:23.1535260Z               at Layer.handle [as handle_request] (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/layer.js:95:5)
2025-09-10T08:31:23.1536381Z               at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:149:13)
2025-09-10T08:31:23.1537221Z               at queryTrackerMiddleware (/home/runner/work/services/services/services/private-sessions/src/db.ts:132:3)
2025-09-10T08:31:23.1537677Z     }
2025-09-10T08:31:23.1541220Z [2025-09-10 08:31:19.699 +0000] ERROR: ValidationError occurred {"service":"private-sessions","requestId":"unknown","method":"POST","path":"/xrpc/social.spkeasy.privatePost.createPosts","duration":2,"status":400,"ip":"313d5b13e067911efcc8e257ab3925051bb57a136f2d54f697e1e92ef9997f35","user":"3698761d94b6992d6277d4dc2932712760c796ead51e44dd484d665e3bcd7c08","relevantLine":"/services/services/packages/common/src/lexicon/lexicon-validation.ts:134:13"}
2025-09-10T08:31:23.1544022Z     error: {
2025-09-10T08:31:23.1544391Z       "name": "ValidationError",
2025-09-10T08:31:23.1545122Z       "message": "Validation failed: encryptedPosts: Expected array, received string",
2025-09-10T08:31:23.1545815Z       "statusCode": 400,
2025-09-10T08:31:23.1546139Z       "stack":
2025-09-10T08:31:23.1546760Z           ValidationError: Validation failed: encryptedPosts: Expected array, received string
2025-09-10T08:31:23.1548234Z               at validateAgainstLexicon (/home/runner/work/services/services/packages/common/src/lexicon/lexicon-validation.ts:134:13)
2025-09-10T08:31:23.1550085Z               at Object.social.spkeasy.privatePost.createPosts [as handler] (/home/runner/work/services/services/services/private-sessions/src/routes/privatePosts.routes.ts:131:5)
2025-09-10T08:31:23.1551801Z               at /home/runner/work/services/services/packages/service-base/src/server.ts:137:46
2025-09-10T08:31:23.1553253Z               at newFn (/home/runner/work/services/services/node_modules/.pnpm/express-async-errors@3.1.1_express@4.21.2/node_modules/express-async-errors/index.js:16:20)
2025-09-10T08:31:23.1555204Z               at Layer.handle [as handle_request] (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/layer.js:95:5)
2025-09-10T08:31:23.1556935Z               at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:149:13)
2025-09-10T08:31:23.1558639Z               at /home/runner/work/services/services/node_modules/.pnpm/body-parser@1.20.3/node_modules/body-parser/lib/read.js:137:5
2025-09-10T08:31:23.1559760Z               at AsyncResource.runInAsyncScope (node:async_hooks:211:14)
2025-09-10T08:31:23.1560991Z               at invokeCallback (/home/runner/work/services/services/node_modules/.pnpm/raw-body@2.5.2/node_modules/raw-body/index.js:238:16)
2025-09-10T08:31:23.1562486Z               at done (/home/runner/work/services/services/node_modules/.pnpm/raw-body@2.5.2/node_modules/raw-body/index.js:227:7)
2025-09-10T08:31:23.1563258Z     }
2025-09-10T08:31:23.1565074Z [90mstdout[2m | tests/integration/api/reactions.test.ts[2m > [22m[2mReactions API Tests[2m > [22m[2mPOST /xrpc/social.spkeasy.reaction.createReaction[2m > [22m[2mshould prevent duplicate reactions from same user
2025-09-10T08:31:23.1566675Z [22m[39mPrismaClientKnownRequestError: 
2025-09-10T08:31:23.1567279Z Invalid `prisma.reaction.create()` invocation in
2025-09-10T08:31:23.1568544Z /home/runner/work/services/services/services/private-sessions/src/services/reaction.service.ts:18:44
2025-09-10T08:31:23.1569251Z 
2025-09-10T08:31:23.1569429Z   15  * @returns The created reaction
2025-09-10T08:31:23.1569792Z   16  */
2025-09-10T08:31:23.1570342Z   17 async createReaction(userDid: string, uri: string): Promise<Reaction> {
2025-09-10T08:31:23.1571231Z â†’ 18   const reaction = await prisma.reaction.create(
2025-09-10T08:31:23.1571918Z Unique constraint failed on the fields: (`userDid`,`uri`)
2025-09-10T08:31:23.1573270Z     at ei.handleRequestError (/home/runner/work/services/services/services/private-sessions/src/generated/prisma-client/runtime/library.js:124:7283)
2025-09-10T08:31:23.1575186Z     at ei.handleAndLogRequestError (/home/runner/work/services/services/services/private-sessions/src/generated/prisma-client/runtime/library.js:124:6608)
2025-09-10T08:31:23.1576561Z     at ei.request (/home/runner/work/services/services/services/private-sessions/src/generated/prisma-client/runtime/library.js:124:6315)
2025-09-10T08:31:23.1578519Z     at a (/home/runner/work/services/services/services/private-sessions/src/generated/prisma-client/runtime/library.js:133:9551)
2025-09-10T08:31:23.1580368Z     at ReactionService.createReaction (/home/runner/work/services/services/services/private-sessions/src/services/reaction.service.ts:18:22)
2025-09-10T08:31:23.1582488Z     at Object.social.spkeasy.reaction.createReaction [as handler] (/home/runner/work/services/services/services/private-sessions/src/routes/reaction.routes.ts:32:22)
2025-09-10T08:31:23.1584154Z     at /home/runner/work/services/services/packages/service-base/src/server.ts:137:26
2025-09-10T08:31:23.1584736Z 
2025-09-10T08:31:23.1586587Z  [31mÃ—[39m tests/integration/api/notifications.test.ts[2m > [22mNotifications API Tests[2m > [22mGET /xrpc/social.spkeasy.notification.getUnreadCount[2m > [22mshould return unread notification count[33m 332[2mms[22m[39m
2025-09-10T08:31:23.1588802Z [31m   â†’ expected { count: +0 } to have property "count" with value 2[39m
2025-09-10T08:31:23.1590989Z  [32mâœ“[39m tests/integration/api/notifications.test.ts[2m > [22mNotifications API Tests[2m > [22mGET /xrpc/social.spkeasy.notification.getUnreadCount[2m > [22mshould return zero for user with no notifications[32m 38[2mms[22m[39m
2025-09-10T08:31:23.1594171Z  [32mâœ“[39m tests/integration/api/notifications.test.ts[2m > [22mNotifications API Tests[2m > [22mGET /xrpc/social.spkeasy.notification.getUnreadCount[2m > [22mshould require authentication[32m 18[2mms[22m[39m
2025-09-10T08:31:23.1597004Z  [32mâœ“[39m tests/integration/api/private-posts.test.ts[2m > [22mPrivate Posts API Tests[2m > [22mPOST /xrpc/social.spkeasy.privatePost.createPosts[2m > [22mshould validate post data format[32m 37[2mms[22m[39m
2025-09-10T08:31:23.1601529Z [2025-09-10 08:31:19.767 +0000] INFO: {"service":"private-sessions","requestId":"unknown","method":"social.spkeasy.privatePost.getPosts","path":"/xrpc/social.spkeasy.privatePost.getPosts","duration":19,"status":200,"ip":"313d5b13e067911efcc8e257ab3925051bb57a136f2d54f697e1e92ef9997f35","user":"3698761d94b6992d6277d4dc2932712760c796ead51e44dd484d665e3bcd7c08","dbDuration":13,"dbProfile":"9,0,4","authDuration":14}
2025-09-10T08:31:23.1605457Z  [31mÃ—[39m tests/integration/api/reactions.test.ts[2m > [22mReactions API Tests[2m > [22mPOST /xrpc/social.spkeasy.reaction.createReaction[2m > [22mshould create a reaction successfully[33m 342[2mms[22m[39m
2025-09-10T08:31:23.1607017Z [31m   â†’ expected null not to be null[39m
2025-09-10T08:31:23.1609082Z [90mstdout[2m | tests/integration/api/reactions.test.ts[2m > [22m[2mReactions API Tests[2m > [22m[2mPOST /xrpc/social.spkeasy.reaction.createReaction[2m > [22m[2mshould require authentication
2025-09-10T08:31:23.1610673Z [22m[39mAuthenticationError: Missing authorization header
2025-09-10T08:31:23.1611713Z     at getBearerToken (/home/runner/work/services/services/packages/common/src/auth/bearer-tokens.ts:58:11)
2025-09-10T08:31:23.1613081Z     at authenticateToken (/home/runner/work/services/services/packages/common/src/auth/bearer-tokens.ts:81:17)
2025-09-10T08:31:23.1614775Z     at newFn (/home/runner/work/services/services/node_modules/.pnpm/express-async-errors@3.1.1_express@4.21.2/node_modules/express-async-errors/index.js:16:20)
2025-09-10T08:31:23.1616707Z     at Layer.handle [as handle_request] (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/layer.js:95:5)
2025-09-10T08:31:23.1618591Z     at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:149:13)
2025-09-10T08:31:23.1620237Z     at prefetchUserFollowing (/home/runner/work/services/services/services/private-sessions/src/server.ts:77:3)
2025-09-10T08:31:23.1621969Z     at newFn (/home/runner/work/services/services/node_modules/.pnpm/express-async-errors@3.1.1_express@4.21.2/node_modules/express-async-errors/index.js:16:20)
2025-09-10T08:31:23.1623921Z     at Layer.handle [as handle_request] (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/layer.js:95:5)
2025-09-10T08:31:23.1625623Z     at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:149:13)
2025-09-10T08:31:23.1627075Z     at queryTrackerMiddleware (/home/runner/work/services/services/services/private-sessions/src/db.ts:132:3)
2025-09-10T08:31:23.1627796Z 
2025-09-10T08:31:23.1631271Z [2025-09-10 08:31:19.779 +0000] INFO: {"service":"private-sessions","requestId":"unknown","method":"social.spkeasy.notification.listNotifications","path":"/xrpc/social.spkeasy.notification.listNotifications","duration":12,"status":200,"ip":"313d5b13e067911efcc8e257ab3925051bb57a136f2d54f697e1e92ef9997f35","user":"a2e2b3deeb1a32b63ae64d5fb18f43d6f3eee5e55e126a26d54bbc6e1a95528d","dbDuration":5,"dbProfile":"5","authDuration":15}
2025-09-10T08:31:23.1636976Z [2025-09-10 08:31:19.742 +0000] INFO: {"service":"private-sessions","requestId":"unknown","method":"social.spkeasy.reaction.createReaction","path":"/xrpc/social.spkeasy.reaction.createReaction","duration":5,"status":200,"ip":"313d5b13e067911efcc8e257ab3925051bb57a136f2d54f697e1e92ef9997f35","user":"a2e2b3deeb1a32b63ae64d5fb18f43d6f3eee5e55e126a26d54bbc6e1a95528d","dbDuration":1,"dbProfile":"1","authDuration":17}
2025-09-10T08:31:23.1642554Z [2025-09-10 08:31:19.773 +0000] ERROR: PrismaClientKnownRequestError occurred {"service":"private-sessions","requestId":"unknown","method":"POST","path":"/xrpc/social.spkeasy.reaction.createReaction","duration":27,"status":400,"ip":"313d5b13e067911efcc8e257ab3925051bb57a136f2d54f697e1e92ef9997f35","user":"a2e2b3deeb1a32b63ae64d5fb18f43d6f3eee5e55e126a26d54bbc6e1a95528d"}
2025-09-10T08:31:23.1644837Z     error: {
2025-09-10T08:31:23.1645219Z       "name": "PrismaClientKnownRequestError",
2025-09-10T08:31:23.1648781Z       "message": "\nInvalid `prisma.reaction.create()` invocation in\n/home/runner/work/services/services/services/private-sessions/src/services/reaction.service.ts:18:44\n\n  15  * @returns The created reaction\n  16  */\n  17 async createReaction(userDid: string, uri: string): Promise<Reaction> {\nâ†’ 18   const reaction = await prisma.reaction.create(\nUnique constraint failed on the fields: (`userDid`,`uri`)",
2025-09-10T08:31:23.1651234Z       "stack":
2025-09-10T08:31:23.1651605Z           PrismaClientKnownRequestError: 
2025-09-10T08:31:23.1652157Z           Invalid `prisma.reaction.create()` invocation in
2025-09-10T08:31:23.1653157Z           /home/runner/work/services/services/services/private-sessions/src/services/reaction.service.ts:18:44
2025-09-10T08:31:23.1653963Z           
2025-09-10T08:31:23.1654305Z             15  * @returns The created reaction
2025-09-10T08:31:23.1654708Z             16  */
2025-09-10T08:31:23.1655283Z             17 async createReaction(userDid: string, uri: string): Promise<Reaction> {
2025-09-10T08:31:23.1656141Z           â†’ 18   const reaction = await prisma.reaction.create(
2025-09-10T08:31:23.1656798Z           Unique constraint failed on the fields: (`userDid`,`uri`)
2025-09-10T08:31:23.1658317Z               at ei.handleRequestError (/home/runner/work/services/services/services/private-sessions/src/generated/prisma-client/runtime/library.js:124:7283)
2025-09-10T08:31:23.1660365Z               at ei.handleAndLogRequestError (/home/runner/work/services/services/services/private-sessions/src/generated/prisma-client/runtime/library.js:124:6608)
2025-09-10T08:31:23.1662289Z               at ei.request (/home/runner/work/services/services/services/private-sessions/src/generated/prisma-client/runtime/library.js:124:6315)
2025-09-10T08:31:23.1664188Z               at a (/home/runner/work/services/services/services/private-sessions/src/generated/prisma-client/runtime/library.js:133:9551)
2025-09-10T08:31:23.1665961Z               at ReactionService.createReaction (/home/runner/work/services/services/services/private-sessions/src/services/reaction.service.ts:18:22)
2025-09-10T08:31:23.1668160Z               at Object.social.spkeasy.reaction.createReaction [as handler] (/home/runner/work/services/services/services/private-sessions/src/routes/reaction.routes.ts:32:22)
2025-09-10T08:31:23.1669739Z               at /home/runner/work/services/services/packages/service-base/src/server.ts:137:26
2025-09-10T08:31:23.1670442Z       "meta": {
2025-09-10T08:31:23.1670768Z         "modelName": "Reaction",
2025-09-10T08:31:23.1671226Z         "target": [
2025-09-10T08:31:23.1671503Z           "userDid",
2025-09-10T08:31:23.1671789Z           "uri"
2025-09-10T08:31:23.1672048Z         ]
2025-09-10T08:31:23.1672288Z       },
2025-09-10T08:31:23.1672549Z       "code": "P2002"
2025-09-10T08:31:23.1672829Z     }
2025-09-10T08:31:23.1675739Z [2025-09-10 08:31:19.792 +0000] ERROR: AuthenticationError occurred {"service":"private-sessions","requestId":"unknown","method":"POST","path":"/xrpc/social.spkeasy.reaction.createReaction","duration":null,"status":401,"ip":"313d5b13e067911efcc8e257ab3925051bb57a136f2d54f697e1e92ef9997f35","relevantLine":"/services/services/packages/common/src/auth/bearer-tokens.ts:58:11"}
2025-09-10T08:31:23.1678195Z     error: {
2025-09-10T08:31:23.1678531Z       "name": "AuthenticationError",
2025-09-10T08:31:23.1679014Z       "message": "Missing authorization header",
2025-09-10T08:31:23.1679611Z       "statusCode": 401,
2025-09-10T08:31:23.1679916Z       "stack":
2025-09-10T08:31:23.1680340Z           AuthenticationError: Missing authorization header
2025-09-10T08:31:23.1681361Z               at getBearerToken (/home/runner/work/services/services/packages/common/src/auth/bearer-tokens.ts:58:11)
2025-09-10T08:31:23.1682749Z               at authenticateToken (/home/runner/work/services/services/packages/common/src/auth/bearer-tokens.ts:81:17)
2025-09-10T08:31:23.1684488Z               at newFn (/home/runner/work/services/services/node_modules/.pnpm/express-async-errors@3.1.1_express@4.21.2/node_modules/express-async-errors/index.js:16:20)
2025-09-10T08:31:23.1686448Z               at Layer.handle [as handle_request] (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/layer.js:95:5)
2025-09-10T08:31:23.1688353Z               at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:149:13)
2025-09-10T08:31:23.1689867Z               at prefetchUserFollowing (/home/runner/work/services/services/services/private-sessions/src/server.ts:77:3)
2025-09-10T08:31:23.1691592Z               at newFn (/home/runner/work/services/services/node_modules/.pnpm/express-async-errors@3.1.1_express@4.21.2/node_modules/express-async-errors/index.js:16:20)
2025-09-10T08:31:23.1693594Z               at Layer.handle [as handle_request] (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/layer.js:95:5)
2025-09-10T08:31:23.1695381Z               at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:149:13)
2025-09-10T08:31:23.1696857Z               at queryTrackerMiddleware (/home/runner/work/services/services/services/private-sessions/src/db.ts:132:3)
2025-09-10T08:31:23.1697678Z     }
2025-09-10T08:31:23.1699565Z [90mstdout[2m | tests/integration/api/reactions.test.ts[2m > [22m[2mReactions API Tests[2m > [22m[2mPOST /xrpc/social.spkeasy.reaction.createReaction[2m > [22m[2mshould require uri parameter
2025-09-10T08:31:23.1701132Z [22m[39mValidationError: Validation failed: uri: Required
2025-09-10T08:31:23.1702303Z     at validateAgainstLexicon (/home/runner/work/services/services/packages/common/src/lexicon/lexicon-validation.ts:134:13)
2025-09-10T08:31:23.1704360Z     at Object.social.spkeasy.reaction.createReaction [as handler] (/home/runner/work/services/services/services/private-sessions/src/routes/reaction.routes.ts:26:5)
2025-09-10T08:31:23.1705895Z     at /home/runner/work/services/services/packages/service-base/src/server.ts:137:46
2025-09-10T08:31:23.1707419Z     at newFn (/home/runner/work/services/services/node_modules/.pnpm/express-async-errors@3.1.1_express@4.21.2/node_modules/express-async-errors/index.js:16:20)
2025-09-10T08:31:23.1709496Z     at Layer.handle [as handle_request] (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/layer.js:95:5)
2025-09-10T08:31:23.1711210Z     at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:149:13)
2025-09-10T08:31:23.1712731Z     at /home/runner/work/services/services/node_modules/.pnpm/body-parser@1.20.3/node_modules/body-parser/lib/read.js:137:5
2025-09-10T08:31:23.1713811Z     at AsyncResource.runInAsyncScope (node:async_hooks:211:14)
2025-09-10T08:31:23.1715008Z     at invokeCallback (/home/runner/work/services/services/node_modules/.pnpm/raw-body@2.5.2/node_modules/raw-body/index.js:238:16)
2025-09-10T08:31:23.1716520Z     at done (/home/runner/work/services/services/node_modules/.pnpm/raw-body@2.5.2/node_modules/raw-body/index.js:227:7)
2025-09-10T08:31:23.1717261Z 
2025-09-10T08:31:23.1720665Z [2025-09-10 08:31:19.820 +0000] INFO: {"service":"private-sessions","requestId":"unknown","method":"social.spkeasy.notification.listNotifications","path":"/xrpc/social.spkeasy.notification.listNotifications","duration":4,"status":200,"ip":"313d5b13e067911efcc8e257ab3925051bb57a136f2d54f697e1e92ef9997f35","user":"a2e2b3deeb1a32b63ae64d5fb18f43d6f3eee5e55e126a26d54bbc6e1a95528d","dbDuration":0,"dbProfile":"0","authDuration":8}
2025-09-10T08:31:23.1726840Z [2025-09-10 08:31:19.817 +0000] ERROR: ValidationError occurred {"service":"private-sessions","requestId":"unknown","method":"POST","path":"/xrpc/social.spkeasy.reaction.createReaction","duration":3,"status":400,"ip":"313d5b13e067911efcc8e257ab3925051bb57a136f2d54f697e1e92ef9997f35","user":"a2e2b3deeb1a32b63ae64d5fb18f43d6f3eee5e55e126a26d54bbc6e1a95528d","relevantLine":"/services/services/packages/common/src/lexicon/lexicon-validation.ts:134:13"}
2025-09-10T08:31:23.1729790Z     error: {
2025-09-10T08:31:23.1730144Z       "name": "ValidationError",
2025-09-10T08:31:23.1730615Z       "message": "Validation failed: uri: Required",
2025-09-10T08:31:23.1731058Z       "statusCode": 400,
2025-09-10T08:31:23.1731362Z       "stack":
2025-09-10T08:31:23.1731789Z           ValidationError: Validation failed: uri: Required
2025-09-10T08:31:23.1732956Z               at validateAgainstLexicon (/home/runner/work/services/services/packages/common/src/lexicon/lexicon-validation.ts:134:13)
2025-09-10T08:31:23.1734881Z               at Object.social.spkeasy.reaction.createReaction [as handler] (/home/runner/work/services/services/services/private-sessions/src/routes/reaction.routes.ts:26:5)
2025-09-10T08:31:23.1736437Z               at /home/runner/work/services/services/packages/service-base/src/server.ts:137:46
2025-09-10T08:31:23.1738116Z               at newFn (/home/runner/work/services/services/node_modules/.pnpm/express-async-errors@3.1.1_express@4.21.2/node_modules/express-async-errors/index.js:16:20)
2025-09-10T08:31:23.1740068Z               at Layer.handle [as handle_request] (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/layer.js:95:5)
2025-09-10T08:31:23.1741789Z               at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:149:13)
2025-09-10T08:31:23.1743349Z               at /home/runner/work/services/services/node_modules/.pnpm/body-parser@1.20.3/node_modules/body-parser/lib/read.js:137:5
2025-09-10T08:31:23.1744455Z               at AsyncResource.runInAsyncScope (node:async_hooks:211:14)
2025-09-10T08:31:23.1745832Z               at invokeCallback (/home/runner/work/services/services/node_modules/.pnpm/raw-body@2.5.2/node_modules/raw-body/index.js:238:16)
2025-09-10T08:31:23.1747372Z               at done (/home/runner/work/services/services/node_modules/.pnpm/raw-body@2.5.2/node_modules/raw-body/index.js:227:7)
2025-09-10T08:31:23.1748423Z     }
2025-09-10T08:31:23.1750673Z [90mstdout[2m | tests/integration/api/notifications.test.ts[2m > [22m[2mNotifications API Tests[2m > [22m[2mGET /xrpc/social.spkeasy.notification.listNotifications[2m > [22m[2mshould return validation error for unsupported priority filter
2025-09-10T08:31:23.1752835Z [22m[39mValidationError: Validation failed: priority: Expected boolean, received string
2025-09-10T08:31:23.1754216Z     at validateAgainstLexicon (/home/runner/work/services/services/packages/common/src/lexicon/lexicon-validation.ts:134:13)
2025-09-10T08:31:23.1756225Z     at Object.social.spkeasy.notification.listNotifications [as handler] (/home/runner/work/services/services/services/private-sessions/src/routes/notification.routes.ts:40:28)
2025-09-10T08:31:23.1758201Z     at /home/runner/work/services/services/packages/service-base/src/server.ts:137:46
2025-09-10T08:31:23.1759732Z     at newFn (/home/runner/work/services/services/node_modules/.pnpm/express-async-errors@3.1.1_express@4.21.2/node_modules/express-async-errors/index.js:16:20)
2025-09-10T08:31:23.1761106Z     at Layer.handle [as handle_request] (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/layer.js:95:5)
2025-09-10T08:31:23.1762483Z     at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:149:13)
2025-09-10T08:31:23.1763865Z     at jsonParser (/home/runner/work/services/services/node_modules/.pnpm/body-parser@1.20.3/node_modules/body-parser/lib/types/json.js:113:7)
2025-09-10T08:31:23.1765172Z     at newFn (/home/runner/work/services/services/node_modules/.pnpm/express-async-errors@3.1.1_express@4.21.2/node_modules/express-async-errors/index.js:16:20)
2025-09-10T08:31:23.1766498Z     at Layer.handle [as handle_request] (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/layer.js:95:5)
2025-09-10T08:31:23.1767677Z     at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:149:13)
2025-09-10T08:31:23.1768413Z 
2025-09-10T08:31:23.1770497Z [2025-09-10 08:31:19.843 +0000] INFO: {"service":"private-sessions","requestId":"unknown","method":"social.spkeasy.reaction.createReaction","path":"/xrpc/social.spkeasy.reaction.createReaction","duration":3,"status":200,"ip":"313d5b13e067911efcc8e257ab3925051bb57a136f2d54f697e1e92ef9997f35","user":"a2e2b3deeb1a32b63ae64d5fb18f43d6f3eee5e55e126a26d54bbc6e1a95528d","dbDuration":0,"dbProfile":"0","authDuration":10}
2025-09-10T08:31:23.1773540Z [2025-09-10 08:31:19.875 +0000] INFO: {"service":"private-sessions","requestId":"unknown","method":"social.spkeasy.reaction.createReaction","path":"/xrpc/social.spkeasy.reaction.createReaction","duration":5,"status":200,"ip":"313d5b13e067911efcc8e257ab3925051bb57a136f2d54f697e1e92ef9997f35","user":"a2e2b3deeb1a32b63ae64d5fb18f43d6f3eee5e55e126a26d54bbc6e1a95528d","dbDuration":0,"dbProfile":"0","authDuration":13}
2025-09-10T08:31:23.1775799Z  [31mÃ—[39m tests/integration/api/private-posts.test.ts[2m > [22mPrivate Posts API Tests[2m > [22mGET /xrpc/social.spkeasy.privatePost.getPosts[2m > [22mshould retrieve encrypted posts for user[32m 68[2mms[22m[39m
2025-09-10T08:31:23.1776750Z [31m   â†’ expected [] to have a length of 1 but got +0[39m
2025-09-10T08:31:23.1777878Z  [32mâœ“[39m tests/integration/api/notifications.test.ts[2m > [22mNotifications API Tests[2m > [22mGET /xrpc/social.spkeasy.notification.listNotifications[2m > [22mshould list notifications for user[32m 52[2mms[22m[39m
2025-09-10T08:31:23.1779793Z  [32mâœ“[39m tests/integration/api/notifications.test.ts[2m > [22mNotifications API Tests[2m > [22mGET /xrpc/social.spkeasy.notification.listNotifications[2m > [22mshould support pagination with limit and cursor[32m 38[2mms[22m[39m
2025-09-10T08:31:23.1781570Z  [32mâœ“[39m tests/integration/api/notifications.test.ts[2m > [22mNotifications API Tests[2m > [22mGET /xrpc/social.spkeasy.notification.listNotifications[2m > [22mshould return validation error for unsupported priority filter[32m 36[2mms[22m[39m
2025-09-10T08:31:23.1783250Z  [32mâœ“[39m tests/integration/api/reactions.test.ts[2m > [22mReactions API Tests[2m > [22mPOST /xrpc/social.spkeasy.reaction.createReaction[2m > [22mshould prevent duplicate reactions from same user[32m 100[2mms[22m[39m
2025-09-10T08:31:23.1784757Z  [32mâœ“[39m tests/integration/api/reactions.test.ts[2m > [22mReactions API Tests[2m > [22mPOST /xrpc/social.spkeasy.reaction.createReaction[2m > [22mshould require authentication[32m 17[2mms[22m[39m
2025-09-10T08:31:23.1786183Z  [32mâœ“[39m tests/integration/api/reactions.test.ts[2m > [22mReactions API Tests[2m > [22mPOST /xrpc/social.spkeasy.reaction.createReaction[2m > [22mshould require uri parameter[32m 23[2mms[22m[39m
2025-09-10T08:31:23.1787579Z  [32mâœ“[39m tests/integration/api/reactions.test.ts[2m > [22mReactions API Tests[2m > [22mPOST /xrpc/social.spkeasy.reaction.createReaction[2m > [22mshould validate uri format[32m 26[2mms[22m[39m
2025-09-10T08:31:23.1789359Z [90mstdout[2m | tests/integration/api/notifications.test.ts[2m > [22m[2mNotifications API Tests[2m > [22m[2mGET /xrpc/social.spkeasy.notification.listNotifications[2m > [22m[2mshould require authentication
2025-09-10T08:31:23.1790452Z [22m[39mAuthenticationError: Missing authorization header
2025-09-10T08:31:23.1791043Z     at getBearerToken (/home/runner/work/services/services/packages/common/src/auth/bearer-tokens.ts:58:11)
2025-09-10T08:31:23.1791802Z     at authenticateToken (/home/runner/work/services/services/packages/common/src/auth/bearer-tokens.ts:81:17)
2025-09-10T08:31:23.1792749Z     at newFn (/home/runner/work/services/services/node_modules/.pnpm/express-async-errors@3.1.1_express@4.21.2/node_modules/express-async-errors/index.js:16:20)
2025-09-10T08:31:23.1793812Z     at Layer.handle [as handle_request] (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/layer.js:95:5)
2025-09-10T08:31:23.1794752Z     at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:149:13)
2025-09-10T08:31:23.1795575Z     at prefetchUserFollowing (/home/runner/work/services/services/services/private-sessions/src/server.ts:77:3)
2025-09-10T08:31:23.1796515Z     at newFn (/home/runner/work/services/services/node_modules/.pnpm/express-async-errors@3.1.1_express@4.21.2/node_modules/express-async-errors/index.js:16:20)
2025-09-10T08:31:23.1797560Z     at Layer.handle [as handle_request] (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/layer.js:95:5)
2025-09-10T08:31:23.1798829Z     at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:149:13)
2025-09-10T08:31:23.1799637Z     at queryTrackerMiddleware (/home/runner/work/services/services/services/private-sessions/src/db.ts:132:3)
2025-09-10T08:31:23.1800037Z 
2025-09-10T08:31:23.1801704Z [2025-09-10 08:31:19.884 +0000] INFO: {"service":"private-sessions","requestId":"unknown","method":"social.spkeasy.reaction.deleteReaction","path":"/xrpc/social.spkeasy.reaction.deleteReaction","duration":4,"status":200,"ip":"313d5b13e067911efcc8e257ab3925051bb57a136f2d54f697e1e92ef9997f35","user":"a2e2b3deeb1a32b63ae64d5fb18f43d6f3eee5e55e126a26d54bbc6e1a95528d","dbDuration":2,"dbProfile":"2","authDuration":0}
2025-09-10T08:31:23.1804990Z [2025-09-10 08:31:19.857 +0000] ERROR: ValidationError occurred {"service":"private-sessions","requestId":"unknown","method":"GET","path":"/xrpc/social.spkeasy.notification.listNotifications","duration":6,"status":400,"ip":"313d5b13e067911efcc8e257ab3925051bb57a136f2d54f697e1e92ef9997f35","user":"a2e2b3deeb1a32b63ae64d5fb18f43d6f3eee5e55e126a26d54bbc6e1a95528d","relevantLine":"/services/services/packages/common/src/lexicon/lexicon-validation.ts:134:13"}
2025-09-10T08:31:23.1806525Z     error: {
2025-09-10T08:31:23.1806729Z       "name": "ValidationError",
2025-09-10T08:31:23.1807112Z       "message": "Validation failed: priority: Expected boolean, received string",
2025-09-10T08:31:23.1807466Z       "statusCode": 400,
2025-09-10T08:31:23.1807653Z       "stack":
2025-09-10T08:31:23.1808135Z           ValidationError: Validation failed: priority: Expected boolean, received string
2025-09-10T08:31:23.1808890Z               at validateAgainstLexicon (/home/runner/work/services/services/packages/common/src/lexicon/lexicon-validation.ts:134:13)
2025-09-10T08:31:23.1810005Z               at Object.social.spkeasy.notification.listNotifications [as handler] (/home/runner/work/services/services/services/private-sessions/src/routes/notification.routes.ts:40:28)
2025-09-10T08:31:23.1810922Z               at /home/runner/work/services/services/packages/service-base/src/server.ts:137:46
2025-09-10T08:31:23.1811782Z               at newFn (/home/runner/work/services/services/node_modules/.pnpm/express-async-errors@3.1.1_express@4.21.2/node_modules/express-async-errors/index.js:16:20)
2025-09-10T08:31:23.1812837Z               at Layer.handle [as handle_request] (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/layer.js:95:5)
2025-09-10T08:31:23.1813792Z               at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:149:13)
2025-09-10T08:31:23.1814868Z               at jsonParser (/home/runner/work/services/services/node_modules/.pnpm/body-parser@1.20.3/node_modules/body-parser/lib/types/json.js:113:7)
2025-09-10T08:31:23.1815902Z               at newFn (/home/runner/work/services/services/node_modules/.pnpm/express-async-errors@3.1.1_express@4.21.2/node_modules/express-async-errors/index.js:16:20)
2025-09-10T08:31:23.1816949Z               at Layer.handle [as handle_request] (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/layer.js:95:5)
2025-09-10T08:31:23.1817894Z               at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:149:13)
2025-09-10T08:31:23.1818500Z     }
2025-09-10T08:31:23.1820089Z [2025-09-10 08:31:19.881 +0000] ERROR: AuthenticationError occurred {"service":"private-sessions","requestId":"unknown","method":"GET","path":"/xrpc/social.spkeasy.notification.listNotifications","duration":null,"status":401,"ip":"313d5b13e067911efcc8e257ab3925051bb57a136f2d54f697e1e92ef9997f35","relevantLine":"/services/services/packages/common/src/auth/bearer-tokens.ts:58:11"}
2025-09-10T08:31:23.1821355Z     error: {
2025-09-10T08:31:23.1821559Z       "name": "AuthenticationError",
2025-09-10T08:31:23.1821846Z       "message": "Missing authorization header",
2025-09-10T08:31:23.1822099Z       "statusCode": 401,
2025-09-10T08:31:23.1822287Z       "stack":
2025-09-10T08:31:23.1822533Z           AuthenticationError: Missing authorization header
2025-09-10T08:31:23.1823112Z               at getBearerToken (/home/runner/work/services/services/packages/common/src/auth/bearer-tokens.ts:58:11)
2025-09-10T08:31:23.1823885Z               at authenticateToken (/home/runner/work/services/services/packages/common/src/auth/bearer-tokens.ts:81:17)
2025-09-10T08:31:23.1824834Z               at newFn (/home/runner/work/services/services/node_modules/.pnpm/express-async-errors@3.1.1_express@4.21.2/node_modules/express-async-errors/index.js:16:20)
2025-09-10T08:31:23.1825895Z               at Layer.handle [as handle_request] (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/layer.js:95:5)
2025-09-10T08:31:23.1826970Z               at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:149:13)
2025-09-10T08:31:23.1827801Z               at prefetchUserFollowing (/home/runner/work/services/services/services/private-sessions/src/server.ts:77:3)
2025-09-10T08:31:23.1828879Z               at newFn (/home/runner/work/services/services/node_modules/.pnpm/express-async-errors@3.1.1_express@4.21.2/node_modules/express-async-errors/index.js:16:20)
2025-09-10T08:31:23.1829948Z               at Layer.handle [as handle_request] (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/layer.js:95:5)
2025-09-10T08:31:23.1830894Z               at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:149:13)
2025-09-10T08:31:23.1831703Z               at queryTrackerMiddleware (/home/runner/work/services/services/services/private-sessions/src/db.ts:132:3)
2025-09-10T08:31:23.1832154Z     }
2025-09-10T08:31:23.1833873Z [2025-09-10 08:31:19.880 +0000] INFO: {"service":"private-sessions","requestId":"unknown","method":"social.spkeasy.privatePost.getPosts","path":"/xrpc/social.spkeasy.privatePost.getPosts","duration":18,"status":200,"ip":"313d5b13e067911efcc8e257ab3925051bb57a136f2d54f697e1e92ef9997f35","user":"3698761d94b6992d6277d4dc2932712760c796ead51e44dd484d665e3bcd7c08","dbDuration":13,"dbProfile":"13,0,0","authDuration":12}
2025-09-10T08:31:23.1836804Z [2025-09-10 08:31:19.909 +0000] INFO: {"service":"private-sessions","requestId":"unknown","method":"social.spkeasy.reaction.deleteReaction","path":"/xrpc/social.spkeasy.reaction.deleteReaction","duration":3,"status":200,"ip":"313d5b13e067911efcc8e257ab3925051bb57a136f2d54f697e1e92ef9997f35","user":"a2e2b3deeb1a32b63ae64d5fb18f43d6f3eee5e55e126a26d54bbc6e1a95528d","dbDuration":1,"dbProfile":"1","authDuration":7}
2025-09-10T08:31:23.1840303Z [2025-09-10 08:31:19.909 +0000] INFO: {"service":"private-sessions","requestId":"unknown","method":"social.spkeasy.notification.listNotifications","path":"/xrpc/social.spkeasy.notification.listNotifications","duration":2,"status":200,"ip":"313d5b13e067911efcc8e257ab3925051bb57a136f2d54f697e1e92ef9997f35","user":"a2e2b3deeb1a32b63ae64d5fb18f43d6f3eee5e55e126a26d54bbc6e1a95528d","dbDuration":0,"dbProfile":"0","authDuration":8}
2025-09-10T08:31:23.1842600Z [90mstdout[2m | tests/integration/api/private-posts.test.ts[2m > [22m[2mPrivate Posts API Tests[2m > [22m[2mGET /xrpc/social.spkeasy.privatePost.getPosts[2m > [22m[2mshould require authentication
2025-09-10T08:31:23.1843479Z [22m[39mAuthenticationError: Missing authorization header
2025-09-10T08:31:23.1844069Z     at getBearerToken (/home/runner/work/services/services/packages/common/src/auth/bearer-tokens.ts:58:11)
2025-09-10T08:31:23.1844866Z     at authenticateToken (/home/runner/work/services/services/packages/common/src/auth/bearer-tokens.ts:81:17)
2025-09-10T08:31:23.1845793Z     at newFn (/home/runner/work/services/services/node_modules/.pnpm/express-async-errors@3.1.1_express@4.21.2/node_modules/express-async-errors/index.js:16:20)
2025-09-10T08:31:23.1846849Z     at Layer.handle [as handle_request] (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/layer.js:95:5)
2025-09-10T08:31:23.1847795Z     at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:149:13)
2025-09-10T08:31:23.1848841Z     at prefetchUserFollowing (/home/runner/work/services/services/services/private-sessions/src/server.ts:77:3)
2025-09-10T08:31:23.1849788Z     at newFn (/home/runner/work/services/services/node_modules/.pnpm/express-async-errors@3.1.1_express@4.21.2/node_modules/express-async-errors/index.js:16:20)
2025-09-10T08:31:23.1850837Z     at Layer.handle [as handle_request] (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/layer.js:95:5)
2025-09-10T08:31:23.1851786Z     at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:149:13)
2025-09-10T08:31:23.1852734Z     at queryTrackerMiddleware (/home/runner/work/services/services/services/private-sessions/src/db.ts:132:3)
2025-09-10T08:31:23.1853141Z 
2025-09-10T08:31:23.1854779Z [2025-09-10 08:31:19.924 +0000] INFO: {"service":"private-sessions","requestId":"unknown","method":"social.spkeasy.privatePost.getPosts","path":"/xrpc/social.spkeasy.privatePost.getPosts","duration":10,"status":200,"ip":"313d5b13e067911efcc8e257ab3925051bb57a136f2d54f697e1e92ef9997f35","user":"3698761d94b6992d6277d4dc2932712760c796ead51e44dd484d665e3bcd7c08","dbDuration":4,"dbProfile":"2,1,1","authDuration":9}
2025-09-10T08:31:23.1857704Z [2025-09-10 08:31:19.934 +0000] INFO: {"service":"private-sessions","requestId":"unknown","method":"social.spkeasy.reaction.createReaction","path":"/xrpc/social.spkeasy.reaction.createReaction","duration":3,"status":200,"ip":"313d5b13e067911efcc8e257ab3925051bb57a136f2d54f697e1e92ef9997f35","user":"a2e2b3deeb1a32b63ae64d5fb18f43d6f3eee5e55e126a26d54bbc6e1a95528d","dbDuration":0,"dbProfile":"0","authDuration":8}
2025-09-10T08:31:23.1860792Z [2025-09-10 08:31:19.943 +0000] INFO: {"service":"private-sessions","requestId":"unknown","method":"social.spkeasy.reaction.deleteReaction","path":"/xrpc/social.spkeasy.reaction.deleteReaction","duration":2,"status":200,"ip":"313d5b13e067911efcc8e257ab3925051bb57a136f2d54f697e1e92ef9997f35","user":"a2e2b3deeb1a32b63ae64d5fb18f43d6f3eee5e55e126a26d54bbc6e1a95528d","dbDuration":0,"dbProfile":"0","authDuration":0}
2025-09-10T08:31:23.1863543Z [2025-09-10 08:31:19.936 +0000] ERROR: AuthenticationError occurred {"service":"private-sessions","requestId":"unknown","method":"GET","path":"/xrpc/social.spkeasy.privatePost.getPosts","duration":null,"status":401,"ip":"313d5b13e067911efcc8e257ab3925051bb57a136f2d54f697e1e92ef9997f35","relevantLine":"/services/services/packages/common/src/auth/bearer-tokens.ts:58:11"}
2025-09-10T08:31:23.1884418Z ##[error]@speakeasy-services/private-sessions#test: command (/home/runner/work/services/services/services/private-sessions) /home/runner/setup-pnpm/node_modules/.bin/pnpm run test exited (1)
2025-09-10T08:31:23.1892715Z  ERROR  run failed: command  exited (1)
2025-09-10T08:31:23.1893154Z     error: {
2025-09-10T08:31:23.1893521Z       "name": "AuthenticationError",
2025-09-10T08:31:23.1893893Z       "message": "Missing authorization header",
2025-09-10T08:31:23.1894176Z       "statusCode": 401,
2025-09-10T08:31:23.1894378Z       "stack":
2025-09-10T08:31:23.1894636Z           AuthenticationError: Missing authorization header
2025-09-10T08:31:23.1895232Z               at getBearerToken (/home/runner/work/services/services/packages/common/src/auth/bearer-tokens.ts:58:11)
2025-09-10T08:31:23.1896040Z               at authenticateToken (/home/runner/work/services/services/packages/common/src/auth/bearer-tokens.ts:81:17)
2025-09-10T08:31:23.1897490Z               at newFn (/home/runner/work/services/services/node_modules/.pnpm/express-async-errors@3.1.1_express@4.21.2/node_modules/express-async-errors/index.js:16:20)
2025-09-10T08:31:23.1899587Z               at Layer.handle [as handle_request] (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/layer.js:95:5)
2025-09-10T08:31:23.1901310Z               at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:149:13)
2025-09-10T08:31:23.1902796Z               at prefetchUserFollowing (/home/runner/work/services/services/services/private-sessions/src/server.ts:77:3)
2025-09-10T08:31:23.1904491Z               at newFn (/home/runner/work/services/services/node_modules/.pnpm/express-async-errors@3.1.1_express@4.21.2/node_modules/express-async-errors/index.js:16:20)
2025-09-10T08:31:23.1906400Z               at Layer.handle [as handle_request] (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/layer.js:95:5)
2025-09-10T08:31:23.1908456Z               at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:149:13)
2025-09-10T08:31:23.1909979Z               at queryTrackerMiddleware (/home/runner/work/services/services/services/private-sessions/src/db.ts:132:3)
2025-09-10T08:31:23.1910814Z     }
2025-09-10T08:31:23.1912663Z [90mstdout[2m | tests/integration/api/reactions.test.ts[2m > [22m[2mReactions API Tests[2m > [22m[2mPOST /xrpc/social.spkeasy.reaction.deleteReaction[2m > [22m[2mshould require authentication
2025-09-10T08:31:23.1914282Z [22m[39mAuthenticationError: Missing authorization header
2025-09-10T08:31:23.1915332Z     at getBearerToken (/home/runner/work/services/services/packages/common/src/auth/bearer-tokens.ts:58:11)
2025-09-10T08:31:23.1916711Z     at authenticateToken (/home/runner/work/services/services/packages/common/src/auth/bearer-tokens.ts:81:17)
2025-09-10T08:31:23.1918498Z     at newFn (/home/runner/work/services/services/node_modules/.pnpm/express-async-errors@3.1.1_express@4.21.2/node_modules/express-async-errors/index.js:16:20)
2025-09-10T08:31:23.1920234Z     at Layer.handle [as handle_request] (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/layer.js:95:5)
2025-09-10T08:31:23.1921770Z     at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:149:13)
2025-09-10T08:31:23.1923164Z     at prefetchUserFollowing (/home/runner/work/services/services/services/private-sessions/src/server.ts:77:3)
2025-09-10T08:31:23.1924699Z     at newFn (/home/runner/work/services/services/node_modules/.pnpm/express-async-errors@3.1.1_express@4.21.2/node_modules/express-async-errors/index.js:16:20)
2025-09-10T08:31:23.1926584Z     at Layer.handle [as handle_request] (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/layer.js:95:5)
2025-09-10T08:31:23.1928331Z     at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:149:13)
2025-09-10T08:31:23.1929666Z     at queryTrackerMiddleware (/home/runner/work/services/services/services/private-sessions/src/db.ts:132:3)
2025-09-10T08:31:23.1930311Z 
2025-09-10T08:31:23.1933212Z [2025-09-10 08:31:19.955 +0000] INFO: {"service":"private-sessions","requestId":"unknown","method":"social.spkeasy.notification.updateSeen","path":"/xrpc/social.spkeasy.notification.updateSeen","duration":6,"status":200,"ip":"313d5b13e067911efcc8e257ab3925051bb57a136f2d54f697e1e92ef9997f35","user":"a2e2b3deeb1a32b63ae64d5fb18f43d6f3eee5e55e126a26d54bbc6e1a95528d","dbDuration":1,"dbProfile":"0,1,0","authDuration":9}
2025-09-10T08:31:23.1938727Z [2025-09-10 08:31:19.953 +0000] ERROR: AuthenticationError occurred {"service":"private-sessions","requestId":"unknown","method":"POST","path":"/xrpc/social.spkeasy.reaction.deleteReaction","duration":null,"status":401,"ip":"313d5b13e067911efcc8e257ab3925051bb57a136f2d54f697e1e92ef9997f35","relevantLine":"/services/services/packages/common/src/auth/bearer-tokens.ts:58:11"}
2025-09-10T08:31:23.1941084Z     error: {
2025-09-10T08:31:23.1941433Z       "name": "AuthenticationError",
2025-09-10T08:31:23.1941931Z       "message": "Missing authorization header",
2025-09-10T08:31:23.1942373Z       "statusCode": 401,
2025-09-10T08:31:23.1942695Z       "stack":
2025-09-10T08:31:23.1943133Z           AuthenticationError: Missing authorization header
2025-09-10T08:31:23.1959713Z               at getBearerToken (/home/runner/work/services/services/packages/common/src/auth/bearer-tokens.ts:58:11)
2025-09-10T08:31:23.1961135Z               at authenticateToken (/home/runner/work/services/services/packages/common/src/auth/bearer-tokens.ts:81:17)
2025-09-10T08:31:23.1962829Z               at newFn (/home/runner/work/services/services/node_modules/.pnpm/express-async-errors@3.1.1_express@4.21.2/node_modules/express-async-errors/index.js:16:20)
2025-09-10T08:31:23.1964214Z               at Layer.handle [as handle_request] (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/layer.js:95:5)
2025-09-10T08:31:23.1965218Z               at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:149:13)
2025-09-10T08:31:23.1966553Z               at prefetchUserFollowing (/home/runner/work/services/services/services/private-sessions/src/server.ts:77:3)
2025-09-10T08:31:23.1968169Z               at newFn (/home/runner/work/services/services/node_modules/.pnpm/express-async-errors@3.1.1_express@4.21.2/node_modules/express-async-errors/index.js:16:20)
2025-09-10T08:31:23.1969296Z               at Layer.handle [as handle_request] (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/layer.js:95:5)
2025-09-10T08:31:23.1970261Z               at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:149:13)
2025-09-10T08:31:23.1971093Z               at queryTrackerMiddleware (/home/runner/work/services/services/services/private-sessions/src/db.ts:132:3)
2025-09-10T08:31:23.1971562Z     }
2025-09-10T08:31:23.1972568Z [90mstdout[2m | tests/integration/api/reactions.test.ts[2m > [22m[2mReactions API Tests[2m > [22m[2mPOST /xrpc/social.spkeasy.reaction.deleteReaction[2m > [22m[2mshould require uri parameter
2025-09-10T08:31:23.1973448Z [22m[39mValidationError: Validation failed: uri: Required
2025-09-10T08:31:23.1974120Z     at validateAgainstLexicon (/home/runner/work/services/services/packages/common/src/lexicon/lexicon-validation.ts:134:13)
2025-09-10T08:31:23.1975323Z     at Object.social.spkeasy.reaction.deleteReaction [as handler] (/home/runner/work/services/services/services/private-sessions/src/routes/reaction.routes.ts:44:5)
2025-09-10T08:31:23.1976166Z     at /home/runner/work/services/services/packages/service-base/src/server.ts:137:46
2025-09-10T08:31:23.1977013Z     at newFn (/home/runner/work/services/services/node_modules/.pnpm/express-async-errors@3.1.1_express@4.21.2/node_modules/express-async-errors/index.js:16:20)
2025-09-10T08:31:23.1978236Z     at Layer.handle [as handle_request] (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/layer.js:95:5)
2025-09-10T08:31:23.1979178Z     at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:149:13)
2025-09-10T08:31:23.1980027Z     at /home/runner/work/services/services/node_modules/.pnpm/body-parser@1.20.3/node_modules/body-parser/lib/read.js:137:5
2025-09-10T08:31:23.1980648Z     at AsyncResource.runInAsyncScope (node:async_hooks:211:14)
2025-09-10T08:31:23.1981312Z     at invokeCallback (/home/runner/work/services/services/node_modules/.pnpm/raw-body@2.5.2/node_modules/raw-body/index.js:238:16)
2025-09-10T08:31:23.1982141Z     at done (/home/runner/work/services/services/node_modules/.pnpm/raw-body@2.5.2/node_modules/raw-body/index.js:227:7)
2025-09-10T08:31:23.1982558Z 
2025-09-10T08:31:23.1983533Z [90mstdout[2m | tests/integration/api/private-posts.test.ts[2m > [22m[2mPrivate Posts API Tests[2m > [22m[2mGET /xrpc/social.spkeasy.privatePost.getPostThread[2m > [22m[2mshould retrieve post thread with replies
2025-09-10T08:31:23.1984388Z [22m[39mNotFoundError: Post not found
2025-09-10T08:31:23.1984941Z     at /home/runner/work/services/services/services/private-sessions/src/services/privatePosts.service.ts:384:19
2025-09-10T08:31:23.1985468Z     at async Promise.all (index 0)
2025-09-10T08:31:23.1986168Z     at PrivatePostsService.getPostThread (/home/runner/work/services/services/services/private-sessions/src/services/privatePosts.service.ts:488:45)
2025-09-10T08:31:23.1987349Z     at Object.social.spkeasy.privatePost.getPostThread [as handler] (/home/runner/work/services/services/services/private-sessions/src/routes/privatePosts.routes.ts:89:20)
2025-09-10T08:31:23.1988414Z     at /home/runner/work/services/services/packages/service-base/src/server.ts:137:26
2025-09-10T08:31:23.1988729Z 
2025-09-10T08:31:23.1989707Z  [31mÃ—[39m tests/integration/api/private-posts.test.ts[2m > [22mPrivate Posts API Tests[2m > [22mGET /xrpc/social.spkeasy.privatePost.getPosts[2m > [22mshould filter posts by author[32m 106[2mms[22m[39m
2025-09-10T08:31:23.1990622Z [31m   â†’ expected [] to have a length of 1 but got +0[39m
2025-09-10T08:31:23.1991680Z  [31mÃ—[39m tests/integration/api/private-posts.test.ts[2m > [22mPrivate Posts API Tests[2m > [22mGET /xrpc/social.spkeasy.privatePost.getPosts[2m > [22mshould support pagination with cursor[32m 44[2mms[22m[39m
2025-09-10T08:31:23.1992604Z [31m   â†’ expected [] to have a length of 2 but got +0[39m
2025-09-10T08:31:23.1993616Z  [32mâœ“[39m tests/integration/api/private-posts.test.ts[2m > [22mPrivate Posts API Tests[2m > [22mGET /xrpc/social.spkeasy.privatePost.getPosts[2m > [22mshould require authentication[32m 11[2mms[22m[39m
2025-09-10T08:31:23.1996107Z [2025-09-10 08:31:19.971 +0000] ERROR: ValidationError occurred {"service":"private-sessions","requestId":"unknown","method":"POST","path":"/xrpc/social.spkeasy.reaction.deleteReaction","duration":2,"status":400,"ip":"313d5b13e067911efcc8e257ab3925051bb57a136f2d54f697e1e92ef9997f35","user":"a2e2b3deeb1a32b63ae64d5fb18f43d6f3eee5e55e126a26d54bbc6e1a95528d","relevantLine":"/services/services/packages/common/src/lexicon/lexicon-validation.ts:134:13"}
2025-09-10T08:31:23.1997628Z     error: {
2025-09-10T08:31:23.1997833Z       "name": "ValidationError",
2025-09-10T08:31:23.1998324Z       "message": "Validation failed: uri: Required",
2025-09-10T08:31:23.1998727Z       "statusCode": 400,
2025-09-10T08:31:23.1998925Z       "stack":
2025-09-10T08:31:23.1999178Z           ValidationError: Validation failed: uri: Required
2025-09-10T08:31:23.1999832Z               at validateAgainstLexicon (/home/runner/work/services/services/packages/common/src/lexicon/lexicon-validation.ts:134:13)
2025-09-10T08:31:23.2000910Z               at Object.social.spkeasy.reaction.deleteReaction [as handler] (/home/runner/work/services/services/services/private-sessions/src/routes/reaction.routes.ts:44:5)
2025-09-10T08:31:23.2001774Z               at /home/runner/work/services/services/packages/service-base/src/server.ts:137:46
2025-09-10T08:31:23.2002636Z               at newFn (/home/runner/work/services/services/node_modules/.pnpm/express-async-errors@3.1.1_express@4.21.2/node_modules/express-async-errors/index.js:16:20)
2025-09-10T08:31:23.2003704Z               at Layer.handle [as handle_request] (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/layer.js:95:5)
2025-09-10T08:31:23.2004674Z               at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:149:13)
2025-09-10T08:31:23.2005536Z               at /home/runner/work/services/services/node_modules/.pnpm/body-parser@1.20.3/node_modules/body-parser/lib/read.js:137:5
2025-09-10T08:31:23.2006154Z               at AsyncResource.runInAsyncScope (node:async_hooks:211:14)
2025-09-10T08:31:23.2006838Z               at invokeCallback (/home/runner/work/services/services/node_modules/.pnpm/raw-body@2.5.2/node_modules/raw-body/index.js:238:16)
2025-09-10T08:31:23.2007694Z               at done (/home/runner/work/services/services/node_modules/.pnpm/raw-body@2.5.2/node_modules/raw-body/index.js:227:7)
2025-09-10T08:31:23.2008498Z     }
2025-09-10T08:31:23.2009931Z  [32mâœ“[39m tests/integration/api/notifications.test.ts[2m > [22mNotifications API Tests[2m > [22mGET /xrpc/social.spkeasy.notification.listNotifications[2m > [22mshould require authentication[32m 26[2mms[22m[39m
2025-09-10T08:31:23.2011617Z  [32mâœ“[39m tests/integration/api/notifications.test.ts[2m > [22mNotifications API Tests[2m > [22mGET /xrpc/social.spkeasy.notification.listNotifications[2m > [22mshould not return notifications for other users[32m 26[2mms[22m[39m
2025-09-10T08:31:23.2013381Z  [31mÃ—[39m tests/integration/api/notifications.test.ts[2m > [22mNotifications API Tests[2m > [22mPOST /xrpc/social.spkeasy.notification.updateSeen[2m > [22mshould mark notifications as seen[32m 53[2mms[22m[39m
2025-09-10T08:31:23.2014322Z [31m   â†’ expected [] to have a length of 2 but got +0[39m
2025-09-10T08:31:23.2015338Z  [32mâœ“[39m tests/integration/api/reactions.test.ts[2m > [22mReactions API Tests[2m > [22mPOST /xrpc/social.spkeasy.reaction.deleteReaction[2m > [22mshould delete an existing reaction[32m 42[2mms[22m[39m
2025-09-10T08:31:23.2016900Z  [32mâœ“[39m tests/integration/api/reactions.test.ts[2m > [22mReactions API Tests[2m > [22mPOST /xrpc/social.spkeasy.reaction.deleteReaction[2m > [22mshould handle deleting non-existent reaction gracefully[32m 24[2mms[22m[39m
2025-09-10T08:31:23.2018692Z  [32mâœ“[39m tests/integration/api/reactions.test.ts[2m > [22mReactions API Tests[2m > [22mPOST /xrpc/social.spkeasy.reaction.deleteReaction[2m > [22mshould only allow users to delete their own reactions[32m 34[2mms[22m[39m
2025-09-10T08:31:23.2020236Z  [32mâœ“[39m tests/integration/api/reactions.test.ts[2m > [22mReactions API Tests[2m > [22mPOST /xrpc/social.spkeasy.reaction.deleteReaction[2m > [22mshould require authentication[32m 10[2mms[22m[39m
2025-09-10T08:31:23.2021676Z  [32mâœ“[39m tests/integration/api/reactions.test.ts[2m > [22mReactions API Tests[2m > [22mPOST /xrpc/social.spkeasy.reaction.deleteReaction[2m > [22mshould require uri parameter[32m 17[2mms[22m[39m
2025-09-10T08:31:23.2023232Z [90mstdout[2m | tests/integration/api/private-posts.test.ts[2m > [22m[2mPrivate Posts API Tests[2m > [22m[2mGET /xrpc/social.spkeasy.privatePost.getPostThread[2m > [22m[2mshould require authentication
2025-09-10T08:31:23.2024276Z [22m[39mAuthenticationError: Missing authorization header
2025-09-10T08:31:23.2024869Z     at getBearerToken (/home/runner/work/services/services/packages/common/src/auth/bearer-tokens.ts:58:11)
2025-09-10T08:31:23.2025642Z     at authenticateToken (/home/runner/work/services/services/packages/common/src/auth/bearer-tokens.ts:81:17)
2025-09-10T08:31:23.2026591Z     at newFn (/home/runner/work/services/services/node_modules/.pnpm/express-async-errors@3.1.1_express@4.21.2/node_modules/express-async-errors/index.js:16:20)
2025-09-10T08:31:23.2027659Z     at Layer.handle [as handle_request] (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/layer.js:95:5)
2025-09-10T08:31:23.2028806Z     at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:149:13)
2025-09-10T08:31:23.2029632Z     at prefetchUserFollowing (/home/runner/work/services/services/services/private-sessions/src/server.ts:77:3)
2025-09-10T08:31:23.2030583Z     at newFn (/home/runner/work/services/services/node_modules/.pnpm/express-async-errors@3.1.1_express@4.21.2/node_modules/express-async-errors/index.js:16:20)
2025-09-10T08:31:23.2031635Z     at Layer.handle [as handle_request] (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/layer.js:95:5)
2025-09-10T08:31:23.2032573Z     at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:149:13)
2025-09-10T08:31:23.2033382Z     at queryTrackerMiddleware (/home/runner/work/services/services/services/private-sessions/src/db.ts:132:3)
2025-09-10T08:31:23.2033780Z 
2025-09-10T08:31:23.2035452Z [2025-09-10 08:31:19.995 +0000] INFO: {"service":"private-sessions","requestId":"unknown","method":"social.spkeasy.reaction.deleteReaction","path":"/xrpc/social.spkeasy.reaction.deleteReaction","duration":2,"status":200,"ip":"313d5b13e067911efcc8e257ab3925051bb57a136f2d54f697e1e92ef9997f35","user":"a2e2b3deeb1a32b63ae64d5fb18f43d6f3eee5e55e126a26d54bbc6e1a95528d","dbDuration":0,"dbProfile":"0","authDuration":12}
2025-09-10T08:31:23.2038414Z [2025-09-10 08:31:19.977 +0000] ERROR: NotFoundError occurred {"service":"private-sessions","requestId":"unknown","method":"GET","path":"/xrpc/social.spkeasy.privatePost.getPostThread","duration":9,"status":404,"ip":"313d5b13e067911efcc8e257ab3925051bb57a136f2d54f697e1e92ef9997f35","user":"3698761d94b6992d6277d4dc2932712760c796ead51e44dd484d665e3bcd7c08"}
2025-09-10T08:31:23.2039616Z     error: {
2025-09-10T08:31:23.2039820Z       "name": "NotFoundError",
2025-09-10T08:31:23.2040080Z       "message": "Post not found",
2025-09-10T08:31:23.2040302Z       "statusCode": 404,
2025-09-10T08:31:23.2040505Z       "stack":
2025-09-10T08:31:23.2040714Z           NotFoundError: Post not found
2025-09-10T08:31:23.2041289Z               at /home/runner/work/services/services/services/private-sessions/src/services/privatePosts.service.ts:384:19
2025-09-10T08:31:23.2041827Z               at async Promise.all (index 0)
2025-09-10T08:31:23.2042559Z               at PrivatePostsService.getPostThread (/home/runner/work/services/services/services/private-sessions/src/services/privatePosts.service.ts:488:45)
2025-09-10T08:31:23.2043757Z               at Object.social.spkeasy.privatePost.getPostThread [as handler] (/home/runner/work/services/services/services/private-sessions/src/routes/privatePosts.routes.ts:89:20)
2025-09-10T08:31:23.2044667Z               at /home/runner/work/services/services/packages/service-base/src/server.ts:137:26
2025-09-10T08:31:23.2045085Z     }
2025-09-10T08:31:23.2046664Z [2025-09-10 08:31:19.990 +0000] ERROR: AuthenticationError occurred {"service":"private-sessions","requestId":"unknown","method":"GET","path":"/xrpc/social.spkeasy.privatePost.getPostThread","duration":null,"status":401,"ip":"313d5b13e067911efcc8e257ab3925051bb57a136f2d54f697e1e92ef9997f35","relevantLine":"/services/services/packages/common/src/auth/bearer-tokens.ts:58:11"}
2025-09-10T08:31:23.2048206Z     error: {
2025-09-10T08:31:23.2048419Z       "name": "AuthenticationError",
2025-09-10T08:31:23.2048715Z       "message": "Missing authorization header",
2025-09-10T08:31:23.2048969Z       "statusCode": 401,
2025-09-10T08:31:23.2049160Z       "stack":
2025-09-10T08:31:23.2049426Z           AuthenticationError: Missing authorization header
2025-09-10T08:31:23.2050023Z               at getBearerToken (/home/runner/work/services/services/packages/common/src/auth/bearer-tokens.ts:58:11)
2025-09-10T08:31:23.2050813Z               at authenticateToken (/home/runner/work/services/services/packages/common/src/auth/bearer-tokens.ts:81:17)
2025-09-10T08:31:23.2051770Z               at newFn (/home/runner/work/services/services/node_modules/.pnpm/express-async-errors@3.1.1_express@4.21.2/node_modules/express-async-errors/index.js:16:20)
2025-09-10T08:31:23.2052845Z               at Layer.handle [as handle_request] (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/layer.js:95:5)
2025-09-10T08:31:23.2053807Z               at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:149:13)
2025-09-10T08:31:23.2054643Z               at prefetchUserFollowing (/home/runner/work/services/services/services/private-sessions/src/server.ts:77:3)
2025-09-10T08:31:23.2055593Z               at newFn (/home/runner/work/services/services/node_modules/.pnpm/express-async-errors@3.1.1_express@4.21.2/node_modules/express-async-errors/index.js:16:20)
2025-09-10T08:31:23.2056754Z               at Layer.handle [as handle_request] (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/layer.js:95:5)
2025-09-10T08:31:23.2057719Z               at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:149:13)
2025-09-10T08:31:23.2058690Z               at queryTrackerMiddleware (/home/runner/work/services/services/services/private-sessions/src/db.ts:132:3)
2025-09-10T08:31:23.2059148Z     }
2025-09-10T08:31:23.2060497Z [90mstdout[2m | tests/integration/api/private-posts.test.ts[2m > [22m[2mPrivate Posts API Tests[2m > [22m[2mGET /xrpc/social.spkeasy.privatePost.getPostThread[2m > [22m[2mshould return internal server error when uri parameter is missing
2025-09-10T08:31:23.2061597Z [22m[39mTypeError: Cannot read properties of undefined (reading 'split')
2025-09-10T08:31:23.2062260Z     at /home/runner/work/services/services/services/private-sessions/src/services/privatePosts.service.ts:647:23
2025-09-10T08:31:23.2062789Z     at Array.map (<anonymous>)
2025-09-10T08:31:23.2063389Z     at canonicalUris (/home/runner/work/services/services/services/private-sessions/src/services/privatePosts.service.ts:646:25)
2025-09-10T08:31:23.2064405Z     at PrivatePostsService.getPostThread (/home/runner/work/services/services/services/private-sessions/src/services/privatePosts.service.ts:355:34)
2025-09-10T08:31:23.2065596Z     at Object.social.spkeasy.privatePost.getPostThread [as handler] (/home/runner/work/services/services/services/private-sessions/src/routes/privatePosts.routes.ts:89:46)
2025-09-10T08:31:23.2066520Z     at /home/runner/work/services/services/packages/service-base/src/server.ts:137:46
2025-09-10T08:31:23.2067386Z     at newFn (/home/runner/work/services/services/node_modules/.pnpm/express-async-errors@3.1.1_express@4.21.2/node_modules/express-async-errors/index.js:16:20)
2025-09-10T08:31:23.2068703Z     at Layer.handle [as handle_request] (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/layer.js:95:5)
2025-09-10T08:31:23.2069659Z     at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:149:13)
2025-09-10T08:31:23.2070580Z     at jsonParser (/home/runner/work/services/services/node_modules/.pnpm/body-parser@1.20.3/node_modules/body-parser/lib/types/json.js:113:7)
2025-09-10T08:31:23.2071205Z 
2025-09-10T08:31:23.2072144Z [90mstdout[2m | tests/integration/api/notifications.test.ts[2m > [22m[2mNotifications API Tests[2m > [22m[2mPOST /xrpc/social.spkeasy.notification.updateSeen[2m > [22m[2mshould require authentication
2025-09-10T08:31:23.2073061Z [22m[39mAuthenticationError: Missing authorization header
2025-09-10T08:31:23.2073649Z     at getBearerToken (/home/runner/work/services/services/packages/common/src/auth/bearer-tokens.ts:58:11)
2025-09-10T08:31:23.2074406Z     at authenticateToken (/home/runner/work/services/services/packages/common/src/auth/bearer-tokens.ts:81:17)
2025-09-10T08:31:23.2075335Z     at newFn (/home/runner/work/services/services/node_modules/.pnpm/express-async-errors@3.1.1_express@4.21.2/node_modules/express-async-errors/index.js:16:20)
2025-09-10T08:31:23.2076401Z     at Layer.handle [as handle_request] (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/layer.js:95:5)
2025-09-10T08:31:23.2077351Z     at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:149:13)
2025-09-10T08:31:23.2078317Z     at prefetchUserFollowing (/home/runner/work/services/services/services/private-sessions/src/server.ts:77:3)
2025-09-10T08:31:23.2079265Z     at newFn (/home/runner/work/services/services/node_modules/.pnpm/express-async-errors@3.1.1_express@4.21.2/node_modules/express-async-errors/index.js:16:20)
2025-09-10T08:31:23.2080322Z     at Layer.handle [as handle_request] (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/layer.js:95:5)
2025-09-10T08:31:23.2081269Z     at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:149:13)
2025-09-10T08:31:23.2082084Z     at queryTrackerMiddleware (/home/runner/work/services/services/services/private-sessions/src/db.ts:132:3)
2025-09-10T08:31:23.2082482Z 
2025-09-10T08:31:23.2084031Z [2025-09-10 08:31:20.013 +0000] ERROR: Unhandled error occurred {"service":"private-sessions","requestId":"unknown","method":"GET","path":"/xrpc/social.spkeasy.privatePost.getPostThread","duration":3,"status":500,"ip":"313d5b13e067911efcc8e257ab3925051bb57a136f2d54f697e1e92ef9997f35","user":"3698761d94b6992d6277d4dc2932712760c796ead51e44dd484d665e3bcd7c08"}
2025-09-10T08:31:23.2085217Z     error: {
2025-09-10T08:31:23.2085396Z       "name": "TypeError",
2025-09-10T08:31:23.2085724Z       "message": "Cannot read properties of undefined (reading 'split')",
2025-09-10T08:31:23.2086035Z       "stack":
2025-09-10T08:31:23.2086342Z           TypeError: Cannot read properties of undefined (reading 'split')
2025-09-10T08:31:23.2086987Z               at /home/runner/work/services/services/services/private-sessions/src/services/privatePosts.service.ts:647:23
2025-09-10T08:31:23.2087520Z               at Array.map (<anonymous>)
2025-09-10T08:31:23.2088259Z               at canonicalUris (/home/runner/work/services/services/services/private-sessions/src/services/privatePosts.service.ts:646:25)
2025-09-10T08:31:23.2089302Z               at PrivatePostsService.getPostThread (/home/runner/work/services/services/services/private-sessions/src/services/privatePosts.service.ts:355:34)
2025-09-10T08:31:23.2090508Z               at Object.social.spkeasy.privatePost.getPostThread [as handler] (/home/runner/work/services/services/services/private-sessions/src/routes/privatePosts.routes.ts:89:46)
2025-09-10T08:31:23.2091416Z               at /home/runner/work/services/services/packages/service-base/src/server.ts:137:46
2025-09-10T08:31:23.2092286Z               at newFn (/home/runner/work/services/services/node_modules/.pnpm/express-async-errors@3.1.1_express@4.21.2/node_modules/express-async-errors/index.js:16:20)
2025-09-10T08:31:23.2093352Z               at Layer.handle [as handle_request] (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/layer.js:95:5)
2025-09-10T08:31:23.2094443Z               at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:149:13)
2025-09-10T08:31:23.2095399Z               at jsonParser (/home/runner/work/services/services/node_modules/.pnpm/body-parser@1.20.3/node_modules/body-parser/lib/types/json.js:113:7)
2025-09-10T08:31:23.2095964Z     }
2025-09-10T08:31:23.2097727Z [2025-09-10 08:31:20.013 +0000] INFO: {"service":"private-sessions","requestId":"unknown","method":"social.spkeasy.reaction.createReaction","path":"/xrpc/social.spkeasy.reaction.createReaction","duration":2,"status":200,"ip":"313d5b13e067911efcc8e257ab3925051bb57a136f2d54f697e1e92ef9997f35","user":"a2e2b3deeb1a32b63ae64d5fb18f43d6f3eee5e55e126a26d54bbc6e1a95528d","dbDuration":0,"dbProfile":"0","authDuration":7}
2025-09-10T08:31:23.2100801Z [2025-09-10 08:31:20.019 +0000] INFO: {"service":"private-sessions","requestId":"unknown","method":"social.spkeasy.reaction.deleteReaction","path":"/xrpc/social.spkeasy.reaction.deleteReaction","duration":2,"status":200,"ip":"313d5b13e067911efcc8e257ab3925051bb57a136f2d54f697e1e92ef9997f35","user":"a2e2b3deeb1a32b63ae64d5fb18f43d6f3eee5e55e126a26d54bbc6e1a95528d","dbDuration":0,"dbProfile":"0","authDuration":0}
2025-09-10T08:31:23.2103788Z [2025-09-10 08:31:19.995 +0000] INFO: {"service":"private-sessions","requestId":"unknown","method":"social.spkeasy.notification.updateSeen","path":"/xrpc/social.spkeasy.notification.updateSeen","duration":5,"status":200,"ip":"313d5b13e067911efcc8e257ab3925051bb57a136f2d54f697e1e92ef9997f35","user":"a2e2b3deeb1a32b63ae64d5fb18f43d6f3eee5e55e126a26d54bbc6e1a95528d","dbDuration":0,"dbProfile":"0,0,0","authDuration":11}
2025-09-10T08:31:23.2106589Z [2025-09-10 08:31:20.013 +0000] ERROR: AuthenticationError occurred {"service":"private-sessions","requestId":"unknown","method":"POST","path":"/xrpc/social.spkeasy.notification.updateSeen","duration":null,"status":401,"ip":"313d5b13e067911efcc8e257ab3925051bb57a136f2d54f697e1e92ef9997f35","relevantLine":"/services/services/packages/common/src/auth/bearer-tokens.ts:58:11"}
2025-09-10T08:31:23.2107849Z     error: {
2025-09-10T08:31:23.2108142Z       "name": "AuthenticationError",
2025-09-10T08:31:23.2108430Z       "message": "Missing authorization header",
2025-09-10T08:31:23.2108691Z       "statusCode": 401,
2025-09-10T08:31:23.2108881Z       "stack":
2025-09-10T08:31:23.2109252Z           AuthenticationError: Missing authorization header
2025-09-10T08:31:23.2109844Z               at getBearerToken (/home/runner/work/services/services/packages/common/src/auth/bearer-tokens.ts:58:11)
2025-09-10T08:31:23.2110638Z               at authenticateToken (/home/runner/work/services/services/packages/common/src/auth/bearer-tokens.ts:81:17)
2025-09-10T08:31:23.2111595Z               at newFn (/home/runner/work/services/services/node_modules/.pnpm/express-async-errors@3.1.1_express@4.21.2/node_modules/express-async-errors/index.js:16:20)
2025-09-10T08:31:23.2112682Z               at Layer.handle [as handle_request] (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/layer.js:95:5)
2025-09-10T08:31:23.2113637Z               at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:149:13)
2025-09-10T08:31:23.2114478Z               at prefetchUserFollowing (/home/runner/work/services/services/services/private-sessions/src/server.ts:77:3)
2025-09-10T08:31:23.2115439Z               at newFn (/home/runner/work/services/services/node_modules/.pnpm/express-async-errors@3.1.1_express@4.21.2/node_modules/express-async-errors/index.js:16:20)
2025-09-10T08:31:23.2116514Z               at Layer.handle [as handle_request] (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/layer.js:95:5)
2025-09-10T08:31:23.2117470Z               at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:149:13)
2025-09-10T08:31:23.2118510Z               at queryTrackerMiddleware (/home/runner/work/services/services/services/private-sessions/src/db.ts:132:3)
2025-09-10T08:31:23.2118980Z     }
2025-09-10T08:31:23.2120005Z [90mstdout[2m | tests/integration/api/notifications.test.ts[2m > [22m[2mNotifications API Tests[2m > [22m[2mPOST /xrpc/social.spkeasy.notification.updateSeen[2m > [22m[2mshould require seenAt parameter
2025-09-10T08:31:23.2120958Z [22m[39mValidationError: Validation failed: seenAt: Required
2025-09-10T08:31:23.2121646Z     at validateAgainstLexicon (/home/runner/work/services/services/packages/common/src/lexicon/lexicon-validation.ts:134:13)
2025-09-10T08:31:23.2122727Z     at Object.social.spkeasy.notification.updateSeen [as handler] (/home/runner/work/services/services/services/private-sessions/src/routes/notification.routes.ts:68:5)
2025-09-10T08:31:23.2123603Z     at /home/runner/work/services/services/packages/service-base/src/server.ts:137:46
2025-09-10T08:31:23.2124462Z     at newFn (/home/runner/work/services/services/node_modules/.pnpm/express-async-errors@3.1.1_express@4.21.2/node_modules/express-async-errors/index.js:16:20)
2025-09-10T08:31:23.2125528Z     at Layer.handle [as handle_request] (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/layer.js:95:5)
2025-09-10T08:31:23.2126482Z     at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:149:13)
2025-09-10T08:31:23.2127339Z     at /home/runner/work/services/services/node_modules/.pnpm/body-parser@1.20.3/node_modules/body-parser/lib/read.js:137:5
2025-09-10T08:31:23.2128049Z     at AsyncResource.runInAsyncScope (node:async_hooks:211:14)
2025-09-10T08:31:23.2128719Z     at invokeCallback (/home/runner/work/services/services/node_modules/.pnpm/raw-body@2.5.2/node_modules/raw-body/index.js:238:16)
2025-09-10T08:31:23.2129574Z     at done (/home/runner/work/services/services/node_modules/.pnpm/raw-body@2.5.2/node_modules/raw-body/index.js:227:7)
2025-09-10T08:31:23.2129994Z 
2025-09-10T08:31:23.2130806Z  [32mâœ“[39m tests/integration/api/reactions.test.ts[2m > [22mReactions API Tests[2m > [22mPOST /xrpc/social.spkeasy.reaction.deleteReaction[2m > [22mshould validate uri format[32m 23[2mms[22m[39m
2025-09-10T08:31:23.2132321Z  [32mâœ“[39m tests/integration/api/reactions.test.ts[2m > [22mReactions API Tests[2m > [22mReaction Integration Tests[2m > [22mshould create and delete reaction in sequence[32m 27[2mms[22m[39m
2025-09-10T08:31:23.2133721Z  [31mÃ—[39m tests/integration/api/reactions.test.ts[2m > [22mReactions API Tests[2m > [22mReaction Integration Tests[2m > [22mshould handle multiple reactions from different users[32m 7[2mms[22m[39m
2025-09-10T08:31:23.2134443Z [31m   â†’ 
2025-09-10T08:31:23.2134716Z Invalid `prisma.session.deleteMany()` invocation in
2025-09-10T08:31:23.2135377Z /home/runner/work/services/services/services/private-sessions/tests/integration/api/reactions.test.ts:53:26
2025-09-10T08:31:23.2135814Z 
2025-09-10T08:31:23.2135956Z   50 await prisma.notification.deleteMany();
2025-09-10T08:31:23.2136287Z   51 await prisma.encryptedPost.deleteMany();
2025-09-10T08:31:23.2136598Z   52 await prisma.sessionKey.deleteMany();
2025-09-10T08:31:23.2136945Z â†’ 53 await prisma.session.deleteMany(
2025-09-10T08:31:23.2137502Z Foreign key constraint violated on the constraint: `encrypted_posts_sessionId_fkey`[39m
2025-09-10T08:31:23.2138222Z [2025-09-10 08:31:20.032 +0000] INFO: Shutting down server... {"service":"private-sessions"}
2025-09-10T08:31:23.2140361Z [2025-09-10 08:31:20.036 +0000] ERROR: ValidationError occurred {"service":"private-sessions","requestId":"unknown","method":"POST","path":"/xrpc/social.spkeasy.notification.updateSeen","duration":6,"status":400,"ip":"313d5b13e067911efcc8e257ab3925051bb57a136f2d54f697e1e92ef9997f35","user":"a2e2b3deeb1a32b63ae64d5fb18f43d6f3eee5e55e126a26d54bbc6e1a95528d","relevantLine":"/services/services/packages/common/src/lexicon/lexicon-validation.ts:134:13"}
2025-09-10T08:31:23.2142013Z     error: {
2025-09-10T08:31:23.2142220Z       "name": "ValidationError",
2025-09-10T08:31:23.2142509Z       "message": "Validation failed: seenAt: Required",
2025-09-10T08:31:23.2142783Z       "statusCode": 400,
2025-09-10T08:31:23.2142968Z       "stack":
2025-09-10T08:31:23.2143236Z           ValidationError: Validation failed: seenAt: Required
2025-09-10T08:31:23.2143908Z               at validateAgainstLexicon (/home/runner/work/services/services/packages/common/src/lexicon/lexicon-validation.ts:134:13)
2025-09-10T08:31:23.2145032Z               at Object.social.spkeasy.notification.updateSeen [as handler] (/home/runner/work/services/services/services/private-sessions/src/routes/notification.routes.ts:68:5)
2025-09-10T08:31:23.2145921Z               at /home/runner/work/services/services/packages/service-base/src/server.ts:137:46
2025-09-10T08:31:23.2146796Z               at newFn (/home/runner/work/services/services/node_modules/.pnpm/express-async-errors@3.1.1_express@4.21.2/node_modules/express-async-errors/index.js:16:20)
2025-09-10T08:31:23.2147881Z               at Layer.handle [as handle_request] (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/layer.js:95:5)
2025-09-10T08:31:23.2148951Z               at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:149:13)
2025-09-10T08:31:23.2149823Z               at /home/runner/work/services/services/node_modules/.pnpm/body-parser@1.20.3/node_modules/body-parser/lib/read.js:137:5
2025-09-10T08:31:23.2150457Z               at AsyncResource.runInAsyncScope (node:async_hooks:211:14)
2025-09-10T08:31:23.2151141Z               at invokeCallback (/home/runner/work/services/services/node_modules/.pnpm/raw-body@2.5.2/node_modules/raw-body/index.js:238:16)
2025-09-10T08:31:23.2151991Z               at done (/home/runner/work/services/services/node_modules/.pnpm/raw-body@2.5.2/node_modules/raw-body/index.js:227:7)
2025-09-10T08:31:23.2152485Z     }
2025-09-10T08:31:23.2152885Z [2025-09-10 08:31:20.042 +0000] INFO: Shutting down server... {"service":"private-sessions"}
2025-09-10T08:31:23.2154304Z  [31mÃ—[39m tests/integration/api/notifications.test.ts[2m > [22mNotifications API Tests[2m > [22mPOST /xrpc/social.spkeasy.notification.updateSeen[2m > [22mshould only update notifications created before seenAt timestamp[32m 41[2mms[22m[39m
2025-09-10T08:31:23.2155309Z [31m   â†’ expected undefined to be null[39m
2025-09-10T08:31:23.2156337Z  [32mâœ“[39m tests/integration/api/notifications.test.ts[2m > [22mNotifications API Tests[2m > [22mPOST /xrpc/social.spkeasy.notification.updateSeen[2m > [22mshould require authentication[32m 10[2mms[22m[39m
2025-09-10T08:31:23.2157879Z  [32mâœ“[39m tests/integration/api/notifications.test.ts[2m > [22mNotifications API Tests[2m > [22mPOST /xrpc/social.spkeasy.notification.updateSeen[2m > [22mshould require seenAt parameter[32m 23[2mms[22m[39m
2025-09-10T08:31:23.2158983Z [2025-09-10 08:31:20.047 +0000] INFO: Shutting down server... {"service":"private-sessions"}
2025-09-10T08:31:23.2159562Z [2025-09-10 08:31:20.050 +0000] INFO: Shutting down server... {"service":"private-sessions"}
2025-09-10T08:31:23.2160844Z [90mstdout[2m | tests/integration/api/private-posts.test.ts[2m > [22m[2mPrivate Posts API Tests[2m > [22m[2mPOST /xrpc/social.spkeasy.privatePost.deletePost[2m > [22m[2mshould require authentication
2025-09-10T08:31:23.2161739Z [22m[39mAuthenticationError: Missing authorization header
2025-09-10T08:31:23.2162334Z     at getBearerToken (/home/runner/work/services/services/packages/common/src/auth/bearer-tokens.ts:58:11)
2025-09-10T08:31:23.2163101Z     at authenticateToken (/home/runner/work/services/services/packages/common/src/auth/bearer-tokens.ts:81:17)
2025-09-10T08:31:23.2164048Z     at newFn (/home/runner/work/services/services/node_modules/.pnpm/express-async-errors@3.1.1_express@4.21.2/node_modules/express-async-errors/index.js:16:20)
2025-09-10T08:31:23.2165246Z     at Layer.handle [as handle_request] (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/layer.js:95:5)
2025-09-10T08:31:23.2166197Z     at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:149:13)
2025-09-10T08:31:23.2167027Z     at prefetchUserFollowing (/home/runner/work/services/services/services/private-sessions/src/server.ts:77:3)
2025-09-10T08:31:23.2168072Z     at newFn (/home/runner/work/services/services/node_modules/.pnpm/express-async-errors@3.1.1_express@4.21.2/node_modules/express-async-errors/index.js:16:20)
2025-09-10T08:31:23.2169134Z     at Layer.handle [as handle_request] (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/layer.js:95:5)
2025-09-10T08:31:23.2170084Z     at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:149:13)
2025-09-10T08:31:23.2170911Z     at queryTrackerMiddleware (/home/runner/work/services/services/services/private-sessions/src/db.ts:132:3)
2025-09-10T08:31:23.2171312Z 
2025-09-10T08:31:23.2172221Z [90mstdout[2m | tests/integration/api/private-posts.test.ts[2m > [22m[2mPrivate Posts API Tests[2m > [22m[2mPOST /xrpc/social.spkeasy.privatePost.deletePost[2m > [22m[2mshould require uri parameter
2025-09-10T08:31:23.2173122Z [22m[39mValidationError: Validation failed: uri: Required
2025-09-10T08:31:23.2173789Z     at validateAgainstLexicon (/home/runner/work/services/services/packages/common/src/lexicon/lexicon-validation.ts:134:13)
2025-09-10T08:31:23.2174859Z     at Object.social.spkeasy.privatePost.deletePost [as handler] (/home/runner/work/services/services/services/private-sessions/src/routes/privatePosts.routes.ts:161:27)
2025-09-10T08:31:23.2175740Z     at /home/runner/work/services/services/packages/service-base/src/server.ts:137:46
2025-09-10T08:31:23.2176598Z     at newFn (/home/runner/work/services/services/node_modules/.pnpm/express-async-errors@3.1.1_express@4.21.2/node_modules/express-async-errors/index.js:16:20)
2025-09-10T08:31:23.2177661Z     at Layer.handle [as handle_request] (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/layer.js:95:5)
2025-09-10T08:31:23.2178817Z     at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:149:13)
2025-09-10T08:31:23.2179682Z     at /home/runner/work/services/services/node_modules/.pnpm/body-parser@1.20.3/node_modules/body-parser/lib/read.js:137:5
2025-09-10T08:31:23.2180308Z     at AsyncResource.runInAsyncScope (node:async_hooks:211:14)
2025-09-10T08:31:23.2180972Z     at invokeCallback (/home/runner/work/services/services/node_modules/.pnpm/raw-body@2.5.2/node_modules/raw-body/index.js:238:16)
2025-09-10T08:31:23.2181821Z     at done (/home/runner/work/services/services/node_modules/.pnpm/raw-body@2.5.2/node_modules/raw-body/index.js:227:7)
2025-09-10T08:31:23.2182245Z 
2025-09-10T08:31:23.2183148Z  [31mÃ—[39m tests/integration/api/private-posts.test.ts[2m > [22mPrivate Posts API Tests[2m > [22mGET /xrpc/social.spkeasy.privatePost.getPostThread[2m > [22mshould retrieve post thread with replies[32m 43[2mms[22m[39m
2025-09-10T08:31:23.2184092Z [31m   â†’ expected 200 "OK", got 404 "Not Found"[39m
2025-09-10T08:31:23.2185122Z  [32mâœ“[39m tests/integration/api/private-posts.test.ts[2m > [22mPrivate Posts API Tests[2m > [22mGET /xrpc/social.spkeasy.privatePost.getPostThread[2m > [22mshould require authentication[32m 11[2mms[22m[39m
2025-09-10T08:31:23.2186788Z  [32mâœ“[39m tests/integration/api/private-posts.test.ts[2m > [22mPrivate Posts API Tests[2m > [22mGET /xrpc/social.spkeasy.privatePost.getPostThread[2m > [22mshould return internal server error when uri parameter is missing[32m 24[2mms[22m[39m
2025-09-10T08:31:23.2188642Z  [32mâœ“[39m tests/integration/api/private-posts.test.ts[2m > [22mPrivate Posts API Tests[2m > [22mPOST /xrpc/social.spkeasy.privatePost.deletePost[2m > [22mshould delete an existing post[32m 40[2mms[22m[39m
2025-09-10T08:31:23.2190156Z  [32mâœ“[39m tests/integration/api/private-posts.test.ts[2m > [22mPrivate Posts API Tests[2m > [22mPOST /xrpc/social.spkeasy.privatePost.deletePost[2m > [22mshould require authentication[32m 7[2mms[22m[39m
2025-09-10T08:31:23.2191647Z  [32mâœ“[39m tests/integration/api/private-posts.test.ts[2m > [22mPrivate Posts API Tests[2m > [22mPOST /xrpc/social.spkeasy.privatePost.deletePost[2m > [22mshould require uri parameter[32m 17[2mms[22m[39m
2025-09-10T08:31:23.2194004Z [2025-09-10 08:31:20.053 +0000] INFO: {"service":"private-sessions","requestId":"unknown","method":"social.spkeasy.privatePost.deletePost","path":"/xrpc/social.spkeasy.privatePost.deletePost","duration":14,"status":200,"ip":"313d5b13e067911efcc8e257ab3925051bb57a136f2d54f697e1e92ef9997f35","user":"3698761d94b6992d6277d4dc2932712760c796ead51e44dd484d665e3bcd7c08","dbDuration":5,"dbProfile":"2,2,0,1,0,0,0","authDuration":12}
2025-09-10T08:31:23.2196823Z [2025-09-10 08:31:20.062 +0000] ERROR: AuthenticationError occurred {"service":"private-sessions","requestId":"unknown","method":"POST","path":"/xrpc/social.spkeasy.privatePost.deletePost","duration":null,"status":401,"ip":"313d5b13e067911efcc8e257ab3925051bb57a136f2d54f697e1e92ef9997f35","relevantLine":"/services/services/packages/common/src/auth/bearer-tokens.ts:58:11"}
2025-09-10T08:31:23.2198173Z     error: {
2025-09-10T08:31:23.2198391Z       "name": "AuthenticationError",
2025-09-10T08:31:23.2198677Z       "message": "Missing authorization header",
2025-09-10T08:31:23.2198938Z       "statusCode": 401,
2025-09-10T08:31:23.2199130Z       "stack":
2025-09-10T08:31:23.2199385Z           AuthenticationError: Missing authorization header
2025-09-10T08:31:23.2199977Z               at getBearerToken (/home/runner/work/services/services/packages/common/src/auth/bearer-tokens.ts:58:11)
2025-09-10T08:31:23.2200771Z               at authenticateToken (/home/runner/work/services/services/packages/common/src/auth/bearer-tokens.ts:81:17)
2025-09-10T08:31:23.2201725Z               at newFn (/home/runner/work/services/services/node_modules/.pnpm/express-async-errors@3.1.1_express@4.21.2/node_modules/express-async-errors/index.js:16:20)
2025-09-10T08:31:23.2202921Z               at Layer.handle [as handle_request] (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/layer.js:95:5)
2025-09-10T08:31:23.2203893Z               at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:149:13)
2025-09-10T08:31:23.2204737Z               at prefetchUserFollowing (/home/runner/work/services/services/services/private-sessions/src/server.ts:77:3)
2025-09-10T08:31:23.2205698Z               at newFn (/home/runner/work/services/services/node_modules/.pnpm/express-async-errors@3.1.1_express@4.21.2/node_modules/express-async-errors/index.js:16:20)
2025-09-10T08:31:23.2206777Z               at Layer.handle [as handle_request] (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/layer.js:95:5)
2025-09-10T08:31:23.2207743Z               at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:149:13)
2025-09-10T08:31:23.2208672Z               at queryTrackerMiddleware (/home/runner/work/services/services/services/private-sessions/src/db.ts:132:3)
2025-09-10T08:31:23.2209144Z     }
2025-09-10T08:31:23.2211051Z [2025-09-10 08:31:20.079 +0000] ERROR: ValidationError occurred {"service":"private-sessions","requestId":"unknown","method":"POST","path":"/xrpc/social.spkeasy.privatePost.deletePost","duration":3,"status":400,"ip":"313d5b13e067911efcc8e257ab3925051bb57a136f2d54f697e1e92ef9997f35","user":"3698761d94b6992d6277d4dc2932712760c796ead51e44dd484d665e3bcd7c08","relevantLine":"/services/services/packages/common/src/lexicon/lexicon-validation.ts:134:13"}
2025-09-10T08:31:23.2212670Z     error: {
2025-09-10T08:31:23.2212867Z       "name": "ValidationError",
2025-09-10T08:31:23.2213149Z       "message": "Validation failed: uri: Required",
2025-09-10T08:31:23.2213416Z       "statusCode": 400,
2025-09-10T08:31:23.2213597Z       "stack":
2025-09-10T08:31:23.2213852Z           ValidationError: Validation failed: uri: Required
2025-09-10T08:31:23.2214505Z               at validateAgainstLexicon (/home/runner/work/services/services/packages/common/src/lexicon/lexicon-validation.ts:134:13)
2025-09-10T08:31:23.2215598Z               at Object.social.spkeasy.privatePost.deletePost [as handler] (/home/runner/work/services/services/services/private-sessions/src/routes/privatePosts.routes.ts:161:27)
2025-09-10T08:31:23.2216491Z               at /home/runner/work/services/services/packages/service-base/src/server.ts:137:46
2025-09-10T08:31:23.2217363Z               at newFn (/home/runner/work/services/services/node_modules/.pnpm/express-async-errors@3.1.1_express@4.21.2/node_modules/express-async-errors/index.js:16:20)
2025-09-10T08:31:23.2218539Z               at Layer.handle [as handle_request] (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/layer.js:95:5)
2025-09-10T08:31:23.2219507Z               at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:149:13)
2025-09-10T08:31:23.2220380Z               at /home/runner/work/services/services/node_modules/.pnpm/body-parser@1.20.3/node_modules/body-parser/lib/read.js:137:5
2025-09-10T08:31:23.2221014Z               at AsyncResource.runInAsyncScope (node:async_hooks:211:14)
2025-09-10T08:31:23.2221689Z               at invokeCallback (/home/runner/work/services/services/node_modules/.pnpm/raw-body@2.5.2/node_modules/raw-body/index.js:238:16)
2025-09-10T08:31:23.2222541Z               at done (/home/runner/work/services/services/node_modules/.pnpm/raw-body@2.5.2/node_modules/raw-body/index.js:227:7)
2025-09-10T08:31:23.2223029Z     }
2025-09-10T08:31:23.2224768Z [2025-09-10 08:31:20.099 +0000] INFO: {"service":"private-sessions","requestId":"unknown","method":"social.spkeasy.privatePost.preAuth","path":"/xrpc/social.spkeasy.privatePost.preAuth","duration":1,"status":200,"ip":"313d5b13e067911efcc8e257ab3925051bb57a136f2d54f697e1e92ef9997f35","user":"3698761d94b6992d6277d4dc2932712760c796ead51e44dd484d665e3bcd7c08","dbDuration":0,"authDuration":7}
2025-09-10T08:31:23.2226898Z [90mstdout[2m | tests/integration/api/private-posts.test.ts[2m > [22m[2mPrivate Posts API Tests[2m > [22m[2mPOST /xrpc/social.spkeasy.privatePost.preAuth[2m > [22m[2mshould require authentication
2025-09-10T08:31:23.2227795Z [22m[39mAuthenticationError: Missing authorization header
2025-09-10T08:31:23.2228496Z     at getBearerToken (/home/runner/work/services/services/packages/common/src/auth/bearer-tokens.ts:58:11)
2025-09-10T08:31:23.2229272Z     at authenticateToken (/home/runner/work/services/services/packages/common/src/auth/bearer-tokens.ts:81:17)
2025-09-10T08:31:23.2230218Z     at newFn (/home/runner/work/services/services/node_modules/.pnpm/express-async-errors@3.1.1_express@4.21.2/node_modules/express-async-errors/index.js:16:20)
2025-09-10T08:31:23.2231303Z     at Layer.handle [as handle_request] (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/layer.js:95:5)
2025-09-10T08:31:23.2232248Z     at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:149:13)
2025-09-10T08:31:23.2233076Z     at prefetchUserFollowing (/home/runner/work/services/services/services/private-sessions/src/server.ts:77:3)
2025-09-10T08:31:23.2234030Z     at newFn (/home/runner/work/services/services/node_modules/.pnpm/express-async-errors@3.1.1_express@4.21.2/node_modules/express-async-errors/index.js:16:20)
2025-09-10T08:31:23.2235208Z     at Layer.handle [as handle_request] (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/layer.js:95:5)
2025-09-10T08:31:23.2236151Z     at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:149:13)
2025-09-10T08:31:23.2236965Z     at queryTrackerMiddleware (/home/runner/work/services/services/services/private-sessions/src/db.ts:132:3)
2025-09-10T08:31:23.2237368Z 
2025-09-10T08:31:23.2238940Z [2025-09-10 08:31:20.105 +0000] ERROR: AuthenticationError occurred {"service":"private-sessions","requestId":"unknown","method":"POST","path":"/xrpc/social.spkeasy.privatePost.preAuth","duration":null,"status":401,"ip":"313d5b13e067911efcc8e257ab3925051bb57a136f2d54f697e1e92ef9997f35","relevantLine":"/services/services/packages/common/src/auth/bearer-tokens.ts:58:11"}
2025-09-10T08:31:23.2240182Z     error: {
2025-09-10T08:31:23.2240386Z       "name": "AuthenticationError",
2025-09-10T08:31:23.2240679Z       "message": "Missing authorization header",
2025-09-10T08:31:23.2240937Z       "statusCode": 401,
2025-09-10T08:31:23.2241135Z       "stack":
2025-09-10T08:31:23.2241392Z           AuthenticationError: Missing authorization header
2025-09-10T08:31:23.2241968Z               at getBearerToken (/home/runner/work/services/services/packages/common/src/auth/bearer-tokens.ts:58:11)
2025-09-10T08:31:23.2242755Z               at authenticateToken (/home/runner/work/services/services/packages/common/src/auth/bearer-tokens.ts:81:17)
2025-09-10T08:31:23.2243716Z               at newFn (/home/runner/work/services/services/node_modules/.pnpm/express-async-errors@3.1.1_express@4.21.2/node_modules/express-async-errors/index.js:16:20)
2025-09-10T08:31:23.2244828Z               at Layer.handle [as handle_request] (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/layer.js:95:5)
2025-09-10T08:31:23.2245786Z               at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:149:13)
2025-09-10T08:31:23.2246632Z               at prefetchUserFollowing (/home/runner/work/services/services/services/private-sessions/src/server.ts:77:3)
2025-09-10T08:31:23.2247596Z               at newFn (/home/runner/work/services/services/node_modules/.pnpm/express-async-errors@3.1.1_express@4.21.2/node_modules/express-async-errors/index.js:16:20)
2025-09-10T08:31:23.2248882Z               at Layer.handle [as handle_request] (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/layer.js:95:5)
2025-09-10T08:31:23.2249842Z               at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:149:13)
2025-09-10T08:31:23.2250668Z               at queryTrackerMiddleware (/home/runner/work/services/services/services/private-sessions/src/db.ts:132:3)
2025-09-10T08:31:23.2251131Z     }
2025-09-10T08:31:23.2252107Z  [32mâœ“[39m tests/integration/api/private-posts.test.ts[2m > [22mPrivate Posts API Tests[2m > [22mPOST /xrpc/social.spkeasy.privatePost.preAuth[2m > [22mshould return success for pre-auth endpoint[32m 20[2mms[22m[39m
2025-09-10T08:31:23.2253620Z  [32mâœ“[39m tests/integration/api/private-posts.test.ts[2m > [22mPrivate Posts API Tests[2m > [22mPOST /xrpc/social.spkeasy.privatePost.preAuth[2m > [22mshould require authentication[32m 7[2mms[22m[39m
2025-09-10T08:31:23.2254590Z [2025-09-10 08:31:20.108 +0000] INFO: Shutting down server... {"service":"private-sessions"}
2025-09-10T08:31:23.2255170Z [2025-09-10 08:31:20.114 +0000] INFO: Shutting down server... {"service":"private-sessions"}
2025-09-10T08:31:23.2256404Z [90mstdout[2m | tests/integration/api/session.test.ts[2m > [22m[2mPrivate Session API Tests[2m > [22m[2mPOST /xrpc/social.spkeasy.privateSession.create[2m > [22m[2mshould create a new private session successfully
2025-09-10T08:31:23.2257565Z [22m[39mValidationError: Session author must be among recipients or they won't be able to read their own posts!
2025-09-10T08:31:23.2258669Z     at SessionService.createSession (/home/runner/work/services/services/services/private-sessions/src/services/session.service.ts:43:13)
2025-09-10T08:31:23.2259756Z     at Object.social.spkeasy.privateSession.create [as handler] (/home/runner/work/services/services/services/private-sessions/src/routes/session.routes.ts:41:41)
2025-09-10T08:31:23.2260610Z     at /home/runner/work/services/services/packages/service-base/src/server.ts:137:46
2025-09-10T08:31:23.2261461Z     at newFn (/home/runner/work/services/services/node_modules/.pnpm/express-async-errors@3.1.1_express@4.21.2/node_modules/express-async-errors/index.js:16:20)
2025-09-10T08:31:23.2262525Z     at Layer.handle [as handle_request] (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/layer.js:95:5)
2025-09-10T08:31:23.2263469Z     at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:149:13)
2025-09-10T08:31:23.2264322Z     at /home/runner/work/services/services/node_modules/.pnpm/body-parser@1.20.3/node_modules/body-parser/lib/read.js:137:5
2025-09-10T08:31:23.2264935Z     at AsyncResource.runInAsyncScope (node:async_hooks:211:14)
2025-09-10T08:31:23.2265593Z     at invokeCallback (/home/runner/work/services/services/node_modules/.pnpm/raw-body@2.5.2/node_modules/raw-body/index.js:238:16)
2025-09-10T08:31:23.2266436Z     at done (/home/runner/work/services/services/node_modules/.pnpm/raw-body@2.5.2/node_modules/raw-body/index.js:227:7)
2025-09-10T08:31:23.2266849Z 
2025-09-10T08:31:23.2267799Z [90mstdout[2m | tests/integration/api/session.test.ts[2m > [22m[2mPrivate Session API Tests[2m > [22m[2mPOST /xrpc/social.spkeasy.privateSession.create[2m > [22m[2mshould create session with multiple recipients
2025-09-10T08:31:23.2269051Z [22m[39mValidationError: Session author must be among recipients or they won't be able to read their own posts!
2025-09-10T08:31:23.2269916Z     at SessionService.createSession (/home/runner/work/services/services/services/private-sessions/src/services/session.service.ts:43:13)
2025-09-10T08:31:23.2271005Z     at Object.social.spkeasy.privateSession.create [as handler] (/home/runner/work/services/services/services/private-sessions/src/routes/session.routes.ts:41:41)
2025-09-10T08:31:23.2272024Z     at /home/runner/work/services/services/packages/service-base/src/server.ts:137:46
2025-09-10T08:31:23.2272881Z     at newFn (/home/runner/work/services/services/node_modules/.pnpm/express-async-errors@3.1.1_express@4.21.2/node_modules/express-async-errors/index.js:16:20)
2025-09-10T08:31:23.2273944Z     at Layer.handle [as handle_request] (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/layer.js:95:5)
2025-09-10T08:31:23.2274890Z     at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:149:13)
2025-09-10T08:31:23.2275749Z     at /home/runner/work/services/services/node_modules/.pnpm/body-parser@1.20.3/node_modules/body-parser/lib/read.js:137:5
2025-09-10T08:31:23.2276361Z     at AsyncResource.runInAsyncScope (node:async_hooks:211:14)
2025-09-10T08:31:23.2277018Z     at invokeCallback (/home/runner/work/services/services/node_modules/.pnpm/raw-body@2.5.2/node_modules/raw-body/index.js:238:16)
2025-09-10T08:31:23.2277867Z     at done (/home/runner/work/services/services/node_modules/.pnpm/raw-body@2.5.2/node_modules/raw-body/index.js:227:7)
2025-09-10T08:31:23.2278385Z 
2025-09-10T08:31:23.2278888Z [2025-09-10 08:31:21.765 +0000] INFO: ðŸš€ private-sessions service running on port 0 {"service":"private-sessions"}
2025-09-10T08:31:23.2281080Z [2025-09-10 08:31:21.804 +0000] ERROR: ValidationError occurred {"service":"private-sessions","requestId":"unknown","method":"POST","path":"/xrpc/social.spkeasy.privateSession.create","duration":4,"status":400,"ip":"313d5b13e067911efcc8e257ab3925051bb57a136f2d54f697e1e92ef9997f35","user":"3698761d94b6992d6277d4dc2932712760c796ead51e44dd484d665e3bcd7c08","relevantLine":"/services/services/services/private-sessions/src/services/session.service.ts:43:13"}
2025-09-10T08:31:23.2282718Z     error: {
2025-09-10T08:31:23.2282919Z       "name": "ValidationError",
2025-09-10T08:31:23.2283374Z       "message": "Session author must be among recipients or they won't be able to read their own posts!",
2025-09-10T08:31:23.2283791Z       "statusCode": 400,
2025-09-10T08:31:23.2283983Z       "stack":
2025-09-10T08:31:23.2284412Z           ValidationError: Session author must be among recipients or they won't be able to read their own posts!
2025-09-10T08:31:23.2285275Z               at SessionService.createSession (/home/runner/work/services/services/services/private-sessions/src/services/session.service.ts:43:13)
2025-09-10T08:31:23.2286369Z               at Object.social.spkeasy.privateSession.create [as handler] (/home/runner/work/services/services/services/private-sessions/src/routes/session.routes.ts:41:41)
2025-09-10T08:31:23.2287235Z               at /home/runner/work/services/services/packages/service-base/src/server.ts:137:46
2025-09-10T08:31:23.2288201Z               at newFn (/home/runner/work/services/services/node_modules/.pnpm/express-async-errors@3.1.1_express@4.21.2/node_modules/express-async-errors/index.js:16:20)
2025-09-10T08:31:23.2289285Z               at Layer.handle [as handle_request] (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/layer.js:95:5)
2025-09-10T08:31:23.2290245Z               at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:149:13)
2025-09-10T08:31:23.2291114Z               at /home/runner/work/services/services/node_modules/.pnpm/body-parser@1.20.3/node_modules/body-parser/lib/read.js:137:5
2025-09-10T08:31:23.2291737Z               at AsyncResource.runInAsyncScope (node:async_hooks:211:14)
2025-09-10T08:31:23.2292422Z               at invokeCallback (/home/runner/work/services/services/node_modules/.pnpm/raw-body@2.5.2/node_modules/raw-body/index.js:238:16)
2025-09-10T08:31:23.2293272Z               at done (/home/runner/work/services/services/node_modules/.pnpm/raw-body@2.5.2/node_modules/raw-body/index.js:227:7)
2025-09-10T08:31:23.2293742Z     }
2025-09-10T08:31:23.2295773Z [2025-09-10 08:31:21.820 +0000] ERROR: ValidationError occurred {"service":"private-sessions","requestId":"unknown","method":"POST","path":"/xrpc/social.spkeasy.privateSession.create","duration":0,"status":400,"ip":"313d5b13e067911efcc8e257ab3925051bb57a136f2d54f697e1e92ef9997f35","user":"3698761d94b6992d6277d4dc2932712760c796ead51e44dd484d665e3bcd7c08","relevantLine":"/services/services/services/private-sessions/src/services/session.service.ts:43:13"}
2025-09-10T08:31:23.2297304Z     error: {
2025-09-10T08:31:23.2297502Z       "name": "ValidationError",
2025-09-10T08:31:23.2298046Z       "message": "Session author must be among recipients or they won't be able to read their own posts!",
2025-09-10T08:31:23.2298467Z       "statusCode": 400,
2025-09-10T08:31:23.2298657Z       "stack":
2025-09-10T08:31:23.2299078Z           ValidationError: Session author must be among recipients or they won't be able to read their own posts!
2025-09-10T08:31:23.2299940Z               at SessionService.createSession (/home/runner/work/services/services/services/private-sessions/src/services/session.service.ts:43:13)
2025-09-10T08:31:23.2301050Z               at Object.social.spkeasy.privateSession.create [as handler] (/home/runner/work/services/services/services/private-sessions/src/routes/session.routes.ts:41:41)
2025-09-10T08:31:23.2301901Z               at /home/runner/work/services/services/packages/service-base/src/server.ts:137:46
2025-09-10T08:31:23.2302765Z               at newFn (/home/runner/work/services/services/node_modules/.pnpm/express-async-errors@3.1.1_express@4.21.2/node_modules/express-async-errors/index.js:16:20)
2025-09-10T08:31:23.2303841Z               at Layer.handle [as handle_request] (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/layer.js:95:5)
2025-09-10T08:31:23.2304917Z               at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:149:13)
2025-09-10T08:31:23.2305780Z               at /home/runner/work/services/services/node_modules/.pnpm/body-parser@1.20.3/node_modules/body-parser/lib/read.js:137:5
2025-09-10T08:31:23.2306407Z               at AsyncResource.runInAsyncScope (node:async_hooks:211:14)
2025-09-10T08:31:23.2307091Z               at invokeCallback (/home/runner/work/services/services/node_modules/.pnpm/raw-body@2.5.2/node_modules/raw-body/index.js:238:16)
2025-09-10T08:31:23.2308031Z               at done (/home/runner/work/services/services/node_modules/.pnpm/raw-body@2.5.2/node_modules/raw-body/index.js:227:7)
2025-09-10T08:31:23.2308512Z     }
2025-09-10T08:31:23.2309480Z [90mstdout[2m | tests/integration/api/session.test.ts[2m > [22m[2mPrivate Session API Tests[2m > [22m[2mPOST /xrpc/social.spkeasy.privateSession.create[2m > [22m[2mshould require authentication
2025-09-10T08:31:23.2310362Z [22m[39mAuthenticationError: Missing authorization header
2025-09-10T08:31:23.2310960Z     at getBearerToken (/home/runner/work/services/services/packages/common/src/auth/bearer-tokens.ts:58:11)
2025-09-10T08:31:23.2311728Z     at authenticateToken (/home/runner/work/services/services/packages/common/src/auth/bearer-tokens.ts:81:17)
2025-09-10T08:31:23.2312678Z     at newFn (/home/runner/work/services/services/node_modules/.pnpm/express-async-errors@3.1.1_express@4.21.2/node_modules/express-async-errors/index.js:16:20)
2025-09-10T08:31:23.2313737Z     at Layer.handle [as handle_request] (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/layer.js:95:5)
2025-09-10T08:31:23.2314691Z     at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:149:13)
2025-09-10T08:31:23.2315524Z     at prefetchUserFollowing (/home/runner/work/services/services/services/private-sessions/src/server.ts:77:3)
2025-09-10T08:31:23.2316469Z     at newFn (/home/runner/work/services/services/node_modules/.pnpm/express-async-errors@3.1.1_express@4.21.2/node_modules/express-async-errors/index.js:16:20)
2025-09-10T08:31:23.2317650Z     at Layer.handle [as handle_request] (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/layer.js:95:5)
2025-09-10T08:31:23.2318707Z     at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:149:13)
2025-09-10T08:31:23.2319517Z     at queryTrackerMiddleware (/home/runner/work/services/services/services/private-sessions/src/db.ts:132:3)
2025-09-10T08:31:23.2319916Z 
2025-09-10T08:31:23.2321402Z [2025-09-10 08:31:21.825 +0000] ERROR: AuthenticationError occurred {"service":"private-sessions","requestId":"unknown","method":"POST","path":"/xrpc/social.spkeasy.privateSession.create","duration":null,"status":401,"ip":"313d5b13e067911efcc8e257ab3925051bb57a136f2d54f697e1e92ef9997f35","relevantLine":"/services/services/packages/common/src/auth/bearer-tokens.ts:58:11"}
2025-09-10T08:31:23.2322650Z     error: {
2025-09-10T08:31:23.2322860Z       "name": "AuthenticationError",
2025-09-10T08:31:23.2323142Z       "message": "Missing authorization header",
2025-09-10T08:31:23.2323405Z       "statusCode": 401,
2025-09-10T08:31:23.2323594Z       "stack":
2025-09-10T08:31:23.2323842Z           AuthenticationError: Missing authorization header
2025-09-10T08:31:23.2324418Z               at getBearerToken (/home/runner/work/services/services/packages/common/src/auth/bearer-tokens.ts:58:11)
2025-09-10T08:31:23.2325193Z               at authenticateToken (/home/runner/work/services/services/packages/common/src/auth/bearer-tokens.ts:81:17)
2025-09-10T08:31:23.2326144Z               at newFn (/home/runner/work/services/services/node_modules/.pnpm/express-async-errors@3.1.1_express@4.21.2/node_modules/express-async-errors/index.js:16:20)
2025-09-10T08:31:23.2327363Z               at Layer.handle [as handle_request] (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/layer.js:95:5)
2025-09-10T08:31:23.2328435Z               at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:149:13)
2025-09-10T08:31:23.2329273Z               at prefetchUserFollowing (/home/runner/work/services/services/services/private-sessions/src/server.ts:77:3)
2025-09-10T08:31:23.2330221Z               at newFn (/home/runner/work/services/services/node_modules/.pnpm/express-async-errors@3.1.1_express@4.21.2/node_modules/express-async-errors/index.js:16:20)
2025-09-10T08:31:23.2331290Z               at Layer.handle [as handle_request] (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/layer.js:95:5)
2025-09-10T08:31:23.2332251Z               at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:149:13)
2025-09-10T08:31:23.2333070Z               at queryTrackerMiddleware (/home/runner/work/services/services/services/private-sessions/src/db.ts:132:3)
2025-09-10T08:31:23.2333528Z     }
2025-09-10T08:31:23.2334531Z [90mstdout[2m | tests/integration/api/session.test.ts[2m > [22m[2mPrivate Session API Tests[2m > [22m[2mPOST /xrpc/social.spkeasy.privateSession.create[2m > [22m[2mshould validate session keys format
2025-09-10T08:31:23.2335572Z [22m[39mValidationError: Validation failed: sessionKeys: Expected array, received string
2025-09-10T08:31:23.2336333Z     at validateAgainstLexicon (/home/runner/work/services/services/packages/common/src/lexicon/lexicon-validation.ts:134:13)
2025-09-10T08:31:23.2337369Z     at Object.social.spkeasy.privateSession.create [as handler] (/home/runner/work/services/services/services/private-sessions/src/routes/session.routes.ts:32:5)
2025-09-10T08:31:23.2338316Z     at /home/runner/work/services/services/packages/service-base/src/server.ts:137:46
2025-09-10T08:31:23.2339165Z     at newFn (/home/runner/work/services/services/node_modules/.pnpm/express-async-errors@3.1.1_express@4.21.2/node_modules/express-async-errors/index.js:16:20)
2025-09-10T08:31:23.2340343Z     at Layer.handle [as handle_request] (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/layer.js:95:5)
2025-09-10T08:31:23.2341298Z     at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:149:13)
2025-09-10T08:31:23.2342148Z     at /home/runner/work/services/services/node_modules/.pnpm/body-parser@1.20.3/node_modules/body-parser/lib/read.js:137:5
2025-09-10T08:31:23.2342758Z     at AsyncResource.runInAsyncScope (node:async_hooks:211:14)
2025-09-10T08:31:23.2343420Z     at invokeCallback (/home/runner/work/services/services/node_modules/.pnpm/raw-body@2.5.2/node_modules/raw-body/index.js:238:16)
2025-09-10T08:31:23.2344264Z     at done (/home/runner/work/services/services/node_modules/.pnpm/raw-body@2.5.2/node_modules/raw-body/index.js:227:7)
2025-09-10T08:31:23.2344675Z 
2025-09-10T08:31:23.2346502Z [2025-09-10 08:31:21.837 +0000] ERROR: ValidationError occurred {"service":"private-sessions","requestId":"unknown","method":"POST","path":"/xrpc/social.spkeasy.privateSession.create","duration":1,"status":400,"ip":"313d5b13e067911efcc8e257ab3925051bb57a136f2d54f697e1e92ef9997f35","user":"3698761d94b6992d6277d4dc2932712760c796ead51e44dd484d665e3bcd7c08","relevantLine":"/services/services/packages/common/src/lexicon/lexicon-validation.ts:134:13"}
2025-09-10T08:31:23.2348081Z     error: {
2025-09-10T08:31:23.2348289Z       "name": "ValidationError",
2025-09-10T08:31:23.2348672Z       "message": "Validation failed: sessionKeys: Expected array, received string",
2025-09-10T08:31:23.2349027Z       "statusCode": 400,
2025-09-10T08:31:23.2349339Z       "stack":
2025-09-10T08:31:23.2349696Z           ValidationError: Validation failed: sessionKeys: Expected array, received string
2025-09-10T08:31:23.2350447Z               at validateAgainstLexicon (/home/runner/work/services/services/packages/common/src/lexicon/lexicon-validation.ts:134:13)
2025-09-10T08:31:23.2351494Z               at Object.social.spkeasy.privateSession.create [as handler] (/home/runner/work/services/services/services/private-sessions/src/routes/session.routes.ts:32:5)
2025-09-10T08:31:23.2352343Z               at /home/runner/work/services/services/packages/service-base/src/server.ts:137:46
2025-09-10T08:31:23.2353194Z               at newFn (/home/runner/work/services/services/node_modules/.pnpm/express-async-errors@3.1.1_express@4.21.2/node_modules/express-async-errors/index.js:16:20)
2025-09-10T08:31:23.2354263Z               at Layer.handle [as handle_request] (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/layer.js:95:5)
2025-09-10T08:31:23.2355231Z               at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:149:13)
2025-09-10T08:31:23.2356093Z               at /home/runner/work/services/services/node_modules/.pnpm/body-parser@1.20.3/node_modules/body-parser/lib/read.js:137:5
2025-09-10T08:31:23.2356710Z               at AsyncResource.runInAsyncScope (node:async_hooks:211:14)
2025-09-10T08:31:23.2357394Z               at invokeCallback (/home/runner/work/services/services/node_modules/.pnpm/raw-body@2.5.2/node_modules/raw-body/index.js:238:16)
2025-09-10T08:31:23.2358391Z               at done (/home/runner/work/services/services/node_modules/.pnpm/raw-body@2.5.2/node_modules/raw-body/index.js:227:7)
2025-09-10T08:31:23.2358867Z     }
2025-09-10T08:31:23.2359846Z [90mstdout[2m | tests/integration/api/session.test.ts[2m > [22m[2mPrivate Session API Tests[2m > [22m[2mPOST /xrpc/social.spkeasy.privateSession.revoke[2m > [22m[2mshould revoke an existing session
2025-09-10T08:31:23.2360764Z [22m[39mValidationError: Validation failed: sessionId: Required
2025-09-10T08:31:23.2361436Z     at validateAgainstLexicon (/home/runner/work/services/services/packages/common/src/lexicon/lexicon-validation.ts:134:13)
2025-09-10T08:31:23.2362588Z     at Object.social.spkeasy.privateSession.revoke [as handler] (/home/runner/work/services/services/services/private-sessions/src/routes/session.routes.ts:60:5)
2025-09-10T08:31:23.2363431Z     at /home/runner/work/services/services/packages/service-base/src/server.ts:137:46
2025-09-10T08:31:23.2364278Z     at newFn (/home/runner/work/services/services/node_modules/.pnpm/express-async-errors@3.1.1_express@4.21.2/node_modules/express-async-errors/index.js:16:20)
2025-09-10T08:31:23.2365333Z     at Layer.handle [as handle_request] (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/layer.js:95:5)
2025-09-10T08:31:23.2366283Z     at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:149:13)
2025-09-10T08:31:23.2367139Z     at /home/runner/work/services/services/node_modules/.pnpm/body-parser@1.20.3/node_modules/body-parser/lib/read.js:137:5
2025-09-10T08:31:23.2367746Z     at AsyncResource.runInAsyncScope (node:async_hooks:211:14)
2025-09-10T08:31:23.2368520Z     at invokeCallback (/home/runner/work/services/services/node_modules/.pnpm/raw-body@2.5.2/node_modules/raw-body/index.js:238:16)
2025-09-10T08:31:23.2369360Z     at done (/home/runner/work/services/services/node_modules/.pnpm/raw-body@2.5.2/node_modules/raw-body/index.js:227:7)
2025-09-10T08:31:23.2369774Z 
2025-09-10T08:31:23.2370659Z [90mstdout[2m | tests/integration/api/session.test.ts[2m > [22m[2mPrivate Session API Tests[2m > [22m[2mPOST /xrpc/social.spkeasy.privateSession.revoke[2m > [22m[2mshould require authentication
2025-09-10T08:31:23.2371529Z [22m[39mAuthenticationError: Missing authorization header
2025-09-10T08:31:23.2372235Z     at getBearerToken (/home/runner/work/services/services/packages/common/src/auth/bearer-tokens.ts:58:11)
2025-09-10T08:31:23.2372994Z     at authenticateToken (/home/runner/work/services/services/packages/common/src/auth/bearer-tokens.ts:81:17)
2025-09-10T08:31:23.2373930Z     at newFn (/home/runner/work/services/services/node_modules/.pnpm/express-async-errors@3.1.1_express@4.21.2/node_modules/express-async-errors/index.js:16:20)
2025-09-10T08:31:23.2374992Z     at Layer.handle [as handle_request] (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/layer.js:95:5)
2025-09-10T08:31:23.2375941Z     at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:149:13)
2025-09-10T08:31:23.2376759Z     at prefetchUserFollowing (/home/runner/work/services/services/services/private-sessions/src/server.ts:77:3)
2025-09-10T08:31:23.2377698Z     at newFn (/home/runner/work/services/services/node_modules/.pnpm/express-async-errors@3.1.1_express@4.21.2/node_modules/express-async-errors/index.js:16:20)
2025-09-10T08:31:23.2378850Z     at Layer.handle [as handle_request] (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/layer.js:95:5)
2025-09-10T08:31:23.2379792Z     at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:149:13)
2025-09-10T08:31:23.2380597Z     at queryTrackerMiddleware (/home/runner/work/services/services/services/private-sessions/src/db.ts:132:3)
2025-09-10T08:31:23.2380995Z 
2025-09-10T08:31:23.2382785Z [2025-09-10 08:31:21.853 +0000] ERROR: ValidationError occurred {"service":"private-sessions","requestId":"unknown","method":"POST","path":"/xrpc/social.spkeasy.privateSession.revoke","duration":1,"status":400,"ip":"313d5b13e067911efcc8e257ab3925051bb57a136f2d54f697e1e92ef9997f35","user":"3698761d94b6992d6277d4dc2932712760c796ead51e44dd484d665e3bcd7c08","relevantLine":"/services/services/packages/common/src/lexicon/lexicon-validation.ts:134:13"}
2025-09-10T08:31:23.2384272Z     error: {
2025-09-10T08:31:23.2384475Z       "name": "ValidationError",
2025-09-10T08:31:23.2384767Z       "message": "Validation failed: sessionId: Required",
2025-09-10T08:31:23.2385046Z       "statusCode": 400,
2025-09-10T08:31:23.2385232Z       "stack":
2025-09-10T08:31:23.2385500Z           ValidationError: Validation failed: sessionId: Required
2025-09-10T08:31:23.2386294Z               at validateAgainstLexicon (/home/runner/work/services/services/packages/common/src/lexicon/lexicon-validation.ts:134:13)
2025-09-10T08:31:23.2387341Z               at Object.social.spkeasy.privateSession.revoke [as handler] (/home/runner/work/services/services/services/private-sessions/src/routes/session.routes.ts:60:5)
2025-09-10T08:31:23.2388310Z               at /home/runner/work/services/services/packages/service-base/src/server.ts:137:46
2025-09-10T08:31:23.2389175Z               at newFn (/home/runner/work/services/services/node_modules/.pnpm/express-async-errors@3.1.1_express@4.21.2/node_modules/express-async-errors/index.js:16:20)
2025-09-10T08:31:23.2390252Z               at Layer.handle [as handle_request] (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/layer.js:95:5)
2025-09-10T08:31:23.2391211Z               at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:149:13)
2025-09-10T08:31:23.2392069Z               at /home/runner/work/services/services/node_modules/.pnpm/body-parser@1.20.3/node_modules/body-parser/lib/read.js:137:5
2025-09-10T08:31:23.2392692Z               at AsyncResource.runInAsyncScope (node:async_hooks:211:14)
2025-09-10T08:31:23.2393367Z               at invokeCallback (/home/runner/work/services/services/node_modules/.pnpm/raw-body@2.5.2/node_modules/raw-body/index.js:238:16)
2025-09-10T08:31:23.2394214Z               at done (/home/runner/work/services/services/node_modules/.pnpm/raw-body@2.5.2/node_modules/raw-body/index.js:227:7)
2025-09-10T08:31:23.2394815Z     }
2025-09-10T08:31:23.2396371Z [2025-09-10 08:31:21.858 +0000] ERROR: AuthenticationError occurred {"service":"private-sessions","requestId":"unknown","method":"POST","path":"/xrpc/social.spkeasy.privateSession.revoke","duration":null,"status":401,"ip":"313d5b13e067911efcc8e257ab3925051bb57a136f2d54f697e1e92ef9997f35","relevantLine":"/services/services/packages/common/src/auth/bearer-tokens.ts:58:11"}
2025-09-10T08:31:23.2397607Z     error: {
2025-09-10T08:31:23.2397808Z       "name": "AuthenticationError",
2025-09-10T08:31:23.2398243Z       "message": "Missing authorization header",
2025-09-10T08:31:23.2398496Z       "statusCode": 401,
2025-09-10T08:31:23.2398685Z       "stack":
2025-09-10T08:31:23.2398941Z           AuthenticationError: Missing authorization header
2025-09-10T08:31:23.2399514Z               at getBearerToken (/home/runner/work/services/services/packages/common/src/auth/bearer-tokens.ts:58:11)
2025-09-10T08:31:23.2400287Z               at authenticateToken (/home/runner/work/services/services/packages/common/src/auth/bearer-tokens.ts:81:17)
2025-09-10T08:31:23.2401235Z               at newFn (/home/runner/work/services/services/node_modules/.pnpm/express-async-errors@3.1.1_express@4.21.2/node_modules/express-async-errors/index.js:16:20)
2025-09-10T08:31:23.2402307Z               at Layer.handle [as handle_request] (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/layer.js:95:5)
2025-09-10T08:31:23.2403265Z               at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:149:13)
2025-09-10T08:31:23.2404099Z               at prefetchUserFollowing (/home/runner/work/services/services/services/private-sessions/src/server.ts:77:3)
2025-09-10T08:31:23.2405050Z               at newFn (/home/runner/work/services/services/node_modules/.pnpm/express-async-errors@3.1.1_express@4.21.2/node_modules/express-async-errors/index.js:16:20)
2025-09-10T08:31:23.2406112Z               at Layer.handle [as handle_request] (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/layer.js:95:5)
2025-09-10T08:31:23.2407062Z               at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:149:13)
2025-09-10T08:31:23.2408100Z               at queryTrackerMiddleware (/home/runner/work/services/services/services/private-sessions/src/db.ts:132:3)
2025-09-10T08:31:23.2408580Z     }
2025-09-10T08:31:23.2409573Z [90mstdout[2m | tests/integration/api/session.test.ts[2m > [22m[2mPrivate Session API Tests[2m > [22m[2mPOST /xrpc/social.spkeasy.privateSession.revoke[2m > [22m[2mshould validate sessionId parameter
2025-09-10T08:31:23.2410496Z [22m[39mValidationError: Validation failed: sessionId: Required
2025-09-10T08:31:23.2411176Z     at validateAgainstLexicon (/home/runner/work/services/services/packages/common/src/lexicon/lexicon-validation.ts:134:13)
2025-09-10T08:31:23.2412203Z     at Object.social.spkeasy.privateSession.revoke [as handler] (/home/runner/work/services/services/services/private-sessions/src/routes/session.routes.ts:60:5)
2025-09-10T08:31:23.2413042Z     at /home/runner/work/services/services/packages/service-base/src/server.ts:137:46
2025-09-10T08:31:23.2413894Z     at newFn (/home/runner/work/services/services/node_modules/.pnpm/express-async-errors@3.1.1_express@4.21.2/node_modules/express-async-errors/index.js:16:20)
2025-09-10T08:31:23.2415034Z     at Layer.handle [as handle_request] (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/layer.js:95:5)
2025-09-10T08:31:23.2415982Z     at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:149:13)
2025-09-10T08:31:23.2416837Z     at /home/runner/work/services/services/node_modules/.pnpm/body-parser@1.20.3/node_modules/body-parser/lib/read.js:137:5
2025-09-10T08:31:23.2417566Z     at AsyncResource.runInAsyncScope (node:async_hooks:211:14)
2025-09-10T08:31:23.2418330Z     at invokeCallback (/home/runner/work/services/services/node_modules/.pnpm/raw-body@2.5.2/node_modules/raw-body/index.js:238:16)
2025-09-10T08:31:23.2419174Z     at done (/home/runner/work/services/services/node_modules/.pnpm/raw-body@2.5.2/node_modules/raw-body/index.js:227:7)
2025-09-10T08:31:23.2419588Z 
2025-09-10T08:31:23.2421381Z [2025-09-10 08:31:21.868 +0000] ERROR: ValidationError occurred {"service":"private-sessions","requestId":"unknown","method":"POST","path":"/xrpc/social.spkeasy.privateSession.revoke","duration":1,"status":400,"ip":"313d5b13e067911efcc8e257ab3925051bb57a136f2d54f697e1e92ef9997f35","user":"3698761d94b6992d6277d4dc2932712760c796ead51e44dd484d665e3bcd7c08","relevantLine":"/services/services/packages/common/src/lexicon/lexicon-validation.ts:134:13"}
2025-09-10T08:31:23.2422873Z     error: {
2025-09-10T08:31:23.2423072Z       "name": "ValidationError",
2025-09-10T08:31:23.2423373Z       "message": "Validation failed: sessionId: Required",
2025-09-10T08:31:23.2423798Z       "statusCode": 400,
2025-09-10T08:31:23.2424128Z       "stack":
2025-09-10T08:31:23.2424573Z           ValidationError: Validation failed: sessionId: Required
2025-09-10T08:31:23.2425753Z               at validateAgainstLexicon (/home/runner/work/services/services/packages/common/src/lexicon/lexicon-validation.ts:134:13)
2025-09-10T08:31:23.2427625Z               at Object.social.spkeasy.privateSession.revoke [as handler] (/home/runner/work/services/services/services/private-sessions/src/routes/session.routes.ts:60:5)
2025-09-10T08:31:23.2429425Z               at /home/runner/work/services/services/packages/service-base/src/server.ts:137:46
2025-09-10T08:31:23.2431054Z               at newFn (/home/runner/work/services/services/node_modules/.pnpm/express-async-errors@3.1.1_express@4.21.2/node_modules/express-async-errors/index.js:16:20)
2025-09-10T08:31:23.2433072Z               at Layer.handle [as handle_request] (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/layer.js:95:5)
2025-09-10T08:31:23.2434886Z               at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:149:13)
2025-09-10T08:31:23.2436721Z               at /home/runner/work/services/services/node_modules/.pnpm/body-parser@1.20.3/node_modules/body-parser/lib/read.js:137:5
2025-09-10T08:31:23.2437886Z               at AsyncResource.runInAsyncScope (node:async_hooks:211:14)
2025-09-10T08:31:23.2439018Z               at invokeCallback (/home/runner/work/services/services/node_modules/.pnpm/raw-body@2.5.2/node_modules/raw-body/index.js:238:16)
2025-09-10T08:31:23.2439883Z               at done (/home/runner/work/services/services/node_modules/.pnpm/raw-body@2.5.2/node_modules/raw-body/index.js:227:7)
2025-09-10T08:31:23.2440362Z     }
2025-09-10T08:31:23.2441414Z  [32mâœ“[39m tests/integration/api/session.test.ts[2m > [22mPrivate Session API Tests[2m > [22mPOST /xrpc/social.spkeasy.privateSession.create[2m > [22mshould create a new private session successfully[32m 50[2mms[22m[39m
2025-09-10T08:31:23.2443023Z  [32mâœ“[39m tests/integration/api/session.test.ts[2m > [22mPrivate Session API Tests[2m > [22mPOST /xrpc/social.spkeasy.privateSession.create[2m > [22mshould create session with multiple recipients[32m 12[2mms[22m[39m
2025-09-10T08:31:23.2444523Z  [32mâœ“[39m tests/integration/api/session.test.ts[2m > [22mPrivate Session API Tests[2m > [22mPOST /xrpc/social.spkeasy.privateSession.create[2m > [22mshould require authentication[32m 5[2mms[22m[39m
2025-09-10T08:31:23.2446036Z  [32mâœ“[39m tests/integration/api/session.test.ts[2m > [22mPrivate Session API Tests[2m > [22mPOST /xrpc/social.spkeasy.privateSession.create[2m > [22mshould validate session keys format[32m 12[2mms[22m[39m
2025-09-10T08:31:23.2447510Z  [32mâœ“[39m tests/integration/api/session.test.ts[2m > [22mPrivate Session API Tests[2m > [22mPOST /xrpc/social.spkeasy.privateSession.revoke[2m > [22mshould revoke an existing session[32m 15[2mms[22m[39m
2025-09-10T08:31:23.2449309Z  [32mâœ“[39m tests/integration/api/session.test.ts[2m > [22mPrivate Session API Tests[2m > [22mPOST /xrpc/social.spkeasy.privateSession.revoke[2m > [22mshould require authentication[32m 5[2mms[22m[39m
2025-09-10T08:31:23.2450787Z  [32mâœ“[39m tests/integration/api/session.test.ts[2m > [22mPrivate Session API Tests[2m > [22mPOST /xrpc/social.spkeasy.privateSession.revoke[2m > [22mshould validate sessionId parameter[32m 10[2mms[22m[39m
2025-09-10T08:31:23.2453148Z [2025-09-10 08:31:21.936 +0000] INFO: {"service":"private-sessions","requestId":"unknown","method":"social.spkeasy.privateSession.getSession","path":"/xrpc/social.spkeasy.privateSession.getSession","duration":57,"status":200,"ip":"313d5b13e067911efcc8e257ab3925051bb57a136f2d54f697e1e92ef9997f35","user":"3698761d94b6992d6277d4dc2932712760c796ead51e44dd484d665e3bcd7c08","dbDuration":4,"dbProfile":"4","authDuration":6}
2025-09-10T08:31:23.2455385Z [90mstdout[2m | tests/integration/api/session.test.ts[2m > [22m[2mPrivate Session API Tests[2m > [22m[2mGET /xrpc/social.spkeasy.privateSession.getSession[2m > [22m[2mshould require authentication
2025-09-10T08:31:23.2456283Z [22m[39mAuthenticationError: Missing authorization header
2025-09-10T08:31:23.2456879Z     at getBearerToken (/home/runner/work/services/services/packages/common/src/auth/bearer-tokens.ts:58:11)
2025-09-10T08:31:23.2457659Z     at authenticateToken (/home/runner/work/services/services/packages/common/src/auth/bearer-tokens.ts:81:17)
2025-09-10T08:31:23.2458738Z     at newFn (/home/runner/work/services/services/node_modules/.pnpm/express-async-errors@3.1.1_express@4.21.2/node_modules/express-async-errors/index.js:16:20)
2025-09-10T08:31:23.2459813Z     at Layer.handle [as handle_request] (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/layer.js:95:5)
2025-09-10T08:31:23.2460775Z     at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:149:13)
2025-09-10T08:31:23.2461606Z     at prefetchUserFollowing (/home/runner/work/services/services/services/private-sessions/src/server.ts:77:3)
2025-09-10T08:31:23.2462683Z     at newFn (/home/runner/work/services/services/node_modules/.pnpm/express-async-errors@3.1.1_express@4.21.2/node_modules/express-async-errors/index.js:16:20)
2025-09-10T08:31:23.2463757Z     at Layer.handle [as handle_request] (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/layer.js:95:5)
2025-09-10T08:31:23.2464706Z     at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:149:13)
2025-09-10T08:31:23.2465526Z     at queryTrackerMiddleware (/home/runner/work/services/services/services/private-sessions/src/db.ts:132:3)
2025-09-10T08:31:23.2465932Z 
2025-09-10T08:31:23.2467438Z [2025-09-10 08:31:21.943 +0000] ERROR: AuthenticationError occurred {"service":"private-sessions","requestId":"unknown","method":"GET","path":"/xrpc/social.spkeasy.privateSession.getSession","duration":null,"status":401,"ip":"313d5b13e067911efcc8e257ab3925051bb57a136f2d54f697e1e92ef9997f35","relevantLine":"/services/services/packages/common/src/auth/bearer-tokens.ts:58:11"}
2025-09-10T08:31:23.2468812Z     error: {
2025-09-10T08:31:23.2469016Z       "name": "AuthenticationError",
2025-09-10T08:31:23.2469304Z       "message": "Missing authorization header",
2025-09-10T08:31:23.2469558Z       "statusCode": 401,
2025-09-10T08:31:23.2469748Z       "stack":
2025-09-10T08:31:23.2470001Z           AuthenticationError: Missing authorization header
2025-09-10T08:31:23.2470581Z               at getBearerToken (/home/runner/work/services/services/packages/common/src/auth/bearer-tokens.ts:58:11)
2025-09-10T08:31:23.2471360Z               at authenticateToken (/home/runner/work/services/services/packages/common/src/auth/bearer-tokens.ts:81:17)
2025-09-10T08:31:23.2472444Z               at newFn (/home/runner/work/services/services/node_modules/.pnpm/express-async-errors@3.1.1_express@4.21.2/node_modules/express-async-errors/index.js:16:20)
2025-09-10T08:31:23.2473529Z               at Layer.handle [as handle_request] (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/layer.js:95:5)
2025-09-10T08:31:23.2474498Z               at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:149:13)
2025-09-10T08:31:23.2475337Z               at prefetchUserFollowing (/home/runner/work/services/services/services/private-sessions/src/server.ts:77:3)
2025-09-10T08:31:23.2476299Z               at newFn (/home/runner/work/services/services/node_modules/.pnpm/express-async-errors@3.1.1_express@4.21.2/node_modules/express-async-errors/index.js:16:20)
2025-09-10T08:31:23.2477374Z               at Layer.handle [as handle_request] (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/layer.js:95:5)
2025-09-10T08:31:23.2478439Z               at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:149:13)
2025-09-10T08:31:23.2479266Z               at queryTrackerMiddleware (/home/runner/work/services/services/services/private-sessions/src/db.ts:132:3)
2025-09-10T08:31:23.2479737Z     }
2025-09-10T08:31:23.2481063Z [90mstdout[2m | tests/integration/api/session.test.ts[2m > [22m[2mPrivate Session API Tests[2m > [22m[2mPOST /xrpc/social.spkeasy.privateSession.addUser[2m > [22m[2mshould add a user to existing session
2025-09-10T08:31:23.2482006Z [22m[39mValidationError: Validation failed: sessionId: Required
2025-09-10T08:31:23.2482701Z     at validateAgainstLexicon (/home/runner/work/services/services/packages/common/src/lexicon/lexicon-validation.ts:134:13)
2025-09-10T08:31:23.2483749Z     at Object.social.spkeasy.privateSession.addUser [as handler] (/home/runner/work/services/services/services/private-sessions/src/routes/session.routes.ts:101:5)
2025-09-10T08:31:23.2484596Z     at /home/runner/work/services/services/packages/service-base/src/server.ts:137:46
2025-09-10T08:31:23.2485579Z     at newFn (/home/runner/work/services/services/node_modules/.pnpm/express-async-errors@3.1.1_express@4.21.2/node_modules/express-async-errors/index.js:16:20)
2025-09-10T08:31:23.2486643Z     at Layer.handle [as handle_request] (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/layer.js:95:5)
2025-09-10T08:31:23.2487590Z     at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:149:13)
2025-09-10T08:31:23.2488566Z     at /home/runner/work/services/services/node_modules/.pnpm/body-parser@1.20.3/node_modules/body-parser/lib/read.js:137:5
2025-09-10T08:31:23.2489185Z     at AsyncResource.runInAsyncScope (node:async_hooks:211:14)
2025-09-10T08:31:23.2489845Z     at invokeCallback (/home/runner/work/services/services/node_modules/.pnpm/raw-body@2.5.2/node_modules/raw-body/index.js:238:16)
2025-09-10T08:31:23.2490679Z     at done (/home/runner/work/services/services/node_modules/.pnpm/raw-body@2.5.2/node_modules/raw-body/index.js:227:7)
2025-09-10T08:31:23.2491092Z 
2025-09-10T08:31:23.2492913Z [2025-09-10 08:31:21.955 +0000] ERROR: ValidationError occurred {"service":"private-sessions","requestId":"unknown","method":"POST","path":"/xrpc/social.spkeasy.privateSession.addUser","duration":0,"status":400,"ip":"313d5b13e067911efcc8e257ab3925051bb57a136f2d54f697e1e92ef9997f35","user":"3698761d94b6992d6277d4dc2932712760c796ead51e44dd484d665e3bcd7c08","relevantLine":"/services/services/packages/common/src/lexicon/lexicon-validation.ts:134:13"}
2025-09-10T08:31:23.2494404Z     error: {
2025-09-10T08:31:23.2494600Z       "name": "ValidationError",
2025-09-10T08:31:23.2495023Z       "message": "Validation failed: sessionId: Required",
2025-09-10T08:31:23.2495299Z       "statusCode": 400,
2025-09-10T08:31:23.2495480Z       "stack":
2025-09-10T08:31:23.2495753Z           ValidationError: Validation failed: sessionId: Required
2025-09-10T08:31:23.2496422Z               at validateAgainstLexicon (/home/runner/work/services/services/packages/common/src/lexicon/lexicon-validation.ts:134:13)
2025-09-10T08:31:23.2497482Z               at Object.social.spkeasy.privateSession.addUser [as handler] (/home/runner/work/services/services/services/private-sessions/src/routes/session.routes.ts:101:5)
2025-09-10T08:31:23.2498452Z               at /home/runner/work/services/services/packages/service-base/src/server.ts:137:46
2025-09-10T08:31:23.2499317Z               at newFn (/home/runner/work/services/services/node_modules/.pnpm/express-async-errors@3.1.1_express@4.21.2/node_modules/express-async-errors/index.js:16:20)
2025-09-10T08:31:23.2500383Z               at Layer.handle [as handle_request] (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/layer.js:95:5)
2025-09-10T08:31:23.2501342Z               at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:149:13)
2025-09-10T08:31:23.2502206Z               at /home/runner/work/services/services/node_modules/.pnpm/body-parser@1.20.3/node_modules/body-parser/lib/read.js:137:5
2025-09-10T08:31:23.2502833Z               at AsyncResource.runInAsyncScope (node:async_hooks:211:14)
2025-09-10T08:31:23.2503508Z               at invokeCallback (/home/runner/work/services/services/node_modules/.pnpm/raw-body@2.5.2/node_modules/raw-body/index.js:238:16)
2025-09-10T08:31:23.2504354Z               at done (/home/runner/work/services/services/node_modules/.pnpm/raw-body@2.5.2/node_modules/raw-body/index.js:227:7)
2025-09-10T08:31:23.2504834Z     }
2025-09-10T08:31:23.2505806Z [90mstdout[2m | tests/integration/api/session.test.ts[2m > [22m[2mPrivate Session API Tests[2m > [22m[2mPOST /xrpc/social.spkeasy.privateSession.addUser[2m > [22m[2mshould require authentication
2025-09-10T08:31:23.2506691Z [22m[39mAuthenticationError: Missing authorization header
2025-09-10T08:31:23.2507278Z     at getBearerToken (/home/runner/work/services/services/packages/common/src/auth/bearer-tokens.ts:58:11)
2025-09-10T08:31:23.2508247Z     at authenticateToken (/home/runner/work/services/services/packages/common/src/auth/bearer-tokens.ts:81:17)
2025-09-10T08:31:23.2509197Z     at newFn (/home/runner/work/services/services/node_modules/.pnpm/express-async-errors@3.1.1_express@4.21.2/node_modules/express-async-errors/index.js:16:20)
2025-09-10T08:31:23.2510258Z     at Layer.handle [as handle_request] (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/layer.js:95:5)
2025-09-10T08:31:23.2511205Z     at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:149:13)
2025-09-10T08:31:23.2512027Z     at prefetchUserFollowing (/home/runner/work/services/services/services/private-sessions/src/server.ts:77:3)
2025-09-10T08:31:23.2512965Z     at newFn (/home/runner/work/services/services/node_modules/.pnpm/express-async-errors@3.1.1_express@4.21.2/node_modules/express-async-errors/index.js:16:20)
2025-09-10T08:31:23.2514019Z     at Layer.handle [as handle_request] (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/layer.js:95:5)
2025-09-10T08:31:23.2514959Z     at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:149:13)
2025-09-10T08:31:23.2515768Z     at queryTrackerMiddleware (/home/runner/work/services/services/services/private-sessions/src/db.ts:132:3)
2025-09-10T08:31:23.2516169Z 
2025-09-10T08:31:23.2517657Z [2025-09-10 08:31:21.959 +0000] ERROR: AuthenticationError occurred {"service":"private-sessions","requestId":"unknown","method":"POST","path":"/xrpc/social.spkeasy.privateSession.addUser","duration":null,"status":401,"ip":"313d5b13e067911efcc8e257ab3925051bb57a136f2d54f697e1e92ef9997f35","relevantLine":"/services/services/packages/common/src/auth/bearer-tokens.ts:58:11"}
2025-09-10T08:31:23.2519134Z     error: {
2025-09-10T08:31:23.2519334Z       "name": "AuthenticationError",
2025-09-10T08:31:23.2519619Z       "message": "Missing authorization header",
2025-09-10T08:31:23.2519882Z       "statusCode": 401,
2025-09-10T08:31:23.2520068Z       "stack":
2025-09-10T08:31:23.2520323Z           AuthenticationError: Missing authorization header
2025-09-10T08:31:23.2520909Z               at getBearerToken (/home/runner/work/services/services/packages/common/src/auth/bearer-tokens.ts:58:11)
2025-09-10T08:31:23.2521673Z               at authenticateToken (/home/runner/work/services/services/packages/common/src/auth/bearer-tokens.ts:81:17)
2025-09-10T08:31:23.2522625Z               at newFn (/home/runner/work/services/services/node_modules/.pnpm/express-async-errors@3.1.1_express@4.21.2/node_modules/express-async-errors/index.js:16:20)
2025-09-10T08:31:23.2523704Z               at Layer.handle [as handle_request] (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/layer.js:95:5)
2025-09-10T08:31:23.2524662Z               at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:149:13)
2025-09-10T08:31:23.2525493Z               at prefetchUserFollowing (/home/runner/work/services/services/services/private-sessions/src/server.ts:77:3)
2025-09-10T08:31:23.2526447Z               at newFn (/home/runner/work/services/services/node_modules/.pnpm/express-async-errors@3.1.1_express@4.21.2/node_modules/express-async-errors/index.js:16:20)
2025-09-10T08:31:23.2527524Z               at Layer.handle [as handle_request] (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/layer.js:95:5)
2025-09-10T08:31:23.2528582Z               at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:149:13)
2025-09-10T08:31:23.2529404Z               at queryTrackerMiddleware (/home/runner/work/services/services/services/private-sessions/src/db.ts:132:3)
2025-09-10T08:31:23.2529870Z     }
2025-09-10T08:31:23.2530966Z [90mstdout[2m | tests/integration/api/session.test.ts[2m > [22m[2mPrivate Session API Tests[2m > [22m[2mPOST /xrpc/social.spkeasy.privateSession.updateKeys[2m > [22m[2mshould update session keys
2025-09-10T08:31:23.2532217Z [22m[39mValidationError: Validation failed: prevKeyId: Required, newKeyId: Required, prevPrivateKey: Required, newPublicKey: Required
2025-09-10T08:31:23.2533117Z     at validateAgainstLexicon (/home/runner/work/services/services/packages/common/src/lexicon/lexicon-validation.ts:134:13)
2025-09-10T08:31:23.2534173Z     at Object.social.spkeasy.privateSession.updateKeys [as handler] (/home/runner/work/services/services/services/private-sessions/src/routes/session.routes.ts:119:5)
2025-09-10T08:31:23.2535038Z     at /home/runner/work/services/services/packages/service-base/src/server.ts:137:46
2025-09-10T08:31:23.2535881Z     at newFn (/home/runner/work/services/services/node_modules/.pnpm/express-async-errors@3.1.1_express@4.21.2/node_modules/express-async-errors/index.js:16:20)
2025-09-10T08:31:23.2536949Z     at Layer.handle [as handle_request] (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/layer.js:95:5)
2025-09-10T08:31:23.2537888Z     at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:149:13)
2025-09-10T08:31:23.2538846Z     at /home/runner/work/services/services/node_modules/.pnpm/body-parser@1.20.3/node_modules/body-parser/lib/read.js:137:5
2025-09-10T08:31:23.2539457Z     at AsyncResource.runInAsyncScope (node:async_hooks:211:14)
2025-09-10T08:31:23.2540126Z     at invokeCallback (/home/runner/work/services/services/node_modules/.pnpm/raw-body@2.5.2/node_modules/raw-body/index.js:238:16)
2025-09-10T08:31:23.2541096Z     at done (/home/runner/work/services/services/node_modules/.pnpm/raw-body@2.5.2/node_modules/raw-body/index.js:227:7)
2025-09-10T08:31:23.2541515Z 
2025-09-10T08:31:23.2542421Z [90mstdout[2m | tests/integration/api/session.test.ts[2m > [22m[2mPrivate Session API Tests[2m > [22m[2mPOST /xrpc/social.spkeasy.privateSession.updateKeys[2m > [22m[2mshould require authentication
2025-09-10T08:31:23.2543319Z [22m[39mAuthenticationError: Missing authorization header
2025-09-10T08:31:23.2543902Z     at getBearerToken (/home/runner/work/services/services/packages/common/src/auth/bearer-tokens.ts:58:11)
2025-09-10T08:31:23.2544667Z     at authenticateToken (/home/runner/work/services/services/packages/common/src/auth/bearer-tokens.ts:81:17)
2025-09-10T08:31:23.2545647Z     at newFn (/home/runner/work/services/services/node_modules/.pnpm/express-async-errors@3.1.1_express@4.21.2/node_modules/express-async-errors/index.js:16:20)
2025-09-10T08:31:23.2546715Z     at Layer.handle [as handle_request] (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/layer.js:95:5)
2025-09-10T08:31:23.2547661Z     at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:149:13)
2025-09-10T08:31:23.2548594Z     at prefetchUserFollowing (/home/runner/work/services/services/services/private-sessions/src/server.ts:77:3)
2025-09-10T08:31:23.2549538Z     at newFn (/home/runner/work/services/services/node_modules/.pnpm/express-async-errors@3.1.1_express@4.21.2/node_modules/express-async-errors/index.js:16:20)
2025-09-10T08:31:23.2550582Z     at Layer.handle [as handle_request] (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/layer.js:95:5)
2025-09-10T08:31:23.2551531Z     at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:149:13)
2025-09-10T08:31:23.2552342Z     at queryTrackerMiddleware (/home/runner/work/services/services/services/private-sessions/src/db.ts:132:3)
2025-09-10T08:31:23.2552736Z 
2025-09-10T08:31:23.2554691Z [2025-09-10 08:31:21.970 +0000] ERROR: ValidationError occurred {"service":"private-sessions","requestId":"unknown","method":"POST","path":"/xrpc/social.spkeasy.privateSession.updateKeys","duration":1,"status":400,"ip":"313d5b13e067911efcc8e257ab3925051bb57a136f2d54f697e1e92ef9997f35","user":"3698761d94b6992d6277d4dc2932712760c796ead51e44dd484d665e3bcd7c08","relevantLine":"/services/services/packages/common/src/lexicon/lexicon-validation.ts:134:13"}
2025-09-10T08:31:23.2556216Z     error: {
2025-09-10T08:31:23.2556411Z       "name": "ValidationError",
2025-09-10T08:31:23.2556962Z       "message": "Validation failed: prevKeyId: Required, newKeyId: Required, prevPrivateKey: Required, newPublicKey: Required",
2025-09-10T08:31:23.2557452Z       "statusCode": 400,
2025-09-10T08:31:23.2557640Z       "stack":
2025-09-10T08:31:23.2558280Z           ValidationError: Validation failed: prevKeyId: Required, newKeyId: Required, prevPrivateKey: Required, newPublicKey: Required
2025-09-10T08:31:23.2559174Z               at validateAgainstLexicon (/home/runner/work/services/services/packages/common/src/lexicon/lexicon-validation.ts:134:13)
2025-09-10T08:31:23.2560239Z               at Object.social.spkeasy.privateSession.updateKeys [as handler] (/home/runner/work/services/services/services/private-sessions/src/routes/session.routes.ts:119:5)
2025-09-10T08:31:23.2561116Z               at /home/runner/work/services/services/packages/service-base/src/server.ts:137:46
2025-09-10T08:31:23.2561981Z               at newFn (/home/runner/work/services/services/node_modules/.pnpm/express-async-errors@3.1.1_express@4.21.2/node_modules/express-async-errors/index.js:16:20)
2025-09-10T08:31:23.2563048Z               at Layer.handle [as handle_request] (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/layer.js:95:5)
2025-09-10T08:31:23.2564127Z               at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:149:13)
2025-09-10T08:31:23.2564987Z               at /home/runner/work/services/services/node_modules/.pnpm/body-parser@1.20.3/node_modules/body-parser/lib/read.js:137:5
2025-09-10T08:31:23.2565612Z               at AsyncResource.runInAsyncScope (node:async_hooks:211:14)
2025-09-10T08:31:23.2566289Z               at invokeCallback (/home/runner/work/services/services/node_modules/.pnpm/raw-body@2.5.2/node_modules/raw-body/index.js:238:16)
2025-09-10T08:31:23.2567137Z               at done (/home/runner/work/services/services/node_modules/.pnpm/raw-body@2.5.2/node_modules/raw-body/index.js:227:7)
2025-09-10T08:31:23.2567617Z     }
2025-09-10T08:31:23.2569303Z [2025-09-10 08:31:21.974 +0000] ERROR: AuthenticationError occurred {"service":"private-sessions","requestId":"unknown","method":"POST","path":"/xrpc/social.spkeasy.privateSession.updateKeys","duration":null,"status":401,"ip":"313d5b13e067911efcc8e257ab3925051bb57a136f2d54f697e1e92ef9997f35","relevantLine":"/services/services/packages/common/src/auth/bearer-tokens.ts:58:11"}
2025-09-10T08:31:23.2570569Z     error: {
2025-09-10T08:31:23.2570774Z       "name": "AuthenticationError",
2025-09-10T08:31:23.2571055Z       "message": "Missing authorization header",
2025-09-10T08:31:23.2571316Z       "statusCode": 401,
2025-09-10T08:31:23.2571503Z       "stack":
2025-09-10T08:31:23.2571750Z           AuthenticationError: Missing authorization header
2025-09-10T08:31:23.2572325Z               at getBearerToken (/home/runner/work/services/services/packages/common/src/auth/bearer-tokens.ts:58:11)
2025-09-10T08:31:23.2573098Z               at authenticateToken (/home/runner/work/services/services/packages/common/src/auth/bearer-tokens.ts:81:17)
2025-09-10T08:31:23.2574048Z               at newFn (/home/runner/work/services/services/node_modules/.pnpm/express-async-errors@3.1.1_express@4.21.2/node_modules/express-async-errors/index.js:16:20)
2025-09-10T08:31:23.2575122Z               at Layer.handle [as handle_request] (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/layer.js:95:5)
2025-09-10T08:31:23.2576078Z               at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:149:13)
2025-09-10T08:31:23.2577023Z               at prefetchUserFollowing (/home/runner/work/services/services/services/private-sessions/src/server.ts:77:3)
2025-09-10T08:31:23.2578073Z               at newFn (/home/runner/work/services/services/node_modules/.pnpm/express-async-errors@3.1.1_express@4.21.2/node_modules/express-async-errors/index.js:16:20)
2025-09-10T08:31:23.2579141Z               at Layer.handle [as handle_request] (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/layer.js:95:5)
2025-09-10T08:31:23.2580099Z               at next (/home/runner/work/services/services/node_modules/.pnpm/express@4.21.2/node_modules/express/lib/router/route.js:149:13)
2025-09-10T08:31:23.2580910Z               at queryTrackerMiddleware (/home/runner/work/services/services/services/private-sessions/src/db.ts:132:3)
2025-09-10T08:31:23.2581374Z     }
2025-09-10T08:31:23.2582365Z  [32mâœ“[39m tests/integration/api/session.test.ts[2m > [22mPrivate Session API Tests[2m > [22mGET /xrpc/social.spkeasy.privateSession.getSession[2m > [22mshould retrieve current session for user[32m 70[2mms[22m[39m
2025-09-10T08:31:23.2583882Z  [32mâœ“[39m tests/integration/api/session.test.ts[2m > [22mPrivate Session API Tests[2m > [22mGET /xrpc/social.spkeasy.privateSession.getSession[2m > [22mshould require authentication[32m 6[2mms[22m[39m
2025-09-10T08:31:23.2585371Z  [32mâœ“[39m tests/integration/api/session.test.ts[2m > [22mPrivate Session API Tests[2m > [22mPOST /xrpc/social.spkeasy.privateSession.addUser[2m > [22mshould add a user to existing session[32m 11[2mms[22m[39m
2025-09-10T08:31:23.2586962Z  [32mâœ“[39m tests/integration/api/session.test.ts[2m > [22mPrivate Session API Tests[2m > [22mPOST /xrpc/social.spkeasy.privateSession.addUser[2m > [22mshould require authentication[32m 4[2mms[22m[39m
2025-09-10T08:31:23.2588527Z  [32mâœ“[39m tests/integration/api/session.test.ts[2m > [22mPrivate Session API Tests[2m > [22mPOST /xrpc/social.spkeasy.privateSession.updateKeys[2m > [22mshould update session keys[32m 11[2mms[22m[39m
2025-09-10T08:31:23.2590000Z  [32mâœ“[39m tests/integration/api/session.test.ts[2m > [22mPrivate Session API Tests[2m > [22mPOST /xrpc/social.spkeasy.privateSession.updateKeys[2m > [22mshould require authentication[32m 4[2mms[22m[39m
2025-09-10T08:31:23.2591300Z  [32mâœ“[39m tests/integration/api/session.test.ts[2m > [22mPrivate Session API Tests[2m > [22mHealth Check[2m > [22mshould return healthy status[32m 4[2mms[22m[39m
2025-09-10T08:31:23.2592121Z [2025-09-10 08:31:21.980 +0000] INFO: Shutting down server... {"service":"private-sessions"}
2025-09-10T08:31:23.2592705Z [2025-09-10 08:31:21.984 +0000] INFO: Shutting down server... {"service":"private-sessions"}
2025-09-10T08:31:23.2592985Z 
2025-09-10T08:31:23.2593269Z [31mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[39m[1m[41m Failed Tests 10 [49m[22m[31mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[39m
2025-09-10T08:31:23.2593482Z 
2025-09-10T08:31:23.2594449Z [41m[1m FAIL [22m[49m tests/integration/api/notifications.test.ts[2m > [22mNotifications API Tests[2m > [22mGET /xrpc/social.spkeasy.notification.getUnreadCount[2m > [22mshould return unread notification count
2025-09-10T08:31:23.2595533Z [31m[1mAssertionError[22m: expected { count: +0 } to have property "count" with value 2[39m
2025-09-10T08:31:23.2595851Z 
2025-09-10T08:31:23.2595963Z [32m- Expected[39m
2025-09-10T08:31:23.2596180Z [31m+ Received[39m
2025-09-10T08:31:23.2596297Z 
2025-09-10T08:31:23.2596384Z [32m- 2[39m
2025-09-10T08:31:23.2596565Z [31m+ 0[39m
2025-09-10T08:31:23.2596662Z 
2025-09-10T08:31:23.2597014Z [36m [2mâ¯[22m tests/integration/api/notifications.test.ts:[2m109:29[22m[39m
2025-09-10T08:31:23.2597532Z     [90m107| [39m        [33m.[39m[34mexpect[39m([34m200[39m)[33m;[39m
2025-09-10T08:31:23.2597847Z     [90m108| [39m
2025-09-10T08:31:23.2598571Z     [90m109| [39m      [34mexpect[39m(response[33m.[39mbody)[33m.[39m[34mtoHaveProperty[39m([32m'count'[39m[33m,[39m [34m2[39m)[33m;[39m
2025-09-10T08:31:23.2599283Z     [90m   | [39m                            [31m^[39m
2025-09-10T08:31:23.2599598Z     [90m110| [39m    })[33m;[39m
2025-09-10T08:31:23.2599828Z     [90m111| [39m
2025-09-10T08:31:23.2599936Z 
2025-09-10T08:31:23.2600144Z [31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[1/10]âŽ¯[22m[39m
2025-09-10T08:31:23.2600317Z 
2025-09-10T08:31:23.2601246Z [41m[1m FAIL [22m[49m tests/integration/api/notifications.test.ts[2m > [22mNotifications API Tests[2m > [22mPOST /xrpc/social.spkeasy.notification.updateSeen[2m > [22mshould mark notifications as seen
2025-09-10T08:31:23.2602236Z [31m[1mAssertionError[22m: expected [] to have a length of 2 but got +0[39m
2025-09-10T08:31:23.2602516Z 
2025-09-10T08:31:23.2602622Z [32m- Expected[39m
2025-09-10T08:31:23.2602841Z [31m+ Received[39m
2025-09-10T08:31:23.2602947Z 
2025-09-10T08:31:23.2603032Z [32m- 2[39m
2025-09-10T08:31:23.2603208Z [31m+ 0[39m
2025-09-10T08:31:23.2603299Z 
2025-09-10T08:31:23.2603646Z [36m [2mâ¯[22m tests/integration/api/notifications.test.ts:[2m304:36[22m[39m
2025-09-10T08:31:23.2604051Z     [90m302| [39m      })[33m;[39m
2025-09-10T08:31:23.2604300Z     [90m303| [39m      
2025-09-10T08:31:23.2604824Z     [90m304| [39m      [34mexpect[39m(updatedNotifications)[33m.[39m[34mtoHaveLength[39m([34m2[39m)[33m;[39m
2025-09-10T08:31:23.2605349Z     [90m   | [39m                                   [31m^[39m
2025-09-10T08:31:23.2605873Z     [90m305| [39m      updatedNotifications[33m.[39m[34mforEach[39m(notification [33m=>[39m {
2025-09-10T08:31:23.2606732Z     [90m306| [39m        [34mexpect[39m(notification[33m.[39mreadAt)[33m.[39mnot[33m.[39m[34mtoBeNull[39m()[33m;[39m
2025-09-10T08:31:23.2607091Z 
2025-09-10T08:31:23.2607293Z [31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[2/10]âŽ¯[22m[39m
2025-09-10T08:31:23.2607470Z 
2025-09-10T08:31:23.2608635Z [41m[1m FAIL [22m[49m tests/integration/api/notifications.test.ts[2m > [22mNotifications API Tests[2m > [22mPOST /xrpc/social.spkeasy.notification.updateSeen[2m > [22mshould only update notifications created before seenAt timestamp
2025-09-10T08:31:23.2618798Z [31m[1mAssertionError[22m: expected undefined to be null[39m
2025-09-10T08:31:23.2619066Z 
2025-09-10T08:31:23.2619195Z [32m- Expected:[39m 
2025-09-10T08:31:23.2619389Z null
2025-09-10T08:31:23.2619480Z 
2025-09-10T08:31:23.2619605Z [31m+ Received:[39m 
2025-09-10T08:31:23.2619794Z undefined
2025-09-10T08:31:23.2619886Z 
2025-09-10T08:31:23.2620264Z [36m [2mâ¯[22m tests/integration/api/notifications.test.ts:[2m358:46[22m[39m
2025-09-10T08:31:23.2620669Z     [90m356| [39m      
2025-09-10T08:31:23.2621118Z     [90m357| [39m      expect(updatedOldNotification?.readAt).not.toBeNull(); // Shouldâ€¦
2025-09-10T08:31:23.2621712Z     [90m358| [39m      expect(updatedNewNotification?.readAt).toBeNull(); // Should stiâ€¦
2025-09-10T08:31:23.2622191Z     [90m   | [39m                                             [31m^[39m
2025-09-10T08:31:23.2622515Z     [90m359| [39m    })[33m;[39m
2025-09-10T08:31:23.2622762Z     [90m360| [39m
2025-09-10T08:31:23.2622870Z 
2025-09-10T08:31:23.2623082Z [31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[3/10]âŽ¯[22m[39m
2025-09-10T08:31:23.2623270Z 
2025-09-10T08:31:23.2624229Z [41m[1m FAIL [22m[49m tests/integration/api/private-posts.test.ts[2m > [22mPrivate Posts API Tests[2m > [22mPOST /xrpc/social.spkeasy.privatePost.createPosts[2m > [22mshould create encrypted posts successfully
2025-09-10T08:31:23.2625177Z [31m[1mError[22m: expected 200 "OK", got 400 "Bad Request"[39m
2025-09-10T08:31:23.2625744Z [36m [2mâ¯[22m tests/integration/api/private-posts.test.ts:[2m100:10[22m[39m
2025-09-10T08:31:23.2626391Z     [90m 98| [39m        [33m.[39m[35mset[39m([32m'Content-Type'[39m[33m,[39m [32m'application/json'[39m)
2025-09-10T08:31:23.2626903Z     [90m 99| [39m        [33m.[39m[34msend[39m(postData)
2025-09-10T08:31:23.2627326Z     [90m100| [39m        [33m.[39m[34mexpect[39m([34m200[39m)[33m;[39m
2025-09-10T08:31:23.2627847Z     [90m   | [39m         [31m^[39m
2025-09-10T08:31:23.2628670Z     [90m101| [39m      [34mexpect[39m(response[33m.[39mbody)[33m.[39m[34mtoHaveProperty[39m([32m'success'[39m[33m,[39m [35mtrue[39m)[33m;[39m
2025-09-10T08:31:23.2629201Z     [90m102| [39m
2025-09-10T08:31:23.2629864Z [90m [2mâ¯[22m Test._assertStatus ../../node_modules/.pnpm/supertest@6.3.4/node_modules/supertest/lib/test.js:[2m252:14[22m[39m
2025-09-10T08:31:23.2630709Z [90m [2mâ¯[22m ../../node_modules/.pnpm/supertest@6.3.4/node_modules/supertest/lib/test.js:[2m308:13[22m[39m
2025-09-10T08:31:23.2631590Z [90m [2mâ¯[22m Test._assertFunction ../../node_modules/.pnpm/supertest@6.3.4/node_modules/supertest/lib/test.js:[2m285:13[22m[39m
2025-09-10T08:31:23.2632481Z [90m [2mâ¯[22m Test.assert ../../node_modules/.pnpm/supertest@6.3.4/node_modules/supertest/lib/test.js:[2m164:23[22m[39m
2025-09-10T08:31:23.2633382Z [90m [2mâ¯[22m Server.localAssert ../../node_modules/.pnpm/supertest@6.3.4/node_modules/supertest/lib/test.js:[2m120:14[22m[39m
2025-09-10T08:31:23.2633776Z 
2025-09-10T08:31:23.2633987Z [31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[4/10]âŽ¯[22m[39m
2025-09-10T08:31:23.2634162Z 
2025-09-10T08:31:23.2635072Z [41m[1m FAIL [22m[49m tests/integration/api/private-posts.test.ts[2m > [22mPrivate Posts API Tests[2m > [22mGET /xrpc/social.spkeasy.privatePost.getPosts[2m > [22mshould retrieve encrypted posts for user
2025-09-10T08:31:23.2636054Z [31m[1mAssertionError[22m: expected [] to have a length of 1 but got +0[39m
2025-09-10T08:31:23.2636502Z 
2025-09-10T08:31:23.2636626Z [32m- Expected[39m
2025-09-10T08:31:23.2636846Z [31m+ Received[39m
2025-09-10T08:31:23.2636959Z 
2025-09-10T08:31:23.2637047Z [32m- 1[39m
2025-09-10T08:31:23.2637229Z [31m+ 0[39m
2025-09-10T08:31:23.2637321Z 
2025-09-10T08:31:23.2637665Z [36m [2mâ¯[22m tests/integration/api/private-posts.test.ts:[2m255:44[22m[39m
2025-09-10T08:31:23.2638538Z     [90m253| [39m      [34mexpect[39m(response[33m.[39mbody)[33m.[39m[34mtoHaveProperty[39m([32m'encryptedPosts'[39m)[33m;[39m
2025-09-10T08:31:23.2639429Z     [90m254| [39m      [34mexpect[39m(response[33m.[39mbody)[33m.[39m[34mtoHaveProperty[39m([32m'encryptedSessionKeys'[39m)[33m;[39m
2025-09-10T08:31:23.2640322Z     [90m255| [39m      [34mexpect[39m(response[33m.[39mbody[33m.[39mencryptedPosts)[33m.[39m[34mtoHaveLength[39m([34m1[39m)[33m;[39m
2025-09-10T08:31:23.2640930Z     [90m   | [39m                                           [31m^[39m
2025-09-10T08:31:23.2641458Z     [90m256| [39m      expect(response.body.encryptedPosts[0]).toHaveProperty('uri', teâ€¦
2025-09-10T08:31:23.2641874Z     [90m257| [39m    })[33m;[39m
2025-09-10T08:31:23.2642026Z 
2025-09-10T08:31:23.2642235Z [31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[5/10]âŽ¯[22m[39m
2025-09-10T08:31:23.2642409Z 
2025-09-10T08:31:23.2643291Z [41m[1m FAIL [22m[49m tests/integration/api/private-posts.test.ts[2m > [22mPrivate Posts API Tests[2m > [22mGET /xrpc/social.spkeasy.privatePost.getPosts[2m > [22mshould filter posts by author
2025-09-10T08:31:23.2644243Z [31m[1mAssertionError[22m: expected [] to have a length of 1 but got +0[39m
2025-09-10T08:31:23.2644511Z 
2025-09-10T08:31:23.2644618Z [32m- Expected[39m
2025-09-10T08:31:23.2644869Z [31m+ Received[39m
2025-09-10T08:31:23.2644975Z 
2025-09-10T08:31:23.2645061Z [32m- 1[39m
2025-09-10T08:31:23.2645240Z [31m+ 0[39m
2025-09-10T08:31:23.2645331Z 
2025-09-10T08:31:23.2645671Z [36m [2mâ¯[22m tests/integration/api/private-posts.test.ts:[2m322:44[22m[39m
2025-09-10T08:31:23.2646185Z     [90m320| [39m        [33m.[39m[34mexpect[39m([34m200[39m)[33m;[39m
2025-09-10T08:31:23.2646500Z     [90m321| [39m
2025-09-10T08:31:23.2647106Z     [90m322| [39m      [34mexpect[39m(response[33m.[39mbody[33m.[39mencryptedPosts)[33m.[39m[34mtoHaveLength[39m([34m1[39m)[33m;[39m
2025-09-10T08:31:23.2647709Z     [90m   | [39m                                           [31m^[39m
2025-09-10T08:31:23.2648445Z     [90m323| [39m      expect(response.body.encryptedPosts[0].authorDid).toBe(authorDidâ€¦
2025-09-10T08:31:23.2648874Z     [90m324| [39m    })[33m;[39m
2025-09-10T08:31:23.2649024Z 
2025-09-10T08:31:23.2649232Z [31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[6/10]âŽ¯[22m[39m
2025-09-10T08:31:23.2649408Z 
2025-09-10T08:31:23.2650320Z [41m[1m FAIL [22m[49m tests/integration/api/private-posts.test.ts[2m > [22mPrivate Posts API Tests[2m > [22mGET /xrpc/social.spkeasy.privatePost.getPosts[2m > [22mshould support pagination with cursor
2025-09-10T08:31:23.2651414Z [31m[1mAssertionError[22m: expected [] to have a length of 2 but got +0[39m
2025-09-10T08:31:23.2651686Z 
2025-09-10T08:31:23.2651799Z [32m- Expected[39m
2025-09-10T08:31:23.2652012Z [31m+ Received[39m
2025-09-10T08:31:23.2652119Z 
2025-09-10T08:31:23.2652209Z [32m- 2[39m
2025-09-10T08:31:23.2652384Z [31m+ 0[39m
2025-09-10T08:31:23.2652480Z 
2025-09-10T08:31:23.2652819Z [36m [2mâ¯[22m tests/integration/api/private-posts.test.ts:[2m362:44[22m[39m
2025-09-10T08:31:23.2653336Z     [90m360| [39m        [33m.[39m[34mexpect[39m([34m200[39m)[33m;[39m
2025-09-10T08:31:23.2653642Z     [90m361| [39m
2025-09-10T08:31:23.2654248Z     [90m362| [39m      [34mexpect[39m(response[33m.[39mbody[33m.[39mencryptedPosts)[33m.[39m[34mtoHaveLength[39m([34m2[39m)[33m;[39m
2025-09-10T08:31:23.2654859Z     [90m   | [39m                                           [31m^[39m
2025-09-10T08:31:23.2655483Z     [90m363| [39m      [34mexpect[39m(response[33m.[39mbody)[33m.[39m[34mtoHaveProperty[39m([32m'cursor'[39m)[33m;[39m
2025-09-10T08:31:23.2655983Z     [90m364| [39m    })[33m;[39m
2025-09-10T08:31:23.2656129Z 
2025-09-10T08:31:23.2656340Z [31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[7/10]âŽ¯[22m[39m
2025-09-10T08:31:23.2656513Z 
2025-09-10T08:31:23.2657466Z [41m[1m FAIL [22m[49m tests/integration/api/private-posts.test.ts[2m > [22mPrivate Posts API Tests[2m > [22mGET /xrpc/social.spkeasy.privatePost.getPostThread[2m > [22mshould retrieve post thread with replies
2025-09-10T08:31:23.2658506Z [31m[1mError[22m: expected 200 "OK", got 404 "Not Found"[39m
2025-09-10T08:31:23.2659060Z [36m [2mâ¯[22m tests/integration/api/private-posts.test.ts:[2m425:10[22m[39m
2025-09-10T08:31:23.2659980Z     [90m423| [39m        [33m.[39m[35mset[39m([32m'Authorization'[39m[33m,[39m [32m`***
2025-09-10T08:31:23.2660531Z     [90m424| [39m        [33m.[39m[34mquery[39m({ uri[33m:[39m actualParentUri })
2025-09-10T08:31:23.2661019Z     [90m425| [39m        [33m.[39m[34mexpect[39m([34m200[39m)[33m;[39m
2025-09-10T08:31:23.2661398Z     [90m   | [39m         [31m^[39m
2025-09-10T08:31:23.2661641Z     [90m426| [39m
2025-09-10T08:31:23.2662220Z     [90m427| [39m      [34mexpect[39m(response[33m.[39mbody)[33m.[39m[34mtoHaveProperty[39m([32m'encryptedPost'[39m)[33m;[39m
2025-09-10T08:31:23.2663172Z [90m [2mâ¯[22m Test._assertStatus ../../node_modules/.pnpm/supertest@6.3.4/node_modules/supertest/lib/test.js:[2m252:14[22m[39m
2025-09-10T08:31:23.2664015Z [90m [2mâ¯[22m ../../node_modules/.pnpm/supertest@6.3.4/node_modules/supertest/lib/test.js:[2m308:13[22m[39m
2025-09-10T08:31:23.2664898Z [90m [2mâ¯[22m Test._assertFunction ../../node_modules/.pnpm/supertest@6.3.4/node_modules/supertest/lib/test.js:[2m285:13[22m[39m
2025-09-10T08:31:23.2665807Z [90m [2mâ¯[22m Test.assert ../../node_modules/.pnpm/supertest@6.3.4/node_modules/supertest/lib/test.js:[2m164:23[22m[39m
2025-09-10T08:31:23.2666722Z [90m [2mâ¯[22m Server.localAssert ../../node_modules/.pnpm/supertest@6.3.4/node_modules/supertest/lib/test.js:[2m120:14[22m[39m
2025-09-10T08:31:23.2667132Z 
2025-09-10T08:31:23.2667339Z [31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[8/10]âŽ¯[22m[39m
2025-09-10T08:31:23.2667519Z 
2025-09-10T08:31:23.2668517Z [41m[1m FAIL [22m[49m tests/integration/api/reactions.test.ts[2m > [22mReactions API Tests[2m > [22mPOST /xrpc/social.spkeasy.reaction.createReaction[2m > [22mshould create a reaction successfully
2025-09-10T08:31:23.2669551Z [31m[1mAssertionError[22m: expected null not to be null[39m
2025-09-10T08:31:23.2670101Z [36m [2mâ¯[22m tests/integration/api/reactions.test.ts:[2m117:28[22m[39m
2025-09-10T08:31:23.2670496Z     [90m115| [39m      })[33m;[39m
2025-09-10T08:31:23.2670748Z     [90m116| [39m      
2025-09-10T08:31:23.2671209Z     [90m117| [39m      [34mexpect[39m(reaction)[33m.[39mnot[33m.[39m[34mtoBeNull[39m()[33m;[39m
2025-09-10T08:31:23.2671680Z     [90m   | [39m                           [31m^[39m
2025-09-10T08:31:23.2672347Z     [90m118| [39m      [34mexpect[39m(reaction[33m?.[39muserDid)[33m.[39m[34mtoBe[39m(userDid)[33m;[39m
2025-09-10T08:31:23.2673019Z     [90m119| [39m      [34mexpect[39m(reaction[33m?.[39muri)[33m.[39m[34mtoBe[39m(testPostUri)[33m;[39m
2025-09-10T08:31:23.2673338Z 
2025-09-10T08:31:23.2673542Z [31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[9/10]âŽ¯[22m[39m
2025-09-10T08:31:23.2673715Z 
2025-09-10T08:31:23.2674556Z [41m[1m FAIL [22m[49m tests/integration/api/reactions.test.ts[2m > [22mReactions API Tests[2m > [22mReaction Integration Tests[2m > [22mshould handle multiple reactions from different users
2025-09-10T08:31:23.2675346Z [31m[1mPrismaClientKnownRequestError[22m: 
2025-09-10T08:31:23.2675704Z Invalid `prisma.session.deleteMany()` invocation in
2025-09-10T08:31:23.2676366Z /home/runner/work/services/services/services/private-sessions/tests/integration/api/reactions.test.ts:53:26
2025-09-10T08:31:23.2676797Z 
2025-09-10T08:31:23.2676930Z   50 await prisma.notification.deleteMany();
2025-09-10T08:31:23.2677260Z   51 await prisma.encryptedPost.deleteMany();
2025-09-10T08:31:23.2677563Z   52 await prisma.sessionKey.deleteMany();
2025-09-10T08:31:23.2677909Z â†’ 53 await prisma.session.deleteMany(
2025-09-10T08:31:23.2678569Z Foreign key constraint violated on the constraint: `encrypted_posts_sessionId_fkey`[39m
2025-09-10T08:31:23.2679355Z [90m [2mâ¯[22m ei.handleRequestError src/generated/prisma-client/runtime/library.js:[2m124:7283[22m[39m
2025-09-10T08:31:23.2680198Z [90m [2mâ¯[22m ei.handleAndLogRequestError src/generated/prisma-client/runtime/library.js:[2m124:6608[22m[39m
2025-09-10T08:31:23.2680973Z [90m [2mâ¯[22m ei.request src/generated/prisma-client/runtime/library.js:[2m124:6315[22m[39m
2025-09-10T08:31:23.2681633Z [90m [2mâ¯[22m a src/generated/prisma-client/runtime/library.js:[2m133:9551[22m[39m
2025-09-10T08:31:23.2682222Z [36m [2mâ¯[22m tests/integration/api/reactions.test.ts:[2m53:5[22m[39m
2025-09-10T08:31:23.2682852Z     [90m 51| [39m    [35mawait[39m prisma[33m.[39mencryptedPost[33m.[39m[34mdeleteMany[39m()[33m;[39m
2025-09-10T08:31:23.2683528Z     [90m 52| [39m    [35mawait[39m prisma[33m.[39msessionKey[33m.[39m[34mdeleteMany[39m()[33m;[39m
2025-09-10T08:31:23.2684153Z     [90m 53| [39m    [35mawait[39m prisma[33m.[39msession[33m.[39m[34mdeleteMany[39m()[33m;[39m
2025-09-10T08:31:23.2684567Z     [90m   | [39m    [31m^[39m
2025-09-10T08:31:23.2684814Z     [90m 54| [39m    
2025-09-10T08:31:23.2685159Z     [90m 55| [39m    [90m// Setup mock for Bluesky session validation[39m
2025-09-10T08:31:23.2685391Z 
2025-09-10T08:31:23.2685604Z [31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[22m[39m
2025-09-10T08:31:23.2686601Z [31m[1mSerialized Error:[22m[39m [90m{ code: 'P2003', meta: { modelName: 'Session', constraint: 'encrypted_posts_sessionId_fkey' }, clientVersion: '6.15.0', batchRequestIdx: undefined }[39m
2025-09-10T08:31:23.2687382Z [31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[10/10]âŽ¯[22m[39m
2025-09-10T08:31:23.2687572Z 
2025-09-10T08:31:23.2687578Z 
2025-09-10T08:31:23.2688060Z [2m Test Files [22m [1m[31m3 failed[39m[22m[2m | [22m[1m[32m1 passed[39m[22m[90m (4)[39m
2025-09-10T08:31:23.2688721Z [2m      Tests [22m [1m[31m10 failed[39m[22m[2m | [22m[1m[32m45 passed[39m[22m[90m (55)[39m
2025-09-10T08:31:23.2689141Z [2m   Start at [22m 08:31:15
2025-09-10T08:31:23.2689916Z [2m   Duration [22m 7.58s[2m (transform 1.40s, setup 687ms, collect 7.53s, tests 3.04s, environment 1ms, prepare 1.71s)[22m
2025-09-10T08:31:23.2690292Z 
2025-09-10T08:31:23.2690297Z 
2025-09-10T08:31:23.2693869Z ##[error]AssertionError: expected { count: +0 } to have property "count" with value 2

- Expected
+ Received

- 2
+ 0

 â¯ tests/integration/api/notifications.test.ts:109:29


2025-09-10T08:31:23.2694833Z 
2025-09-10T08:31:23.2696134Z ##[error]AssertionError: expected [] to have a length of 2 but got +0

- Expected
+ Received

- 2
+ 0

 â¯ tests/integration/api/notifications.test.ts:304:36


2025-09-10T08:31:23.2697136Z 
2025-09-10T08:31:23.2698567Z ##[error]AssertionError: expected undefined to be null

- Expected: 
null

+ Received: 
undefined

 â¯ tests/integration/api/notifications.test.ts:358:46


2025-09-10T08:31:23.2699396Z 
2025-09-10T08:31:23.2703320Z ##[error]Error: expected 200 "OK", got 400 "Bad Request"
 â¯ tests/integration/api/private-posts.test.ts:100:10
 â¯ Test._assertStatus ../../node_modules/.pnpm/supertest@6.3.4/node_modules/supertest/lib/test.js:252:14
 â¯ ../../node_modules/.pnpm/supertest@6.3.4/node_modules/supertest/lib/test.js:308:13
 â¯ Test._assertFunction ../../node_modules/.pnpm/supertest@6.3.4/node_modules/supertest/lib/test.js:285:13
 â¯ Test.assert ../../node_modules/.pnpm/supertest@6.3.4/node_modules/supertest/lib/test.js:164:23
 â¯ Server.localAssert ../../node_modules/.pnpm/supertest@6.3.4/node_modules/supertest/lib/test.js:120:14


2025-09-10T08:31:23.2705411Z 
2025-09-10T08:31:23.2706554Z ##[error]AssertionError: expected [] to have a length of 1 but got +0

- Expected
+ Received

- 1
+ 0

 â¯ tests/integration/api/private-posts.test.ts:255:44


2025-09-10T08:31:23.2707348Z 
2025-09-10T08:31:23.2708597Z ##[error]AssertionError: expected [] to have a length of 1 but got +0

- Expected
+ Received

- 1
+ 0

 â¯ tests/integration/api/private-posts.test.ts:322:44


2025-09-10T08:31:23.2709400Z 
2025-09-10T08:31:23.2710545Z ##[error]AssertionError: expected [] to have a length of 2 but got +0

- Expected
+ Received

- 2
+ 0

 â¯ tests/integration/api/private-posts.test.ts:362:44


2025-09-10T08:31:23.2711366Z 
2025-09-10T08:31:23.2715328Z ##[error]Error: expected 200 "OK", got 404 "Not Found"
 â¯ tests/integration/api/private-posts.test.ts:425:10
 â¯ Test._assertStatus ../../node_modules/.pnpm/supertest@6.3.4/node_modules/supertest/lib/test.js:252:14
 â¯ ../../node_modules/.pnpm/supertest@6.3.4/node_modules/supertest/lib/test.js:308:13
 â¯ Test._assertFunction ../../node_modules/.pnpm/supertest@6.3.4/node_modules/supertest/lib/test.js:285:13
 â¯ Test.assert ../../node_modules/.pnpm/supertest@6.3.4/node_modules/supertest/lib/test.js:164:23
 â¯ Server.localAssert ../../node_modules/.pnpm/supertest@6.3.4/node_modules/supertest/lib/test.js:120:14


2025-09-10T08:31:23.2717449Z 
2025-09-10T08:31:23.2718499Z ##[error]AssertionError: expected null not to be null
 â¯ tests/integration/api/reactions.test.ts:117:28


2025-09-10T08:31:23.2719216Z 
2025-09-10T08:31:23.2726011Z ##[error]PrismaClientKnownRequestError: 
Invalid `prisma.session.deleteMany()` invocation in
/home/runner/work/services/services/services/private-sessions/tests/integration/api/reactions.test.ts:53:26

  50 await prisma.notification.deleteMany();
  51 await prisma.encryptedPost.deleteMany();
  52 await prisma.sessionKey.deleteMany();
â†’ 53 await prisma.session.deleteMany(
Foreign key constraint violated on the constraint: `encrypted_posts_sessionId_fkey`
 â¯ ei.handleRequestError src/generated/prisma-client/runtime/library.js:124:7283
 â¯ ei.handleAndLogRequestError src/generated/prisma-client/runtime/library.js:124:6608
 â¯ ei.request src/generated/prisma-client/runtime/library.js:124:6315
 â¯ a src/generated/prisma-client/runtime/library.js:133:9551
 â¯ tests/integration/api/reactions.test.ts:53:5

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'P2003', meta: { modelName: 'Session', constraint: 'encrypted_posts_sessionId_fkey' }, clientVersion: '6.15.0', batchRequestIdx: undefined }

2025-09-10T08:31:23.2729898Z â€‰ELIFECYCLEâ€‰ Test failed. See above for more details.
2025-09-10T08:31:23.2730438Z [WARN] command finished with error, but continuing...
2025-09-10T08:31:23.2730645Z 
2025-09-10T08:31:23.2730758Z  Tasks:    17 successful, 18 total
2025-09-10T08:31:23.2731038Z Cached:    10 cached, 18 total
2025-09-10T08:31:23.2731256Z   Time:    9.926s 
2025-09-10T08:31:23.2731538Z Failed:    @speakeasy-services/private-sessions#test
2025-09-10T08:31:23.2731744Z 
2025-09-10T08:31:23.2731977Z â€‰ELIFECYCLEâ€‰ Test failed. See above for more details.
2025-09-10T08:31:23.2733542Z ##[error]Process completed with exit code 1.
2025-09-10T08:31:23.2780891Z Post job cleanup.
2025-09-10T08:31:23.3308811Z Pruning is unnecessary.
2025-09-10T08:31:23.3398443Z Post job cleanup.
2025-09-10T08:31:23.4320706Z [command]/usr/bin/git version
2025-09-10T08:31:23.4357160Z git version 2.51.0
2025-09-10T08:31:23.4405467Z Temporarily overriding HOME='/home/runner/work/_temp/2ead2542-9cec-4b7e-a66f-bd1fdcc0b76b' before making global git config changes
2025-09-10T08:31:23.4406606Z Adding repository directory to the temporary git global config as a safe directory
2025-09-10T08:31:23.4410511Z [command]/usr/bin/git config --global --add safe.directory /home/runner/work/services/services
2025-09-10T08:31:23.4444308Z [command]/usr/bin/git config --local --name-only --get-regexp core\.sshCommand
2025-09-10T08:31:23.4477493Z [command]/usr/bin/git submodule foreach --recursive sh -c "git config --local --name-only --get-regexp 'core\.sshCommand' && git config --local --unset-all 'core.sshCommand' || :"
2025-09-10T08:31:23.4719510Z [command]/usr/bin/git config --local --name-only --get-regexp http\.https\:\/\/github\.com\/\.extraheader
2025-09-10T08:31:23.4742456Z http.https://github.com/.extraheader
2025-09-10T08:31:23.4755111Z [command]/usr/bin/git config --local --unset-all http.https://github.com/.extraheader
2025-09-10T08:31:23.4787916Z [command]/usr/bin/git submodule foreach --recursive sh -c "git config --local --name-only --get-regexp 'http\.https\:\/\/github\.com\/\.extraheader' && git config --local --unset-all 'http.https://github.com/.extraheader' || :"
2025-09-10T08:31:23.5104854Z Print service container logs: 8aa5bf64f2a2455aa0a50299e31d5cf1_postgres15alpine_969090
2025-09-10T08:31:23.5109751Z ##[command]/usr/bin/docker logs --details 740d372ee3f147e6cbc4957c2aba839dfe922d79340b25e1219e3bef33eed394
2025-09-10T08:31:23.5235539Z  sh: locale: not found
2025-09-10T08:31:23.5236079Z  2025-09-10 08:29:24.493 UTC [35] WARNING:  no usable system locales were found
2025-09-10T08:31:23.5236852Z  The files belonging to this database system will be owned by user "postgres".
2025-09-10T08:31:23.5237538Z  This user must also own the server process.
2025-09-10T08:31:23.5237902Z  
2025-09-10T08:31:23.5238489Z  The database cluster will be initialized with locale "en_US.utf8".
2025-09-10T08:31:23.5239215Z  The default database encoding has accordingly been set to "UTF8".
2025-09-10T08:31:23.5239873Z  The default text search configuration will be set to "english".
2025-09-10T08:31:23.5240358Z  
2025-09-10T08:31:23.5240612Z  Data page checksums are disabled.
2025-09-10T08:31:23.5241020Z  
2025-09-10T08:31:23.5241452Z  fixing permissions on existing directory /var/lib/postgresql/data ... ok
2025-09-10T08:31:23.5242046Z  creating subdirectories ... ok
2025-09-10T08:31:23.5242506Z  selecting dynamic shared memory implementation ... posix
2025-09-10T08:31:23.5243028Z  selecting default max_connections ... 100
2025-09-10T08:31:23.5243464Z  selecting default shared_buffers ... 128MB
2025-09-10T08:31:23.5243880Z  selecting default time zone ... UTC
2025-09-10T08:31:23.5244277Z  creating configuration files ... ok
2025-09-10T08:31:23.5244674Z  running bootstrap script ... ok
2025-09-10T08:31:23.5245112Z  performing post-bootstrap initialization ... ok
2025-09-10T08:31:23.5245551Z  syncing data to disk ... ok
2025-09-10T08:31:23.5245849Z  
2025-09-10T08:31:23.5246062Z  
2025-09-10T08:31:23.5246362Z  Success. You can now start the database server using:
2025-09-10T08:31:23.5246797Z  
2025-09-10T08:31:23.5247118Z      pg_ctl -D /var/lib/postgresql/data -l logfile start
2025-09-10T08:31:23.5247540Z  
2025-09-10T08:31:23.5248132Z  initdb: warning: enabling "trust" authentication for local connections
2025-09-10T08:31:23.5249169Z  initdb: hint: You can change this by editing pg_hba.conf or using the option -A, or --auth-local and --auth-host, the next time you run initdb.
2025-09-10T08:31:23.5250427Z  2025-09-10 08:29:25.565 UTC [1] LOG:  starting PostgreSQL 15.14 on x86_64-pc-linux-musl, compiled by gcc (Alpine 14.2.0) 14.2.0, 64-bit
2025-09-10T08:31:23.5251377Z  2025-09-10 08:29:25.565 UTC [1] LOG:  listening on IPv4 address "0.0.0.0", port 5432
2025-09-10T08:31:23.5252342Z  2025-09-10 08:29:25.565 UTC [1] LOG:  listening on IPv6 address "::", port 5432
2025-09-10T08:31:23.5253069Z  2025-09-10 08:29:25.567 UTC [1] LOG:  listening on Unix socket "/var/run/postgresql/.s.PGSQL.5432"
2025-09-10T08:31:23.5253787Z  2025-09-10 08:29:25.571 UTC [57] LOG:  database system was shut down at 2025-09-10 08:29:25 UTC
2025-09-10T08:31:23.5254446Z  2025-09-10 08:29:25.576 UTC [1] LOG:  database system is ready to accept connections
2025-09-10T08:31:23.5255000Z  2025-09-10 08:29:34.049 UTC [67] FATAL:  role "root" does not exist
2025-09-10T08:31:23.5255523Z  2025-09-10 08:29:44.101 UTC [74] FATAL:  role "root" does not exist
2025-09-10T08:31:23.5256094Z  2025-09-10 08:29:54.151 UTC [81] FATAL:  role "root" does not exist
2025-09-10T08:31:23.5256826Z  2025-09-10 08:30:04.226 UTC [89] FATAL:  role "root" does not exist
2025-09-10T08:31:23.5257398Z  2025-09-10 08:30:14.266 UTC [96] FATAL:  role "root" does not exist
2025-09-10T08:31:23.5257922Z  2025-09-10 08:30:24.313 UTC [105] FATAL:  role "root" does not exist
2025-09-10T08:31:23.5258443Z  2025-09-10 08:30:34.377 UTC [123] FATAL:  role "root" does not exist
2025-09-10T08:31:23.5258802Z  2025-09-10 08:30:44.420 UTC [134] FATAL:  role "root" does not exist
2025-09-10T08:31:23.5259131Z  2025-09-10 08:30:54.492 UTC [141] FATAL:  role "root" does not exist
2025-09-10T08:31:23.5259716Z  2025-09-10 08:31:04.568 UTC [148] FATAL:  role "root" does not exist
2025-09-10T08:31:23.5260534Z  2025-09-10 08:31:14.664 UTC [156] FATAL:  role "root" does not exist
2025-09-10T08:31:23.5261122Z  2025-09-10 08:31:19.550 UTC [171] ERROR:  insert or update on table "encrypted_posts" violates foreign key constraint "encrypted_posts_sessionId_fkey"
2025-09-10T08:31:23.5261898Z  2025-09-10 08:31:19.550 UTC [171] DETAIL:  Key (sessionId)=(dac1569c-df2c-4139-a6ed-05c27c3351f2) is not present in table "sessions".
2025-09-10T08:31:23.5262892Z  2025-09-10 08:31:19.550 UTC [171] STATEMENT:  INSERT INTO "private_sessions"."encrypted_posts" ("uri","rkey","sessionId","authorDid","langs","replyRootUri","replyUri","encryptedContent","createdAt") VALUES ($1,$2,$3,$4,$5,$6,$7,$8,$9)
2025-09-10T08:31:23.5263845Z  2025-09-10 08:31:19.745 UTC [176] ERROR:  duplicate key value violates unique constraint "idx_trusted_users_unique_active"
2025-09-10T08:31:23.5264530Z  2025-09-10 08:31:19.745 UTC [176] DETAIL:  Key ("authorDid", "recipientDid")=(did:example:alex-author, did:example:valid-valery) already exists.
2025-09-10T08:31:23.5265820Z  2025-09-10 08:31:19.745 UTC [176] STATEMENT:  INSERT INTO "trusted_users"."trusted_users" ("authorDid","recipientDid","createdAt") VALUES ($1,$2,$3) RETURNING "trusted_users"."trusted_users"."authorDid", "trusted_users"."trusted_users"."recipientDid", "trusted_users"."trusted_users"."createdAt", "trusted_users"."trusted_users"."deletedAt"
2025-09-10T08:31:23.5267015Z  2025-09-10 08:31:19.750 UTC [173] ERROR:  duplicate key value violates unique constraint "reactions_userDid_uri_key"
2025-09-10T08:31:23.5267785Z  2025-09-10 08:31:19.750 UTC [173] DETAIL:  Key ("userDid", uri)=(did:example:user, at://did:example:author/social.spkeasy.privatePost/test-post) already exists.
2025-09-10T08:31:23.5269354Z  2025-09-10 08:31:19.750 UTC [173] STATEMENT:  INSERT INTO "private_sessions"."reactions" ("id","userDid","uri","createdAt") VALUES ($1,$2,$3,$4) RETURNING "private_sessions"."reactions"."id", "private_sessions"."reactions"."userDid", "private_sessions"."reactions"."uri", "private_sessions"."reactions"."createdAt", "private_sessions"."reactions"."updatedAt"
2025-09-10T08:31:23.5270773Z  2025-09-10 08:31:20.026 UTC [163] ERROR:  update or delete on table "sessions" violates foreign key constraint "encrypted_posts_sessionId_fkey" on table "encrypted_posts"
2025-09-10T08:31:23.5271604Z  2025-09-10 08:31:20.026 UTC [163] DETAIL:  Key (id)=(39b867aa-970c-4245-b670-15b37a627a92) is still referenced from table "encrypted_posts".
2025-09-10T08:31:23.5272225Z  2025-09-10 08:31:20.026 UTC [163] STATEMENT:  DELETE FROM "private_sessions"."sessions" WHERE 1=1
2025-09-10T08:31:23.5273043Z  waiting for server to start....2025-09-10 08:29:25.249 UTC [41] LOG:  starting PostgreSQL 15.14 on x86_64-pc-linux-musl, compiled by gcc (Alpine 14.2.0) 14.2.0, 64-bit
2025-09-10T08:31:23.5273720Z  2025-09-10 08:29:25.250 UTC [41] LOG:  listening on Unix socket "/var/run/postgresql/.s.PGSQL.5432"
2025-09-10T08:31:23.5274201Z  2025-09-10 08:29:25.254 UTC [44] LOG:  database system was shut down at 2025-09-10 08:29:25 UTC
2025-09-10T08:31:23.5274636Z  2025-09-10 08:29:25.258 UTC [41] LOG:  database system is ready to accept connections
2025-09-10T08:31:23.5274964Z   done
2025-09-10T08:31:23.5275127Z  server started
2025-09-10T08:31:23.5275301Z  CREATE DATABASE
2025-09-10T08:31:23.5275464Z  
2025-09-10T08:31:23.5275612Z  
2025-09-10T08:31:23.5275914Z  /usr/local/bin/docker-entrypoint.sh: ignoring /docker-entrypoint-initdb.d/*
2025-09-10T08:31:23.5276280Z  
2025-09-10T08:31:23.5276572Z  waiting for server to shut down...2025-09-10 08:29:25.436 UTC [41] LOG:  received fast shutdown request
2025-09-10T08:31:23.5277028Z  .2025-09-10 08:29:25.438 UTC [41] LOG:  aborting any active transactions
2025-09-10T08:31:23.5277529Z  2025-09-10 08:29:25.440 UTC [41] LOG:  background worker "logical replication launcher" (PID 47) exited with exit code 1
2025-09-10T08:31:23.5278174Z  2025-09-10 08:29:25.443 UTC [42] LOG:  shutting down
2025-09-10T08:31:23.5278607Z  2025-09-10 08:29:25.443 UTC [42] LOG:  checkpoint starting: shutdown immediate
2025-09-10T08:31:23.5279615Z  2025-09-10 08:29:25.469 UTC [42] LOG:  checkpoint complete: wrote 921 buffers (5.6%); 0 WAL file(s) added, 0 removed, 0 recycled; write=0.021 s, sync=0.003 s, total=0.026 s; sync files=301, longest=0.001 s, average=0.001 s; distance=4239 kB, estimate=4239 kB
2025-09-10T08:31:23.5280411Z  2025-09-10 08:29:25.478 UTC [41] LOG:  database system is shut down
2025-09-10T08:31:23.5280686Z   done
2025-09-10T08:31:23.5280837Z  server stopped
2025-09-10T08:31:23.5280992Z  
2025-09-10T08:31:23.5281196Z  PostgreSQL init process complete; ready for start up.
2025-09-10T08:31:23.5281457Z  
2025-09-10T08:31:23.5287066Z Stop and remove container: 8aa5bf64f2a2455aa0a50299e31d5cf1_postgres15alpine_969090
2025-09-10T08:31:23.5291696Z ##[command]/usr/bin/docker rm --force 740d372ee3f147e6cbc4957c2aba839dfe922d79340b25e1219e3bef33eed394
2025-09-10T08:31:23.7813519Z 740d372ee3f147e6cbc4957c2aba839dfe922d79340b25e1219e3bef33eed394
2025-09-10T08:31:23.7836019Z Print service container logs: f73d8c708e4043b0bd7a54c71649e65a_localstacklocalstacklatest_1ba29c
2025-09-10T08:31:23.7838356Z ##[command]/usr/bin/docker logs --details cf2411009a9b5b7c8a72ad0c8e2b62ddd492d94af1e06971cb43de553307fd28
2025-09-10T08:31:23.7963444Z  LocalStack supervisor: starting
2025-09-10T08:31:23.7964066Z  LocalStack supervisor: localstack process (PID 13) starting
2025-09-10T08:31:23.7965159Z  2025-09-10T08:29:48.317 DEBUG --- [  MainThread] l.utils.docker_utils       : Using SdkDockerClient. LEGACY_DOCKER_CLIENT: False, SDK installed: True
2025-09-10T08:31:23.7968308Z  2025-09-10T08:29:48.319 DEBUG --- [  MainThread] l.u.c.docker_sdk_client    : Creating Docker SDK client failed: Error while fetching server API version: ('Connection aborted.', FileNotFoundError(2, 'No such file or directory')). If you want to use Docker as container runtime, make sure to mount the socket at /var/run/docker.sock
2025-09-10T08:31:23.7970763Z  2025-09-10T08:29:48.503  WARN --- [  MainThread] l.services.internal        : Enabling diagnose endpoint, please be aware that this can expose sensitive information via your network.
2025-09-10T08:31:23.7972634Z  2025-09-10T08:29:48.512 DEBUG --- [  MainThread] plux.runtime.manager       : instantiating plugin PluginSpec(localstack.runtime.components.aws = <class 'localstack.aws.components.AwsComponents'>)
2025-09-10T08:31:23.7974224Z  2025-09-10T08:29:48.512 DEBUG --- [  MainThread] plux.runtime.manager       : loading plugin localstack.runtime.components:aws
2025-09-10T08:31:23.7974982Z  
2025-09-10T08:31:23.7975245Z  LocalStack version: 4.7.1.dev140
2025-09-10T08:31:23.7975965Z  LocalStack build date: 2025-09-10
2025-09-10T08:31:23.7976354Z  LocalStack build git hash: fd33aafb9
2025-09-10T08:31:23.7976719Z  
2025-09-10T08:31:23.7977324Z  2025-09-10T08:29:48.512 DEBUG --- [  MainThread] localstack.utils.run       : Executing command: rm -rf "/tmp/localstack"
2025-09-10T08:31:23.7979355Z  2025-09-10T08:29:48.548 DEBUG --- [  MainThread] plux.runtime.manager       : instantiating plugin PluginSpec(localstack.hooks.on_infra_start._patch_botocore_endpoint_in_memory = <function _patch_botocore_endpoint_in_memory at 0x7fe2257c89a0>)
2025-09-10T08:31:23.7981580Z  2025-09-10T08:29:48.548 DEBUG --- [  MainThread] plux.runtime.manager       : plugin localstack.hooks.on_infra_start:_patch_botocore_endpoint_in_memory is disabled, reason: Load condition for plugin was false
2025-09-10T08:31:23.7983716Z  2025-09-10T08:29:48.549 DEBUG --- [  MainThread] plux.runtime.manager       : instantiating plugin PluginSpec(localstack.hooks.on_infra_start._patch_botocore_json_parser = <function _patch_botocore_json_parser at 0x7fe2257c85e0>)
2025-09-10T08:31:23.7985631Z  2025-09-10T08:29:48.549 DEBUG --- [  MainThread] plux.runtime.manager       : loading plugin localstack.hooks.on_infra_start:_patch_botocore_json_parser
2025-09-10T08:31:23.7988260Z  2025-09-10T08:29:48.549 DEBUG --- [  MainThread] plux.runtime.manager       : instantiating plugin PluginSpec(localstack.hooks.on_infra_start._patch_cbor2 = <function _patch_cbor2 at 0x7fe2257c8720>)
2025-09-10T08:31:23.7989472Z  2025-09-10T08:29:48.549 DEBUG --- [  MainThread] plux.runtime.manager       : loading plugin localstack.hooks.on_infra_start:_patch_cbor2
2025-09-10T08:31:23.7990573Z  2025-09-10T08:29:48.549 DEBUG --- [  MainThread] plux.runtime.manager       : instantiating plugin PluginSpec(localstack.hooks.on_infra_start._publish_config_as_analytics_event = <function _publish_config_as_analytics_event at 0x7fe224cf1440>)
2025-09-10T08:31:23.7991721Z  2025-09-10T08:29:48.549 DEBUG --- [  MainThread] plux.runtime.manager       : loading plugin localstack.hooks.on_infra_start:_publish_config_as_analytics_event
2025-09-10T08:31:23.7992789Z  2025-09-10T08:29:48.549 DEBUG --- [  MainThread] plux.runtime.manager       : instantiating plugin PluginSpec(localstack.hooks.on_infra_start._publish_container_info = <function _publish_container_info at 0x7fe224cf0cc0>)
2025-09-10T08:31:23.7993804Z  2025-09-10T08:29:48.549 DEBUG --- [  MainThread] plux.runtime.manager       : loading plugin localstack.hooks.on_infra_start:_publish_container_info
2025-09-10T08:31:23.7994816Z  2025-09-10T08:29:48.549 DEBUG --- [  MainThread] plux.runtime.manager       : instantiating plugin PluginSpec(localstack.hooks.on_infra_start._run_init_scripts_on_start = <function _run_init_scripts_on_start at 0x7fe224cbf100>)
2025-09-10T08:31:23.7995841Z  2025-09-10T08:29:48.549 DEBUG --- [  MainThread] plux.runtime.manager       : loading plugin localstack.hooks.on_infra_start:_run_init_scripts_on_start
2025-09-10T08:31:23.7996868Z  2025-09-10T08:29:48.549 DEBUG --- [  MainThread] plux.runtime.manager       : instantiating plugin PluginSpec(localstack.hooks.on_infra_start.apply_aws_runtime_patches = <function apply_aws_runtime_patches at 0x7fe224cf0fe0>)
2025-09-10T08:31:23.7997910Z  2025-09-10T08:29:48.549 DEBUG --- [  MainThread] plux.runtime.manager       : loading plugin localstack.hooks.on_infra_start:apply_aws_runtime_patches
2025-09-10T08:31:23.7999154Z  2025-09-10T08:29:48.549 DEBUG --- [  MainThread] plux.runtime.manager       : instantiating plugin PluginSpec(localstack.hooks.on_infra_start.apply_runtime_patches = <function apply_runtime_patches at 0x7fe224cf0860>)
2025-09-10T08:31:23.8000152Z  2025-09-10T08:29:48.549 DEBUG --- [  MainThread] plux.runtime.manager       : loading plugin localstack.hooks.on_infra_start:apply_runtime_patches
2025-09-10T08:31:23.8001218Z  2025-09-10T08:29:48.549 DEBUG --- [  MainThread] plux.runtime.manager       : instantiating plugin PluginSpec(localstack.hooks.on_infra_start.conditionally_enable_debugger = <function conditionally_enable_debugger at 0x7fe224cf0400>)
2025-09-10T08:31:23.8002450Z  2025-09-10T08:29:48.549 DEBUG --- [  MainThread] plux.runtime.manager       : loading plugin localstack.hooks.on_infra_start:conditionally_enable_debugger
2025-09-10T08:31:23.8003490Z  2025-09-10T08:29:48.549 DEBUG --- [  MainThread] plux.runtime.manager       : instantiating plugin PluginSpec(localstack.hooks.on_infra_start.delete_cached_certificate = <function delete_cached_certificate at 0x7fe224cf00e0>)
2025-09-10T08:31:23.8004664Z  2025-09-10T08:29:48.549 DEBUG --- [  MainThread] plux.runtime.manager       : plugin localstack.hooks.on_infra_start:delete_cached_certificate is disabled, reason: Load condition for plugin was false
2025-09-10T08:31:23.8005810Z  2025-09-10T08:29:48.549 DEBUG --- [  MainThread] plux.runtime.manager       : instantiating plugin PluginSpec(localstack.hooks.on_infra_start.deprecation_warnings = <function deprecation_warnings at 0x7fe224cf0220>)
2025-09-10T08:31:23.8006793Z  2025-09-10T08:29:48.550 DEBUG --- [  MainThread] plux.runtime.manager       : loading plugin localstack.hooks.on_infra_start:deprecation_warnings
2025-09-10T08:31:23.8007768Z  2025-09-10T08:29:48.550 DEBUG --- [  MainThread] plux.runtime.manager       : instantiating plugin PluginSpec(localstack.hooks.on_infra_start.eager_load_services = <function eager_load_services at 0x7fe224cbd260>)
2025-09-10T08:31:23.8009171Z  2025-09-10T08:29:48.550 DEBUG --- [  MainThread] plux.runtime.manager       : plugin localstack.hooks.on_infra_start:eager_load_services is disabled, reason: Load condition for plugin was false
2025-09-10T08:31:23.8010345Z  2025-09-10T08:29:48.550 DEBUG --- [  MainThread] plux.runtime.manager       : instantiating plugin PluginSpec(localstack.hooks.on_infra_start.init_response_mutation_handler = <function init_response_mutation_handler at 0x7fe224cf3d80>)
2025-09-10T08:31:23.8011416Z  2025-09-10T08:29:48.550 DEBUG --- [  MainThread] plux.runtime.manager       : loading plugin localstack.hooks.on_infra_start:init_response_mutation_handler
2025-09-10T08:31:23.8012549Z  2025-09-10T08:29:48.550 DEBUG --- [  MainThread] plux.runtime.manager       : instantiating plugin PluginSpec(localstack.hooks.on_infra_start.register_cloudformation_deploy_ui = <function register_cloudformation_deploy_ui at 0x7fe224d2c040>)
2025-09-10T08:31:23.8013669Z  2025-09-10T08:29:48.550 DEBUG --- [  MainThread] plux.runtime.manager       : loading plugin localstack.hooks.on_infra_start:register_cloudformation_deploy_ui
2025-09-10T08:31:23.8014764Z  2025-09-10T08:29:48.550 DEBUG --- [  MainThread] plux.runtime.manager       : instantiating plugin PluginSpec(localstack.hooks.on_infra_start.register_custom_endpoints = <function register_custom_endpoints at 0x7fe224bde980>)
2025-09-10T08:31:23.8015810Z  2025-09-10T08:29:48.550 DEBUG --- [  MainThread] plux.runtime.manager       : loading plugin localstack.hooks.on_infra_start:register_custom_endpoints
2025-09-10T08:31:23.8016848Z  2025-09-10T08:29:48.550 DEBUG --- [  MainThread] plux.runtime.manager       : instantiating plugin PluginSpec(localstack.hooks.on_infra_start.register_swagger_endpoints = <function register_swagger_endpoints at 0x7fe2249284a0>)
2025-09-10T08:31:23.8017891Z  2025-09-10T08:29:48.550 DEBUG --- [  MainThread] plux.runtime.manager       : loading plugin localstack.hooks.on_infra_start:register_swagger_endpoints
2025-09-10T08:31:23.8019162Z  2025-09-10T08:29:48.550 DEBUG --- [  MainThread] plux.runtime.manager       : instantiating plugin PluginSpec(localstack.hooks.on_infra_start.setup_dns_configuration_on_host = <function setup_dns_configuration_on_host at 0x7fe2249287c0>)
2025-09-10T08:31:23.8020230Z  2025-09-10T08:29:48.550 DEBUG --- [  MainThread] plux.runtime.manager       : loading plugin localstack.hooks.on_infra_start:setup_dns_configuration_on_host
2025-09-10T08:31:23.8021218Z  2025-09-10T08:29:48.550 DEBUG --- [  MainThread] plux.runtime.manager       : instantiating plugin PluginSpec(localstack.hooks.on_infra_start.start_dns_server = <function start_dns_server at 0x7fe224928680>)
2025-09-10T08:31:23.8022280Z  2025-09-10T08:29:48.550 DEBUG --- [  MainThread] plux.runtime.manager       : loading plugin localstack.hooks.on_infra_start:start_dns_server
2025-09-10T08:31:23.8023256Z  2025-09-10T08:29:48.550 DEBUG --- [  MainThread] plux.runtime.manager       : instantiating plugin PluginSpec(localstack.hooks.on_infra_start.validate_configuration = <function validate_configuration at 0x7fe224bde840>)
2025-09-10T08:31:23.8024256Z  2025-09-10T08:29:48.550 DEBUG --- [  MainThread] plux.runtime.manager       : loading plugin localstack.hooks.on_infra_start:validate_configuration
2025-09-10T08:31:23.8024950Z  2025-09-10T08:29:48.633 DEBUG --- [  MainThread] localstack.dns.server      : Determined fallback dns: 127.0.0.11
2025-09-10T08:31:23.8025586Z  2025-09-10T08:29:48.633 DEBUG --- [  MainThread] localstack.dns.server      : Starting DNS servers (tcp/udp port 53 on 0.0.0.0)...
2025-09-10T08:31:23.8026294Z  2025-09-10T08:29:48.633 DEBUG --- [  MainThread] localstack.dns.server      : Adding host .*localhost.localstack.cloud pointing to LocalStack
2025-09-10T08:31:23.8027198Z  2025-09-10T08:29:48.633 DEBUG --- [  MainThread] localstack.dns.server      : Adding host .*localhost.localstack.cloud with record DynamicRecord(record_type=<RecordType.A: 1>, record_id=None)
2025-09-10T08:31:23.8028766Z  2025-09-10T08:29:48.633 DEBUG --- [  MainThread] localstack.dns.server      : Adding host .*localhost.localstack.cloud with record DynamicRecord(record_type=<RecordType.AAAA: 2>, record_id=None)
2025-09-10T08:31:23.8029781Z  2025-09-10T08:29:48.633 DEBUG --- [  MainThread] localstack.dns.server      : Adding host analytics-localhost.localstack.cloud pointing to LocalStack
2025-09-10T08:31:23.8030756Z  2025-09-10T08:29:48.633 DEBUG --- [  MainThread] localstack.dns.server      : Adding host analytics-localhost.localstack.cloud with record DynamicRecord(record_type=<RecordType.A: 1>, record_id=None)
2025-09-10T08:31:23.8031900Z  2025-09-10T08:29:48.633 DEBUG --- [  MainThread] localstack.dns.server      : Adding host analytics-localhost.localstack.cloud with record DynamicRecord(record_type=<RecordType.AAAA: 2>, record_id=None)
2025-09-10T08:31:23.8032912Z  2025-09-10T08:29:48.633 DEBUG --- [  MainThread] localstack.dns.server      : Adding host control-storage-localhost.localstack.cloud pointing to LocalStack
2025-09-10T08:31:23.8033926Z  2025-09-10T08:29:48.633 DEBUG --- [  MainThread] localstack.dns.server      : Adding host control-storage-localhost.localstack.cloud with record DynamicRecord(record_type=<RecordType.A: 1>, record_id=None)
2025-09-10T08:31:23.8035102Z  2025-09-10T08:29:48.633 DEBUG --- [  MainThread] localstack.dns.server      : Adding host control-storage-localhost.localstack.cloud with record DynamicRecord(record_type=<RecordType.AAAA: 2>, record_id=None)
2025-09-10T08:31:23.8036086Z  2025-09-10T08:29:48.633 DEBUG --- [  MainThread] localstack.dns.server      : Adding host data-localhost.localstack.cloud pointing to LocalStack
2025-09-10T08:31:23.8037009Z  2025-09-10T08:29:48.633 DEBUG --- [  MainThread] localstack.dns.server      : Adding host data-localhost.localstack.cloud with record DynamicRecord(record_type=<RecordType.A: 1>, record_id=None)
2025-09-10T08:31:23.8038313Z  2025-09-10T08:29:48.633 DEBUG --- [  MainThread] localstack.dns.server      : Adding host data-localhost.localstack.cloud with record DynamicRecord(record_type=<RecordType.AAAA: 2>, record_id=None)
2025-09-10T08:31:23.8039269Z  2025-09-10T08:29:48.634 DEBUG --- [  MainThread] localstack.dns.server      : Adding host query-localhost.localstack.cloud pointing to LocalStack
2025-09-10T08:31:23.8040197Z  2025-09-10T08:29:48.634 DEBUG --- [  MainThread] localstack.dns.server      : Adding host query-localhost.localstack.cloud with record DynamicRecord(record_type=<RecordType.A: 1>, record_id=None)
2025-09-10T08:31:23.8041285Z  2025-09-10T08:29:48.634 DEBUG --- [  MainThread] localstack.dns.server      : Adding host query-localhost.localstack.cloud with record DynamicRecord(record_type=<RecordType.AAAA: 2>, record_id=None)
2025-09-10T08:31:23.8042362Z  2025-09-10T08:29:48.634 DEBUG --- [  MainThread] localstack.dns.server      : Adding host runtime-localhost.localstack.cloud pointing to LocalStack
2025-09-10T08:31:23.8043308Z  2025-09-10T08:29:48.634 DEBUG --- [  MainThread] localstack.dns.server      : Adding host runtime-localhost.localstack.cloud with record DynamicRecord(record_type=<RecordType.A: 1>, record_id=None)
2025-09-10T08:31:23.8044421Z  2025-09-10T08:29:48.634 DEBUG --- [  MainThread] localstack.dns.server      : Adding host runtime-localhost.localstack.cloud with record DynamicRecord(record_type=<RecordType.AAAA: 2>, record_id=None)
2025-09-10T08:31:23.8045379Z  2025-09-10T08:29:48.634 DEBUG --- [  MainThread] localstack.dns.server      : Adding host storage-localhost.localstack.cloud pointing to LocalStack
2025-09-10T08:31:23.8046331Z  2025-09-10T08:29:48.634 DEBUG --- [  MainThread] localstack.dns.server      : Adding host storage-localhost.localstack.cloud with record DynamicRecord(record_type=<RecordType.A: 1>, record_id=None)
2025-09-10T08:31:23.8047442Z  2025-09-10T08:29:48.634 DEBUG --- [  MainThread] localstack.dns.server      : Adding host storage-localhost.localstack.cloud with record DynamicRecord(record_type=<RecordType.AAAA: 2>, record_id=None)
2025-09-10T08:31:23.8048576Z  2025-09-10T08:29:48.634 DEBUG --- [  MainThread] localstack.dns.server      : Adding host streaming-localhost.localstack.cloud pointing to LocalStack
2025-09-10T08:31:23.8049643Z  2025-09-10T08:29:48.634 DEBUG --- [  MainThread] localstack.dns.server      : Adding host streaming-localhost.localstack.cloud with record DynamicRecord(record_type=<RecordType.A: 1>, record_id=None)
2025-09-10T08:31:23.8050774Z  2025-09-10T08:29:48.634 DEBUG --- [  MainThread] localstack.dns.server      : Adding host streaming-localhost.localstack.cloud with record DynamicRecord(record_type=<RecordType.AAAA: 2>, record_id=None)
2025-09-10T08:31:23.8051737Z  2025-09-10T08:29:48.634 DEBUG --- [  MainThread] localstack.dns.server      : Adding host sync-localhost.localstack.cloud pointing to LocalStack
2025-09-10T08:31:23.8052659Z  2025-09-10T08:29:48.634 DEBUG --- [  MainThread] localstack.dns.server      : Adding host sync-localhost.localstack.cloud with record DynamicRecord(record_type=<RecordType.A: 1>, record_id=None)
2025-09-10T08:31:23.8053740Z  2025-09-10T08:29:48.634 DEBUG --- [  MainThread] localstack.dns.server      : Adding host sync-localhost.localstack.cloud with record DynamicRecord(record_type=<RecordType.AAAA: 2>, record_id=None)
2025-09-10T08:31:23.8054679Z  2025-09-10T08:29:48.634 DEBUG --- [  MainThread] localstack.dns.server      : Adding host tags-localhost.localstack.cloud pointing to LocalStack
2025-09-10T08:31:23.8055595Z  2025-09-10T08:29:48.634 DEBUG --- [  MainThread] localstack.dns.server      : Adding host tags-localhost.localstack.cloud with record DynamicRecord(record_type=<RecordType.A: 1>, record_id=None)
2025-09-10T08:31:23.8056673Z  2025-09-10T08:29:48.634 DEBUG --- [  MainThread] localstack.dns.server      : Adding host tags-localhost.localstack.cloud with record DynamicRecord(record_type=<RecordType.AAAA: 2>, record_id=None)
2025-09-10T08:31:23.8057632Z  2025-09-10T08:29:48.634 DEBUG --- [  MainThread] localstack.dns.server      : Adding host workflows-localhost.localstack.cloud pointing to LocalStack
2025-09-10T08:31:23.8058820Z  2025-09-10T08:29:48.634 DEBUG --- [  MainThread] localstack.dns.server      : Adding host workflows-localhost.localstack.cloud with record DynamicRecord(record_type=<RecordType.A: 1>, record_id=None)
2025-09-10T08:31:23.8059946Z  2025-09-10T08:29:48.634 DEBUG --- [  MainThread] localstack.dns.server      : Adding host workflows-localhost.localstack.cloud with record DynamicRecord(record_type=<RecordType.AAAA: 2>, record_id=None)
2025-09-10T08:31:23.8060778Z  2025-09-10T08:29:48.635 DEBUG --- [-functhread1] localstack.dns.server      : DNS Server started
2025-09-10T08:31:23.8061331Z  2025-09-10T08:29:48.639 DEBUG --- [  MainThread] localstack.dns.server      : DNS server startup finished.
2025-09-10T08:31:23.8062629Z  2025-09-10T08:29:48.640 DEBUG --- [-functhread2] l.u.c.docker_sdk_client    : Creating Docker SDK client failed: Error while fetching server API version: ('Connection aborted.', FileNotFoundError(2, 'No such file or directory')). If you want to use Docker as container runtime, make sure to mount the socket at /var/run/docker.sock
2025-09-10T08:31:23.8063916Z  2025-09-10T08:29:48.640 DEBUG --- [  MainThread] localstack.runtime.init    : Init scripts discovered: {BOOT: [], START: [], READY: [], SHUTDOWN: []}
2025-09-10T08:31:23.8064702Z  2025-09-10T08:29:48.641 DEBUG --- [  MainThread] localstack.plugins         : Checking for the usage of deprecated community features and configs...
2025-09-10T08:31:23.8065914Z  2025-09-10T08:29:48.641  WARN --- [  MainThread] localstack.deprecations    : DEFAULT_REGION is deprecated (since 0.12.7) and will be removed in upcoming releases of LocalStack! LocalStack now has full multi-region support. This option has no effect. Please remove it from your configuration.
2025-09-10T08:31:23.8067627Z  2025-09-10T08:29:48.643 DEBUG --- [-functhread2] l.u.c.docker_sdk_client    : Creating Docker SDK client failed: Error while fetching server API version: ('Connection aborted.', FileNotFoundError(2, 'No such file or directory')). If you want to use Docker as container runtime, make sure to mount the socket at /var/run/docker.sock
2025-09-10T08:31:23.8069180Z  2025-09-10T08:29:48.652 DEBUG --- [  MainThread] localstack.dns.server      : Overwriting container DNS server to point to localhost
2025-09-10T08:31:23.8069880Z  2025-09-10T08:29:48.653 DEBUG --- [  MainThread] localstack.utils.ssl       : Attempting to download local SSL certificate file
2025-09-10T08:31:23.8070519Z  2025-09-10T08:29:48.826 DEBUG --- [  MainThread] localstack.utils.ssl       : SSL certificate downloaded successfully
2025-09-10T08:31:23.8071479Z  2025-09-10T08:29:48.827 DEBUG --- [  MainThread] plux.runtime.manager       : instantiating plugin PluginSpec(localstack.runtime.server.twisted = <class 'localstack.runtime.server.plugins.TwistedRuntimeServerPlugin'>)
2025-09-10T08:31:23.8072473Z  2025-09-10T08:29:48.827 DEBUG --- [  MainThread] plux.runtime.manager       : loading plugin localstack.runtime.server:twisted
2025-09-10T08:31:23.8073434Z  2025-09-10T08:29:48.947 DEBUG --- [ady_monitor)] plux.runtime.manager       : instantiating plugin PluginSpec(localstack.hooks.on_infra_ready._run_init_scripts_on_ready = <function _run_init_scripts_on_ready at 0x7fe224cbf240>)
2025-09-10T08:31:23.8074456Z  2025-09-10T08:29:48.947 DEBUG --- [ady_monitor)] plux.runtime.manager       : loading plugin localstack.hooks.on_infra_ready:_run_init_scripts_on_ready
2025-09-10T08:31:23.8075500Z  2025-09-10T08:29:48.947 DEBUG --- [ady_monitor)] plux.runtime.manager       : instantiating plugin PluginSpec(localstack.hooks.on_infra_ready.publish_provider_assignment = <function publish_provider_assignment at 0x7fe212d10cc0>)
2025-09-10T08:31:23.8076552Z  2025-09-10T08:29:48.947 DEBUG --- [ady_monitor)] plux.runtime.manager       : loading plugin localstack.hooks.on_infra_ready:publish_provider_assignment
2025-09-10T08:31:23.8077074Z  Ready.
2025-09-10T08:31:23.8077600Z  2025-09-10T08:30:33.916 DEBUG --- [et.reactor-0] localstack.aws.spec        : loading service catalog index cache file /usr/lib/localstack/service-catalog-4_7_1_dev140-1_40_25.dill
2025-09-10T08:31:23.8078653Z  2025-09-10T08:30:34.029 DEBUG --- [et.reactor-0] l.aws.handlers.service     : no service set in context, skipping request parsing
2025-09-10T08:31:23.8079233Z  2025-09-10T08:30:34.029  INFO --- [et.reactor-0] localstack.request.http    : GET / => 200
2025-09-10T08:31:23.8079962Z  2025-09-10T08:30:34.091 DEBUG --- [et.reactor-0] plux.runtime.manager       : instantiating plugin PluginSpec(localstack.aws.provider.s3:default = <function s3 at 0x7fe212d347c0>)
2025-09-10T08:31:23.8080783Z  2025-09-10T08:30:34.092 DEBUG --- [et.reactor-0] plux.runtime.manager       : loading plugin localstack.aws.provider:s3:default
2025-09-10T08:31:23.8081383Z  2025-09-10T08:30:34.402  INFO --- [et.reactor-0] localstack.request.aws     : AWS s3.CreateBucket => 200
2025-09-10T08:31:23.8082047Z  2025-09-10T08:30:34.417  INFO --- [et.reactor-0] localstack.request.aws     : AWS s3.PutBucketCors => 200
2025-09-10T08:31:23.8082581Z  2025-09-10T08:30:34.426  INFO --- [et.reactor-0] localstack.request.aws     : AWS s3.ListBuckets => 200
2025-09-10T08:31:23.8083109Z  2025-09-10T08:30:34.439  INFO --- [et.reactor-0] localstack.request.aws     : AWS s3.PutBucketCors => 200
2025-09-10T08:31:23.8084235Z Stop and remove container: f73d8c708e4043b0bd7a54c71649e65a_localstacklocalstacklatest_1ba29c
2025-09-10T08:31:23.8084965Z ##[command]/usr/bin/docker rm --force cf2411009a9b5b7c8a72ad0c8e2b62ddd492d94af1e06971cb43de553307fd28
2025-09-10T08:31:23.9686447Z cf2411009a9b5b7c8a72ad0c8e2b62ddd492d94af1e06971cb43de553307fd28
2025-09-10T08:31:23.9707814Z Remove container network: github_network_aa2edaaa637e473c89f2582ba465e42a
2025-09-10T08:31:23.9712517Z ##[command]/usr/bin/docker network rm github_network_aa2edaaa637e473c89f2582ba465e42a
2025-09-10T08:31:24.0873516Z github_network_aa2edaaa637e473c89f2582ba465e42a
2025-09-10T08:31:24.0929192Z Cleaning up orphan processes